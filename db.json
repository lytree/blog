{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/img/avatar.jpg","path":"img/avatar.jpg","modified":0,"renderable":0},{"_id":"source/assets/0b6fcecfe53184140bb4005dd0eab836-20230127151311-0gha64i.png","path":"assets/0b6fcecfe53184140bb4005dd0eab836-20230127151311-0gha64i.png","modified":0,"renderable":0},{"_id":"source/assets/20200809110444386-20230127151311-z1qxdzv.png","path":"assets/20200809110444386-20230127151311-z1qxdzv.png","modified":0,"renderable":0},{"_id":"source/assets/20210417191156743-20230127151311-j5awou3.png","path":"assets/20210417191156743-20230127151311-j5awou3.png","modified":0,"renderable":0},{"_id":"source/assets/20210417191226786-20230127151312-304h995.png","path":"assets/20210417191226786-20230127151312-304h995.png","modified":0,"renderable":0},{"_id":"source/assets/20210417191245920-20230127151311-nf45pi0.png","path":"assets/20210417191245920-20230127151311-nf45pi0.png","modified":0,"renderable":0},{"_id":"source/assets/20210417191255980-20230127151311-y6imh9a.png","path":"assets/20210417191255980-20230127151311-y6imh9a.png","modified":0,"renderable":0},{"_id":"source/assets/20210417191320754-20230127151312-g8jrdjp.png","path":"assets/20210417191320754-20230127151312-g8jrdjp.png","modified":0,"renderable":0},{"_id":"source/assets/2d694736eb7778a548cdcb8189d6e226-20230127151312-riapszh.png","path":"assets/2d694736eb7778a548cdcb8189d6e226-20230127151312-riapszh.png","modified":0,"renderable":0},{"_id":"source/assets/327dcba48317d39b2cd0ee081d4e3fdc-20230127151312-4qigjlr.png","path":"assets/327dcba48317d39b2cd0ee081d4e3fdc-20230127151312-4qigjlr.png","modified":0,"renderable":0},{"_id":"source/assets/2edff9c3d5cb698abb0e62d720ad704b-20230127151311-dy2b8hg.png","path":"assets/2edff9c3d5cb698abb0e62d720ad704b-20230127151311-dy2b8hg.png","modified":0,"renderable":0},{"_id":"source/assets/39c6a500cefa6e29150c1295d3e152d1-20230127151312-5z7fqgr.png","path":"assets/39c6a500cefa6e29150c1295d3e152d1-20230127151312-5z7fqgr.png","modified":0,"renderable":0},{"_id":"source/assets/3fdc14e6be9f37b481abe633ac866a26-20230127151312-ko7ta8u.png","path":"assets/3fdc14e6be9f37b481abe633ac866a26-20230127151312-ko7ta8u.png","modified":0,"renderable":0},{"_id":"source/assets/640-20230404215050-p95bson.png","path":"assets/640-20230404215050-p95bson.png","modified":0,"renderable":0},{"_id":"source/assets/410360b70936d286a4df4ab2c11f28ad-20230127151311-j96gr8d.png","path":"assets/410360b70936d286a4df4ab2c11f28ad-20230127151311-j96gr8d.png","modified":0,"renderable":0},{"_id":"source/assets/640-20230404215050-qd8x4fd.png","path":"assets/640-20230404215050-qd8x4fd.png","modified":0,"renderable":0},{"_id":"source/assets/640-20230404215051-hnbb7ug.png","path":"assets/640-20230404215051-hnbb7ug.png","modified":0,"renderable":0},{"_id":"source/assets/640-20230404215051-lu967n5.png","path":"assets/640-20230404215051-lu967n5.png","modified":0,"renderable":0},{"_id":"source/assets/640-20230404215051-nrxnl0j.png","path":"assets/640-20230404215051-nrxnl0j.png","modified":0,"renderable":0},{"_id":"source/assets/640-20230404215051-pdghyi7.png","path":"assets/640-20230404215051-pdghyi7.png","modified":0,"renderable":0},{"_id":"source/assets/640-20230404215051-rx0ju25.png","path":"assets/640-20230404215051-rx0ju25.png","modified":0,"renderable":0},{"_id":"source/assets/6c916769e7f2450157bce49ea9438c10-20230127151312-x7ufhrj.png","path":"assets/6c916769e7f2450157bce49ea9438c10-20230127151312-x7ufhrj.png","modified":0,"renderable":0},{"_id":"source/assets/704e3015827edff48d6c84777aa28006-20230127151312-jonjh5w.png","path":"assets/704e3015827edff48d6c84777aa28006-20230127151312-jonjh5w.png","modified":0,"renderable":0},{"_id":"source/assets/83f121c9c340db46f955badf876220b2-20230127151311-j2wtijc.png","path":"assets/83f121c9c340db46f955badf876220b2-20230127151311-j2wtijc.png","modified":0,"renderable":0},{"_id":"source/assets/a0d8c504b2c17abbfb8eb40bc4d86d79-20230127151311-0azix9f.png","path":"assets/a0d8c504b2c17abbfb8eb40bc4d86d79-20230127151311-0azix9f.png","modified":0,"renderable":0},{"_id":"source/assets/b5e5ca9c35421192e7f02864c4fb30bb-20230127151311-iwgg2ln.png","path":"assets/b5e5ca9c35421192e7f02864c4fb30bb-20230127151311-iwgg2ln.png","modified":0,"renderable":0},{"_id":"source/assets/c2d8c43d5c018eb584586ad5857fbbf4-20230127151311-ml2ddae.png","path":"assets/c2d8c43d5c018eb584586ad5857fbbf4-20230127151311-ml2ddae.png","modified":0,"renderable":0},{"_id":"source/assets/da55da191ca558b60531e3a6b6ce5267-20230127151311-wiqzfgo.png","path":"assets/da55da191ca558b60531e3a6b6ce5267-20230127151311-wiqzfgo.png","modified":0,"renderable":0},{"_id":"source/assets/dubbo-export-20221214214601-bb3rzp9.jpg","path":"assets/dubbo-export-20221214214601-bb3rzp9.jpg","modified":0,"renderable":0},{"_id":"source/assets/dubbo-extension-20221214214601-56szafs.jpg","path":"assets/dubbo-extension-20221214214601-56szafs.jpg","modified":0,"renderable":0},{"_id":"source/assets/dubbo-framework-20221214214602-6xcgoty.jpg","path":"assets/dubbo-framework-20221214214602-6xcgoty.jpg","modified":0,"renderable":0},{"_id":"source/assets/dubbo-modules-20221214214601-dcxfz3a.jpg","path":"assets/dubbo-modules-20221214214601-dcxfz3a.jpg","modified":0,"renderable":0},{"_id":"source/assets/dubbo-refer-20221214214601-20gbi94.jpg","path":"assets/dubbo-refer-20221214214601-20gbi94.jpg","modified":0,"renderable":0},{"_id":"source/assets/dubbo-relation-20221214214601-7hb77fv.jpg","path":"assets/dubbo-relation-20221214214601-7hb77fv.jpg","modified":0,"renderable":0},{"_id":"source/assets/f0b471f40aa64279914a3acbd6e2913b-20230127151312-khh42zb.png","path":"assets/f0b471f40aa64279914a3acbd6e2913b-20230127151312-khh42zb.png","modified":0,"renderable":0},{"_id":"source/assets/ff614ca7c83414c712848a25b23e6a91-20230127151312-slrk125.png","path":"assets/ff614ca7c83414c712848a25b23e6a91-20230127151312-slrk125.png","modified":0,"renderable":0},{"_id":"source/assets/image-20221212232058-z1xl373.png","path":"assets/image-20221212232058-z1xl373.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-0kn4aj5.png","path":"assets/image-20230218230318-0kn4aj5.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-31t0a0v.png","path":"assets/image-20230218230318-31t0a0v.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-cknlz85.png","path":"assets/image-20230218230318-cknlz85.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-i0g5orx.png","path":"assets/image-20230218230318-i0g5orx.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-nedvesv.png","path":"assets/image-20230218230318-nedvesv.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-t4i4y3l.png","path":"assets/image-20230218230318-t4i4y3l.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-t9tvsgp.png","path":"assets/image-20230218230318-t9tvsgp.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-w95qpr6.png","path":"assets/image-20230218230318-w95qpr6.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-ybffha3.png","path":"assets/image-20230218230318-ybffha3.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-ye9g47h.png","path":"assets/image-20230218230318-ye9g47h.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230218230318-ypt4n3t.png","path":"assets/image-20230218230318-ypt4n3t.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230423172026-j99710c.png","path":"assets/image-20230423172026-j99710c.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230424141422-t5zbclo.png","path":"assets/image-20230424141422-t5zbclo.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230503214900-rmo1ydd.png","path":"assets/image-20230503214900-rmo1ydd.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230505215709-q6pir67.png","path":"assets/image-20230505215709-q6pir67.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230519215732-zz9jpqo.png","path":"assets/image-20230519215732-zz9jpqo.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230527140729-waan312.png","path":"assets/image-20230527140729-waan312.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230527154724-v674duu.png","path":"assets/image-20230527154724-v674duu.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230619222624-l98xjgi.png","path":"assets/image-20230619222624-l98xjgi.png","modified":0,"renderable":0},{"_id":"source/assets/image-20230619222818-5btwdt3.png","path":"assets/image-20230619222818-5btwdt3.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231117162020-0zic8ee.png","path":"assets/image-20231117162020-0zic8ee.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231117162030-ue9pyz9.png","path":"assets/image-20231117162030-ue9pyz9.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231117164621-qjdsktw.png","path":"assets/image-20231117164621-qjdsktw.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231119124040-5kytmcz.png","path":"assets/image-20231119124040-5kytmcz.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231119124137-6apottn.png","path":"assets/image-20231119124137-6apottn.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231119124615-vxa33dm.png","path":"assets/image-20231119124615-vxa33dm.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231119154230-3g5nidd.png","path":"assets/image-20231119154230-3g5nidd.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231119154304-hwfdw8h.jpeg","path":"assets/image-20231119154304-hwfdw8h.jpeg","modified":0,"renderable":0},{"_id":"source/assets/image-20231126145713-0pou43f.png","path":"assets/image-20231126145713-0pou43f.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231126155909-4zbslm1.png","path":"assets/image-20231126155909-4zbslm1.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231126161709-b35di3t.png","path":"assets/image-20231126161709-b35di3t.png","modified":0,"renderable":0},{"_id":"source/assets/image-20231202123415-e2licnx.jpeg","path":"assets/image-20231202123415-e2licnx.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-0002-20230327194009-43b76u4.png","path":"assets/net-img-0002-20230327194009-43b76u4.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-0004-20230327194009-xusl7vj.png","path":"assets/net-img-0004-20230327194009-xusl7vj.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-0005-20230327194009-2m11zb7.png","path":"assets/net-img-0005-20230327194009-2m11zb7.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-0006-20230327194009-rdpidiy.png","path":"assets/net-img-0006-20230327194009-rdpidiy.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-0008-20230327194010-vj80p08.jpg","path":"assets/net-img-0008-20230327194010-vj80p08.jpg","modified":0,"renderable":0},{"_id":"source/assets/net-img-0009-20230327193706-lo1au43.jpg","path":"assets/net-img-0009-20230327193706-lo1au43.jpg","modified":0,"renderable":0},{"_id":"source/assets/net-img-0007-20230327194009-obwi5jv.png","path":"assets/net-img-0007-20230327194009-obwi5jv.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-0010-20230327194235-781jk47.png","path":"assets/net-img-0010-20230327194235-781jk47.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-0011-20230327194235-6us5fo3.png","path":"assets/net-img-0011-20230327194235-6us5fo3.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-0012-20230327194235-dpf6how.png","path":"assets/net-img-0012-20230327194235-dpf6how.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873055902-03de6700-dcb1-42a8-927e-af658b90b6b0-20230330213228-vjyh5tl.png","path":"assets/net-img-1582873055902-03de6700-dcb1-42a8-927e-af658b90b6b0-20230330213228-vjyh5tl.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873072467-a61dd6d9-f02a-4653-bcff-eeb592deaf68-20230330213234-ppelol3.png","path":"assets/net-img-1582873072467-a61dd6d9-f02a-4653-bcff-eeb592deaf68-20230330213234-ppelol3.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873090325-a7683e68-a46d-418f-bba5-0bd6c8c7575b-20230330213237-ldsjgn2.webp","path":"assets/net-img-1582873090325-a7683e68-a46d-418f-bba5-0bd6c8c7575b-20230330213237-ldsjgn2.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873104499-77f0b1b3-a218-4cc7-9cd1-c5ab317f53ce-20230330213239-aq0b92g.png","path":"assets/net-img-1582873104499-77f0b1b3-a218-4cc7-9cd1-c5ab317f53ce-20230330213239-aq0b92g.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873144333-18753191-d8b2-47e1-a610-33c7c552fdaa-20230330213217-uigw9ix.png","path":"assets/net-img-1582873144333-18753191-d8b2-47e1-a610-33c7c552fdaa-20230330213217-uigw9ix.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873156123-9f655847-4b5d-4c84-8116-ede849af16e3-20230330213218-q1lh95h.png","path":"assets/net-img-1582873156123-9f655847-4b5d-4c84-8116-ede849af16e3-20230330213218-q1lh95h.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873335047-0818927f-77de-4ad8-aa95-fb7d537f6700-20230330213215-9u0gs7n.webp","path":"assets/net-img-1582873335047-0818927f-77de-4ad8-aa95-fb7d537f6700-20230330213215-9u0gs7n.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873408415-b3e28487-6473-4fff-b4c9-b99b6b91a53a-20230330213216-4pmp0ac.webp","path":"assets/net-img-1582873408415-b3e28487-6473-4fff-b4c9-b99b6b91a53a-20230330213216-4pmp0ac.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873416741-a71a0d28-b66d-49ca-8487-c0e0ceaa704c-20230330213216-jddkbfu.webp","path":"assets/net-img-1582873416741-a71a0d28-b66d-49ca-8487-c0e0ceaa704c-20230330213216-jddkbfu.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873565810-556fde0f-9973-46d5-9e8e-4853e80b6ba3-20230330213302-b5p12uc.png","path":"assets/net-img-1582873565810-556fde0f-9973-46d5-9e8e-4853e80b6ba3-20230330213302-b5p12uc.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873583782-b5959bc6-9ff9-4ef1-95b3-9bc3fc1f83b9-20230330213307-m55wdql.png","path":"assets/net-img-1582873583782-b5959bc6-9ff9-4ef1-95b3-9bc3fc1f83b9-20230330213307-m55wdql.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873589321-1b21962d-3411-4d4f-af00-b2a82490e43c-20230330213311-i7hquya.png","path":"assets/net-img-1582873589321-1b21962d-3411-4d4f-af00-b2a82490e43c-20230330213311-i7hquya.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873594959-8501a655-dbe2-4983-9dcd-a33bde8f07f6-20230330213317-uu5k36v.png","path":"assets/net-img-1582873594959-8501a655-dbe2-4983-9dcd-a33bde8f07f6-20230330213317-uu5k36v.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873601269-c3ee8a62-7c38-4751-8cff-f60ddc262d41-20230330213313-8vw56oe.png","path":"assets/net-img-1582873601269-c3ee8a62-7c38-4751-8cff-f60ddc262d41-20230330213313-8vw56oe.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873690823-e85d7b31-4173-4adc-b4b4-92f314fd952b-20230330213322-ngp5u86.webp","path":"assets/net-img-1582873690823-e85d7b31-4173-4adc-b4b4-92f314fd952b-20230330213322-ngp5u86.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873927778-b80fd046-98af-4768-bfc1-6d59761271e2-20230330213325-w0s4a7u.png","path":"assets/net-img-1582873927778-b80fd046-98af-4768-bfc1-6d59761271e2-20230330213325-w0s4a7u.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873928532-40dd13b8-87fb-4ecd-8e07-399dbc61eeb8-20230330213331-q75g2s7.png","path":"assets/net-img-1582873928532-40dd13b8-87fb-4ecd-8e07-399dbc61eeb8-20230330213331-q75g2s7.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582873954652-cd9e9eab-021c-4792-9558-291d9ec5d743-20230330213333-aijfe0m.png","path":"assets/net-img-1582873954652-cd9e9eab-021c-4792-9558-291d9ec5d743-20230330213333-aijfe0m.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874001071-2fe5ab73-14e5-45aa-b07c-81ba0fecc256-20230330213404-cm5njiz.png","path":"assets/net-img-1582874001071-2fe5ab73-14e5-45aa-b07c-81ba0fecc256-20230330213404-cm5njiz.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874136797-a333d011-4325-4f7c-82f6-9792216b1a21-20230330213157-i9zy78v.webp","path":"assets/net-img-1582874136797-a333d011-4325-4f7c-82f6-9792216b1a21-20230330213157-i9zy78v.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874168420-5865fe9a-fe6d-49b5-961a-2addc05fce6a-20230330213157-z8hfg9r.webp","path":"assets/net-img-1582874168420-5865fe9a-fe6d-49b5-961a-2addc05fce6a-20230330213157-z8hfg9r.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874168964-bb84b249-5332-4a93-b161-842b2e6955ed-20230330213157-wrr6xqk.webp","path":"assets/net-img-1582874168964-bb84b249-5332-4a93-b161-842b2e6955ed-20230330213157-wrr6xqk.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874243939-2eae4163-881d-47f6-b75d-18c057db48ef-20230330213158-setmh7t.webp","path":"assets/net-img-1582874243939-2eae4163-881d-47f6-b75d-18c057db48ef-20230330213158-setmh7t.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874263210-a9e7bda6-4ed7-4d2d-8991-cdad8a2c292b-20230330213158-fukp6eb.png","path":"assets/net-img-1582874263210-a9e7bda6-4ed7-4d2d-8991-cdad8a2c292b-20230330213158-fukp6eb.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874272168-5169d4d6-17f9-493d-b99b-c9a678dd13da-20230330213159-jscv9ip.webp","path":"assets/net-img-1582874272168-5169d4d6-17f9-493d-b99b-c9a678dd13da-20230330213159-jscv9ip.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874279332-65260fd7-5a39-4fd1-85b8-86729cc9982c-20230330213159-yohdmn5.webp","path":"assets/net-img-1582874279332-65260fd7-5a39-4fd1-85b8-86729cc9982c-20230330213159-yohdmn5.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874334522-3936dfde-ef4a-4cf9-ab86-6001429fbb86-20230330213343-txdiivw.jpeg","path":"assets/net-img-1582874334522-3936dfde-ef4a-4cf9-ab86-6001429fbb86-20230330213343-txdiivw.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582874350036-1fb8d7cf-688f-4628-ae77-9a21de7c4d2e-20230330213346-aj91hqy.png","path":"assets/net-img-1582874350036-1fb8d7cf-688f-4628-ae77-9a21de7c4d2e-20230330213346-aj91hqy.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875290415-c052f229-8c31-4560-acef-300acae2409b-20221030135515-tme9bzx.png","path":"assets/net-img-1582875290415-c052f229-8c31-4560-acef-300acae2409b-20221030135515-tme9bzx.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875326094-cb5a96e7-e4c2-421d-83cf-216ca4f7f024-20221030135516-5igfhr6.png","path":"assets/net-img-1582875326094-cb5a96e7-e4c2-421d-83cf-216ca4f7f024-20221030135516-5igfhr6.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875326657-55738037-28bf-4de9-925a-f08034e0c722-20221030135516-j4ktjne.png","path":"assets/net-img-1582875326657-55738037-28bf-4de9-925a-f08034e0c722-20221030135516-j4ktjne.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875381841-0104c814-acd3-4ef3-a3bd-f5331d9a06bc-20221030135516-0716ftg.png","path":"assets/net-img-1582875381841-0104c814-acd3-4ef3-a3bd-f5331d9a06bc-20221030135516-0716ftg.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875390665-923c52b9-52ce-4e6f-9cee-763046546af3-20221030135517-j4zeqi7.png","path":"assets/net-img-1582875390665-923c52b9-52ce-4e6f-9cee-763046546af3-20221030135517-j4zeqi7.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png","path":"assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875452927-44c67a88-5cee-48b1-a764-a26d40a77538-20221030135540-f7dfpln.png","path":"assets/net-img-1582875452927-44c67a88-5cee-48b1-a764-a26d40a77538-20221030135540-f7dfpln.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875462202-61de3608-d606-44f6-b8d0-c82da3a7acd8-20221030135541-a1152vd.png","path":"assets/net-img-1582875462202-61de3608-d606-44f6-b8d0-c82da3a7acd8-20221030135541-a1152vd.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875470139-ea71ffbe-3cbd-44d8-8560-1e72b3a4bab4-20221030135541-hkuw6hs.png","path":"assets/net-img-1582875470139-ea71ffbe-3cbd-44d8-8560-1e72b3a4bab4-20221030135541-hkuw6hs.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875478351-18a69ed7-cb09-4a5a-a020-097490219718-20221030135517-0h9pq4n.png","path":"assets/net-img-1582875478351-18a69ed7-cb09-4a5a-a020-097490219718-20221030135517-0h9pq4n.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875574292-5a9c3846-0673-451f-8a69-409c0c8dff9c-20221030103933-qh2ia8u.png","path":"assets/net-img-1582875574292-5a9c3846-0673-451f-8a69-409c0c8dff9c-20221030103933-qh2ia8u.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1582875605484-a8880998-f9be-42d5-9997-a1c908ca05a9-20221030103933-jzsw591.webp","path":"assets/net-img-1582875605484-a8880998-f9be-42d5-9997-a1c908ca05a9-20221030103933-jzsw591.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1591690708309-b6db1e95-1bbf-4140-b612-26fefc8d85b5-20221030132327-6s3ed7l.png","path":"assets/net-img-1591690708309-b6db1e95-1bbf-4140-b612-26fefc8d85b5-20221030132327-6s3ed7l.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1591690708399-bf1076aa-bdad-4e5f-ae30-261ccda91da5-20221030132327-4fweook.png","path":"assets/net-img-1591690708399-bf1076aa-bdad-4e5f-ae30-261ccda91da5-20221030132327-4fweook.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1591690708492-8b43720d-e8dc-4e22-9057-dcc4be2210de-20221030132325-ac88yvu.jpeg","path":"assets/net-img-1591690708492-8b43720d-e8dc-4e22-9057-dcc4be2210de-20221030132325-ac88yvu.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1591690708909-03b304db-aa14-40fc-954b-2e5812e31b86-20221030132326-7iwfv9t.png","path":"assets/net-img-1591690708909-03b304db-aa14-40fc-954b-2e5812e31b86-20221030132326-7iwfv9t.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1591690908749-8d13658b-f28f-4a16-9787-5d802366b2bb-20221030132339-jhzqts2.png","path":"assets/net-img-1591690908749-8d13658b-f28f-4a16-9787-5d802366b2bb-20221030132339-jhzqts2.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1592902119376-b0ab487a-f7f3-454f-a784-aad737462ad4-20230330213502-h755rwl.png","path":"assets/net-img-1592902119376-b0ab487a-f7f3-454f-a784-aad737462ad4-20230330213502-h755rwl.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1592902119321-dda9e910-093f-47bf-890e-4719cb145075-20230527145229-565b500.png","path":"assets/net-img-1592902119321-dda9e910-093f-47bf-890e-4719cb145075-20230527145229-565b500.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1592902119376-b0ab487a-f7f3-454f-a784-aad737462ad4-20230527145229-vu7qxs4.png","path":"assets/net-img-1592902119376-b0ab487a-f7f3-454f-a784-aad737462ad4-20230527145229-vu7qxs4.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1592902120990-cffe2ea4-a4ed-4505-8bbd-c9b64730ae6e-20230527145229-4455z5v.png","path":"assets/net-img-1592902120990-cffe2ea4-a4ed-4505-8bbd-c9b64730ae6e-20230527145229-4455z5v.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593008781064-94397bdb-4bd4-475a-b0de-25689df5598d-20230330213216-bqv0b3r.jpeg","path":"assets/net-img-1593008781064-94397bdb-4bd4-475a-b0de-25689df5598d-20230330213216-bqv0b3r.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593008911203-7a81af80-db8b-4843-a59a-755e226e2314-20230330213217-h350tsl.jpeg","path":"assets/net-img-1593008911203-7a81af80-db8b-4843-a59a-755e226e2314-20230330213217-h350tsl.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593009574123-1720bb9a-11ab-462c-9acc-83dfd40a63e3-20230330213217-8hneydr.jpeg","path":"assets/net-img-1593009574123-1720bb9a-11ab-462c-9acc-83dfd40a63e3-20230330213217-8hneydr.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593010056655-793ce18b-c4e9-4985-9ba7-ef5347134e12-20230330213219-q7hvhww.png","path":"assets/net-img-1593010056655-793ce18b-c4e9-4985-9ba7-ef5347134e12-20230330213219-q7hvhww.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593010032163-e4fd6098-299b-4fac-adb3-b40e6ca3e534-20230330213218-jvzy0d2.png","path":"assets/net-img-1593010032163-e4fd6098-299b-4fac-adb3-b40e6ca3e534-20230330213218-jvzy0d2.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593075294735-276336e9-41de-469d-a9e8-b4806bbdc0e9-20230330213341-wrzblbs.png","path":"assets/net-img-1593075294735-276336e9-41de-469d-a9e8-b4806bbdc0e9-20230330213341-wrzblbs.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593075259316-cba6509a-9a9a-4282-8698-99fa1fcc0794-20230330213350-b5wkbl5.png","path":"assets/net-img-1593075259316-cba6509a-9a9a-4282-8698-99fa1fcc0794-20230330213350-b5wkbl5.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593075298003-cebf8380-65e8-4a56-9a03-72d7f02ef65c-20230330213346-itjo56n.png","path":"assets/net-img-1593075298003-cebf8380-65e8-4a56-9a03-72d7f02ef65c-20230330213346-itjo56n.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593075308254-c4ace563-ded0-42d8-8a4c-435a8bbe890f-20230330213356-yp75ww5.png","path":"assets/net-img-1593075308254-c4ace563-ded0-42d8-8a4c-435a8bbe890f-20230330213356-yp75ww5.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593075466359-4fe25412-ad7b-4d12-ab59-556c6203aec3-20230330213411-owuofo8.png","path":"assets/net-img-1593075466359-4fe25412-ad7b-4d12-ab59-556c6203aec3-20230330213411-owuofo8.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593075485480-eabde977-18f7-4a38-9f43-2a2792d14d5a-20230330213419-xbq6pfl.png","path":"assets/net-img-1593075485480-eabde977-18f7-4a38-9f43-2a2792d14d5a-20230330213419-xbq6pfl.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593075510764-fa7e6f63-dbec-4789-a374-d8b319f98994-20230330213428-853fmb5.png","path":"assets/net-img-1593075510764-fa7e6f63-dbec-4789-a374-d8b319f98994-20230330213428-853fmb5.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593076022539-0b41a928-a33d-4749-8e05-a629389f5b11-20230330213208-977tliz.png","path":"assets/net-img-1593076022539-0b41a928-a33d-4749-8e05-a629389f5b11-20230330213208-977tliz.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593076049581-f084ed7e-111c-4a99-944b-bb4aadb0f33b-20230330213209-kp1deud.png","path":"assets/net-img-1593076049581-f084ed7e-111c-4a99-944b-bb4aadb0f33b-20230330213209-kp1deud.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593076060148-a751342f-828e-49f2-a853-47b276d0fc68-20230330213209-k1w1si6.png","path":"assets/net-img-1593076060148-a751342f-828e-49f2-a853-47b276d0fc68-20230330213209-k1w1si6.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593076076024-42ad7f21-eb2c-4c6b-8c34-802819b1fd8f-20230330213209-f5hjado.png","path":"assets/net-img-1593076076024-42ad7f21-eb2c-4c6b-8c34-802819b1fd8f-20230330213209-f5hjado.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593076140792-4ab064fd-2370-4f64-a89e-6d7fc5bb9f39-20230330213209-drma95r.png","path":"assets/net-img-1593076140792-4ab064fd-2370-4f64-a89e-6d7fc5bb9f39-20230330213209-drma95r.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1593854466438-89baf576-0e30-4db7-934e-2781413c9510-20221030140124-w8acjeh.png","path":"assets/net-img-1593854466438-89baf576-0e30-4db7-934e-2781413c9510-20221030140124-w8acjeh.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1596005642573-853dc49e-7632-496d-9221-33e3b7879fea-20221030132325-84wdxkw.jpeg","path":"assets/net-img-1596005642573-853dc49e-7632-496d-9221-33e3b7879fea-20221030132325-84wdxkw.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1596361953803-ed588642-562c-49e8-99dd-cdc0e81519b7-20230426150127-crjga75.png","path":"assets/net-img-1596361953803-ed588642-562c-49e8-99dd-cdc0e81519b7-20230426150127-crjga75.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1596249786159-92610d33-5cbb-4d46-b7a5-6f1c8d3d1d92-20221030135516-9i6hh1r.jpeg","path":"assets/net-img-1596249786159-92610d33-5cbb-4d46-b7a5-6f1c8d3d1d92-20221030135516-9i6hh1r.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1596362023744-7f76e71b-8cd9-4797-87f7-bccdb93fbb3a-20221030140106-k1plvtd.jpeg","path":"assets/net-img-1596362023744-7f76e71b-8cd9-4797-87f7-bccdb93fbb3a-20221030140106-k1plvtd.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1596783175795-a3a09f05-cdc6-4406-9b0a-0f3f6a28a5ff-20221030105031-64rpjno.jpeg","path":"assets/net-img-1596783175795-a3a09f05-cdc6-4406-9b0a-0f3f6a28a5ff-20221030105031-64rpjno.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1596783496811-3a6ed88c-bb38-40b7-aaf3-ca98b12493f2-20221030105031-aijlekh.jpeg","path":"assets/net-img-1596783496811-3a6ed88c-bb38-40b7-aaf3-ca98b12493f2-20221030105031-aijlekh.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602123134723-ab15ac69-5397-4422-8dcf-3c43f4a10e06-20221030124512-4k4z367.png","path":"assets/net-img-1602123134723-ab15ac69-5397-4422-8dcf-3c43f4a10e06-20221030124512-4k4z367.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602123013155-86ac51db-7d0a-4241-8094-f1fe2e16b43c-20221030124512-fqt8gu2.png","path":"assets/net-img-1602123013155-86ac51db-7d0a-4241-8094-f1fe2e16b43c-20221030124512-fqt8gu2.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602404087657-9aa12bdc-ba61-429f-bf21-dcf0efc211fa-20221030124615-fz11c88.png","path":"assets/net-img-1602404087657-9aa12bdc-ba61-429f-bf21-dcf0efc211fa-20221030124615-fz11c88.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602405124816-7ec65b09-2556-4ba3-b9ca-dabf0081929f-20230330213836-e0kef3p.png","path":"assets/net-img-1602405124816-7ec65b09-2556-4ba3-b9ca-dabf0081929f-20230330213836-e0kef3p.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602510155856-cf2ddad6-d6bb-4ea0-bb8c-f9b1dc49cee8-20221030124433-3c4w0ya.png","path":"assets/net-img-1602510155856-cf2ddad6-d6bb-4ea0-bb8c-f9b1dc49cee8-20221030124433-3c4w0ya.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602914807774-75634a6f-e238-498a-b0ce-e27f039a9646-20221030124604-ehzp01i.png","path":"assets/net-img-1602914807774-75634a6f-e238-498a-b0ce-e27f039a9646-20221030124604-ehzp01i.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602920769113-5b1bf8b5-f2b3-4a36-948b-721849b796d7-20221030124537-xtsxn6h.png","path":"assets/net-img-1602920769113-5b1bf8b5-f2b3-4a36-948b-721849b796d7-20221030124537-xtsxn6h.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1602998399972-d63036ef-500b-49ae-a31a-84a558efb1ae-20221030124502-upt9d1p.png","path":"assets/net-img-1602998399972-d63036ef-500b-49ae-a31a-84a558efb1ae-20221030124502-upt9d1p.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1603004208800-d47ee0f7-24fa-4b06-ae5f-8ce7b97e1e34-20221030124351-wgmd1lo.png","path":"assets/net-img-1603004208800-d47ee0f7-24fa-4b06-ae5f-8ce7b97e1e34-20221030124351-wgmd1lo.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1603013197743-541a8456-5d1b-477d-9658-1b6d5c06780a-20230330213832-g2oqx3t.png","path":"assets/net-img-1603013197743-541a8456-5d1b-477d-9658-1b6d5c06780a-20230330213832-g2oqx3t.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1603013239640-a2f1a79b-35c2-4ca8-9355-5f37e9d680bb-20221030124448-sl4zele.png","path":"assets/net-img-1603013239640-a2f1a79b-35c2-4ca8-9355-5f37e9d680bb-20221030124448-sl4zele.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1603013275619-1a15e41e-436b-41ef-bce1-147db82e5a83-20221030124522-yeb4ilf.png","path":"assets/net-img-1603013275619-1a15e41e-436b-41ef-bce1-147db82e5a83-20221030124522-yeb4ilf.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1603013309762-3689744a-be23-4e8f-8487-d397b3cc7869-20221030124624-9buvwxc.png","path":"assets/net-img-1603013309762-3689744a-be23-4e8f-8487-d397b3cc7869-20221030124624-9buvwxc.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615533992554-f7ecd3db-e7d5-4f29-b845-a22cb39dee76-20230426150127-m6xofsl.png","path":"assets/net-img-1615533992554-f7ecd3db-e7d5-4f29-b845-a22cb39dee76-20230426150127-m6xofsl.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615535960262-7646f229-98d2-4474-be5c-3e5dd3c3e7ac-20221030140153-c14thj0.png","path":"assets/net-img-1615535960262-7646f229-98d2-4474-be5c-3e5dd3c3e7ac-20221030140153-c14thj0.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20221030135532-u420fpk.png","path":"assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20221030135532-u420fpk.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20230330213518-3fydrb9.png","path":"assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20230330213518-3fydrb9.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20221030135532-6itdbiz.png","path":"assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20221030135532-6itdbiz.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20230330213518-2ptpa3a.png","path":"assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20230330213518-2ptpa3a.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20221030135532-iwc3p25.png","path":"assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20221030135532-iwc3p25.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20230330213519-1im5mrq.png","path":"assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20230330213519-1im5mrq.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615619423077-dea312ee-787e-4a28-b723-199f76a214f7-20221030135542-mx20k3e.png","path":"assets/net-img-1615619423077-dea312ee-787e-4a28-b723-199f76a214f7-20221030135542-mx20k3e.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1615619453470-bdab6e23-1385-4538-9c91-ceefcd05aa27-20221030135542-vyoxljv.png","path":"assets/net-img-1615619453470-bdab6e23-1385-4538-9c91-ceefcd05aa27-20221030135542-vyoxljv.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1623829860526-2438b2e1-de01-4c73-aa21-84e18c00d37c-20221031123408-wcse42k.png","path":"assets/net-img-1623829860526-2438b2e1-de01-4c73-aa21-84e18c00d37c-20221031123408-wcse42k.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1624106093230-4372b31c-0d0f-4640-8e80-62b7bdd258e4-20230122192859-kbq2rlz.png","path":"assets/net-img-1624106093230-4372b31c-0d0f-4640-8e80-62b7bdd258e4-20230122192859-kbq2rlz.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1624109586831-fa30fbaf-01b4-4243-bedf-eedfe9631e67-20230122192859-buewr2p.png","path":"assets/net-img-1624109586831-fa30fbaf-01b4-4243-bedf-eedfe9631e67-20230122192859-buewr2p.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1625277244322-1304b001-049b-467f-9207-4012228cca38-20221031123243-oqmq9cu.jpeg","path":"assets/net-img-1625277244322-1304b001-049b-467f-9207-4012228cca38-20221031123243-oqmq9cu.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1626851086718-49fece61-64f3-4f2e-9b78-f97e17176373-20230101203426-dn382za.png","path":"assets/net-img-1626851086718-49fece61-64f3-4f2e-9b78-f97e17176373-20230101203426-dn382za.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1626851420391-9aa6cf8f-fa40-49c3-8a7a-941763583502-20230101203427-ybsosns.png","path":"assets/net-img-1626851420391-9aa6cf8f-fa40-49c3-8a7a-941763583502-20230101203427-ybsosns.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1626854477699-226d8221-ae45-44f5-b8fd-6003efd2531c-20230101203427-giho3sf.png","path":"assets/net-img-1626854477699-226d8221-ae45-44f5-b8fd-6003efd2531c-20230101203427-giho3sf.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1627291037100-eacf8101-ce28-4c56-9c4b-12e59e5a3b26-20221031123408-gsirdhu.jpeg","path":"assets/net-img-1627291037100-eacf8101-ce28-4c56-9c4b-12e59e5a3b26-20221031123408-gsirdhu.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1627455003158-01c028a9-eb52-46e6-85ab-c811d640a84d-20221031123409-s3v35p9.jpeg","path":"assets/net-img-1627455003158-01c028a9-eb52-46e6-85ab-c811d640a84d-20221031123409-s3v35p9.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1628324723790-e7e469c7-62d0-4076-aa53-5e937ae80bee-20230122192859-e7kchm7.jpeg","path":"assets/net-img-1628324723790-e7e469c7-62d0-4076-aa53-5e937ae80bee-20230122192859-e7kchm7.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1628905841173-c32bdb25-8b61-4f16-b08e-96898d7aeefc-20221031123444-2pva1h4.png","path":"assets/net-img-1628905841173-c32bdb25-8b61-4f16-b08e-96898d7aeefc-20221031123444-2pva1h4.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1629558034184-e1fe6601-777e-4a34-afe5-df37e5a9b720-20230330213445-e5uive7.png","path":"assets/net-img-1629558034184-e1fe6601-777e-4a34-afe5-df37e5a9b720-20230330213445-e5uive7.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1629559055065-5ad8d49f-81b6-45f3-87f8-c98716f799ed-20230330213451-7nkjlzc.png","path":"assets/net-img-1629559055065-5ad8d49f-81b6-45f3-87f8-c98716f799ed-20230330213451-7nkjlzc.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1629559366006-0194df18-86f2-45fd-bd85-6f675b19bdb0-20230330213459-p7i5mm5.png","path":"assets/net-img-1629559366006-0194df18-86f2-45fd-bd85-6f675b19bdb0-20230330213459-p7i5mm5.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1629560137959-ab93eb78-c083-4c80-8283-4cfc470c8af0-20230330213504-cteixk9.png","path":"assets/net-img-1629560137959-ab93eb78-c083-4c80-8283-4cfc470c8af0-20230330213504-cteixk9.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1629870852837-ca139768-9f26-412a-8940-49ed6e38f57a-20230330213513-n1dmxgm.png","path":"assets/net-img-1629870852837-ca139768-9f26-412a-8940-49ed6e38f57a-20230330213513-n1dmxgm.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1631431982904-ce964c3b-4c64-4915-84a9-a3799dd2cf92-20230330213415-i9cgn1s.png","path":"assets/net-img-1631431982904-ce964c3b-4c64-4915-84a9-a3799dd2cf92-20230330213415-i9cgn1s.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1631436389678-e6910ed9-8e3c-4d73-93bf-362566a4ebb0-20230330213421-crfgpeh.png","path":"assets/net-img-1631436389678-e6910ed9-8e3c-4d73-93bf-362566a4ebb0-20230330213421-crfgpeh.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1639574230606-ee713d6a-1223-4275-bfaa-f60258aa6eea-20221030132914-2yfiwaf.jpeg","path":"assets/net-img-1639574230606-ee713d6a-1223-4275-bfaa-f60258aa6eea-20221030132914-2yfiwaf.jpeg","modified":0,"renderable":0},{"_id":"source/assets/net-img-1645242293838-01142675-6027-4b29-8f4d-1d872c2d6cea-20221030140106-8zicdb0.png","path":"assets/net-img-1645242293838-01142675-6027-4b29-8f4d-1d872c2d6cea-20221030140106-8zicdb0.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1646740660775-762fcaa3-26b5-4d95-ac43-5cca58540969-20230330213439-sxz1b5i.png","path":"assets/net-img-1646740660775-762fcaa3-26b5-4d95-ac43-5cca58540969-20230330213439-sxz1b5i.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073234010-c17ae82e-6da7-479a-ba1c-b1543abba0d5-20221111215525-80jshsc.png","path":"assets/net-img-1665073234010-c17ae82e-6da7-479a-ba1c-b1543abba0d5-20221111215525-80jshsc.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1646742883104-4eef3a95-3655-44f4-8887-2f5f1628732e-20230330213506-2xv20ln.png","path":"assets/net-img-1646742883104-4eef3a95-3655-44f4-8887-2f5f1628732e-20230330213506-2xv20ln.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073313636-93fb8cb7-e679-4c0f-8067-885d28f67ded-20221111215526-vcl9xfw.png","path":"assets/net-img-1665073313636-93fb8cb7-e679-4c0f-8067-885d28f67ded-20221111215526-vcl9xfw.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073347225-5388dfc6-3fc2-4492-902c-b7fcd02f3245-20221111215525-4h0vo0n.png","path":"assets/net-img-1665073347225-5388dfc6-3fc2-4492-902c-b7fcd02f3245-20221111215525-4h0vo0n.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073353104-76e6707d-af7c-4e84-97dd-7458adee7994-20221111215525-0zkzrc2.png","path":"assets/net-img-1665073353104-76e6707d-af7c-4e84-97dd-7458adee7994-20221111215525-0zkzrc2.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073358729-865ac7d0-89b5-4cc8-814e-a892038da58b-20221111215525-k257bcx.png","path":"assets/net-img-1665073358729-865ac7d0-89b5-4cc8-814e-a892038da58b-20221111215525-k257bcx.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073365265-002fd960-3cab-45d5-a547-968487191335-20221111215525-51j8yv0.png","path":"assets/net-img-1665073365265-002fd960-3cab-45d5-a547-968487191335-20221111215525-51j8yv0.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073370943-3b2e7f1c-7c9a-46a3-9e37-31742edea2f4-20221111215525-xb7w2cn.png","path":"assets/net-img-1665073370943-3b2e7f1c-7c9a-46a3-9e37-31742edea2f4-20221111215525-xb7w2cn.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073398713-d6f47c91-e7a2-407a-9cc0-de52b301cf26-20221111215526-gwi38jk.png","path":"assets/net-img-1665073398713-d6f47c91-e7a2-407a-9cc0-de52b301cf26-20221111215526-gwi38jk.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073405592-73518a43-9c02-4d55-baee-bafcff044efe-20221111215526-c9mhwt8.png","path":"assets/net-img-1665073405592-73518a43-9c02-4d55-baee-bafcff044efe-20221111215526-c9mhwt8.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073414310-928255a5-b8a0-4a7b-817f-dbabda18feef-20221111215526-c0gy94f.png","path":"assets/net-img-1665073414310-928255a5-b8a0-4a7b-817f-dbabda18feef-20221111215526-c0gy94f.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073424520-10dfe592-ea00-4ea5-b46e-992601919f1f-20221111215526-q1f6my9.png","path":"assets/net-img-1665073424520-10dfe592-ea00-4ea5-b46e-992601919f1f-20221111215526-q1f6my9.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073433573-ed1fdba5-d19f-40c2-a4f9-96a6ddbff0d2-20221111215526-5pgyp70.png","path":"assets/net-img-1665073433573-ed1fdba5-d19f-40c2-a4f9-96a6ddbff0d2-20221111215526-5pgyp70.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073440336-5f261660-b58b-4c06-9c1d-f21c0865e31c-20221111215526-0s6pvi9.png","path":"assets/net-img-1665073440336-5f261660-b58b-4c06-9c1d-f21c0865e31c-20221111215526-0s6pvi9.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073448391-a1d5eef7-134c-4b01-9c2e-2df8cc9ec893-20221111215526-gp8xqtg.png","path":"assets/net-img-1665073448391-a1d5eef7-134c-4b01-9c2e-2df8cc9ec893-20221111215526-gp8xqtg.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073460709-ab3783c9-f4f3-46ae-ab45-fe489a701313-20221111215526-4cnfbe6.png","path":"assets/net-img-1665073460709-ab3783c9-f4f3-46ae-ab45-fe489a701313-20221111215526-4cnfbe6.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073467540-2062cc90-042f-4ea8-8dbc-1afa0c8232c7-20221111215527-13hnynb.png","path":"assets/net-img-1665073467540-2062cc90-042f-4ea8-8dbc-1afa0c8232c7-20221111215527-13hnynb.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073473485-b4b83d79-2af4-4681-9d50-1c9096dc935c-20221111215527-zawp2eq.png","path":"assets/net-img-1665073473485-b4b83d79-2af4-4681-9d50-1c9096dc935c-20221111215527-zawp2eq.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073484287-631d0da3-1bb4-4881-b567-647d058f4f47-20221111215527-l67jrtu.png","path":"assets/net-img-1665073484287-631d0da3-1bb4-4881-b567-647d058f4f47-20221111215527-l67jrtu.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073567805-1c681335-41e9-40c3-a02a-0155e0383924-20221111215527-s7tudvn.png","path":"assets/net-img-1665073567805-1c681335-41e9-40c3-a02a-0155e0383924-20221111215527-s7tudvn.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073576092-3eea97da-b483-4acc-a6fd-eece98224cd0-20221111215527-fr7igf9.png","path":"assets/net-img-1665073576092-3eea97da-b483-4acc-a6fd-eece98224cd0-20221111215527-fr7igf9.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073584346-6bc72f6a-0e4a-412e-94bc-81d860d5b059-20221111215527-k046iu2.png","path":"assets/net-img-1665073584346-6bc72f6a-0e4a-412e-94bc-81d860d5b059-20221111215527-k046iu2.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073596487-2a45c98e-71a7-45e8-a0c2-ac4b06cd0cff-20221111215527-fzwff39.png","path":"assets/net-img-1665073596487-2a45c98e-71a7-45e8-a0c2-ac4b06cd0cff-20221111215527-fzwff39.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073607553-c63d8f6f-883c-4ce4-9acd-3861c0ffd7ff-20221111215527-e9urwmu.png","path":"assets/net-img-1665073607553-c63d8f6f-883c-4ce4-9acd-3861c0ffd7ff-20221111215527-e9urwmu.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073624592-674dd74d-86d2-4605-9955-7a16e09a1cb4-20221111215527-1blmix8.png","path":"assets/net-img-1665073624592-674dd74d-86d2-4605-9955-7a16e09a1cb4-20221111215527-1blmix8.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073630217-bd1f44be-c442-48c7-9478-62d7f8fc79ce-20221111215527-fmqia49.png","path":"assets/net-img-1665073630217-bd1f44be-c442-48c7-9478-62d7f8fc79ce-20221111215527-fmqia49.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073635044-265417f7-ec52-4a11-9a17-929aa008498c-20221111215527-s30ehyk.png","path":"assets/net-img-1665073635044-265417f7-ec52-4a11-9a17-929aa008498c-20221111215527-s30ehyk.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073657734-f1c3e079-3804-43d3-8e30-9b46530ad337-20221111215527-74wm25r.png","path":"assets/net-img-1665073657734-f1c3e079-3804-43d3-8e30-9b46530ad337-20221111215527-74wm25r.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073663657-eac74193-3f2d-4823-b1ce-076ee644f1ba-20221111215527-ce3yoc2.png","path":"assets/net-img-1665073663657-eac74193-3f2d-4823-b1ce-076ee644f1ba-20221111215527-ce3yoc2.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073671982-4bc2b9c6-228b-49a6-96ed-ab6555a1b26d-20221111215527-af0xz7y.png","path":"assets/net-img-1665073671982-4bc2b9c6-228b-49a6-96ed-ab6555a1b26d-20221111215527-af0xz7y.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073689906-f5db7615-5190-4e77-9d08-d177ad4026de-20221111215533-4736rjm.png","path":"assets/net-img-1665073689906-f5db7615-5190-4e77-9d08-d177ad4026de-20221111215533-4736rjm.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073701183-299298fc-39d3-49a7-80e3-7c1240dbf6bc-20221111215533-jaec6x0.png","path":"assets/net-img-1665073701183-299298fc-39d3-49a7-80e3-7c1240dbf6bc-20221111215533-jaec6x0.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073728272-8bc0096c-6425-4310-979a-28ad42d6e2c0-20221111215533-kvytuuy.png","path":"assets/net-img-1665073728272-8bc0096c-6425-4310-979a-28ad42d6e2c0-20221111215533-kvytuuy.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073733517-eb68002c-afc1-4746-96e4-0fa95b21bfad-20221111215533-jinki2i.png","path":"assets/net-img-1665073733517-eb68002c-afc1-4746-96e4-0fa95b21bfad-20221111215533-jinki2i.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073741703-3acb8484-f36b-4738-8769-c50625b23727-20221111215534-pwccic8.png","path":"assets/net-img-1665073741703-3acb8484-f36b-4738-8769-c50625b23727-20221111215534-pwccic8.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665073776507-524d18b7-c84e-4311-a742-c02a67d7a63e-20221111215534-h1bzg7o.png","path":"assets/net-img-1665073776507-524d18b7-c84e-4311-a742-c02a67d7a63e-20221111215534-h1bzg7o.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665887335160-92fef518-ebb8-4a80-8bba-39f60880a491-20221030140113-ritolt8.webp","path":"assets/net-img-1665887335160-92fef518-ebb8-4a80-8bba-39f60880a491-20221030140113-ritolt8.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665887374286-cdf6dee1-f1f2-4de2-8fdd-0652d9e2f667-20221030140113-kzrzbzq.webp","path":"assets/net-img-1665887374286-cdf6dee1-f1f2-4de2-8fdd-0652d9e2f667-20221030140113-kzrzbzq.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-1665887401184-ef95895d-d794-43e2-8d11-46c0b6186d3a-20221030140113-0svrost.webp","path":"assets/net-img-1665887401184-ef95895d-d794-43e2-8d11-46c0b6186d3a-20221030140113-0svrost.webp","modified":0,"renderable":0},{"_id":"source/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230330213516-hs7yexh.svg","path":"assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230330213516-hs7yexh.svg","modified":0,"renderable":0},{"_id":"source/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230527145229-bw8f49a.svg","path":"assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230527145229-bw8f49a.svg","modified":0,"renderable":0},{"_id":"source/assets/net-img-640-20221123123914-g18ng9z.png","path":"assets/net-img-640-20221123123914-g18ng9z.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-640-20221123124059-5desc25.png","path":"assets/net-img-640-20221123124059-5desc25.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-640-20230330194058-16epkoj.png","path":"assets/net-img-640-20230330194058-16epkoj.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-JDgR0O-20221030104726-xwobg2m.jpg","path":"assets/net-img-JDgR0O-20221030104726-xwobg2m.jpg","modified":0,"renderable":0},{"_id":"source/assets/net-img-640-20230330193532-4safylx.png","path":"assets/net-img-640-20230330193532-4safylx.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-Javb7R-20221030105018-f0nmumb.jpg","path":"assets/net-img-Javb7R-20221030105018-f0nmumb.jpg","modified":0,"renderable":0},{"_id":"source/assets/net-img-NHqeHS-20221030124555-egcayk2.png","path":"assets/net-img-NHqeHS-20221030124555-egcayk2.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-NIKEYn-20221030105009-qtc7vqs.jpg","path":"assets/net-img-NIKEYn-20221030105009-qtc7vqs.jpg","modified":0,"renderable":0},{"_id":"source/assets/net-img-NILhqg-20221030105009-gkjt4x4.jpg","path":"assets/net-img-NILhqg-20221030105009-gkjt4x4.jpg","modified":0,"renderable":0},{"_id":"source/assets/net-img-Nxg2RI-20221030140124-2j3rd9u.png","path":"assets/net-img-Nxg2RI-20221030140124-2j3rd9u.png","modified":0,"renderable":0},{"_id":"source/assets/net-img-regexp-cn-20221030151436-zbahpvf.png","path":"assets/net-img-regexp-cn-20221030151436-zbahpvf.png","modified":0,"renderable":0},{"_id":"source/assets/recover1.jpg","path":"assets/recover1.jpg","modified":0,"renderable":0},{"_id":"source/assets/recover2.jpg","path":"assets/recover2.jpg","modified":0,"renderable":0},{"_id":"source/assets/_20221129215049-20221129215137-xy69pf5.jpg","path":"assets/_20221129215049-20221129215137-xy69pf5.jpg","modified":0,"renderable":0},{"_id":"source/img/svg/bilibili.svg","path":"img/svg/bilibili.svg","modified":0,"renderable":0},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/butterfly-icon.png","path":"img/butterfly-icon.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/error-page.png","path":"img/error-page.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"source/assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp","path":"assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp","modified":0,"renderable":0},{"_id":"source/assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp","path":"assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp","modified":0,"renderable":0},{"_id":"source/assets/0dfa05911b3f4f448db0ce247eb0db91tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-oai6wan.awebp","path":"assets/0dfa05911b3f4f448db0ce247eb0db91tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-oai6wan.awebp","modified":0,"renderable":0},{"_id":"source/assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp","path":"assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp","modified":0,"renderable":0},{"_id":"source/assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp","path":"assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp","modified":0,"renderable":0},{"_id":"source/assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp","path":"assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp","modified":0,"renderable":0},{"_id":"source/assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp","path":"assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp","modified":0,"renderable":0},{"_id":"source/assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp","path":"assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp","modified":0,"renderable":0},{"_id":"source/assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp","path":"assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp","modified":0,"renderable":0},{"_id":"source/assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp","path":"assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp","modified":0,"renderable":0},{"_id":"source/assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp","path":"assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp","modified":0,"renderable":0},{"_id":"source/assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp","path":"assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp","modified":0,"renderable":0},{"_id":"source/assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp","path":"assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp","modified":0,"renderable":0},{"_id":"source/assets/594708f975664198bd523b79b8e1a73ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0c9y8yc.awebp","path":"assets/594708f975664198bd523b79b8e1a73ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0c9y8yc.awebp","modified":0,"renderable":0},{"_id":"source/assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp","path":"assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp","modified":0,"renderable":0},{"_id":"source/assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp","path":"assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp","modified":0,"renderable":0},{"_id":"source/assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp","path":"assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp","modified":0,"renderable":0},{"_id":"source/assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp","path":"assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp","modified":0,"renderable":0},{"_id":"source/assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp","path":"assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp","modified":0,"renderable":0},{"_id":"source/assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp","path":"assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp","modified":0,"renderable":0},{"_id":"source/assets/b704efb8f0784c89b520d5e990bcd670tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-zv6m9iy.awebp","path":"assets/b704efb8f0784c89b520d5e990bcd670tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-zv6m9iy.awebp","modified":0,"renderable":0},{"_id":"source/assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp","path":"assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp","modified":0,"renderable":0},{"_id":"source/assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp","path":"assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp","modified":0,"renderable":0},{"_id":"source/assets/d682866856c240b39d8dd674462b4072tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ptt3047.awebp","path":"assets/d682866856c240b39d8dd674462b4072tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ptt3047.awebp","modified":0,"renderable":0},{"_id":"source/assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp","path":"assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp","modified":0,"renderable":0},{"_id":"source/assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp","path":"assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp","modified":0,"renderable":0},{"_id":"source/assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp","path":"assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp","modified":0,"renderable":0},{"_id":"source/assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp","path":"assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp","modified":0,"renderable":0},{"_id":"source/assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp","path":"assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp","modified":0,"renderable":0},{"_id":"source/assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp","path":"assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp","modified":0,"renderable":0},{"_id":"source/assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp","path":"assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp","modified":0,"renderable":0},{"_id":"source/assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp","path":"assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp","modified":0,"renderable":0},{"_id":"source/assets/faa389f1359544b382bcaf1b9b5227bbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-woeeb5g.awebp","path":"assets/faa389f1359544b382bcaf1b9b5227bbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-woeeb5g.awebp","modified":0,"renderable":0},{"_id":"source/assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp","path":"assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp","modified":0,"renderable":0}],"Cache":[{"_id":"source/_data/styles.styl","hash":"9b172b1183effd328fbc67b2b0144ee248fbe538","modified":1745288519455},{"_id":"source/categories/index.md","hash":"1395184f0d2558fb5718d6dc0ccbbea5e4c60927","modified":1745107735838},{"_id":"source/img/avatar.jpg","hash":"c83e297b31b2980e9754293df5fa61b550befe3a","modified":1745288519639},{"_id":"source/tags/index.md","hash":"59375ce68c4ea9cab11669ca4d232dc0b17eefb4","modified":1745107735841},{"_id":"source/assets/0b6fcecfe53184140bb4005dd0eab836-20230127151311-0gha64i.png","hash":"bae9a3ae5487965c67494f6a8bcc29f3796a4616","modified":1745288519463},{"_id":"source/assets/20200809110444386-20230127151311-z1qxdzv.png","hash":"d1bcf5cc5016c65c1c8dfd7ef23b36e6c947b39f","modified":1745288519463},{"_id":"source/music/index.md","hash":"e3e6eca7c734cdfb963a50f09bfedc715aadb118","modified":1745107735841},{"_id":"source/assets/2d694736eb7778a548cdcb8189d6e226-20230127151312-riapszh.png","hash":"e7ad32cf02bb6f432b89c5893c6f5e185a8f95b7","modified":1745288519471},{"_id":"source/assets/327dcba48317d39b2cd0ee081d4e3fdc-20230127151312-4qigjlr.png","hash":"0f2c302d870b7f675cef1d23767307c1b18bbc14","modified":1745288519471},{"_id":"source/assets/2edff9c3d5cb698abb0e62d720ad704b-20230127151311-dy2b8hg.png","hash":"58008120a30cf8d8ca11a32bfbc8534868c780f8","modified":1745288519471},{"_id":"source/assets/39c6a500cefa6e29150c1295d3e152d1-20230127151312-5z7fqgr.png","hash":"5168db5245f5d7e11cf5c6f32608177c1562af98","modified":1745288519475},{"_id":"source/assets/640-20230404215051-pdghyi7.png","hash":"4dd1944316313ba8c5858ffd16a52eaaf9e0aac8","modified":1745288519479},{"_id":"source/assets/b5e5ca9c35421192e7f02864c4fb30bb-20230127151311-iwgg2ln.png","hash":"ee2d610a81cf1cd720b9a311c1608418049375b7","modified":1745288519479},{"_id":"source/assets/c2d8c43d5c018eb584586ad5857fbbf4-20230127151311-ml2ddae.png","hash":"e92f93c660a7069be52d2b186a4ee48e67fc611c","modified":1745288519483},{"_id":"source/assets/da55da191ca558b60531e3a6b6ce5267-20230127151311-wiqzfgo.png","hash":"89b4dcffe22aaeb612f8d8d44395dcefbf4027f9","modified":1745288519483},{"_id":"source/assets/dubbo-modules-20221214214601-dcxfz3a.jpg","hash":"a81339084c61e6e88a645df24a100f99252ee2d8","modified":1745288519483},{"_id":"source/assets/dubbo-relation-20221214214601-7hb77fv.jpg","hash":"b6d8258211efaf56f5b84c3535512ab87fd91581","modified":1745288519483},{"_id":"source/assets/ff614ca7c83414c712848a25b23e6a91-20230127151312-slrk125.png","hash":"573f477c483695ffff8716221ce4e05c028c21c3","modified":1745288519487},{"_id":"source/assets/image-20230218230318-0kn4aj5.png","hash":"961ffed68b045a0327c4de05ceba7ed9678b06c6","modified":1745288519487},{"_id":"source/assets/image-20230218230318-31t0a0v.png","hash":"eea7d51faef16c0743fda3184a5f109ab5f946f3","modified":1745288519487},{"_id":"source/assets/image-20230218230318-i0g5orx.png","hash":"7c81b3ba2f3c7031dce4944d49c26b4620fd16a3","modified":1745288519487},{"_id":"source/assets/image-20230218230318-cknlz85.png","hash":"5994bf3ba95ef539a5d93906cd954a8ad924fc84","modified":1745288519487},{"_id":"source/assets/image-20230218230318-t4i4y3l.png","hash":"61b376acb2adadd3bbaeb6d7377e7d83c1ec0c05","modified":1745288519487},{"_id":"source/assets/image-20230218230318-w95qpr6.png","hash":"0418c9a1496a70f2bc26baf91356e735f9ef538c","modified":1745288519487},{"_id":"source/assets/image-20230218230318-ybffha3.png","hash":"5e16e58c0db061654c14558b1a4c510bc6d72a4a","modified":1745288519491},{"_id":"source/assets/image-20230218230318-ye9g47h.png","hash":"168de4de61f89f23e67201c2de59b272f79b6926","modified":1745288519491},{"_id":"source/assets/image-20230218230318-ypt4n3t.png","hash":"87eb13cbc9b90a9f11dd92e7a1e3cda8fb7d4a95","modified":1745288519491},{"_id":"source/assets/image-20230218230318-nedvesv.png","hash":"45e270b26ea7b43d6e0984c300a539723416e67f","modified":1745288519487},{"_id":"source/assets/image-20230423172026-j99710c.png","hash":"883bd920611be893fe581cc2e2e53f4bd4a85525","modified":1745288519491},{"_id":"source/assets/image-20230505215709-q6pir67.png","hash":"33fd34987cb9c5c0dbf947046e6cc9a1ec9ecc9a","modified":1745288519491},{"_id":"source/assets/image-20230519215732-zz9jpqo.png","hash":"d63b938154b8b371dbcba26dea785815738dc533","modified":1745288519491},{"_id":"source/assets/image-20231119124040-5kytmcz.png","hash":"c92f258000b91edf24db4fa57248184aab5d7ff0","modified":1745288519499},{"_id":"source/assets/image-20231126161709-b35di3t.png","hash":"9af051afa303573bb95b4c559aa1b446360ef447","modified":1745288519527},{"_id":"source/assets/image-20230218230318-t9tvsgp.png","hash":"84f584278240b51e3ccc1208a8510d850714312b","modified":1745288519487},{"_id":"source/assets/net-img-1582873055902-03de6700-dcb1-42a8-927e-af658b90b6b0-20230330213228-vjyh5tl.png","hash":"02396f78d1be8b02ca4cf7efd37ec051c443be38","modified":1745288519559},{"_id":"source/assets/net-img-1582873072467-a61dd6d9-f02a-4653-bcff-eeb592deaf68-20230330213234-ppelol3.png","hash":"c4709d68ebe2880391ccb3b31edf93587b7ad822","modified":1745288519559},{"_id":"source/assets/net-img-1582873090325-a7683e68-a46d-418f-bba5-0bd6c8c7575b-20230330213237-ldsjgn2.webp","hash":"957194f1a9e698a629eff8be47cca675ee9b9082","modified":1745288519559},{"_id":"source/assets/net-img-1582873156123-9f655847-4b5d-4c84-8116-ede849af16e3-20230330213218-q1lh95h.png","hash":"c3d698b9bb8502b82b1677eeccdf1dc5179a1c12","modified":1745288519563},{"_id":"source/assets/net-img-1582873335047-0818927f-77de-4ad8-aa95-fb7d537f6700-20230330213215-9u0gs7n.webp","hash":"325753c050aeadeb41abb811db6932fcc9756cd0","modified":1745288519563},{"_id":"source/assets/net-img-1582873144333-18753191-d8b2-47e1-a610-33c7c552fdaa-20230330213217-uigw9ix.png","hash":"64e5d7a35a0fdd7b382ff036fa463edc29f1af45","modified":1745288519563},{"_id":"source/assets/net-img-1582873601269-c3ee8a62-7c38-4751-8cff-f60ddc262d41-20230330213313-8vw56oe.png","hash":"d4c6236d7806c168e159e57501764179442a6839","modified":1745288519567},{"_id":"source/assets/net-img-1582873416741-a71a0d28-b66d-49ca-8487-c0e0ceaa704c-20230330213216-jddkbfu.webp","hash":"607b6b8b44d4ebf8d11cda966f2c047942e62b47","modified":1745288519563},{"_id":"source/assets/net-img-1582873927778-b80fd046-98af-4768-bfc1-6d59761271e2-20230330213325-w0s4a7u.png","hash":"369ef2ab199332ff160f82fce185f96c7e408345","modified":1745288519567},{"_id":"source/assets/net-img-1582873954652-cd9e9eab-021c-4792-9558-291d9ec5d743-20230330213333-aijfe0m.png","hash":"a25433de852d27f730cd4abef66576122429b314","modified":1745288519567},{"_id":"source/assets/net-img-1582873104499-77f0b1b3-a218-4cc7-9cd1-c5ab317f53ce-20230330213239-aq0b92g.png","hash":"1ee2406b2b6ad8e8cdd96b301e76b353c8a9c229","modified":1745288519563},{"_id":"source/assets/net-img-1582873690823-e85d7b31-4173-4adc-b4b4-92f314fd952b-20230330213322-ngp5u86.webp","hash":"12465e7924ed4b09fe0192921b8337dae8db4b9a","modified":1745288519567},{"_id":"source/assets/net-img-1582874243939-2eae4163-881d-47f6-b75d-18c057db48ef-20230330213158-setmh7t.webp","hash":"96b5d70ff0bdab3d8180fb713dd6e8ba30d505ed","modified":1745288519571},{"_id":"source/assets/net-img-1582874168420-5865fe9a-fe6d-49b5-961a-2addc05fce6a-20230330213157-z8hfg9r.webp","hash":"cef07fcb1e58699024480d7b5c584d90aba0228b","modified":1745288519571},{"_id":"source/assets/net-img-1582874168964-bb84b249-5332-4a93-b161-842b2e6955ed-20230330213157-wrr6xqk.webp","hash":"a141b07c1984453e310c582226e442062e78ae56","modified":1745288519571},{"_id":"source/assets/net-img-1582874279332-65260fd7-5a39-4fd1-85b8-86729cc9982c-20230330213159-yohdmn5.webp","hash":"a6d62b42aebc0b63cb37a508191422a363e18ae9","modified":1745288519571},{"_id":"source/assets/net-img-1582874334522-3936dfde-ef4a-4cf9-ab86-6001429fbb86-20230330213343-txdiivw.jpeg","hash":"870924d44a9995a72ad2d1715ca8466e4f932b25","modified":1745288519571},{"_id":"source/assets/net-img-1582875290415-c052f229-8c31-4560-acef-300acae2409b-20221030135515-tme9bzx.png","hash":"8ef7b28179b9da9186474531f7739c3fff3cbd10","modified":1745288519571},{"_id":"source/assets/net-img-1582875326094-cb5a96e7-e4c2-421d-83cf-216ca4f7f024-20221030135516-5igfhr6.png","hash":"e0ff2aee5d376fb0101a542728f5909eede94315","modified":1745288519571},{"_id":"source/assets/net-img-1582875326657-55738037-28bf-4de9-925a-f08034e0c722-20221030135516-j4ktjne.png","hash":"96ee4e7065f5263abeb8d95a11ce0a18a84f494f","modified":1745288519571},{"_id":"source/assets/net-img-1582875381841-0104c814-acd3-4ef3-a3bd-f5331d9a06bc-20221030135516-0716ftg.png","hash":"80f1bf83e38d1461dc6910d6a30f79d6e2a1394b","modified":1745288519571},{"_id":"source/assets/net-img-1582874136797-a333d011-4325-4f7c-82f6-9792216b1a21-20230330213157-i9zy78v.webp","hash":"34290e221871996dca8c8375aa428da463082adb","modified":1745288519571},{"_id":"source/assets/net-img-1582874350036-1fb8d7cf-688f-4628-ae77-9a21de7c4d2e-20230330213346-aj91hqy.png","hash":"c7fad5d3499a6e0d8e4c4d560da5cddb7a36a55a","modified":1745288519571},{"_id":"source/assets/net-img-1582875452927-44c67a88-5cee-48b1-a764-a26d40a77538-20221030135540-f7dfpln.png","hash":"2daf9869605e16a37c4418c28e52afec9866c7db","modified":1745288519571},{"_id":"source/assets/net-img-1582875462202-61de3608-d606-44f6-b8d0-c82da3a7acd8-20221030135541-a1152vd.png","hash":"94df1ef507bac6d026fa641efdffa9bc09a61a13","modified":1745288519571},{"_id":"source/assets/net-img-1582875470139-ea71ffbe-3cbd-44d8-8560-1e72b3a4bab4-20221030135541-hkuw6hs.png","hash":"9d13278bb6ad5ab8a07fd25d0affc856348afbbc","modified":1745288519571},{"_id":"source/assets/net-img-1582875605484-a8880998-f9be-42d5-9997-a1c908ca05a9-20221030103933-jzsw591.webp","hash":"0dc72ecb95f0deb30a2fcd8b198821b605bd04ea","modified":1745288519575},{"_id":"source/assets/net-img-1591690708309-b6db1e95-1bbf-4140-b612-26fefc8d85b5-20221030132327-6s3ed7l.png","hash":"52f3bbca5eb07588c0f47b6cde9f9fa1745631a4","modified":1745288519575},{"_id":"source/assets/net-img-1582874272168-5169d4d6-17f9-493d-b99b-c9a678dd13da-20230330213159-jscv9ip.webp","hash":"9989009c49220d7ad185cf7e1daecdb15af6d1da","modified":1745288519571},{"_id":"source/assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png","hash":"926070ac7bf26f22aab50a0f1b4ad414a02a22fd","modified":1745288519571},{"_id":"source/assets/net-img-1582875478351-18a69ed7-cb09-4a5a-a020-097490219718-20221030135517-0h9pq4n.png","hash":"0828e1ca982af7beedadf87586333ed1cf72fa39","modified":1745288519571},{"_id":"source/assets/net-img-1593076049581-f084ed7e-111c-4a99-944b-bb4aadb0f33b-20230330213209-kp1deud.png","hash":"572c4ff3a54622992e4754d21dc167429bcd50ff","modified":1745288519591},{"_id":"source/assets/net-img-1593076060148-a751342f-828e-49f2-a853-47b276d0fc68-20230330213209-k1w1si6.png","hash":"6ac6a432217bf88a0f8a20b143a9614ea8f078ef","modified":1745288519591},{"_id":"source/assets/net-img-1593854466438-89baf576-0e30-4db7-934e-2781413c9510-20221030140124-w8acjeh.png","hash":"aa5311b240c042132db43fd8ad7c9fd5e2684e44","modified":1745288519591},{"_id":"source/assets/net-img-1596361953803-ed588642-562c-49e8-99dd-cdc0e81519b7-20230426150127-crjga75.png","hash":"412de8e9c61132120a513b6dc1f1346c4f318f5e","modified":1745288519591},{"_id":"source/assets/net-img-1596362023744-7f76e71b-8cd9-4797-87f7-bccdb93fbb3a-20221030140106-k1plvtd.jpeg","hash":"871111348a751329bfc43b7558b117ab0fb54781","modified":1745288519591},{"_id":"source/assets/net-img-1593076076024-42ad7f21-eb2c-4c6b-8c34-802819b1fd8f-20230330213209-f5hjado.png","hash":"485de0eed404f2cdfe10a922214864646c536df1","modified":1745288519591},{"_id":"source/assets/net-img-1596783496811-3a6ed88c-bb38-40b7-aaf3-ca98b12493f2-20221030105031-aijlekh.jpeg","hash":"5bfb117e03defcf9d738674cf866591401250d25","modified":1745288519595},{"_id":"source/assets/net-img-1602123134723-ab15ac69-5397-4422-8dcf-3c43f4a10e06-20221030124512-4k4z367.png","hash":"faf44e5bbb92043e8b5781e7319f87b546001ea5","modified":1745288519595},{"_id":"source/assets/net-img-1602123013155-86ac51db-7d0a-4241-8094-f1fe2e16b43c-20221030124512-fqt8gu2.png","hash":"39b5117e13e5ec7803b99c9d8c9bd63784d09f54","modified":1745288519595},{"_id":"source/assets/net-img-1593076140792-4ab064fd-2370-4f64-a89e-6d7fc5bb9f39-20230330213209-drma95r.png","hash":"f57af1b9c0bf6dcba32d0394fc6778030f4d8147","modified":1745288519591},{"_id":"source/assets/net-img-1615533992554-f7ecd3db-e7d5-4f29-b845-a22cb39dee76-20230426150127-m6xofsl.png","hash":"99b89d8e0dc371e00ad8ca4e57c31fd470372296","modified":1745288519599},{"_id":"source/assets/net-img-1615535960262-7646f229-98d2-4474-be5c-3e5dd3c3e7ac-20221030140153-c14thj0.png","hash":"413ce886d78c230e5721a2238e703cd686208aa9","modified":1745288519599},{"_id":"source/assets/net-img-1625277244322-1304b001-049b-467f-9207-4012228cca38-20221031123243-oqmq9cu.jpeg","hash":"b715ae4a307faa63a555fef73f50a7e67219f8d2","modified":1745288519615},{"_id":"source/assets/net-img-1602510155856-cf2ddad6-d6bb-4ea0-bb8c-f9b1dc49cee8-20221030124433-3c4w0ya.png","hash":"3cd3283688af621e14353a63ae12c976b3b96cd7","modified":1745288519595},{"_id":"source/assets/net-img-1628324723790-e7e469c7-62d0-4076-aa53-5e937ae80bee-20230122192859-e7kchm7.jpeg","hash":"c564a0797766a360cb3d700344659bcb1a63a5af","modified":1745288519619},{"_id":"source/assets/net-img-1631436389678-e6910ed9-8e3c-4d73-93bf-362566a4ebb0-20230330213421-crfgpeh.png","hash":"3a084424eb7936f0e84046f2ed80e94e5a82d243","modified":1745288519623},{"_id":"source/assets/net-img-1639574230606-ee713d6a-1223-4275-bfaa-f60258aa6eea-20221030132914-2yfiwaf.jpeg","hash":"da8ff67b12daf7bc3384b335f9baa0924bb7de74","modified":1745288519623},{"_id":"source/assets/net-img-1646740660775-762fcaa3-26b5-4d95-ac43-5cca58540969-20230330213439-sxz1b5i.png","hash":"c85a97f212680ea6313e5b59dc14a4fd660bf2d9","modified":1745288519623},{"_id":"source/assets/net-img-1665073234010-c17ae82e-6da7-479a-ba1c-b1543abba0d5-20221111215525-80jshsc.png","hash":"f021b7c6e560a155d4e76284566214ce181fe201","modified":1745288519623},{"_id":"source/assets/net-img-1665073313636-93fb8cb7-e679-4c0f-8067-885d28f67ded-20221111215526-vcl9xfw.png","hash":"17f4f5b751e089a0d76b52e471ec5c9a2ceff444","modified":1745288519623},{"_id":"source/assets/net-img-1645242293838-01142675-6027-4b29-8f4d-1d872c2d6cea-20221030140106-8zicdb0.png","hash":"be0a7ca296495c45aeefa6205ee972c27fc09d3f","modified":1745288519623},{"_id":"source/assets/net-img-1665073358729-865ac7d0-89b5-4cc8-814e-a892038da58b-20221111215525-k257bcx.png","hash":"0ca686dd92e384559cc5bd7ed4110b5589a489e8","modified":1745288519623},{"_id":"source/assets/net-img-1665073365265-002fd960-3cab-45d5-a547-968487191335-20221111215525-51j8yv0.png","hash":"f021b7c6e560a155d4e76284566214ce181fe201","modified":1745288519623},{"_id":"source/assets/net-img-1665073370943-3b2e7f1c-7c9a-46a3-9e37-31742edea2f4-20221111215525-xb7w2cn.png","hash":"3ef96c77a510a92610cca91745e6818fca50f32c","modified":1745288519623},{"_id":"source/assets/net-img-1665073398713-d6f47c91-e7a2-407a-9cc0-de52b301cf26-20221111215526-gwi38jk.png","hash":"7c6c6a376b2d11bea215fa3f0396944ee98a0bf2","modified":1745288519623},{"_id":"source/assets/net-img-1665073405592-73518a43-9c02-4d55-baee-bafcff044efe-20221111215526-c9mhwt8.png","hash":"db37da8537372287a3483ee2088adbf70c908b3e","modified":1745288519623},{"_id":"source/assets/net-img-1665073414310-928255a5-b8a0-4a7b-817f-dbabda18feef-20221111215526-c0gy94f.png","hash":"03eda78dbd90f3e27b35c07b6149ebb22f80c60a","modified":1745288519623},{"_id":"source/assets/net-img-1665073424520-10dfe592-ea00-4ea5-b46e-992601919f1f-20221111215526-q1f6my9.png","hash":"5732bdd2254fc2df9b32ed878191af5c9c203857","modified":1745288519623},{"_id":"source/assets/net-img-1665073433573-ed1fdba5-d19f-40c2-a4f9-96a6ddbff0d2-20221111215526-5pgyp70.png","hash":"cd07f2413a92f7bfbc47ed997015527862cd2d26","modified":1745288519623},{"_id":"source/assets/net-img-1665073347225-5388dfc6-3fc2-4492-902c-b7fcd02f3245-20221111215525-4h0vo0n.png","hash":"11c3c24fada168360225f3da625dbf1940d1ebae","modified":1745288519623},{"_id":"source/assets/net-img-1665073353104-76e6707d-af7c-4e84-97dd-7458adee7994-20221111215525-0zkzrc2.png","hash":"3ef868230856bca16fb92c66fad7d37199561848","modified":1745288519623},{"_id":"source/assets/net-img-1665073440336-5f261660-b58b-4c06-9c1d-f21c0865e31c-20221111215526-0s6pvi9.png","hash":"fba77817166eca4d0a2606451c136c09ce22b0c0","modified":1745288519623},{"_id":"source/assets/net-img-1665073460709-ab3783c9-f4f3-46ae-ab45-fe489a701313-20221111215526-4cnfbe6.png","hash":"20ef0c0783a74dd7d0bc460949462b9502e2c060","modified":1745288519623},{"_id":"source/assets/net-img-1665073467540-2062cc90-042f-4ea8-8dbc-1afa0c8232c7-20221111215527-13hnynb.png","hash":"c84aeb21cb1986b15d68ecc274e8e73d2422e3c3","modified":1745288519623},{"_id":"source/assets/net-img-1665073484287-631d0da3-1bb4-4881-b567-647d058f4f47-20221111215527-l67jrtu.png","hash":"948d0c45ed7ffa9b202a60d247a0d1f961ecf147","modified":1745288519623},{"_id":"source/assets/net-img-1665073567805-1c681335-41e9-40c3-a02a-0155e0383924-20221111215527-s7tudvn.png","hash":"1aa5dc9f6b8ac8ab605ae58386281637ea30e2c7","modified":1745288519623},{"_id":"source/assets/net-img-1665073576092-3eea97da-b483-4acc-a6fd-eece98224cd0-20221111215527-fr7igf9.png","hash":"1dccaa650671139a972c29df9bab164cc9bd41d8","modified":1745288519623},{"_id":"source/assets/net-img-1665073596487-2a45c98e-71a7-45e8-a0c2-ac4b06cd0cff-20221111215527-fzwff39.png","hash":"4ea4eb5389253148560fe2f84be9949baf4ea1e2","modified":1745288519627},{"_id":"source/assets/net-img-1665073473485-b4b83d79-2af4-4681-9d50-1c9096dc935c-20221111215527-zawp2eq.png","hash":"f07245405e0b6c65db1543d51618afc03188b6c9","modified":1745288519623},{"_id":"source/assets/net-img-1665073448391-a1d5eef7-134c-4b01-9c2e-2df8cc9ec893-20221111215526-gp8xqtg.png","hash":"459a880bf0f7383a95471dd2fb8557743f84f7f5","modified":1745288519623},{"_id":"source/assets/net-img-1665073635044-265417f7-ec52-4a11-9a17-929aa008498c-20221111215527-s30ehyk.png","hash":"6111298420b3d37a2abdfbb525ca7a462a6eec42","modified":1745288519627},{"_id":"source/assets/net-img-1665073657734-f1c3e079-3804-43d3-8e30-9b46530ad337-20221111215527-74wm25r.png","hash":"fc0fcbcaa2176b4165d445deff78632786aba535","modified":1745288519627},{"_id":"source/assets/net-img-1665073663657-eac74193-3f2d-4823-b1ce-076ee644f1ba-20221111215527-ce3yoc2.png","hash":"c32e7b43243a7c3bba6e278596a971fcfe4c5626","modified":1745288519627},{"_id":"source/assets/net-img-1665073671982-4bc2b9c6-228b-49a6-96ed-ab6555a1b26d-20221111215527-af0xz7y.png","hash":"b5c7a29925623db00334fc81da68e7d67e9b8c30","modified":1745288519627},{"_id":"source/assets/net-img-1665073733517-eb68002c-afc1-4746-96e4-0fa95b21bfad-20221111215533-jinki2i.png","hash":"d9b4a0218a7653d5650c5820ddf7f6cb939b9255","modified":1745288519627},{"_id":"source/assets/net-img-1665073630217-bd1f44be-c442-48c7-9478-62d7f8fc79ce-20221111215527-fmqia49.png","hash":"30b83f99717332339d4fc99ad3d24b6b09fa1195","modified":1745288519627},{"_id":"source/assets/net-img-1665073624592-674dd74d-86d2-4605-9955-7a16e09a1cb4-20221111215527-1blmix8.png","hash":"476ee418d2e2e1df657a5e4c52fc46fafb7e6aeb","modified":1745288519627},{"_id":"source/assets/net-img-1665073607553-c63d8f6f-883c-4ce4-9acd-3861c0ffd7ff-20221111215527-e9urwmu.png","hash":"58792d335b56d61df03a0c719534b9ebe175ca06","modified":1745288519627},{"_id":"source/assets/net-img-1665887374286-cdf6dee1-f1f2-4de2-8fdd-0652d9e2f667-20221030140113-kzrzbzq.webp","hash":"e81b945e532f9bf366758c468c3770749ad5f729","modified":1745288519631},{"_id":"source/assets/net-img-1665887401184-ef95895d-d794-43e2-8d11-46c0b6186d3a-20221030140113-0svrost.webp","hash":"b9cc68508d12b2d5167602efd3e447eed2852a99","modified":1745288519631},{"_id":"source/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230330213516-hs7yexh.svg","hash":"de008cd5d533e2399ea43a9e0ac40f01d45ccf75","modified":1745107735823},{"_id":"source/assets/net-img-1665073776507-524d18b7-c84e-4311-a742-c02a67d7a63e-20221111215534-h1bzg7o.png","hash":"70ce12adde5768aa3d7f75fcd23c01bba60a1481","modified":1745288519631},{"_id":"source/assets/net-img-1665887335160-92fef518-ebb8-4a80-8bba-39f60880a491-20221030140113-ritolt8.webp","hash":"13169ab8c1647fc0aed80b0917e77d124ae2e772","modified":1745288519631},{"_id":"source/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230527145229-bw8f49a.svg","hash":"de008cd5d533e2399ea43a9e0ac40f01d45ccf75","modified":1745107735823},{"_id":"source/assets/net-img-640-20221123123914-g18ng9z.png","hash":"fed1d8bb65255b53f32f1dad99c958516440db00","modified":1745288519635},{"_id":"source/assets/net-img-Javb7R-20221030105018-f0nmumb.jpg","hash":"6643e83588989e0b9c562ecb62522511134180da","modified":1745288519635},{"_id":"source/assets/net-img-NIKEYn-20221030105009-qtc7vqs.jpg","hash":"96d4d9622ab94e815195a267ebd748deeca387d5","modified":1745288519635},{"_id":"source/assets/net-img-NILhqg-20221030105009-gkjt4x4.jpg","hash":"cf376bbe8f2ca07f66dba0bd27632de1d5a917b3","modified":1745288519635},{"_id":"source/assets/net-img-Nxg2RI-20221030140124-2j3rd9u.png","hash":"aae52ae2b5b8dd06bf02d43ee65d3dea3fbe1507","modified":1745288519635},{"_id":"source/assets/net-img-regexp-cn-20221030151436-zbahpvf.png","hash":"11e9763df7885e5f0102411d0d3097baac0be549","modified":1745288519639},{"_id":"source/assets/recover1.jpg","hash":"c3bed5eede5543317b5b1d1e6131510f12713d9d","modified":1745288519639},{"_id":"source/assets/recover2.jpg","hash":"6c25fad45107d0e81cfc93f6e72c8797d42fd120","modified":1745288519639},{"_id":"source/assets/net-img-NHqeHS-20221030124555-egcayk2.png","hash":"579571e4e43197309ab62b28f5b8d0298e7914b1","modified":1745288519635},{"_id":"source/_posts/java/Base.md","hash":"a2b306964de8955c0391c9019321b32d87a16570","modified":1745107735544},{"_id":"source/_posts/java/Collection.md","hash":"d37302730014f1617293ff7e00d8959733944b6a","modified":1745829708386},{"_id":"source/_posts/java/JVM.md","hash":"dcd32f95a6e022051ec3b5dd050dfb50923b2df2","modified":1745829708389},{"_id":"source/_posts/java/JavaWeb.md","hash":"518e78131fe061450ca36a4c1af821ef18a8b48b","modified":1745107735553},{"_id":"source/_posts/java/thread.md","hash":"43b40f3044194f891d2be8d79624f59e0fc3600b","modified":1745829708394},{"_id":"source/img/svg/bilibili.svg","hash":"e6c75b45007399f850ad762f6360297215dc4144","modified":1745107735840},{"_id":"source/_posts/Effective-Java/01. .md","hash":"bf82552d626cfeabf87e726cb2c6675ae4bd25a0","modified":1745288519455},{"_id":"source/_posts/Effective-Java/02. builder.md","hash":"8120c558078a9340f4149b6b3314268a99828cde","modified":1745288519455},{"_id":"source/_posts/Effective-Java/03. Singleton.md","hash":"f411ca4722f126d8415af856d953c0c7767a1293","modified":1745288519455},{"_id":"source/_posts/Effective-Java/04. .md","hash":"0339c29d7d45b2a5302fc337fad93b8fc78a6e35","modified":1745288519455},{"_id":"source/_posts/Effective-Java/05. (hardwiring resources).md","hash":"85efac1482bc39b1941e556204c4a61c445340f1","modified":1745288519455},{"_id":"source/_posts/Effective-Java/06. .md","hash":"6746fbd853989b4492732c7a9b88feacfa00ba0d","modified":1745288519455},{"_id":"source/_posts/Effective-Java/07. .md","hash":"6fc4d34463713d1668bdcec350e5ddcfa3f97226","modified":1745288519455},{"_id":"source/_posts/Effective-Java/08. FinalizerCleaner.md","hash":"28401601e39153e760eb000c74093052d757d5bb","modified":1745288519455},{"_id":"source/_posts/Effective-Java/09. try-with-resourcestry-finally.md","hash":"fad5dc2c872ad2a7f66aa033019e757658af25b1","modified":1745288519455},{"_id":"source/_posts/java/ByteBuddy.md","hash":"3146810f87d7459bfd72e10a5c5cd8a3e2041a72","modified":1745829708385},{"_id":"source/_posts/Effective-Java/10. equals.md","hash":"cbfc0ef2445c206b6092630d7774abedd9be4ece","modified":1745288519455},{"_id":"source/assets/net-img-640-20230330193532-4safylx.png","hash":"fef4a36094e1d2d446dcd6db1bd08bde2a33afd8","modified":1745288519635},{"_id":"source/_posts/Effective-Java/13.  clone .md","hash":"6ee8a68a1b242614801f25646f0c08dbdfaa94ce","modified":1745288519455},{"_id":"source/_posts/Effective-Java/14. Comparable.md","hash":"812d3cf33fe2ba9961ad6a284c7efb5dde0a1ffa","modified":1745288519455},{"_id":"source/_posts/Effective-Java/15. .md","hash":"aced087d4fc9f05613cacb8d7856922fa9bcd06b","modified":1745288519455},{"_id":"source/_posts/Effective-Java/16. .md","hash":"9338fdff29af02f3a7560e396d754bd96f0d2f79","modified":1745288519455},{"_id":"source/_posts/Effective-Java/17. .md","hash":"4af808fedf1de24405a3a8fc1d979af573f9c3e1","modified":1745288519455},{"_id":"source/_posts/Effective-Java/18. .md","hash":"e2e9ab02336ae7bb850af8dfe5b6e1f96f1d5060","modified":1745288519455},{"_id":"source/_posts/Effective-Java/19. .md","hash":"d81c11513f2e403920bb1c2baf2f220e82b744a0","modified":1745288519455},{"_id":"source/_posts/Effective-Java/20. .md","hash":"65d5faf545a58d67d22774561246b4ade6348d36","modified":1745288519455},{"_id":"source/_posts/Effective-Java/21. .md","hash":"3b43b9a0f2f25c3d42aa2080af8bee5b8b815ca8","modified":1745288519455},{"_id":"source/_posts/Effective-Java/22. .md","hash":"90db2cbffb13ccb82a578a0adace90ff8d94594c","modified":1745288519455},{"_id":"source/_posts/Effective-Java/23. .md","hash":"479947cee3105310e77a35fb0f569b6d7bb92071","modified":1745288519455},{"_id":"source/_posts/Effective-Java/24. .md","hash":"1149464abeb6caa0723359bbc002836bde2de78a","modified":1745288519455},{"_id":"source/_posts/Effective-Java/25. .md","hash":"59c223128d423ea1cec024038a026870aad1676d","modified":1745288519455},{"_id":"source/_posts/Effective-Java/26. .md","hash":"0d38f2acd1a496d5a5885aa8c7e8aa43ec3f67d3","modified":1745288519455},{"_id":"source/_posts/Effective-Java/12.  toString .md","hash":"3680b5a8dd288695c81e4a0bbf67de9056a7a6ae","modified":1745288519455},{"_id":"source/_posts/Effective-Java/28. .md","hash":"a3bd075dd95392e8141a642e3cf8b080f46c3fc4","modified":1745288519455},{"_id":"source/_posts/Effective-Java/29. .md","hash":"5a39f728e738890b83e83b20422560bd9e7c835d","modified":1745288519455},{"_id":"source/_posts/Effective-Java/30. .md","hash":"a47797d88179519b19f602559936e3f8e70a813f","modified":1745288519455},{"_id":"source/_posts/Effective-Java/27. .md","hash":"85735e3582edb0dd46445bd2a2e2f727f3bd2c39","modified":1745288519455},{"_id":"source/_posts/Effective-Java/31. API.md","hash":"888cde29cd1335fa1b581bf4954cc2afa0a83bd7","modified":1745288519455},{"_id":"source/_posts/Effective-Java/33. .md","hash":"4d920ebf9ecec110e0fbd68e087675e273ff6617","modified":1745288519455},{"_id":"source/_posts/Effective-Java/34. .md","hash":"5c6eec649d269dede8fb3a09d7067207c56e6359","modified":1745288519459},{"_id":"source/_posts/Effective-Java/35. .md","hash":"b44cf12f22129e65ed7396f31ac8ea05198b4d9c","modified":1745288519459},{"_id":"source/_posts/Effective-Java/36. EnumSet.md","hash":"99e60cf43ae97615138e001a09b6e8802f52ee70","modified":1745288519459},{"_id":"source/_posts/Effective-Java/37. EnumMap.md","hash":"4990936c24b785b1e5165b5acbcb4f17c53a3b2a","modified":1745288519459},{"_id":"source/_posts/Effective-Java/38. .md","hash":"1d75b857acbd0fcaea3bd38b5bb4110d7bc1238e","modified":1745288519459},{"_id":"source/_posts/Effective-Java/39. .md","hash":"5fb9f1404d26a22007410ccda5a6b180e0a7b6f9","modified":1745288519459},{"_id":"source/_posts/Effective-Java/40. Override.md","hash":"02d80972d51ffc9084643718549f2e5ef4a4021c","modified":1745288519459},{"_id":"source/_posts/Effective-Java/41. .md","hash":"8f55d00706ac87c619c0d077613f011e50a1c83d","modified":1745288519459},{"_id":"source/_posts/Effective-Java/42. lambda.md","hash":"1b3dfed0e9711c1a4bb87491761eb20f692321ea","modified":1745288519459},{"_id":"source/_posts/Effective-Java/43. lambda.md","hash":"54bb636380e25042ceb3d85816035d1626a4a38a","modified":1745288519459},{"_id":"source/_posts/Effective-Java/11. equalshashcode.md","hash":"cdb7a1a8d9d672e57d15a166681b90a66088710f","modified":1745288519455},{"_id":"source/_posts/Effective-Java/44. .md","hash":"82fffdc414aaeb40925ee6fc3a104fcad2e18eb5","modified":1745288519459},{"_id":"source/_posts/Effective-Java/32. .md","hash":"c7c775db271304c87f7eceb81885ea80a1b70675","modified":1745288519455},{"_id":"source/_posts/Effective-Java/49. .md","hash":"7de98ffc44195560e2b8970f57e8ecf03d964a62","modified":1745288519459},{"_id":"source/_posts/Effective-Java/47. CollectionStream.md","hash":"bc70de6759da3d920e473c55090aa8eef04b79eb","modified":1745288519459},{"_id":"source/_posts/Effective-Java/50. .md","hash":"38aaed60f94ecd5dbd7bbfe31d7bdd0d7be7f739","modified":1745288519459},{"_id":"source/_posts/Effective-Java/51. .md","hash":"8916171efa5c08766b1bacd1a09781e7b1d75f90","modified":1745288519459},{"_id":"source/_posts/Effective-Java/52. .md","hash":"daf4a5d3aa484325f1c449671337489cbce8666e","modified":1745288519459},{"_id":"source/_posts/Effective-Java/53. .md","hash":"ca0dac0ae97bab0e37f0b3a3a4d22dab5a18bff0","modified":1745288519459},{"_id":"source/_posts/Effective-Java/54.  null.md","hash":"cdb723fec7959808ace54a73dbfe3d3c1e26ff8e","modified":1745288519459},{"_id":"source/_posts/Effective-Java/55.  Optional.md","hash":"729d8c069eebef73b1afc518a7320ca40c903f13","modified":1745288519459},{"_id":"source/_posts/Effective-Java/56.  API .md","hash":"87c48400c0cb3f44a9ed4aa1cb4326bcf524a0b7","modified":1745288519459},{"_id":"source/_posts/Effective-Java/45. Stream.md","hash":"de9b89b42eb5463311d4ddf963739abeb4f1895b","modified":1745288519459},{"_id":"source/_posts/Effective-Java/57. .md","hash":"093c42a74d1900bfe724d06081c9907e7b2df92d","modified":1745288519459},{"_id":"source/_posts/Effective-Java/59. .md","hash":"068aecbebfb3142f849901cdd278300576551919","modified":1745288519459},{"_id":"source/_posts/Effective-Java/48. .md","hash":"f8037ba7e8fb5679abdc82b65b33e421a517a288","modified":1745288519459},{"_id":"source/_posts/Effective-Java/58. for-each  for .md","hash":"43a387159242012195bced6da086c9a7b566eb93","modified":1745288519459},{"_id":"source/_posts/Effective-Java/60.  float  double .md","hash":"387858bb3f93fa140a729876d1c61b81c0d65175","modified":1745288519459},{"_id":"source/_posts/Effective-Java/46. .md","hash":"d5d493109045592dbe6902e59b1bcc41d72a3b6a","modified":1745288519459},{"_id":"source/_posts/Effective-Java/61. .md","hash":"0629f49ca9b26ccef39746df2ef64fa234fe78c3","modified":1745288519459},{"_id":"source/_posts/Effective-Java/63. .md","hash":"84d2b5361146b45c690c28654414ab97b4770bf1","modified":1745288519459},{"_id":"source/_posts/Effective-Java/62. .md","hash":"d0519186405bf5c90086f9bb998390d01d393a6c","modified":1745288519459},{"_id":"source/_posts/Effective-Java/64. .md","hash":"aebfc8b1f213741059800b4bcc2e1947dad90d36","modified":1745288519459},{"_id":"source/_posts/Effective-Java/65. .md","hash":"5244b9242369e1335e4f014dcd764fd4d82d7add","modified":1745288519459},{"_id":"source/_posts/Effective-Java/66. .md","hash":"ce70eb18f625b7caf759439a62445da1360a66e6","modified":1745288519459},{"_id":"source/_posts/Effective-Java/68. .md","hash":"e057a695373948ec7976995db1d50d04d723fd77","modified":1745288519459},{"_id":"source/_posts/Effective-Java/69. .md","hash":"eb3731eb2bd75cce2b9a5270f8f200ba6cc02de9","modified":1745288519459},{"_id":"source/_posts/Effective-Java/67. .md","hash":"d4b35b657379fab42a9cdfde2f8420fccff3b587","modified":1745288519459},{"_id":"source/_posts/Effective-Java/70. .md","hash":"1d3ca76f5ea397d7ad9595de51bdbb6a9aad89b1","modified":1745288519459},{"_id":"source/_posts/Effective-Java/71. .md","hash":"469b2092d08d7bf47cc70ca6e496184797adae72","modified":1745288519459},{"_id":"source/_posts/Effective-Java/72. .md","hash":"672eb2ce27165fb007da0c8430e07ce2256481b5","modified":1745288519459},{"_id":"source/_posts/Effective-Java/73. .md","hash":"95a1f3ff9a83a77f7a4fb449dbadd389643c2273","modified":1745288519459},{"_id":"source/_posts/Effective-Java/74. .md","hash":"8eb6f3c815e4b7f2b41b949c2df7485946bad057","modified":1745288519459},{"_id":"source/_posts/Effective-Java/76. .md","hash":"65d6765471e16ba4e17ef34ceaa471afc7fc0fc4","modified":1745288519459},{"_id":"source/_posts/Effective-Java/75. .md","hash":"e663f3502b06e080f661ccdaf344768456bd0a89","modified":1745288519459},{"_id":"source/_posts/Effective-Java/77. .md","hash":"e4ec2077f4c00cf1efc363a590ef16c25fa2eb7e","modified":1745288519459},{"_id":"source/_posts/Effective-Java/78. .md","hash":"96e65c1571023b5bcca872739e918f0b3e68ed5d","modified":1745288519459},{"_id":"source/_posts/Effective-Java/79. .md","hash":"0a5bf93933a4374fd2086d1360f138737fac82b3","modified":1745288519459},{"_id":"source/_posts/Effective-Java/80. executor task  stream .md","hash":"69ed86a33ac7eeffe52e3a0f7809c70a704110db","modified":1745288519459},{"_id":"source/_posts/Effective-Java/81.  wait  notify.md","hash":"8a0f32cc5e543b9dd50b87c2404e6558ff818cbd","modified":1745288519459},{"_id":"source/_posts/Effective-Java/82. .md","hash":"85f2b2bf0041b445b951d90ad042d3b1919099f8","modified":1745288519459},{"_id":"source/_posts/Effective-Java/83. .md","hash":"79d8ea5a4b801922034b94fd176af1b468401bec","modified":1745288519459},{"_id":"source/_posts/Effective-Java/84. .md","hash":"28d253636031ebd980c88737a349c5899af7455f","modified":1745288519459},{"_id":"source/_posts/Effective-Java/85.  Java .md","hash":"96fa8449dd71797bf1a4fbebfebe10963b175acd","modified":1745288519463},{"_id":"source/_posts/Effective-Java/86.  Serializable.md","hash":"5d0844b8b7ae1abdbd37a107c0108a934e16a92d","modified":1745288519463},{"_id":"source/_posts/Effective-Java/87. .md","hash":"e83efee8de2f39fbdd4735f33df8a1713dbdc962","modified":1745288519463},{"_id":"source/_posts/Effective-Java/89.  readResolve.md","hash":"7c6601b666c3cbb5d3f14f62b3b841f942d072cb","modified":1745288519463},{"_id":"source/_posts/Effective-Java/88.  readObject .md","hash":"5bce9a33fb6ad4e6c0972cba60b62c9c70c5a016","modified":1745288519463},{"_id":"source/_posts/Effective-Java/90. .md","hash":"43bb4d78e805b1bfdfec8f60354c92cdbfc42c01","modified":1745288519463},{"_id":"source/_posts/java/Base/JavaStream.md","hash":"f97925e0bc003d76a587f51d4f054629367c60f6","modified":1745107735544},{"_id":"source/_posts/java/Base/ThreadLocal.md","hash":"c02a59a723e192f30c61e683bae0bd79d7884a15","modified":1745107735546},{"_id":"source/_posts/java/Base/Volatile.md","hash":"9b6118e7faf5bbb03d795f94ff421453fd76c421","modified":1745829708383},{"_id":"source/_posts/java/Collection/List.md","hash":"31fe0e881c1f4e9331ac464066a0c8e38503d69f","modified":1745107735548},{"_id":"source/_posts/java/Collection/Map.md","hash":"d3dcf0f60791924d4d7954e31848e96683b1a9bd","modified":1745829708387},{"_id":"source/_posts/java/Collection/Queue.md","hash":"63d8d89d4e7e38fcd0ad135cae0575c60803af76","modified":1745829708388},{"_id":"source/_posts/java/Collection/Set.md","hash":"3fdb5a9b32a3cfb4ef70461dd7581ed50ffe757b","modified":1745107735549},{"_id":"source/_posts/java/JVM/Java.md","hash":"304facf3598dc4156564262b3e55dbac84a4b5b0","modified":1745829708390},{"_id":"source/_posts/java/JVM/.md","hash":"062046151eb98db2e593a1e86b618dabf7a3eb5c","modified":1745829708391},{"_id":"source/_posts/java/JVM/.md","hash":"a97790ddbfcc4e48e2602696e41767aa85e77289","modified":1745829708391},{"_id":"source/_posts/java/JVM/.md","hash":"151918cf15588c074eaa27397dafda6c39f02968","modified":1745829708393},{"_id":"source/_posts/java/JavaWeb/Filter.md","hash":"21a5931ec808e010a76b47a8dad1e3a09c5ae061","modified":1745107735554},{"_id":"source/_posts/java/thread/.md","hash":"cf31bcd923bca9b58d14ec7c829fec9529f5987a","modified":1745829708395},{"_id":"source/_posts/java/thread/.md","hash":"93a82aefc39ba1bdde9540152edf4de83b09fae3","modified":1745829708396},{"_id":"source/_posts/java/thread/.md","hash":"5b2a25189cf1ce1703dc45f54a9a84a5ddbf61d0","modified":1745829708396},{"_id":"source/_posts/java/thread/.md","hash":"a1f71f31ea021c850b065ea198bca3f512877ccd","modified":1745829708397},{"_id":"source/assets/640-20230404215050-p95bson.png","hash":"0478df316349a076dfd91794b6ec861f95a5bada","modified":1745288519475},{"_id":"source/assets/net-img-1665073689906-f5db7615-5190-4e77-9d08-d177ad4026de-20221111215533-4736rjm.png","hash":"ecde750c44c0479a23f40c533748b829956a355b","modified":1745288519627},{"_id":"source/assets/640-20230404215050-qd8x4fd.png","hash":"daf1e3d27b80ee965c951c8f20b739f53215ee37","modified":1745288519475},{"_id":"source/assets/640-20230404215051-hnbb7ug.png","hash":"ecf312e7d0993fac1e8e595a5f4fa15a18e55732","modified":1745288519475},{"_id":"source/assets/640-20230404215051-lu967n5.png","hash":"befacad3f7005229202acebb0eb99f8d6185f7f9","modified":1745288519479},{"_id":"source/assets/640-20230404215051-nrxnl0j.png","hash":"4c94e2699cc8d1d8d5dd12a501c6df744d2e33a9","modified":1745288519479},{"_id":"source/assets/640-20230404215051-rx0ju25.png","hash":"98475a34df76ba664ef881b7e96101e3175650c5","modified":1745288519479},{"_id":"source/assets/6c916769e7f2450157bce49ea9438c10-20230127151312-x7ufhrj.png","hash":"bc1d3688bb55b74d18fb3bb5312e04e13ed5cb5e","modified":1745288519479},{"_id":"source/assets/704e3015827edff48d6c84777aa28006-20230127151312-jonjh5w.png","hash":"78a1c568a73ffdbd297c6f90c52738aa4427d6cd","modified":1745288519479},{"_id":"source/assets/83f121c9c340db46f955badf876220b2-20230127151311-j2wtijc.png","hash":"8c893b97511365f9a8a3cd6f142289cd4ebe5404","modified":1745288519479},{"_id":"source/assets/a0d8c504b2c17abbfb8eb40bc4d86d79-20230127151311-0azix9f.png","hash":"8d9910c06f73d0a0598f8267875b27772113da46","modified":1745288519479},{"_id":"source/assets/dubbo-export-20221214214601-bb3rzp9.jpg","hash":"1b3b5ef646a2870f664342904d7885fb7a69e493","modified":1745288519483},{"_id":"source/assets/dubbo-extension-20221214214601-56szafs.jpg","hash":"ae81b670b3781e6cecc373196218c63bebe89dad","modified":1745288519483},{"_id":"source/assets/dubbo-refer-20221214214601-20gbi94.jpg","hash":"e5c54853878b2f2e74dc1cf081808fd35c8afaab","modified":1745288519483},{"_id":"source/assets/f0b471f40aa64279914a3acbd6e2913b-20230127151312-khh42zb.png","hash":"e9a77caa9da51d1dd93a650495edd99a745ffccf","modified":1745288519487},{"_id":"source/assets/net-img-1665073701183-299298fc-39d3-49a7-80e3-7c1240dbf6bc-20221111215533-jaec6x0.png","hash":"19880cddc5c6a0b4b0bf82eec65beca6a37aee51","modified":1745288519627},{"_id":"source/assets/410360b70936d286a4df4ab2c11f28ad-20230127151311-j96gr8d.png","hash":"9716aecb984c1aa96693f8d1add945965eca9dcc","modified":1745288519475},{"_id":"source/assets/net-img-1665073728272-8bc0096c-6425-4310-979a-28ad42d6e2c0-20221111215533-kvytuuy.png","hash":"fc3ffdbd4ac7bac30b237de89866a8da823d0653","modified":1745288519627},{"_id":"source/assets/image-20230527140729-waan312.png","hash":"7eb8148e69f0cb3a939c5b3dd660545c3555e13f","modified":1745288519495},{"_id":"source/assets/image-20230527154724-v674duu.png","hash":"e57f382e17e0010d0e3684effe9260c649f9aeb1","modified":1745288519495},{"_id":"source/assets/image-20231119124615-vxa33dm.png","hash":"b2c0b04d99f9054312296f671a202c38d21f3702","modified":1745288519503},{"_id":"source/assets/net-img-0010-20230327194235-781jk47.png","hash":"d890a9ab327c0065b186eda3665a77555f66b202","modified":1745288519559},{"_id":"source/assets/net-img-1582873408415-b3e28487-6473-4fff-b4c9-b99b6b91a53a-20230330213216-4pmp0ac.webp","hash":"b22a07c71bb19493649e357ebe8ac92c1c9b80f4","modified":1745288519563},{"_id":"source/assets/net-img-1582873928532-40dd13b8-87fb-4ecd-8e07-399dbc61eeb8-20230330213331-q75g2s7.png","hash":"113b354cea75d36907ed70440faf49fdd397885b","modified":1745288519567},{"_id":"source/assets/net-img-1582874001071-2fe5ab73-14e5-45aa-b07c-81ba0fecc256-20230330213404-cm5njiz.png","hash":"211d2f540d3f18a1a692ba20c674d8cd3fb82a8a","modified":1745288519567},{"_id":"source/assets/net-img-1582874263210-a9e7bda6-4ed7-4d2d-8991-cdad8a2c292b-20230330213158-fukp6eb.png","hash":"3173c36ea570d35dd72ac5faa1a66803ad40812f","modified":1745288519571},{"_id":"source/assets/net-img-1582875390665-923c52b9-52ce-4e6f-9cee-763046546af3-20221030135517-j4zeqi7.png","hash":"112e4849845efefe49ce92bae1b850d6bc40a2d5","modified":1745288519571},{"_id":"source/assets/net-img-1591690708492-8b43720d-e8dc-4e22-9057-dcc4be2210de-20221030132325-ac88yvu.jpeg","hash":"db64f36546b2ae95739190e0994072eaa85dfb1f","modified":1745288519575},{"_id":"source/assets/net-img-1592902119376-b0ab487a-f7f3-454f-a784-aad737462ad4-20230330213502-h755rwl.png","hash":"dda2bfe438c8055100d16d9d7a132b43706e605d","modified":1745288519579},{"_id":"source/assets/net-img-1592902120990-cffe2ea4-a4ed-4505-8bbd-c9b64730ae6e-20230527145229-4455z5v.png","hash":"ad04409d1de7cdbb01b3fc6a8b7368ef80f5d80b","modified":1745288519579},{"_id":"source/assets/net-img-1593008781064-94397bdb-4bd4-475a-b0de-25689df5598d-20230330213216-bqv0b3r.jpeg","hash":"5cf37908a60979b8c0936e2d2ef0a91278f06c5a","modified":1745288519579},{"_id":"source/assets/net-img-1593008911203-7a81af80-db8b-4843-a59a-755e226e2314-20230330213217-h350tsl.jpeg","hash":"24ef0af2cd8bf480c01b58355b9d770de004b8a8","modified":1745288519583},{"_id":"source/assets/net-img-1593009574123-1720bb9a-11ab-462c-9acc-83dfd40a63e3-20230330213217-8hneydr.jpeg","hash":"7450dae97f4e6b2b24b12a60f50c88de1f3f8d99","modified":1745288519583},{"_id":"source/assets/net-img-1593010056655-793ce18b-c4e9-4985-9ba7-ef5347134e12-20230330213219-q7hvhww.png","hash":"f2af6f8b3a6ad39d3064a8c5f9cdbdedb6bf134e","modified":1745288519583},{"_id":"source/assets/net-img-1591690908749-8d13658b-f28f-4a16-9787-5d802366b2bb-20221030132339-jhzqts2.png","hash":"512a93f3e2cca50690d50a270235eabf87b47f2e","modified":1745288519579},{"_id":"source/assets/net-img-1593075259316-cba6509a-9a9a-4282-8698-99fa1fcc0794-20230330213350-b5wkbl5.png","hash":"77ef5f5fc2606eb5cf053d3987ca74886e24df95","modified":1745288519583},{"_id":"source/assets/net-img-1593075298003-cebf8380-65e8-4a56-9a03-72d7f02ef65c-20230330213346-itjo56n.png","hash":"316fdaa407fbf34ab761e6efc3597b56ee6100b7","modified":1745288519587},{"_id":"source/assets/net-img-1593075308254-c4ace563-ded0-42d8-8a4c-435a8bbe890f-20230330213356-yp75ww5.png","hash":"316fdaa407fbf34ab761e6efc3597b56ee6100b7","modified":1745288519587},{"_id":"source/assets/net-img-1593075466359-4fe25412-ad7b-4d12-ab59-556c6203aec3-20230330213411-owuofo8.png","hash":"2befb400a71425c989d9549b0e04b65214e9a716","modified":1745288519587},{"_id":"source/assets/net-img-1593075485480-eabde977-18f7-4a38-9f43-2a2792d14d5a-20230330213419-xbq6pfl.png","hash":"33763d8634927c0ea2ae44579eea5dfb9ae470e8","modified":1745288519587},{"_id":"source/assets/net-img-1593075294735-276336e9-41de-469d-a9e8-b4806bbdc0e9-20230330213341-wrzblbs.png","hash":"316fdaa407fbf34ab761e6efc3597b56ee6100b7","modified":1745288519587},{"_id":"source/assets/net-img-1592902119376-b0ab487a-f7f3-454f-a784-aad737462ad4-20230527145229-vu7qxs4.png","hash":"dda2bfe438c8055100d16d9d7a132b43706e605d","modified":1745288519579},{"_id":"source/assets/net-img-1593076022539-0b41a928-a33d-4749-8e05-a629389f5b11-20230330213208-977tliz.png","hash":"5beb1517d61fedd3981fdb6b992211c8e3e38bc0","modified":1745288519591},{"_id":"source/assets/net-img-1593075510764-fa7e6f63-dbec-4789-a374-d8b319f98994-20230330213428-853fmb5.png","hash":"f1cf27550f04d5863ee0f043848094cab3ba02fc","modified":1745288519587},{"_id":"source/assets/net-img-1596249786159-92610d33-5cbb-4d46-b7a5-6f1c8d3d1d92-20221030135516-9i6hh1r.jpeg","hash":"167542888a2ac22d16444dfffc6c7f3490afa4c5","modified":1745288519591},{"_id":"source/assets/net-img-1592902119321-dda9e910-093f-47bf-890e-4719cb145075-20230527145229-565b500.png","hash":"5339b6e9d1ca86874e2e278dd6576f48f7bca50f","modified":1745288519579},{"_id":"source/assets/net-img-1596783175795-a3a09f05-cdc6-4406-9b0a-0f3f6a28a5ff-20221030105031-64rpjno.jpeg","hash":"abdac5a591401ba625f9906a82d0151d6db649ff","modified":1745288519591},{"_id":"source/assets/net-img-1602914807774-75634a6f-e238-498a-b0ce-e27f039a9646-20221030124604-ehzp01i.png","hash":"c2fbab203e042d7575b5299d478924a0ab8e05d3","modified":1745288519595},{"_id":"source/assets/net-img-1602404087657-9aa12bdc-ba61-429f-bf21-dcf0efc211fa-20221030124615-fz11c88.png","hash":"6a5c2117715720f8a65bdaf2ae575d74a6af7f9a","modified":1745288519595},{"_id":"source/assets/net-img-1602998399972-d63036ef-500b-49ae-a31a-84a558efb1ae-20221030124502-upt9d1p.png","hash":"a4f9f093069a13bd7a44feee16f58851d8c74542","modified":1745288519595},{"_id":"source/assets/net-img-1603004208800-d47ee0f7-24fa-4b06-ae5f-8ce7b97e1e34-20221030124351-wgmd1lo.png","hash":"a869bf0b72f7dff0f0561b8c6f88fe846df28ed7","modified":1745288519599},{"_id":"source/assets/net-img-1602405124816-7ec65b09-2556-4ba3-b9ca-dabf0081929f-20230330213836-e0kef3p.png","hash":"38bf1df28a8794f922982beab6f83a5d86f728bb","modified":1745288519595},{"_id":"source/assets/net-img-1602920769113-5b1bf8b5-f2b3-4a36-948b-721849b796d7-20221030124537-xtsxn6h.png","hash":"e52d3c0fc15cfad4385dfe78e5d863b68ab4ad25","modified":1745288519595},{"_id":"source/assets/net-img-1603013275619-1a15e41e-436b-41ef-bce1-147db82e5a83-20221030124522-yeb4ilf.png","hash":"b4ea1c39bdc1604b038d114feed52f2e628f9665","modified":1745288519599},{"_id":"source/assets/net-img-1603013309762-3689744a-be23-4e8f-8487-d397b3cc7869-20221030124624-9buvwxc.png","hash":"a1bbc1affcf31dfe1308e483e928b285209e921a","modified":1745288519599},{"_id":"source/assets/net-img-1603013197743-541a8456-5d1b-477d-9658-1b6d5c06780a-20230330213832-g2oqx3t.png","hash":"4a4f123a2e54af955404aa1be763bdb3a398ffbd","modified":1745288519599},{"_id":"source/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20221030135532-u420fpk.png","hash":"0ba2d08b26c612f6a89b5726f64087b5c9c84787","modified":1745288519599},{"_id":"source/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20230330213518-3fydrb9.png","hash":"0ba2d08b26c612f6a89b5726f64087b5c9c84787","modified":1745288519599},{"_id":"source/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20230330213518-2ptpa3a.png","hash":"cfc78b0e47b891d1fca9dc54d1ddd78afe90550a","modified":1745288519603},{"_id":"source/assets/net-img-1603013239640-a2f1a79b-35c2-4ca8-9355-5f37e9d680bb-20221030124448-sl4zele.png","hash":"5927bb1371fb10e84599ffcea6c902ddfd9b8439","modified":1745288519599},{"_id":"source/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20221030135532-6itdbiz.png","hash":"cfc78b0e47b891d1fca9dc54d1ddd78afe90550a","modified":1745288519603},{"_id":"source/assets/net-img-1626851086718-49fece61-64f3-4f2e-9b78-f97e17176373-20230101203426-dn382za.png","hash":"46c374ebe93e60a9a4d8bb90d95a77021b45cb7c","modified":1745288519615},{"_id":"source/assets/net-img-1627291037100-eacf8101-ce28-4c56-9c4b-12e59e5a3b26-20221031123408-gsirdhu.jpeg","hash":"1c5326f40d22eab0e2a610f8ccc224b6b9501b76","modified":1745288519615},{"_id":"source/assets/net-img-1627455003158-01c028a9-eb52-46e6-85ab-c811d640a84d-20221031123409-s3v35p9.jpeg","hash":"56c8bddb1d453c3a47d11f847678b667770ff797","modified":1745288519619},{"_id":"source/assets/net-img-1629558034184-e1fe6601-777e-4a34-afe5-df37e5a9b720-20230330213445-e5uive7.png","hash":"550f368c0231a7e2f3021034569cc665d57a6787","modified":1745288519619},{"_id":"source/assets/net-img-1629559055065-5ad8d49f-81b6-45f3-87f8-c98716f799ed-20230330213451-7nkjlzc.png","hash":"3110a1357dfb77908084b87a5f8f8f745e16c988","modified":1745288519619},{"_id":"source/assets/net-img-1629870852837-ca139768-9f26-412a-8940-49ed6e38f57a-20230330213513-n1dmxgm.png","hash":"f5a30dac1d0f59a46c2637d318ce03b66f3121fa","modified":1745288519619},{"_id":"source/assets/net-img-1629559366006-0194df18-86f2-45fd-bd85-6f675b19bdb0-20230330213459-p7i5mm5.png","hash":"8f1be2292fcd61ed11916df32996d0c842f5868c","modified":1745288519619},{"_id":"source/assets/net-img-1631431982904-ce964c3b-4c64-4915-84a9-a3799dd2cf92-20230330213415-i9cgn1s.png","hash":"b770ae567fc87b114ec3116386d0e37edfc9a2be","modified":1745288519619},{"_id":"source/assets/net-img-1629560137959-ab93eb78-c083-4c80-8283-4cfc470c8af0-20230330213504-cteixk9.png","hash":"8a0f3c4fa62305900746a569186fe8839998f8ed","modified":1745288519619},{"_id":"source/assets/net-img-1646742883104-4eef3a95-3655-44f4-8887-2f5f1628732e-20230330213506-2xv20ln.png","hash":"1d55719d69d55b681aebfcccafda70e697684387","modified":1745288519623},{"_id":"source/assets/net-img-1626854477699-226d8221-ae45-44f5-b8fd-6003efd2531c-20230101203427-giho3sf.png","hash":"0f80ac0b2a2e4830fe7920af14fe54f5fe460552","modified":1745288519615},{"_id":"source/assets/net-img-640-20221123124059-5desc25.png","hash":"a0672bd10f97851a80294820734c8fdb8a83f76b","modified":1745288519635},{"_id":"source/assets/net-img-640-20230330194058-16epkoj.png","hash":"48e84cd029773e8adf0980b45354c56ec2e3df71","modified":1745288519635},{"_id":"source/assets/20210417191156743-20230127151311-j5awou3.png","hash":"660496d40debc115e3ecb4090bde67e518a9c6cd","modified":1745288519467},{"_id":"source/assets/20210417191245920-20230127151311-nf45pi0.png","hash":"59a93eaf67fc22a0ee5e55946fbe512406428c74","modified":1745288519467},{"_id":"source/assets/image-20221212232058-z1xl373.png","hash":"18ca78dfb60a0cf777cae7740f1c1299ea350062","modified":1745288519487},{"_id":"source/assets/image-20231117162020-0zic8ee.png","hash":"dd464a6d6f989f1ed302272194b29de04a038e68","modified":1745288519495},{"_id":"source/assets/image-20231126145713-0pou43f.png","hash":"427762194e416a4ed7a0a2cdc5ad9739a45ed666","modified":1745288519527},{"_id":"source/assets/net-img-1582873589321-1b21962d-3411-4d4f-af00-b2a82490e43c-20230330213311-i7hquya.png","hash":"fdfd6b2907a88b48a698e9051e943247d301de4e","modified":1745288519567},{"_id":"source/assets/net-img-1593010032163-e4fd6098-299b-4fac-adb3-b40e6ca3e534-20230330213218-jvzy0d2.png","hash":"69211aafe949bffe6da5649c54a6412496e2ddbe","modified":1745288519583},{"_id":"source/assets/net-img-1596005642573-853dc49e-7632-496d-9221-33e3b7879fea-20221030132325-84wdxkw.jpeg","hash":"88284c1eecce4f4b1bfc5382f8d4e08da4fccaf9","modified":1745288519591},{"_id":"source/assets/net-img-1624106093230-4372b31c-0d0f-4640-8e80-62b7bdd258e4-20230122192859-kbq2rlz.png","hash":"cb34bc60f583ed3d34b50574782211e0bab66919","modified":1745288519611},{"_id":"source/assets/net-img-1628905841173-c32bdb25-8b61-4f16-b08e-96898d7aeefc-20221031123444-2pva1h4.png","hash":"df9133d35fbddc693f913c6408a877dd58c9cd34","modified":1745288519619},{"_id":"source/assets/net-img-JDgR0O-20221030104726-xwobg2m.jpg","hash":"fa78b0c2612032e75f6b98f6509907b82332f666","modified":1745288519635},{"_id":"source/assets/20210417191226786-20230127151312-304h995.png","hash":"65b978ef856e5df70bbdc66c70b1d30e8b7b4ca4","modified":1745288519467},{"_id":"source/assets/20210417191255980-20230127151311-y6imh9a.png","hash":"69c83af75684b8f312f1255172bb7ad86f1de3b3","modified":1745288519471},{"_id":"source/assets/dubbo-framework-20221214214602-6xcgoty.jpg","hash":"956b54b92bc5c11635909a706fedde850930b89c","modified":1745288519483},{"_id":"source/assets/image-20230424141422-t5zbclo.png","hash":"83d623939686dc82dc41dca9e4815a4525816258","modified":1745288519491},{"_id":"source/assets/image-20231119124137-6apottn.png","hash":"eba7b1aeeea6dc0ee781cc54a0bfb8775bafd568","modified":1745288519499},{"_id":"source/assets/image-20230503214900-rmo1ydd.png","hash":"63d8124aaaf884e4c986b5aae4ae5db51aac6991","modified":1745288519491},{"_id":"source/assets/net-img-1582873583782-b5959bc6-9ff9-4ef1-95b3-9bc3fc1f83b9-20230330213307-m55wdql.png","hash":"e912d62b4c896916fb1eb15eb98b289666bc69b0","modified":1745288519563},{"_id":"source/assets/net-img-1582873594959-8501a655-dbe2-4983-9dcd-a33bde8f07f6-20230330213317-uu5k36v.png","hash":"a3c98651944a4bd158b0c2f5ec65dfb41b81a10c","modified":1745288519567},{"_id":"source/assets/net-img-1582875574292-5a9c3846-0673-451f-8a69-409c0c8dff9c-20221030103933-qh2ia8u.png","hash":"68c2624cfa788b453075a0902037673fffb432aa","modified":1745288519575},{"_id":"source/assets/net-img-1591690708399-bf1076aa-bdad-4e5f-ae30-261ccda91da5-20221030132327-4fweook.png","hash":"7a3f29db0804640a4084eed5e235dd6dea3ce1b6","modified":1745288519575},{"_id":"source/assets/net-img-1591690708909-03b304db-aa14-40fc-954b-2e5812e31b86-20221030132326-7iwfv9t.png","hash":"f30f62e8044d03122bcb10c1ecd936875c7864b2","modified":1745288519579},{"_id":"source/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20221030135532-iwc3p25.png","hash":"c593a666fb33cded85ae00413ade1c031882e5e6","modified":1745288519603},{"_id":"source/assets/net-img-1615619453470-bdab6e23-1385-4538-9c91-ceefcd05aa27-20221030135542-vyoxljv.png","hash":"30dfe5dcbbf79426f99197afbbfc3aa083e57836","modified":1745288519607},{"_id":"source/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20230330213519-1im5mrq.png","hash":"c593a666fb33cded85ae00413ade1c031882e5e6","modified":1745288519603},{"_id":"source/assets/net-img-1626851420391-9aa6cf8f-fa40-49c3-8a7a-941763583502-20230101203427-ybsosns.png","hash":"6c668b516ac102fc9727189230944b007d90baaf","modified":1745288519615},{"_id":"source/assets/net-img-1665073584346-6bc72f6a-0e4a-412e-94bc-81d860d5b059-20221111215527-k046iu2.png","hash":"8519cb1ad23cd866b3ba9254ad90fc4b7573732c","modified":1745288519627},{"_id":"source/assets/image-20230619222624-l98xjgi.png","hash":"cc14f495702df91cabd340194168ec55a3e3b060","modified":1745288519495},{"_id":"source/assets/image-20231117164621-qjdsktw.png","hash":"2b6cd4f708d015427be913cc191aef6258dda2dd","modified":1745288519499},{"_id":"source/assets/image-20231126155909-4zbslm1.png","hash":"0b7402beed24ffef50fb48547963e9c61644e8df","modified":1745288519527},{"_id":"source/assets/net-img-0011-20230327194235-6us5fo3.png","hash":"89253aaf65febdd684c337f9e7c82ab551a6fa73","modified":1745288519559},{"_id":"source/assets/net-img-0012-20230327194235-dpf6how.png","hash":"2176e4249b48413bbcbce7d6b9d27a34cf32a265","modified":1745288519559},{"_id":"source/assets/net-img-1582873565810-556fde0f-9973-46d5-9e8e-4853e80b6ba3-20230330213302-b5p12uc.png","hash":"52803510a8272e7507289a0acbaa5967d16c9a5f","modified":1745288519563},{"_id":"node_modules/hexo-theme-kratos-rebirth/.prettierignore","hash":"ae49ab74482bf0157ba7d30c21f5941a754ace36","modified":1745301264564},{"_id":"node_modules/hexo-theme-kratos-rebirth/.prettierrc","hash":"5f36b2ea290645ee34d943220a14b54ee5ea5be5","modified":1740119171853},{"_id":"node_modules/hexo-theme-kratos-rebirth/LICENSE","hash":"3dbbc837c7fd9be599f14a285e5fb5d48b4d8870","modified":1745301264580},{"_id":"node_modules/hexo-theme-kratos-rebirth/_config.yml","hash":"e846ad285f81a1b0af1ad76784d7b030f31249ea","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/ReadMe.md","hash":"8837b333650681cd3b84dc2880b7106e1beac8bf","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/package.json","hash":"83c1684e5162b62eb0b6869a7e5aa94f19ac772b","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/.husky/pre-commit","hash":"d93c558f564ea45c405fb08da13309ad3642aecb","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/devtools/build-once.js","hash":"60d86d0bdd3807ce33c544e2bacd8968b228e8e9","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/devtools/build-options.js","hash":"a433c50501cbb60b21d3e38632e59d8a2fa5276a","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/devtools/build-watch.js","hash":"d657fcec297bf6240f41ee442937b57d3869e18e","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/languages/zh-CN.yml","hash":"b77108a02d38755aedcb31a6bd900b054540c9ba","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/archive.ejs","hash":"623ff5552eed30c929173a94495cc0408e716635","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/category.ejs","hash":"5677b70953e6a33038a0e03eaa06e45c10ec7d73","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/index.ejs","hash":"a8726925ebdf84617b508bf1a018a2b89ae1d4e6","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/layout.ejs","hash":"a092091234ed2934f5eb00c1bc286a1129afcad1","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/page.ejs","hash":"57c2d595e2dce3e4d9a6153c4a0f4c9f34bc2e44","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/post.ejs","hash":"0e7ecca733e658f4c6c9524fdd3084f9026d16ad","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/tag.ejs","hash":"5677b70953e6a33038a0e03eaa06e45c10ec7d73","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/additional-pages.js","hash":"61dcde531a4fd414fbc8c9c2b6ae92eac478db12","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/cdn-optimize-helpers.js","hash":"317191b128b031c3ba885c9a4dff68f28e070bfb","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/check-update.js","hash":"8272cd8c8dd22837f6f262c8e05b26099fdfaa87","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/gen-jsconfig.js","hash":"6e1aa475e99d5eac47d593ee46bf5e23543bbc3f","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/icon-to-html.js","hash":"d73e554f974fa8cfe702d986269e2ba46ea3a8d8","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/process-template.js","hash":"a0ba35be0a9b392c6f13b36c2bc127fac7ffe16d","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/search.js","hash":"7ca740b0f8dd084516eeda9c52b77ab04bed3a5e","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/tag-widgets.js","hash":"db83b945bc7c0710e085cac6f5f4985f92b411ba","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"b07412f7926bd6bc9a2d327ce9c7ae67e548ba66","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"7200fed1dfaaaa4d54f9c61fe1239f0ee040a6c0","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/.github/workflows/auto-release.yml","hash":"4fbe5b7c5aa47ea6c1116bd84de3088007ffc21b","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/.github/workflows/build-demo.yml","hash":"02bc61088feb85bebd4871006319c04d432b74cf","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/.github/workflows/build-test.yml","hash":"7ebd5e1f844b1c6cb67737566d7ff98eb843a0bd","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_index_style/card.ejs","hash":"ecb8a3368dadc0cf5df3c9305514f2313297f3fb","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_index_style/half.ejs","hash":"6ae5385151b0a9c94822087f8e316d1eb147bda4","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_index_style/status.ejs","hash":"5923b8dc74b161248db1f91db191c61b674c3430","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_modals/donate.ejs","hash":"9f4bbd3a03419c1da4a6157fc574b88846af8083","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_modals/share.ejs","hash":"7cea1da7c4579f6829b2f832e7d18fd730b7c258","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_pages/404.ejs","hash":"08babbe40015929680457cfd521832aad807dbdd","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_pages/categories.ejs","hash":"dd6c136ae3a28c6992500996d151a6083056797c","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_pages/search.ejs","hash":"dd050df8ce5a1bd3d4ac3091bacc4a24a993b7a8","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_partial/after-footer.ejs","hash":"7b1947b1454f106a72acc63197509141a9a5b6c0","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_pages/tags.ejs","hash":"6464e6a80cec58a7c517496a11e483d691f7abb0","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_partial/breadcrumb.ejs","hash":"deeaa93ca7513bc33a65797d7d5a66c9de6b16b4","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_partial/footer.ejs","hash":"676189d9fcaea6eb05c2dfa78c55205acd899302","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_partial/head.ejs","hash":"f25f3267b4f2caf6e66371b5a5527f97af7c9805","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_partial/header.ejs","hash":"9548a96fb6c1e3f37258ad3ef0817a4d9c13476d","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_partial/sidebar.ejs","hash":"ed0f28964cf73a8d90ba4dcaa992a66d42b13a35","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_widget/about.ejs","hash":"f970ca289ab43e715181cbbbe6c824d7880bf495","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_widget/category.ejs","hash":"b5494d86c54731125eeb93e5f93c2c978dbcc385","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_widget/posts.ejs","hash":"e48374fc0ca4e9ce5fe63483aa8f8504a92aa5c2","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_widget/tagcloud.ejs","hash":"d0f6a1f768c0145f7e76fcae9715d575a7e2c37d","modified":1745301264600},{"_id":"node_modules/hexo-theme-kratos-rebirth/layout/_widget/toc.ejs","hash":"10e8b0ca50309e9a7220edee38faa0b7321cab02","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/scripts/lib/cdn.js","hash":"d5ed17a54dbb710805090ca27b3bea102872da94","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/kr-core.min.css","hash":"d72a0b5e296f5e1f5a09bb28cd6ca6246d50a32b","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/images/404.webp","hash":"e07a240ab6ddeb77ee28a9531e0bc94077206248","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/images/default.webp","hash":"6046fa3912d7001afea7e3634fc093ec7da3e7cc","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/images/user.svg","hash":"9875dc6c4d296886d642a8ee3049db8aad406184","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/js/kr-core.min.js","hash":"09d85de8fabc5d9d355c25b44adf8b32b3a42694","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/js/kr-pjax.min.js","hash":"33842dc1a48f91ce3731baa6adf1969cf1443175","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/js/kr-search.min.js","hash":"f21b03b0515aed07efa86f7103b5262bf20793f1","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/js/kr-theme.min.js","hash":"b951ed9d6d15cc9424a49012672276543fdb935c","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/kr-theme/dark.min.css","hash":"90c00f4c65f93ff5151d98d7722302944e4e3389","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/kr-theme/light.min.css","hash":"3cfcb3ac03bc1349febe5cc8012fe1c67939b3fb","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/js/kr-modal/donate.min.js","hash":"899cf6376b6a4d2d0075f81ef25c684f40a85727","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/js/kr-modal/share.min.js","hash":"b8ce793233299bfaf6290d238ac531d328b6c4f8","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/History.md","hash":"38f837f30c75bed4b8990b36fdf540fe3c63ccd3","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/License.md","hash":"bc3e61d337e51c177534c644c20f190148d7905e","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/Notes.md","hash":"e7b5de6240b6918cbdccc708a06e4b20555966c1","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/Readme.md","hash":"63959b38ef0747eadd6f731b48d7aded7edc227b","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/bower.json","hash":"55980d38b6f24ec91f44579bcd38c667986368c5","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/component.json","hash":"ecbc4792d8583f73050dd4d918fea8073a7ded60","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/nprogress.css","hash":"17ca817a091da9dcf5fe0f2f1e1f2eea60a33149","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/nprogress.js","hash":"a7e1146d2021c42e68b599dc8bcc69d44fc31df3","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/package.json","hash":"574122118ffc8d4705e58806a13612553bc41588","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/highlight/highlight.js/light.min.css","hash":"630129eab75776f1cf68122efd511a41d1ba2f71","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/highlight/highlight.js/night-bright.min.css","hash":"824090a9fcbd60dbd79711c739c83c1a49d014d1","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/highlight/highlight.js/night-blue.min.css","hash":"d2b9c867d6d07e2068e85229f65bcf647b0337a7","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/highlight/highlight.js/night-eighties.min.css","hash":"48af974844df43711328280d72d9659a55407cac","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/highlight/highlight.js/night.min.css","hash":"b62bd2c95fb37281235d2d6fa874605560cdb252","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/css/highlight/prismjs/atom-dark.min.css","hash":"b99f782c938ebb1931ed3c7ea0aa2b16fc25ed16","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/test/component.html","hash":"5965cc7f9bb812ada1ffcd6abec39124c20a4ef8","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/nprogress@0.2.0/test/test.js","hash":"5c795debb89ec7d35ba1ec1e8ccbab0a7a353d78","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js","hash":"ea4d54224b3a1737c90bc1bba2d5742b75a60ee9","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/viewerjs@1.11.6/dist/viewer.css","hash":"8cc334ada7b80acd5a4abba27eafa401955fe579","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/viewerjs@1.11.6/dist/viewer.min.css","hash":"2e91a988d09aa17b3ee69463ec65a8b4447ae40c","modified":1745301264596},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/viewerjs@1.11.6/dist/viewer.min.js","hash":"8078b489658d7230e04069cefc84b99e1037f768","modified":1745301264608},{"_id":"source/assets/20210417191320754-20230127151312-g8jrdjp.png","hash":"dd1d3cb238af5550eef55056b50966793c34a226","modified":1745288519471},{"_id":"source/assets/image-20231117162030-ue9pyz9.png","hash":"6e9f29720c323a223db23d759b2a8c181b083ec3","modified":1745288519499},{"_id":"source/assets/image-20231119154230-3g5nidd.png","hash":"d6d544370fb3424614200bc4e507736e1232b51b","modified":1745288519503},{"_id":"source/assets/net-img-0002-20230327194009-43b76u4.png","hash":"fc814defbecf370c56170ac0d15f3e0b93b51696","modified":1745288519543},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1745301264616},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/viewerjs@1.11.6/dist/viewer.common.js","hash":"d86e95961369ec9383f89341dbe31e8d20db5033","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/viewerjs@1.11.6/dist/viewer.esm.js","hash":"1a76a6022b5c390eb786d7b3250a7e3c91d27389","modified":1745301264608},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/viewerjs@1.11.6/dist/viewer.js","hash":"471c93ce111abf02029a06661df79a4105f88408","modified":1745301264608},{"_id":"source/assets/net-img-1615619423077-dea312ee-787e-4a28-b723-199f76a214f7-20221030135542-mx20k3e.png","hash":"b4a5bed105f3d44c025b27c1b0f747b200b1fa27","modified":1745288519607},{"_id":"source/assets/_20221129215049-20221129215137-xy69pf5.jpg","hash":"49e75019313beb7dd36c03005938a4ab6dfed887","modified":1745288519639},{"_id":"source/assets/3fdc14e6be9f37b481abe633ac866a26-20230127151312-ko7ta8u.png","hash":"38a30a877028e896cb01f9ce849c88f4899a0c9e","modified":1745288519475},{"_id":"source/assets/net-img-0004-20230327194009-xusl7vj.png","hash":"4a31fef67d5662833fe069a5965459f3ad532818","modified":1745288519543},{"_id":"source/assets/net-img-0005-20230327194009-2m11zb7.png","hash":"45ecb280911ffd95feee86b4e637a127b22603ce","modified":1745288519547},{"_id":"source/assets/net-img-0007-20230327194009-obwi5jv.png","hash":"476b8a60e579a08ef8157ccece03e7a4ae3a3303","modified":1745288519551},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1745301264612},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1745301264604},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1745301264612},{"_id":"source/assets/net-img-1624109586831-fa30fbaf-01b4-4243-bedf-eedfe9631e67-20230122192859-buewr2p.png","hash":"e01f630b8f5bfefca0023ed64d4dcd7312b63643","modified":1745288519615},{"_id":"source/assets/net-img-0006-20230327194009-rdpidiy.png","hash":"90897c9c0c5369590efb4a3cb707f196222708d4","modified":1745288519547},{"_id":"source/assets/net-img-0009-20230327193706-lo1au43.jpg","hash":"b93578b5b9afce553dc98288e61d622408b19084","modified":1745288519555},{"_id":"source/assets/net-img-1623829860526-2438b2e1-de01-4c73-aa21-84e18c00d37c-20221031123408-wcse42k.png","hash":"0399712737ef6427d49e48d5d63dfbd23bf40e4d","modified":1745288519611},{"_id":"source/assets/image-20230619222818-5btwdt3.png","hash":"93d229df154b33632dc0fd6321f7d5d3348f7e08","modified":1745288519495},{"_id":"source/assets/net-img-0008-20230327194010-vj80p08.jpg","hash":"23b7ee822c099a0ba6d0236bbf138c14802582cc","modified":1745288519555},{"_id":"node_modules/hexo-theme-kratos-rebirth/source/vendors/font-awesome@4.7.0/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1745301264612},{"_id":"source/assets/net-img-1665073741703-3acb8484-f36b-4738-8769-c50625b23727-20221111215534-pwccic8.png","hash":"6a5abcd2924620571b61900f720e35f9771a1147","modified":1745288519631},{"_id":"source/assets/image-20231202123415-e2licnx.jpeg","hash":"e36fcb08b0e84f5f0ee2669fdeed9debbe0dda49","modified":1745288519539},{"_id":"source/assets/image-20231119154304-hwfdw8h.jpeg","hash":"a4f9157154e31ff5efa456ba1cda9e9dbc676bf2","modified":1745288519523},{"_id":"node_modules/hexo-theme-butterfly/LICENSE","hash":"c8bc7df08db9dd3b39c2c2259a163a36cf2f6808","modified":1745301884931},{"_id":"node_modules/hexo-theme-butterfly/README.md","hash":"e1b9096ae0c4e5ef0a911aec05dbad4a3aae3173","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/README_CN.md","hash":"92e45255b8725f0a00450c88fcfd51ec61e1db67","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/package.json","hash":"0f469650107841dc1dc716aa94b3ca2bb0721762","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/_config.yml","hash":"7166aff350fcf84cbc01835fad5731eb855cecd7","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/plugins.yml","hash":"a2704f0406484fdae3410e9992cf996f9859356e","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/.github/FUNDING.yml","hash":"da5e77f5e0cdb7e11b36546fb6796d10e3dfbe5d","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/languages/default.yml","hash":"a2c938b1ef69195aec10c90dc7d1871953548e01","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/languages/en.yml","hash":"a2c938b1ef69195aec10c90dc7d1871953548e01","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/languages/ja.yml","hash":"a281d3cc3e117e90597b783dc5569dba3976d2eb","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/languages/ko.yml","hash":"c7d861c58f204f47a5b4d6e118e1f1e8fb8a852f","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-CN.yml","hash":"e0bf36edf18cf3380b900be7528b536252990c26","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-HK.yml","hash":"bac3063ad2892be232f7d91361c28585a3cc7eb5","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-TW.yml","hash":"bd7ee35aa30964493d2729ef105bb86331b096c3","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/layout/archive.pug","hash":"bc77220dfc269b8faad0930e1a4142ebf68165e5","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/category.pug","hash":"a7e9805a781e34e38d27462e6ce2a5821c34bb9f","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/index.pug","hash":"a93004cc8ec8050df603d32a6e6e02cd96fd9875","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/page.pug","hash":"7ce2a49c6c41847de4ccea377ade116339984434","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/post.pug","hash":"65c4a49c65c3fc4d9dc88b9791a75710c698c3a1","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/tag.pug","hash":"ca5333bd262cb58c195c844b593a0eed0c721766","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"10ce05c8dbde09f53bdabe40b5388de9ccc71a31","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"63ad2249ad09fb3fe21bd5ff9adefb304a7ab24a","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"6e0f9470b18bd37d4891282ac73d61676b040e8c","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/publish.yml","hash":"e320b40c051bae1549156cd5ea4a51383cf78598","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/stale.yml","hash":"4040c76547e270aaf184e9b219a44ca41bbb1b9f","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/additional-js.pug","hash":"f9b02aac0dbbb2b71c037dd215e70c8b7ec7741c","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/footer.pug","hash":"6bd41add3a45e55d5e51eab5285a2d1a909d37f3","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head.pug","hash":"1d11e334b22dbbedcb0f751f9ee9789d4416605e","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/layout.pug","hash":"e5e6c05a621483b3542f2884e8ba45e84b1e973a","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/pagination.pug","hash":"bd45e6fa935ace9cb54499b0491dacfb78ccc354","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/rightside.pug","hash":"43f951b639038f3bc01deea03368d8dcf492cbb0","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/sidebar.pug","hash":"3e65b7bf6bccccbba7e15349f0a44f15c64c5b5e","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/scripts/common/postDesc.js","hash":"272613a71d16f0de6dac883be4839259f774be76","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/404.js","hash":"039fc75f363d79669b0b2177d929cdff6f2ef7a4","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/cdn.js","hash":"7864ba45716c51aef8d8b04fd4bc212e0008ce3b","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/comment.js","hash":"7b1b16e1e8e08245a345764616956be50487eb53","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/init.js","hash":"ce68e84a9ccfcf91100befbaa9afc392a0cd93bb","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/merge_config.js","hash":"10ffed853a935498f1f5da2c5b57200c957874a7","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/stylus.js","hash":"bac639c404588ea62e601ef0bcd368c3bd0119af","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/welcome.js","hash":"f59e10305fef59ea3e62a7395106c0927582879d","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/post_lazyload.js","hash":"b23108d29fff3e32384d8689c8bcd2ab306a1ae7","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/random_cover.js","hash":"20a6ebf63439501a4b3fc81e7a2a2ea5d103bace","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_archives.js","hash":"3eb0bbb1288dc7b0ff82cc46ceb53bd666893416","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_categories.js","hash":"0cdf781a8c14d7b50d309e69f282ec7b178804bb","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/getArchiveLength.js","hash":"bf77635e920eaf52bceebc95f87c7c87a7ca8038","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/inject_head_js.js","hash":"00c5742ad1c75b3c5684d02ffc6a1921399e5376","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/related_post.js","hash":"950b7d0966429bf0f9e6c5e1161e50e545e320b4","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/series.js","hash":"45367c4ce827329867dbcc750ec125da9ccb2cfd","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/page.js","hash":"a07b586b510aa2df953102d998e84207acc34f9b","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/button.js","hash":"2f44e1b3ccd170b256eae178299d6fa933a8d490","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/chartjs.js","hash":"195ba802d7e8406c155124a9c939a2318f82938b","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/flink.js","hash":"25eefe10189caf3910a0e5d5b2f2043ae9255531","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/gallery.js","hash":"fa3d0a64f7fce4aff7928d4ddd95548978ba001c","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/hide.js","hash":"f02fb085a88a2c0c82aeffacc24e1b71c74bd7c0","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/inlineImg.js","hash":"89c6c78d2db43b190055d5690741a79bab4f3e7e","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/label.js","hash":"cf0bc17d0180231167cc6aa8a00fc64f198cb9f9","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/mermaid.js","hash":"50d8d8fac5c5b6e26317028895d7d82a2cf46606","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/note.js","hash":"e68d8d21f3a86e3646907a3685550ee20e8d4a9f","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/score.js","hash":"f589fb6646bd17cf12d77a9b251dd614e1c8b899","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/series.js","hash":"40bc9a065e3a1423e0e66f4911e00713ca9f5e9e","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/tabs.js","hash":"3c486b149e28edd1a06843f05a5c355000991b82","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/timeline.js","hash":"176804f07567aa80f1ed95897a968a996b155dec","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","hash":"b13d96924a5534bff91d75566b196ac87b4fac22","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","hash":"d1eec577074ab7b262182885576135bf1896e12c","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/source/img/error-page.png","hash":"d2519710498a871ca3e913c57e2ba20a805b6430","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.ico","hash":"455ac256580bf31a45813dbbdb87219bfc8bfb04","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","hash":"fdb5482d04a75bd79946ad1ed291d281d0e9362d","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","hash":"5a52047b8520f79864d5a4ee2379a29751aead23","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","hash":"48637ad8e405306772b93837f33400bde1055819","modified":1745301884943},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/Open_Graph.pug","hash":"e93a36d3c29b5a02c7f26a23f96e1f84b063cbe8","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/analytics.pug","hash":"e792a435afee1f9491095084a00dc77e3522c1fd","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config.pug","hash":"9ea75b06f19bf356f340f4a3fc1bdc0713cfe445","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/google_adsense.pug","hash":"f29123e603cbbcc6ce277d4e8f600ba67498077c","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config_site.pug","hash":"56a3c32de1a15627ff38c67f1131cdd6ec5ac924","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/preconnect.pug","hash":"1e1a69aa2cbda2e621c741b3802093244b3cc04e","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/pwa.pug","hash":"83ed05ef1e39f2ee70c3fba2cf96e488d8ffec66","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/site_verification.pug","hash":"5168caadc4cf541f5d6676a9c5e8ae47a948f9ad","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/structured_data.pug","hash":"1b83ae33961528f128596753fd05067c672d6bff","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/index.pug","hash":"44331c9db74b281b5c5c41439d3407a9076df1a1","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/menu_item.pug","hash":"733184f88e3a586a5fcc9d193ad500556b6c8eed","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/post-info.pug","hash":"7d799c4694adb6e265e3f4b975d7f7f6a7021a17","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/social.pug","hash":"e2d31e0f450ad42c47f7ee96375799342bf2f19b","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/nav.pug","hash":"18b984ce184ea53d2dff5a03cc2d0d39d2ec3406","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/fullpage-loading.pug","hash":"a2f7d69ca7ec58f24fe7d4e04ae21d5b62b01567","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/index.pug","hash":"d76ce71ba106e350670c021a3dcae57547d01830","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/pace.pug","hash":"9d2d539555bab495959b9df734ed5c43a9f9e5a9","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/article-sort.pug","hash":"ef7afe0df7a3746744ac8185da7163b7406120ca","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/indexPostUI.pug","hash":"f3389fa9ae4fa32e3c16573286583bc3023e57ad","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/default-page.pug","hash":"efb40388e37cca0b5e7c3c66e811a42f8d32c910","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/404.pug","hash":"15d32c511e4875066fcbe9cb84c3ada07b5a7c41","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/flink.pug","hash":"6b0fa5f048aca8e9cbe56978301af918cf7ac34a","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/shuoshuo.pug","hash":"b2423cfc57a5e3a0e1112ff7c18d5c5c720d89d5","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/tags.pug","hash":"79ad31eb72a9e14007770b18a426406a25315b38","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/outdate-notice.pug","hash":"b7ce9484bc5c97ea6154f0b78fb9b8951fafedbd","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/post-copyright.pug","hash":"b96c232e5178d927987791d9ae386dd83679535a","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/reward.pug","hash":"db92f25ff3fd061882f81bf74ca560ff66983a0c","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/aplayer.pug","hash":"ed79fef5b5025415ea12eaed970f3fe7f6ef9596","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/effect.pug","hash":"43014bfc63583d3ee8808d526dd165848c0ed52f","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pjax.pug","hash":"efe4f8019632b51c92c4f7628758538305e06e47","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/subtitle.pug","hash":"236c3ce26dd76e80b04d457789475c42da5ac0c8","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/prismjs.pug","hash":"88f979a0b1a19eeb0db229247833bf9c6865c3b9","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/umami_analytics.pug","hash":"bc35a1552d26ecdeeadbf06300078dbb5128a6e5","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_ad.pug","hash":"a8312b527493dabbadbb1280760168d3bc909a3b","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_announcement.pug","hash":"21e019bdc3b1e796bb00976bb29af2d51f873624","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_author.pug","hash":"1aba8aa7cd767dc96879d13a13b4c8ceb9023233","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_bottom_self.pug","hash":"1dba77d250eeebfb6e293d504352c7e9ea31980b","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_archives.pug","hash":"73d33b6930e7944187a4b3403daf25d27077a2dd","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_categories.pug","hash":"66e383b4ef374951eb87dd1bf4cdb7a667193fb5","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_newest_comment.pug","hash":"d8753772889b5d0f4d15639ed6af5e91e53b1d03","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_post_series.pug","hash":"e0bb72fa0ce15964b11b8fe421cae3432394e35f","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_post_toc.pug","hash":"1dd19a564320d248dbcee7f118a5b96c6466da65","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_recent_post.pug","hash":"bb842d2aa6469d65bf06af1372f0a19a9e4ef44c","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_tags.pug","hash":"842b772a387b576550fa127030e1c2e9bf65716d","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_top_self.pug","hash":"7b5ae404a1205546b7de4be42291315cf918f2b3","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_webinfo.pug","hash":"fcddd80cdeb6aa81f342cd9f0102302f6ba087a8","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/index.pug","hash":"45f620cd87b9ef2aa9d1e024e697ed6b4eecff34","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/function.styl","hash":"d12340a7df4601b9a23f070e16645861aeb3bb0a","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/index.styl","hash":"4fcb8222b9548e22f7b76f12d33e3698240cbae0","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight.styl","hash":"67062d597408068e4a59e95851e98fed34b745da","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/theme.styl","hash":"a51edfd3e499e7d38c32241c40e8e4d371efca73","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/aside.styl","hash":"ba174889e770ae9f6683379b9eae9d8c94253080","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/chat.styl","hash":"4cc02bcbaa4a1933a82a9ea57a603fe2d059fc77","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/comments.styl","hash":"fbfce4d67cacd1df22fb73d89d008693f59d9d91","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/footer.styl","hash":"d7b988d8588207086670f39aa49fce442c429f7a","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/head.styl","hash":"094108f2a4e351a2fa496d6bd3e2388151416b3f","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/loading.styl","hash":"f0b01bbf321c2c24fdccaee367dd9fd448031a72","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/pagination.styl","hash":"7d7554573c005399bc8c2264a85896d2d51be1e1","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/relatedposts.styl","hash":"ef8e8549fe7ad4b99793844a93b4a89f77f417d5","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/reward.styl","hash":"d9cdf564a822a585e67fd5bac8573ba87eeb3743","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/post.styl","hash":"543eaf9c7df7e0db841e5946ee5f9082c3c46290","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/rightside.styl","hash":"a0f5835f04358122e8b1d38dd3e8da09a1b5b431","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/sidebar.styl","hash":"084dc4dfb41f55e237a9d6cf8c2f5dba729b83be","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/third-party.styl","hash":"0af7c8754f04bdd9a02a14d880774753bd2e35ee","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/darkmode.styl","hash":"4c9849df9c68d892c7df0ca28123aeb0dc9dc424","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/readmode.styl","hash":"ad66212554468b7067590308ed4cf40524fea662","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/404.styl","hash":"205ccc7d0ec6ce1193b46bc0c9ce0385594581fb","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/archives.styl","hash":"5abe5480d83ff8b452a780a484d50a44091475bf","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/categories.styl","hash":"c4cda7b0c99015df29ce00fdfddd2f7679653754","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/common.styl","hash":"dcff804c4c237e1e908481b44c1ac4e39ac0da34","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/flink.styl","hash":"1f8d715faf3b91b53426e38195c0920afb3bfa1c","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/homepage.styl","hash":"992d192db7d1c96e995b85ed11c20c571d33fbad","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/shuoshuo.styl","hash":"79bb1d9a27822ed5675d1e52f5dbd0e2f5d5010a","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/tags.styl","hash":"7543bb688876a946538d66b991c71b94b5216277","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/algolia.styl","hash":"d8a8275a68a1421c4c09b604cf78bea16c1d0463","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/index.styl","hash":"6c4cbdadd9a49029fe0c59e29808d873e5b6b6ee","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/button.styl","hash":"de8437a058a315d14d7e7034066f095b7b3ed4b4","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/local-search.styl","hash":"1f2b86df86df81c3a59377b29102314ffc73dfa6","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/gallery.styl","hash":"30d1f809efd252ed0233d96d4374efd2b01d2292","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hexo.styl","hash":"985b183db7b7bfd8f9bdb60494549fb7f850348b","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hide.styl","hash":"d27dbccaf3de1c9158d19e4fd49a25953cb5778d","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/inlineImg.styl","hash":"3be8d0a75e7cc96548667cae0cb6a474279bd0b5","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/label.styl","hash":"216f52fefc2274b542b549d8470503e6f1a308fb","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/note.styl","hash":"4929382bd60788d34752a66e2fe764ef797a72a0","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/series.styl","hash":"0657169849bc4bf4d93b5492ade040c8f58c1901","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/tabs.styl","hash":"3a88eedcb694da79e92581ce50cb1a430b1fb615","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/timeline.styl","hash":"e846ddaef494d46cdfa2379deacfe74fa1cc5264","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/source/css/_third-party/normalize.min.css","hash":"8549829fb7d3c21cd9e119884962e8c463a4a267","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","hash":"7119f2f2943de71999d3dd6ba5c60cde846f114b","modified":1745301884935},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","hash":"a2b783230a9143de69004cfc914d9f55e6fc1660","modified":1745301884939},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"febff991595504d8e850ced0b9cc090f02ed97f0","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f0a90d8e39915a74b16ef22e851f179415cd7eaa","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"b03ee8625149191f9d5d057bbc9824b68d8dd0c4","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d6fff5a7f84c8b09f282f9ddc0020a68a8aac9ea","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"cbfbcf34a24d21ba2b21cf9eedb76f4c3c563c5a","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"846cabae287ae31b3bbfac3da022475713dd5ecc","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"b5db4203a1392385838c73549ddeae0a4be67eba","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"7884883ec15792f7e54daacb3c62b851dde2b66a","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"fd2320ee25507bb8ef49f932c2d170586b44ea4d","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/chatra.pug","hash":"5b29badecbbe828112c001156023fc0566045cf6","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/crisp.pug","hash":"24d094fd917947c0ca7492fa094328b1a183b873","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/index.pug","hash":"e8438941085def0591a72fc9b0d705dbf107f54f","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/tidio.pug","hash":"62466b251052cae609b6369d4cb4b6a85320757d","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/artalk.pug","hash":"89c63a5f0c0ab6314de7158fbc8fcbc84997fc55","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqus.pug","hash":"f2ea5249b3e6670f6c8c77868f4f42c502e43830","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"c81fa7d8a5cb96d1ae07bfa8c46b84a58161add1","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"8af585e6d6f73ee57114eefad574dc6e8ea9f570","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/giscus.pug","hash":"592b2251db6c1abeb8b0eebe3b2e6d9aa0dec445","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"58914c58a190e3bc0aa37cb581e77e442b563501","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/index.pug","hash":"db6713d2b90eb8183f86ac92c26761a8501c0ddb","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/js.pug","hash":"3abbaaa4ea575c45b3cebffd40bad1acc6ffce84","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/livere.pug","hash":"7a80231fc71822e503879383a2d9611edf1d72dd","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/remark42.pug","hash":"84f7cfde00f929fa3dc40349bcab060ec68f1b9f","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"53d99831f29aeb2e336ed1407d79590041f77002","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/valine.pug","hash":"24f18b0c67803210d53abbf9c1d454c000b06eee","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/waline.pug","hash":"e2bf15357485cd502414b3b20f5b1f762a2fd014","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/chartjs.pug","hash":"732eb1118ea1a73aa5c164d639097c614f8e9953","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/index.pug","hash":"af66d13204030d47537b9e31a6173e63589ce7ff","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/katex.pug","hash":"b83db9fa64d42a0bfd97efb660e09be3f166a144","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mathjax.pug","hash":"db2f4fff80a1166476ea76ae004aa186df11bad3","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mermaid.pug","hash":"ca2fc5928ca292f29fd8333c73733344994096fb","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"187302dbc916852ff2fdf47061e272c061611dda","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/common.pug","hash":"27fa75affebc6e84a487c62bceff783bde595256","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"fa4b4194749d05f7249f365f2b89c0281057ce54","modified":1745301884951},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"72e2970b23570e308f8af5d8ba8e5e3321d01bbf","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"a7c07dbc1e970a5b247091458e1ee9b144a3366d","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"34edfebf0cace0852806be774910ccb0e0914650","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"d2e12a9fc302a4efe52c90d44896fbd73e193a1f","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d376ec17fb19fcdcf0d2ad71330190146d3af879","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"716dc463fe4ef5112e7018ed60804125fdfa5cad","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"ec6c685080634ac46ffbea1b8f10313388888f43","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/algolia.pug","hash":"7f0ede1cd3fed2669c94a8e1b21bc0b183f310b8","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/docsearch.pug","hash":"013756ff3363344987cc00fc9bd833baf193c341","modified":1745301884955},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/index.pug","hash":"f8557548d2ad8dd149c562193991c6c6cda02415","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/local-search.pug","hash":"2622b4cf9189fa23e4a422aaf9ef272e4f2c6137","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/addtoany.pug","hash":"f5ee1c9c8ffa4bca972d30f4de69268b8d47f052","modified":1745301884947},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/share-js.pug","hash":"efef352c1d122409575386bf3894dce8e87032e2","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/index.pug","hash":"e51e896ccb13900de38dc81cf44dc789e2418a12","modified":1745301884959},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/diff.styl","hash":"9f02598b5e4296aec6470639d4bac4c9ac46392e","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/index.styl","hash":"ef52ebf1e8e751a412f9456fdaeee7d88afd9a72","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/diff.styl","hash":"077ec530831be1d80e93da380406b9f5abd0918a","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/index.styl","hash":"1883c91d43bff10aae55122a21e0b064b6f5c9dd","modified":1745301884967},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"de4bb5fc2dfca368b35e4c1109c92f7abc9e2245","modified":1745301884971},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/utterances.pug","hash":"30a7d157890de69deab28baa47fb7bb28b040efd","modified":1745301884963},{"_id":"node_modules/hexo-theme-butterfly/source/img/butterfly-icon.png","hash":"f5dd732fed5c3bcd4aa76bac3441bac8485fb432","modified":1745301884943},{"_id":"source/about/index.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1745302527631},{"_id":"source/_posts/java/thread/assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png","hash":"926070ac7bf26f22aab50a0f1b4ad414a02a22fd","modified":1745304424332},{"_id":"source/assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp","hash":"83eb3ebf7ea7ce9bd9851a972fef4700f2db6369","modified":1713355524000},{"_id":"source/assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp","hash":"ecd824b83a9c389240d6fa7a4c5cc5c71472c296","modified":1713355524000},{"_id":"source/assets/0dfa05911b3f4f448db0ce247eb0db91tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-oai6wan.awebp","hash":"122acee91c37e100abaae4837f5ea6af9008060a","modified":1713355524000},{"_id":"source/assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp","hash":"898cb7719a29420b606db776c8831d88f7bea10d","modified":1713355524000},{"_id":"source/assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp","hash":"d4f2127935c3866c1d4e7c9f25a29e5e593b5e10","modified":1713355524000},{"_id":"source/assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp","hash":"1e3b0d18c3334de8bedb5fc639de7ed5ce4f23cc","modified":1713355524000},{"_id":"source/assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp","hash":"de6e4e9ded053a1b3f1adb69875c10555a23bfb5","modified":1713355524000},{"_id":"source/assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp","hash":"5043b9963391e1541b6181cdb98a273c72c7eff7","modified":1713355524000},{"_id":"source/assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp","hash":"d20c589e3e683da0bf713ee3e67738ec46331fc4","modified":1713355524000},{"_id":"source/assets/594708f975664198bd523b79b8e1a73ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0c9y8yc.awebp","hash":"35f07093b3a2e2bfb4b22391a9dd375518efcfde","modified":1713355524000},{"_id":"source/assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp","hash":"943ec93733bcf26d21b25f6ad69436b08966c62d","modified":1713355524000},{"_id":"source/assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp","hash":"898cb7719a29420b606db776c8831d88f7bea10d","modified":1713355524000},{"_id":"source/assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp","hash":"898cb7719a29420b606db776c8831d88f7bea10d","modified":1713355524000},{"_id":"source/assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp","hash":"ecd824b83a9c389240d6fa7a4c5cc5c71472c296","modified":1713355524000},{"_id":"source/assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp","hash":"30818642518ac339c3b5dd7bbf72e90d627ee41b","modified":1713355524000},{"_id":"source/assets/b704efb8f0784c89b520d5e990bcd670tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-zv6m9iy.awebp","hash":"68d0160eff5b6dd02c390d7828a98ae39ab95c9b","modified":1713355524000},{"_id":"source/assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp","hash":"bf15c40cd7d44c951bac934785bcb85f0ff10ebb","modified":1713355524000},{"_id":"source/assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp","hash":"8f5518faaeabb248d154a1d80d61e67fe89e446d","modified":1713355524000},{"_id":"source/assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp","hash":"a9c2d081f8d38c9b7f943033a43750daf6c65667","modified":1713355524000},{"_id":"source/assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp","hash":"9d77519d200e67b376ad07779f3ff7675642928f","modified":1713355524000},{"_id":"source/assets/d682866856c240b39d8dd674462b4072tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ptt3047.awebp","hash":"8192644a7b9946015345797563487d651fc02c3f","modified":1713355524000},{"_id":"source/assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp","hash":"de85ddb99d387378061109fb98f78feb39ab90e8","modified":1713355524000},{"_id":"source/assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp","hash":"7b13c53c1cf9bb5791a9ad7cc65db3a09880e01a","modified":1713355524000},{"_id":"source/assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp","hash":"8772d815415551014082f341890ef9c2aa284ffe","modified":1713355524000},{"_id":"source/assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp","hash":"d68b03f8fd4cc1993b01b2648e0141bb83930dc9","modified":1713355524000},{"_id":"source/assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp","hash":"de85ddb99d387378061109fb98f78feb39ab90e8","modified":1713355524000},{"_id":"source/assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp","hash":"0255f87efaa2f130b7732bc33e6fc5c2528cb4a8","modified":1713355524000},{"_id":"source/_posts/20250501/2.md","hash":"b90f54227f8314963ee0eb572a4fabb60bb6d3eb","modified":1746090734022},{"_id":"source/_posts/20250501/1.md","hash":"c25ca4f5b86687978b4880e37d597dff269994a3","modified":1746090127672},{"_id":"source/assets/faa389f1359544b382bcaf1b9b5227bbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-woeeb5g.awebp","hash":"7be54a28d7082bc9065eacb415babb8166f3f115","modified":1713355524000},{"_id":"source/_posts/20250501/3.md","hash":"5b3a3fb5f26e702cc5caa83fa4c2e81f68dce3ad","modified":1746091790778},{"_id":"source/_posts/20250501/5.md","hash":"09e92b766c840b53bb32bd920f320f4dca013bfa","modified":1746092336124},{"_id":"source/_posts/20250501/6.md","hash":"6845791ec05d96edbc9c4f76525046545e42b2ee","modified":1746092445205},{"_id":"source/_posts/20250501/4.md","hash":"e63bdc5669f647cfa7f297f8a5300de1078ff127","modified":1746091897986},{"_id":"source/assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp","hash":"b395029db2b2e45f3655da46aca7af51c90abc62","modified":1713355524000},{"_id":"source/assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp","hash":"f509457d8a1e1193ecddd6971b62f7d825ebe4f9","modified":1713355524000},{"_id":"source/assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp","hash":"1d09d6164fdb55996376417d60d49f690d60d408","modified":1713355524000},{"_id":"source/assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp","hash":"cbf01e2f2b6d17cdefec667d80932d331364c9ed","modified":1713355524000},{"_id":"source/assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp","hash":"f509457d8a1e1193ecddd6971b62f7d825ebe4f9","modified":1713355524000},{"_id":"source/assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp","hash":"f509457d8a1e1193ecddd6971b62f7d825ebe4f9","modified":1713355524000},{"_id":"source/_posts/20250501/7.md","hash":"b548033fd3fb904f01a538df56a3ddc83ac13d5b","modified":1746092565348},{"_id":"source/_posts/20250501/assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp","hash":"83eb3ebf7ea7ce9bd9851a972fef4700f2db6369","modified":1713355524000},{"_id":"source/_posts/20250501/assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp","hash":"ecd824b83a9c389240d6fa7a4c5cc5c71472c296","modified":1713355524000},{"_id":"source/_posts/20250501/assets/0dfa05911b3f4f448db0ce247eb0db91tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-oai6wan.awebp","hash":"122acee91c37e100abaae4837f5ea6af9008060a","modified":1713355524000},{"_id":"source/_posts/20250501/assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp","hash":"d4f2127935c3866c1d4e7c9f25a29e5e593b5e10","modified":1713355524000},{"_id":"source/_posts/20250501/assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp","hash":"5043b9963391e1541b6181cdb98a273c72c7eff7","modified":1713355524000},{"_id":"source/_posts/20250501/assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp","hash":"898cb7719a29420b606db776c8831d88f7bea10d","modified":1713355524000},{"_id":"source/_posts/20250501/assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp","hash":"b395029db2b2e45f3655da46aca7af51c90abc62","modified":1713355524000},{"_id":"source/_posts/20250501/assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp","hash":"de6e4e9ded053a1b3f1adb69875c10555a23bfb5","modified":1713355524000},{"_id":"source/_posts/20250501/assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp","hash":"1e3b0d18c3334de8bedb5fc639de7ed5ce4f23cc","modified":1713355524000},{"_id":"source/_posts/20250501/assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp","hash":"d20c589e3e683da0bf713ee3e67738ec46331fc4","modified":1713355524000},{"_id":"source/_posts/20250501/assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp","hash":"898cb7719a29420b606db776c8831d88f7bea10d","modified":1713355524000},{"_id":"source/_posts/20250501/assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp","hash":"943ec93733bcf26d21b25f6ad69436b08966c62d","modified":1713355524000},{"_id":"source/_posts/20250501/assets/594708f975664198bd523b79b8e1a73ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0c9y8yc.awebp","hash":"35f07093b3a2e2bfb4b22391a9dd375518efcfde","modified":1713355524000},{"_id":"source/_posts/20250501/assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp","hash":"bf15c40cd7d44c951bac934785bcb85f0ff10ebb","modified":1713355524000},{"_id":"source/_posts/20250501/assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp","hash":"898cb7719a29420b606db776c8831d88f7bea10d","modified":1713355524000},{"_id":"source/_posts/20250501/assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp","hash":"30818642518ac339c3b5dd7bbf72e90d627ee41b","modified":1713355524000},{"_id":"source/_posts/20250501/assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp","hash":"ecd824b83a9c389240d6fa7a4c5cc5c71472c296","modified":1713355524000},{"_id":"source/_posts/20250501/assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp","hash":"8f5518faaeabb248d154a1d80d61e67fe89e446d","modified":1713355524000},{"_id":"source/_posts/20250501/assets/b704efb8f0784c89b520d5e990bcd670tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-zv6m9iy.awebp","hash":"68d0160eff5b6dd02c390d7828a98ae39ab95c9b","modified":1713355524000},{"_id":"source/_posts/20250501/assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp","hash":"a9c2d081f8d38c9b7f943033a43750daf6c65667","modified":1713355524000},{"_id":"source/_posts/20250501/assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp","hash":"9d77519d200e67b376ad07779f3ff7675642928f","modified":1713355524000},{"_id":"source/_posts/20250501/assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp","hash":"d68b03f8fd4cc1993b01b2648e0141bb83930dc9","modified":1713355524000},{"_id":"source/_posts/20250501/assets/d682866856c240b39d8dd674462b4072tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ptt3047.awebp","hash":"8192644a7b9946015345797563487d651fc02c3f","modified":1713355524000},{"_id":"source/_posts/20250501/assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp","hash":"7b13c53c1cf9bb5791a9ad7cc65db3a09880e01a","modified":1713355524000},{"_id":"source/_posts/20250501/assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp","hash":"de85ddb99d387378061109fb98f78feb39ab90e8","modified":1713355524000},{"_id":"source/_posts/20250501/assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp","hash":"8772d815415551014082f341890ef9c2aa284ffe","modified":1713355524000},{"_id":"source/_posts/20250501/assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp","hash":"de85ddb99d387378061109fb98f78feb39ab90e8","modified":1713355524000},{"_id":"source/_posts/20250501/assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp","hash":"0255f87efaa2f130b7732bc33e6fc5c2528cb4a8","modified":1713355524000},{"_id":"source/_posts/20250501/assets/faa389f1359544b382bcaf1b9b5227bbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-woeeb5g.awebp","hash":"7be54a28d7082bc9065eacb415babb8166f3f115","modified":1713355524000},{"_id":"source/_posts/20250501/assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp","hash":"f509457d8a1e1193ecddd6971b62f7d825ebe4f9","modified":1713355524000},{"_id":"source/_posts/20250501/assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp","hash":"1d09d6164fdb55996376417d60d49f690d60d408","modified":1713355524000},{"_id":"source/_posts/20250501/assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp","hash":"f509457d8a1e1193ecddd6971b62f7d825ebe4f9","modified":1713355524000},{"_id":"source/_posts/20250501/assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp","hash":"cbf01e2f2b6d17cdefec667d80932d331364c9ed","modified":1713355524000},{"_id":"source/_posts/20250501/assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp","hash":"f509457d8a1e1193ecddd6971b62f7d825ebe4f9","modified":1713355524000}],"Category":[{"name":"WSL","_id":"cma56nfvo0002isjj047r393u"},{"name":"Java","_id":"cma56nfvu0007isjjehho4osz"},{"name":"Redis","_id":"cma56nfvv000bisjj7bkx50ac"},{"name":"Javascript","_id":"cma56nfvx000gisjj2yvi3urh"},{"name":"K3S","_id":"cma56nfvy000kisjj25czg1g4"},{"name":"Consul","_id":"cma56nfvz000pisjj1sdd2g4z"},{"name":"Netty","_id":"cma56nfw0000sisjj95c85bq1"}],"Data":[],"Page":[{"title":"","date":"2023-03-26T06:56:21.000Z","updated":"2025-04-20T00:08:55.838Z","type":"categories","comments":1,"description":null,"keywords":null,"top_img":null,"mathjax":null,"katex":null,"aside":null,"aplayer":null,"highlight_shrink":null,"_content":"","source":"categories/index.md","raw":"---\ntitle: \ndate: 2023-03-26 14:56:21\nupdated:\ntype: \"categories\"\ncomments:\ndescription:\nkeywords:\ntop_img:\nmathjax:\nkatex:\naside:\naplayer:\nhighlight_shrink:\n---\n","path":"categories/index.html","_id":"cm9s3f3yk0000bfg4b9w86gjl","layout":"page","content":"","excerpt":"","more":""},{"title":"music","date":"2023-03-26T08:02:27.000Z","updated":"2025-04-20T00:08:55.841Z","type":null,"comments":1,"description":null,"keywords":null,"top_img":null,"mathjax":null,"katex":null,"aside":null,"aplayer":null,"highlight_shrink":null,"_content":"","source":"music/index.md","raw":"---\ntitle: music\ndate: 2023-03-26 16:02:27\nupdated:\ntype:\ncomments:\ndescription:\nkeywords:\ntop_img:\nmathjax:\nkatex:\naside:\naplayer:\nhighlight_shrink:\n---\n","path":"music/index.html","_id":"cm9s3f3ys0002bfg46amjefog","layout":"page","content":"","excerpt":"","more":""},{"title":"","date":"2023-03-26T06:54:25.000Z","updated":"2025-04-20T00:08:55.841Z","type":"tags","comments":1,"description":null,"keywords":null,"top_img":null,"mathjax":null,"katex":null,"aside":null,"aplayer":null,"highlight_shrink":null,"_content":"","source":"tags/index.md","raw":"---\ntitle: \ndate: 2023-03-26 14:54:25\nupdated:\ntype: \"tags\"\ncomments:\ndescription:\nkeywords:\ntop_img:\nmathjax:\nkatex:\naside:\naplayer:\nhighlight_shrink:\n---\n","path":"tags/index.html","_id":"cm9s3f3yu0004bfg411vb67bv","layout":"page","content":"","excerpt":"","more":""},{"_content":"","source":"about/index.md","raw":"","date":"2025-04-22T06:15:27.631Z","updated":"2025-04-22T06:15:27.631Z","path":"about/index.html","_id":"cm9s4299d0000rmg4gjo77wkg","title":"","comments":1,"layout":"page","content":"","excerpt":"","more":""}],"Post":[{"title":"Base","date":"2022-10-30T05:24:18.000Z","lastmod":"2022-10-30T05:24:18.000Z","_content":"\n# Base\n\n## String \n\nString \n\n```java\nString str1 = \"abcd\";//\"abcd\" str1  str1 \"abcd\"\"\nString str2 = new String(\"abcd\");//\nString str3 = new String(\"abcd\");//\nSystem.out.println(str1==str2);//false\nSystem.out.println(str2==str3);//false\n```\n\n\n\n,\n\n****\n\n-  String \n-  String  String  intern JDK1.71.7 String JDK1.7\n\n## StringBuffer  StrinBuilder  ,String \n\njava8  String  final ****`private final char value[]`\njava8  java9  String  final ****`private final byte[] value`\n\n`StringBuffer`  `StringBuilder`  `AbstractStringBuilder` `AbstractStringBuilder``char[] value` final \n\n- :\n  String ,,.`AbstractStringBuilder`,.Stringbuffer ,.Stringbuilder ,\n- :\n   String  String , String ,StringBuffer  StringBuffer ,,. StringBuilder  StringBuffer ,\n\n##  Java \n\n,`super()`,,,\n\n## \n\n1.  public(Java 8 \n2.  staticfinal \n3.  extends \n4.  public publicprotected  default  private \n5. \n6.  JDK 1.8  protected JDK 1.8  default\n7. JDK 1.8  public  JDK 1.8  public  default \n\n## \n\n:`public``private``static`,.`final`\n:`static``static`\n:\n,: final \n\n##  equals  hashCode \n\n`==` : \n\n`equals()` : ( 1 )\n 1`equals()``equals()`==\n 2`equals()``equals()` true()\n\n\n-  : HashSet \n\n`equals()` hashCode()  hashCode()\n\n-   HashSet ,\n\n1.  hashCode() equals() true\n2.  hashCode()hashCode() ****\n\n(key-value), hashcode (hashcode )pass . hashCode  equals  equals \n\n## (java )\n\npass by value\npass by reference\n\n## Java \n\n****\n\n- try   catch  catch  finally \n- catch   try \n- finally  finally  try  catch  return finally \n  ** 4 finally **\n-  finally  finally \n-  System.exit(int) exit  finally \n- \n-  CPU\n\n>  try  return try \n> \n> a.\n> b. jsr  finally \n> c. finally \n>  tryfinally  return try  return finally  return.\n\n## Java  IO ?\n\n\n\n\n\n## java \n\n- try   catch  catch  finally \n- catch   try \n- finally  finally  try  catch  return finally \n\n 4 finally \n\n-  finally  finally \n-  System.exit(int) exit  finally \n- \n-  CPU\n  **  try  finally  return finally  finally **\n\n## Java\n\n### \n\n#### public\n\n#### protected\n\n#### private\n\n#### default\n\n### \n\n#### final \n\n- final final  final \n- final \n- final \n\n#### static \n\n- :  static  static   Java \n- : , (>>) .\n- static  : ********1. 2.  static \n\n#### abstract\n\n#### synchronized\n\n## Object\n\n### Object\n\nObject registerNatives()getClass()hashCode()equals()clone()toString()notify()notifyAll()wait(long)wait(long,int)wait()finalize()\n\n- registerNatives()\n  - ** native**\n- getClass()[(1)](#oJQGR)\n  - `Class` \n- hashCode()\n- equals()\n- clone()\n- toString()\n- wait()/ wait(long)/ wait(long,int)\n  -  notify()/notifyAll()\n  - \n    -  IllegalMonitorStateException\n    -  wait Thread.sleepThread.yield()\n    - wait notify()/notifyAll() wait(long) notify()/nofiyAll() wait(long,int) 0 999999 +1\n- notify()/notifyAll()[(2)](#W03CQ)\n  -  `wait` `notify()/notifyAll()`\n  - ****\n    -  notify() notify() notify()\n- finalize()\n  - JVMJVM\n  - finalize()4\n    -  finalize()\n    - finalize()\n    -  JVM finalize()\n    -  JVM finalize()\n\n### \n\n## \n\n### \n\n- boolean\n- \n- \n- \n- \n- char \n\n**byte short char int**\n\n## \n\n### .classclass.forname()  getClass() \n\n- ****\n  - java.lang.Class\n  -  Class \n- ****\n  - \n    - Class.forname()\n    - Class.class.getClass()\n  - class.forname() \n  - Class c = C.classJVMCC(C)CClass\n  - Class c = c.getClass() Class \n\n###  wait()/notify() Object\n\n Object\n\n###\n","source":"_posts/java/Base.md","raw":"---\ntitle: Base\ndate: 2022-10-30T13:24:18Z\nlastmod: 2022-10-30T13:24:18Z\n---\n\n# Base\n\n## String \n\nString \n\n```java\nString str1 = \"abcd\";//\"abcd\" str1  str1 \"abcd\"\"\nString str2 = new String(\"abcd\");//\nString str3 = new String(\"abcd\");//\nSystem.out.println(str1==str2);//false\nSystem.out.println(str2==str3);//false\n```\n\n\n\n,\n\n****\n\n-  String \n-  String  String  intern JDK1.71.7 String JDK1.7\n\n## StringBuffer  StrinBuilder  ,String \n\njava8  String  final ****`private final char value[]`\njava8  java9  String  final ****`private final byte[] value`\n\n`StringBuffer`  `StringBuilder`  `AbstractStringBuilder` `AbstractStringBuilder``char[] value` final \n\n- :\n  String ,,.`AbstractStringBuilder`,.Stringbuffer ,.Stringbuilder ,\n- :\n   String  String , String ,StringBuffer  StringBuffer ,,. StringBuilder  StringBuffer ,\n\n##  Java \n\n,`super()`,,,\n\n## \n\n1.  public(Java 8 \n2.  staticfinal \n3.  extends \n4.  public publicprotected  default  private \n5. \n6.  JDK 1.8  protected JDK 1.8  default\n7. JDK 1.8  public  JDK 1.8  public  default \n\n## \n\n:`public``private``static`,.`final`\n:`static``static`\n:\n,: final \n\n##  equals  hashCode \n\n`==` : \n\n`equals()` : ( 1 )\n 1`equals()``equals()`==\n 2`equals()``equals()` true()\n\n\n-  : HashSet \n\n`equals()` hashCode()  hashCode()\n\n-   HashSet ,\n\n1.  hashCode() equals() true\n2.  hashCode()hashCode() ****\n\n(key-value), hashcode (hashcode )pass . hashCode  equals  equals \n\n## (java )\n\npass by value\npass by reference\n\n## Java \n\n****\n\n- try   catch  catch  finally \n- catch   try \n- finally  finally  try  catch  return finally \n  ** 4 finally **\n-  finally  finally \n-  System.exit(int) exit  finally \n- \n-  CPU\n\n>  try  return try \n> \n> a.\n> b. jsr  finally \n> c. finally \n>  tryfinally  return try  return finally  return.\n\n## Java  IO ?\n\n\n\n\n\n## java \n\n- try   catch  catch  finally \n- catch   try \n- finally  finally  try  catch  return finally \n\n 4 finally \n\n-  finally  finally \n-  System.exit(int) exit  finally \n- \n-  CPU\n  **  try  finally  return finally  finally **\n\n## Java\n\n### \n\n#### public\n\n#### protected\n\n#### private\n\n#### default\n\n### \n\n#### final \n\n- final final  final \n- final \n- final \n\n#### static \n\n- :  static  static   Java \n- : , (>>) .\n- static  : ********1. 2.  static \n\n#### abstract\n\n#### synchronized\n\n## Object\n\n### Object\n\nObject registerNatives()getClass()hashCode()equals()clone()toString()notify()notifyAll()wait(long)wait(long,int)wait()finalize()\n\n- registerNatives()\n  - ** native**\n- getClass()[(1)](#oJQGR)\n  - `Class` \n- hashCode()\n- equals()\n- clone()\n- toString()\n- wait()/ wait(long)/ wait(long,int)\n  -  notify()/notifyAll()\n  - \n    -  IllegalMonitorStateException\n    -  wait Thread.sleepThread.yield()\n    - wait notify()/notifyAll() wait(long) notify()/nofiyAll() wait(long,int) 0 999999 +1\n- notify()/notifyAll()[(2)](#W03CQ)\n  -  `wait` `notify()/notifyAll()`\n  - ****\n    -  notify() notify() notify()\n- finalize()\n  - JVMJVM\n  - finalize()4\n    -  finalize()\n    - finalize()\n    -  JVM finalize()\n    -  JVM finalize()\n\n### \n\n## \n\n### \n\n- boolean\n- \n- \n- \n- \n- char \n\n**byte short char int**\n\n## \n\n### .classclass.forname()  getClass() \n\n- ****\n  - java.lang.Class\n  -  Class \n- ****\n  - \n    - Class.forname()\n    - Class.class.getClass()\n  - class.forname() \n  - Class c = C.classJVMCC(C)CClass\n  - Class c = c.getClass() Class \n\n###  wait()/notify() Object\n\n Object\n\n###\n","slug":"java-Base","published":1,"updated":"2025-04-20T00:08:55.544Z","_id":"cm9s3f3yo0001bfg4gji44ji6","comments":1,"layout":"post","photos":[],"content":"<h1>Base</h1>\n<h2 id=\"String-\">String </h2>\n<p>String </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">str1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;abcd&quot;</span>;<span class=\"comment\">//&quot;abcd&quot; str1  str1 &quot;abcd&quot;&quot;</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">str2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(<span class=\"string\">&quot;abcd&quot;</span>);<span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">str3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(<span class=\"string\">&quot;abcd&quot;</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">System.out.println(str1==str2);<span class=\"comment\">//false</span></span><br><span class=\"line\">System.out.println(str2==str3);<span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n<p></p>\n<p>,<br>\n<br>\n<strong></strong></p>\n<ul>\n<li> String </li>\n<li> String  String  intern JDK1.71.7 String JDK1.7</li>\n</ul>\n<h2 id=\"StringBuffer--StrinBuilder--String-\">StringBuffer  StrinBuilder  ,String </h2>\n<p>java8  String  final <strong></strong><code>private final char value[]</code><br>\njava8  java9  String  final <strong></strong><code>private final byte[] value</code></p>\n<p><code>StringBuffer</code>  <code>StringBuilder</code>  <code>AbstractStringBuilder</code> <code>AbstractStringBuilder</code><code>char[] value</code> final </p>\n<ul>\n<li>:<br>\nString ,,.<code>AbstractStringBuilder</code>,.Stringbuffer ,.Stringbuilder ,</li>\n<li>:<br>\n String  String , String ,StringBuffer  StringBuffer ,,. StringBuilder  StringBuffer ,</li>\n</ul>\n<h2 id=\"-Java-\"> Java </h2>\n<p>,<code>super()</code>,,,</p>\n<h2 id=\"\"></h2>\n<ol>\n<li> public(Java 8 </li>\n<li> staticfinal </li>\n<li> extends </li>\n<li> public publicprotected  default  private </li>\n<li></li>\n<li> JDK 1.8  protected JDK 1.8  default</li>\n<li>JDK 1.8  public  JDK 1.8  public  default </li>\n</ol>\n<h2 id=\"\"></h2>\n<p>:<code>public``private``static</code>,.<code>final</code><br>\n:<code>static</code><code>static</code><br>\n:<br>\n,: final </p>\n<h2 id=\"-equals--hashCode-\"> equals  hashCode </h2>\n<p><code>==</code> : </p>\n<p><code>equals()</code> : ( 1 )<br>\n 1<code>equals()</code><code>equals()</code>==<br>\n 2<code>equals()</code><code>equals()</code> true()<br>\n</p>\n<ul>\n<li> : HashSet </li>\n</ul>\n<p><code>equals()</code> hashCode()  hashCode()</p>\n<ul>\n<li>  HashSet ,</li>\n</ul>\n<ol>\n<li> hashCode() equals() true</li>\n<li> hashCode()hashCode() <strong></strong></li>\n</ol>\n<p>(key-value), hashcode (hashcode )pass . hashCode  equals  equals </p>\n<h2 id=\"-java-\">(java )</h2>\n<p>pass by value<br>\npass by reference</p>\n<h2 id=\"Java-\">Java </h2>\n<p><strong></strong></p>\n<ul>\n<li>try   catch  catch  finally </li>\n<li>catch   try </li>\n<li>finally  finally  try  catch  return finally <br>\n<strong> 4 finally </strong></li>\n<li> finally  finally </li>\n<li> System.exit(int) exit  finally </li>\n<li></li>\n<li> CPU</li>\n</ul>\n<blockquote>\n<p> try  return try <br>\n<br>\na.<br>\nb. jsr  finally <br>\nc. finally <br>\n tryfinally  return try  return finally  return.</p>\n</blockquote>\n<h2 id=\"Java--IO-\">Java  IO ?</h2>\n<p><br>\n<br>\n</p>\n<h2 id=\"java-\">java </h2>\n<ul>\n<li>try   catch  catch  finally </li>\n<li>catch   try </li>\n<li>finally  finally  try  catch  return finally </li>\n</ul>\n<p> 4 finally </p>\n<ul>\n<li> finally  finally </li>\n<li> System.exit(int) exit  finally </li>\n<li></li>\n<li> CPU<br>\n<strong>  try  finally  return finally  finally </strong></li>\n</ul>\n<h2 id=\"Java\">Java</h2>\n<h3 id=\"\"></h3>\n<h4 id=\"public\">public</h4>\n<h4 id=\"protected\">protected</h4>\n<h4 id=\"private\">private</h4>\n<h4 id=\"default\">default</h4>\n<h3 id=\"\"></h3>\n<h4 id=\"final-\">final </h4>\n<ul>\n<li>final final  final </li>\n<li>final </li>\n<li>final </li>\n</ul>\n<h4 id=\"static-\">static </h4>\n<ul>\n<li>:  static  static   Java </li>\n<li>: , (&gt;&gt;) .</li>\n<li>static  : <strong></strong><strong></strong>1. 2.  static </li>\n</ul>\n<h4 id=\"abstract\">abstract</h4>\n<h4 id=\"synchronized\">synchronized</h4>\n<h2 id=\"Object\">Object</h2>\n<h3 id=\"Object\">Object</h3>\n<p>Object registerNatives()getClass()hashCode()equals()clone()toString()notify()notifyAll()wait(long)wait(long,int)wait()finalize()</p>\n<ul>\n<li>registerNatives()\n<ul>\n<li><strong> native</strong></li>\n</ul>\n</li>\n<li>getClass()<a href=\"#oJQGR\">(1)</a>\n<ul>\n<li><code>Class</code> </li>\n</ul>\n</li>\n<li>hashCode()</li>\n<li>equals()</li>\n<li>clone()</li>\n<li>toString()</li>\n<li>wait()/ wait(long)/ wait(long,int)\n<ul>\n<li> notify()/notifyAll()</li>\n<li>\n<ul>\n<li> IllegalMonitorStateException</li>\n<li> wait Thread.sleepThread.yield()</li>\n<li>wait notify()/notifyAll() wait(long) notify()/nofiyAll() wait(long,int) 0 999999 +1</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>notify()/notifyAll()<a href=\"#W03CQ\">(2)</a>\n<ul>\n<li> <code>wait</code> <code>notify()/notifyAll()</code></li>\n<li><strong></strong>\n<ul>\n<li> notify() notify() notify()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>finalize()\n<ul>\n<li>JVMJVM</li>\n<li>finalize()4\n<ul>\n<li> finalize()</li>\n<li>finalize()</li>\n<li> JVM finalize()</li>\n<li> JVM finalize()</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<ul>\n<li>boolean</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>char </li>\n</ul>\n<p><strong>byte short char int</strong></p>\n<h2 id=\"\"></h2>\n<h3 id=\"-classclass-forname--getClass-\">.classclass.forname()  getClass() </h3>\n<ul>\n<li><strong></strong>\n<ul>\n<li>java.lang.Class</li>\n<li> Class </li>\n</ul>\n</li>\n<li><strong></strong>\n<ul>\n<li>\n<ul>\n<li>Class.forname()</li>\n<li>Class.class.getClass()</li>\n</ul>\n</li>\n<li>class.forname() </li>\n<li>Class c = C.classJVMCC(C)CClass</li>\n<li>Class c = c.getClass() Class </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"-wait-notify--Object\"> wait()/notify() Object</h3>\n<p> Object</p>\n<h3 id=\"-2\"></h3>\n","excerpt":"","more":"<h1>Base</h1>\n<h2 id=\"String-\">String </h2>\n<p>String </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">str1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;abcd&quot;</span>;<span class=\"comment\">//&quot;abcd&quot; str1  str1 &quot;abcd&quot;&quot;</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">str2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(<span class=\"string\">&quot;abcd&quot;</span>);<span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">str3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(<span class=\"string\">&quot;abcd&quot;</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">System.out.println(str1==str2);<span class=\"comment\">//false</span></span><br><span class=\"line\">System.out.println(str2==str3);<span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure>\n<p></p>\n<p>,<br>\n<br>\n<strong></strong></p>\n<ul>\n<li> String </li>\n<li> String  String  intern JDK1.71.7 String JDK1.7</li>\n</ul>\n<h2 id=\"StringBuffer--StrinBuilder--String-\">StringBuffer  StrinBuilder  ,String </h2>\n<p>java8  String  final <strong></strong><code>private final char value[]</code><br>\njava8  java9  String  final <strong></strong><code>private final byte[] value</code></p>\n<p><code>StringBuffer</code>  <code>StringBuilder</code>  <code>AbstractStringBuilder</code> <code>AbstractStringBuilder</code><code>char[] value</code> final </p>\n<ul>\n<li>:<br>\nString ,,.<code>AbstractStringBuilder</code>,.Stringbuffer ,.Stringbuilder ,</li>\n<li>:<br>\n String  String , String ,StringBuffer  StringBuffer ,,. StringBuilder  StringBuffer ,</li>\n</ul>\n<h2 id=\"-Java-\"> Java </h2>\n<p>,<code>super()</code>,,,</p>\n<h2 id=\"\"></h2>\n<ol>\n<li> public(Java 8 </li>\n<li> staticfinal </li>\n<li> extends </li>\n<li> public publicprotected  default  private </li>\n<li></li>\n<li> JDK 1.8  protected JDK 1.8  default</li>\n<li>JDK 1.8  public  JDK 1.8  public  default </li>\n</ol>\n<h2 id=\"\"></h2>\n<p>:<code>public``private``static</code>,.<code>final</code><br>\n:<code>static</code><code>static</code><br>\n:<br>\n,: final </p>\n<h2 id=\"-equals--hashCode-\"> equals  hashCode </h2>\n<p><code>==</code> : </p>\n<p><code>equals()</code> : ( 1 )<br>\n 1<code>equals()</code><code>equals()</code>==<br>\n 2<code>equals()</code><code>equals()</code> true()<br>\n</p>\n<ul>\n<li> : HashSet </li>\n</ul>\n<p><code>equals()</code> hashCode()  hashCode()</p>\n<ul>\n<li>  HashSet ,</li>\n</ul>\n<ol>\n<li> hashCode() equals() true</li>\n<li> hashCode()hashCode() <strong></strong></li>\n</ol>\n<p>(key-value), hashcode (hashcode )pass . hashCode  equals  equals </p>\n<h2 id=\"-java-\">(java )</h2>\n<p>pass by value<br>\npass by reference</p>\n<h2 id=\"Java-\">Java </h2>\n<p><strong></strong></p>\n<ul>\n<li>try   catch  catch  finally </li>\n<li>catch   try </li>\n<li>finally  finally  try  catch  return finally <br>\n<strong> 4 finally </strong></li>\n<li> finally  finally </li>\n<li> System.exit(int) exit  finally </li>\n<li></li>\n<li> CPU</li>\n</ul>\n<blockquote>\n<p> try  return try <br>\n<br>\na.<br>\nb. jsr  finally <br>\nc. finally <br>\n tryfinally  return try  return finally  return.</p>\n</blockquote>\n<h2 id=\"Java--IO-\">Java  IO ?</h2>\n<p><br>\n<br>\n</p>\n<h2 id=\"java-\">java </h2>\n<ul>\n<li>try   catch  catch  finally </li>\n<li>catch   try </li>\n<li>finally  finally  try  catch  return finally </li>\n</ul>\n<p> 4 finally </p>\n<ul>\n<li> finally  finally </li>\n<li> System.exit(int) exit  finally </li>\n<li></li>\n<li> CPU<br>\n<strong>  try  finally  return finally  finally </strong></li>\n</ul>\n<h2 id=\"Java\">Java</h2>\n<h3 id=\"\"></h3>\n<h4 id=\"public\">public</h4>\n<h4 id=\"protected\">protected</h4>\n<h4 id=\"private\">private</h4>\n<h4 id=\"default\">default</h4>\n<h3 id=\"\"></h3>\n<h4 id=\"final-\">final </h4>\n<ul>\n<li>final final  final </li>\n<li>final </li>\n<li>final </li>\n</ul>\n<h4 id=\"static-\">static </h4>\n<ul>\n<li>:  static  static   Java </li>\n<li>: , (&gt;&gt;) .</li>\n<li>static  : <strong></strong><strong></strong>1. 2.  static </li>\n</ul>\n<h4 id=\"abstract\">abstract</h4>\n<h4 id=\"synchronized\">synchronized</h4>\n<h2 id=\"Object\">Object</h2>\n<h3 id=\"Object\">Object</h3>\n<p>Object registerNatives()getClass()hashCode()equals()clone()toString()notify()notifyAll()wait(long)wait(long,int)wait()finalize()</p>\n<ul>\n<li>registerNatives()\n<ul>\n<li><strong> native</strong></li>\n</ul>\n</li>\n<li>getClass()<a href=\"#oJQGR\">(1)</a>\n<ul>\n<li><code>Class</code> </li>\n</ul>\n</li>\n<li>hashCode()</li>\n<li>equals()</li>\n<li>clone()</li>\n<li>toString()</li>\n<li>wait()/ wait(long)/ wait(long,int)\n<ul>\n<li> notify()/notifyAll()</li>\n<li>\n<ul>\n<li> IllegalMonitorStateException</li>\n<li> wait Thread.sleepThread.yield()</li>\n<li>wait notify()/notifyAll() wait(long) notify()/nofiyAll() wait(long,int) 0 999999 +1</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>notify()/notifyAll()<a href=\"#W03CQ\">(2)</a>\n<ul>\n<li> <code>wait</code> <code>notify()/notifyAll()</code></li>\n<li><strong></strong>\n<ul>\n<li> notify() notify() notify()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>finalize()\n<ul>\n<li>JVMJVM</li>\n<li>finalize()4\n<ul>\n<li> finalize()</li>\n<li>finalize()</li>\n<li> JVM finalize()</li>\n<li> JVM finalize()</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<ul>\n<li>boolean</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>char </li>\n</ul>\n<p><strong>byte short char int</strong></p>\n<h2 id=\"\"></h2>\n<h3 id=\"-classclass-forname--getClass-\">.classclass.forname()  getClass() </h3>\n<ul>\n<li><strong></strong>\n<ul>\n<li>java.lang.Class</li>\n<li> Class </li>\n</ul>\n</li>\n<li><strong></strong>\n<ul>\n<li>\n<ul>\n<li>Class.forname()</li>\n<li>Class.class.getClass()</li>\n</ul>\n</li>\n<li>class.forname() </li>\n<li>Class c = C.classJVMCC(C)CClass</li>\n<li>Class c = c.getClass() Class </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"-wait-notify--Object\"> wait()/notify() Object</h3>\n<p> Object</p>\n<h3 id=\"-2\"></h3>\n"},{"title":"ByteBuddy","date":"2023-06-19T14:23:00.000Z","lastmod":"2023-07-08T05:54:37.000Z","_content":"\n# ByteBuddy\n\n```\n      <dependency>\n            <groupId>net.bytebuddy</groupId>\n            <artifactId>byte-buddy</artifactId>\n            <version>1.11.12</version>\n        </dependency>\n```\n\n## Hello World\n\n```\nClass<?> dynamicType = new ByteBuddy()\n                .subclass(Object.class)\n                .method(ElementMatchers.named(\"toString\"))\n                .intercept(FixedValue.value(\"Hello World\"))\n                .make()\n                .load(HelloWorldBuddy.class.getClassLoader())\n                .getLoaded();\nObject instance = dynamicType.newInstance();\nString toString = instance.toString();\nSystem.out.println(toString);\nSystem.out.println(instance.getClass().getCanonicalName());\n```\n\n![image](/assets/image-20230619222624-l98xjgi.png)\n\nByteBuddyAPIByteBuddy  \n\n\n* subclass \n* method  Object  toString \n* intercept  toString  value\n*  make \n\nByte BuddyByte Buddy  API Java  Java \n\n## \n\n```\nDynamicType.Unloaded<?> dynamicType = new ByteBuddy()\n  .subclass(Object.class)\n  .name(\"com.zlk.learning.bytebuddy.DynamicType\")\n  .make();\n```\n\n Object  Object \n\n```\npublic class DynamicTYpe {\n\n}\n```\n\nAPI\n\n```\n        DynamicType.Unloaded<?> dynamicType = new ByteBuddy()\n                .subclass(Object.class)\n                .name(\"com.zlk.learning.bytebuddy.DynamicType\")\n                .defineField(\"name\", String.class, 1)\n                .defineField(\"age\", Integer.class, 1)\n                .method(ElementMatchers.named(\"toString\"))\n                .intercept(FixedValue.value(\"Hello World!\"))\n                .make();\n```\n\n![image](/assets/image-20230619222818-5btwdt3.png)\n\nnameagetoString Hello World!\n\n\n\n```java\n\n\n    @Override\n    public Object instantiate(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args) throws BeansException {\n        Class<?> beanClass = beanDefinition.getBeanClass();\n        ArrayList<TypeDescription.Generic> list = getGenerics(beanClass);\n        Class clazz = new ByteBuddy().subclass(beanClass).implement(list)\n                .make()\n                .load(getClass().getClassLoader())\n                .getLoaded();\n        try {\n            if (null == ctor) return clazz.getDeclaredConstructor().newInstance();\n            return clazz.getDeclaredConstructor(ctor.getParameterTypes()).newInstance(args);\n        } catch (NoSuchMethodException | InstantiationException | IllegalAccessException | InvocationTargetException e) {\n            throw new BeansException(\"Failed to instantiate [\" + clazz.getName() + \"]\", e);\n        }\n    }\n    //\n    private static ArrayList<TypeDescription.Generic> getGenerics(Class<?> beanClass) {\n        ArrayList<TypeDescription.Generic> list = new ArrayList<>();\n        try {\n            Type[] genericInterfaces = beanClass.getGenericInterfaces();\n            for (Type type : genericInterfaces) {\n                Type[] typeArguments = ((ParameterizedType) type).getActualTypeArguments();\n                Class<?>[] classes = new Class[typeArguments.length];\n                for (int i = 0; i < typeArguments.length; i++) {\n                    classes[i] = Class.forName(typeArguments[i].getTypeName());\n                }\n                Class<?> aClass = Class.forName(((ParameterizedType) type).getRawType().getTypeName());\n                TypeDescription.Generic listType = TypeDescription.Generic.Builder.parameterizedType(aClass, classes).build();\n                list.add(listType);\n            }\n        } catch (ClassNotFoundException e) {\n            throw new BeansException(\"Failed to instantiate [\" + beanClass.getName() + \"]\", e);\n        }\n        return list;\n    }\n```\n\n\n\n## \n\n DynamicType.Unloaded Java  DynamicType.Unloaded  getBytes \n\n jar  saveIn(File)  inject(File)  Jar  ClassLoadingStrategy \n\nClassLoadingStrategyByte BufferClassLoaderClassLoadingStrategy.Default\n\n* WRAPPERWrapping\n* CHILD_FIRST\n* INJECTION\n\n```\n Class<?> dynamicClass = dynamicType\n                .load(Object.class.getClassLoader(), ClassLoadingStrategy.Default.WRAPPER)\n                .getLoaded();\n```\n\n WRAPPER ApplicationClassLoader  \n`getLoaded  Java Class `\n\n## \n\ntoString\n\n### \n\nByteBuddy  net.bytebuddy.matcher.ElementMatcher \n\n```\nFoo dynamicFoo = new ByteBuddy()\n  .subclass(Foo.class)\n  // Foo.class\n  .method(isDeclaredBy(Foo.class)).intercept(FixedValue.value(\"One!\"))\n  // foo\n  .method(named(\"foo\")).intercept(FixedValue.value(\"Two!\"))\n  // foo1\n  .method(named(\"foo\").and(takesArguments(1))).intercept(FixedValue.value(\"Three!\"))\n  .make()\n  .load(getClass().getClassLoader())\n  .getLoaded()\n  .newInstance();\n```\n\n### \n\nMethodDelegationPOJOByte BuddySourceTarget\n\n```\nclass Source {\n  public String hello(String name) { return null; }\n}\n\nclass Target {\n\n  public static String hello(String name) {\n    return \"Hello \" + name + \"!\";\n  }\n}\n\nString helloWorld = new ByteBuddy()\n  .subclass(Source.class)\n  .method(named(\"hello\"))\n  //    \n  .intercept(MethodDelegation.to(Target.class))\n  .make()\n  .load(getClass().getClassLoader())\n  .getLoaded()\n  .newInstance()\n  .hello(\"World\");\n```\n\n Target \n\n```\nclass Target {\n  public static String intercept(String name) { return \"Hello \" + name + \"!\"; }\n  public static String intercept(int i) { return Integer.toString(i); }\n  public static String intercept(Object o) { return o.toString(); }\n}\n```\n\nByte BuddyByte Buddy\n\n* intercept(int)Pass\n*  intercept(String)\n\n public @RuntimeType \n\n```java\n    @RuntimeType\n    public  Object interceptor(@This Object proxy, @Origin Method method,\n                              @SuperMethod Method superMethod,\n                              @AllArguments Object[] args) throws Exception {\n        System.out.println(\"bytebuddy delegate proxy2 before sing \");\n        Object ret = superMethod.invoke(proxy, args);\n        System.out.println(\"bytebuddy delegate proxy2 after sing \");\n        return ret;\n    }\n```\n\n### \n\nTarget intercept ByteBuddy \n\n```\nvoid intercept(Object o1, Object o2)\n// \nvoid intercept(@Argument(0) Object o1, @Argument(1) Object o2)\n```\n\n\n\n* @Argument \n* @AllArguments \n* @This \n* @DefaultCall super\n* @SuperCall \n* @Origin \n* @RuntimeType ByteBuddy\n* @Super \n* @FieldValue \n\n## Agent\n\nJava  1.5  java.lang.instrument Java  API java.lang.instrument  Java AgentJava Agent \n\nByteBuddybytebuddyAgentBuilderagent\n\n```\nclass ToStringAgent {\n  public static void premain(String arguments, Instrumentation instrumentation) {\n    new AgentBuilder.Default()\n        .type(isAnnotatedWith(ToString.class))\n        .transform(new AgentBuilder.Transformer() {\n      @Override\n      public DynamicType.Builder transform(DynamicType.Builder builder,\n                                              TypeDescription typeDescription,\n                                              ClassLoader classloader) {\n        return builder.method(named(\"toString\"))\n                      .intercept(FixedValue.value(\"transformed\"));\n      }\n    }).installOn(instrumentation);\n  }\n}\n```\n\n* type ElementMatcher class\n* transform class\n\n## ElementMatcher\n\nElementMatcherclassbytebuddyElementMatchersclass name\n\nJunctionElementMatcherand  or Matcher\n\n```\n      new AgentBuilder.Default()\n                .type(ElementMatchers.isAnnotatedWith(ToString.class)).and(ElementMatchers.isSubTypeOf(DynamicClass.class)).or(ElementMatchers.named(\"DynamicClass\"))\n                .transform(new AgentBuilder.Transformer() {\n                    public DynamicType.Builder<?> transform(DynamicType.Builder<?> builder, TypeDescription typeDescription, ClassLoader classLoader, JavaModule javaModule) {\n                        return builder\n                                .method(ElementMatchers.named(\"hello\"))\n                                .intercept(MethodDelegation.to(MyServiceInterceptor.class))\n                                ;\n                    }\n                }).installOn(instrumentation);\n```\n\n## [Transformer](https://so.csdn.net/so/search?q=Transformer&spm=1001.2101.3001.7020)\n\nTransformer  transformDynamicType.Builderbuilder ByteBuddyhellohello MyServiceInterceptor\n\n```\npublic class MyServiceInterceptor {\n\n    @RuntimeType\n    public static Object intercept(@Origin Method method, @SuperCall Callable<?> callable) throws Exception {\n        System.out.println(\"intercept\" + method.getName());\n        return callable.call();\n    }\n  \n}\n\n```\n\n## \n\n\n\n## END\n\n****  \n`bytebuddy https://bytebuddy.net/#/tutorial`\n\n`https://juejin.cn/post/6844903965553852423#heading-12`\n","source":"_posts/java/ByteBuddy.md","raw":"---\ntitle: ByteBuddy\ndate: 2023-06-19T22:23:00Z\nlastmod: 2023-07-08T13:54:37Z\n---\n\n# ByteBuddy\n\n```\n      <dependency>\n            <groupId>net.bytebuddy</groupId>\n            <artifactId>byte-buddy</artifactId>\n            <version>1.11.12</version>\n        </dependency>\n```\n\n## Hello World\n\n```\nClass<?> dynamicType = new ByteBuddy()\n                .subclass(Object.class)\n                .method(ElementMatchers.named(\"toString\"))\n                .intercept(FixedValue.value(\"Hello World\"))\n                .make()\n                .load(HelloWorldBuddy.class.getClassLoader())\n                .getLoaded();\nObject instance = dynamicType.newInstance();\nString toString = instance.toString();\nSystem.out.println(toString);\nSystem.out.println(instance.getClass().getCanonicalName());\n```\n\n![image](/assets/image-20230619222624-l98xjgi.png)\n\nByteBuddyAPIByteBuddy  \n\n\n* subclass \n* method  Object  toString \n* intercept  toString  value\n*  make \n\nByte BuddyByte Buddy  API Java  Java \n\n## \n\n```\nDynamicType.Unloaded<?> dynamicType = new ByteBuddy()\n  .subclass(Object.class)\n  .name(\"com.zlk.learning.bytebuddy.DynamicType\")\n  .make();\n```\n\n Object  Object \n\n```\npublic class DynamicTYpe {\n\n}\n```\n\nAPI\n\n```\n        DynamicType.Unloaded<?> dynamicType = new ByteBuddy()\n                .subclass(Object.class)\n                .name(\"com.zlk.learning.bytebuddy.DynamicType\")\n                .defineField(\"name\", String.class, 1)\n                .defineField(\"age\", Integer.class, 1)\n                .method(ElementMatchers.named(\"toString\"))\n                .intercept(FixedValue.value(\"Hello World!\"))\n                .make();\n```\n\n![image](/assets/image-20230619222818-5btwdt3.png)\n\nnameagetoString Hello World!\n\n\n\n```java\n\n\n    @Override\n    public Object instantiate(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args) throws BeansException {\n        Class<?> beanClass = beanDefinition.getBeanClass();\n        ArrayList<TypeDescription.Generic> list = getGenerics(beanClass);\n        Class clazz = new ByteBuddy().subclass(beanClass).implement(list)\n                .make()\n                .load(getClass().getClassLoader())\n                .getLoaded();\n        try {\n            if (null == ctor) return clazz.getDeclaredConstructor().newInstance();\n            return clazz.getDeclaredConstructor(ctor.getParameterTypes()).newInstance(args);\n        } catch (NoSuchMethodException | InstantiationException | IllegalAccessException | InvocationTargetException e) {\n            throw new BeansException(\"Failed to instantiate [\" + clazz.getName() + \"]\", e);\n        }\n    }\n    //\n    private static ArrayList<TypeDescription.Generic> getGenerics(Class<?> beanClass) {\n        ArrayList<TypeDescription.Generic> list = new ArrayList<>();\n        try {\n            Type[] genericInterfaces = beanClass.getGenericInterfaces();\n            for (Type type : genericInterfaces) {\n                Type[] typeArguments = ((ParameterizedType) type).getActualTypeArguments();\n                Class<?>[] classes = new Class[typeArguments.length];\n                for (int i = 0; i < typeArguments.length; i++) {\n                    classes[i] = Class.forName(typeArguments[i].getTypeName());\n                }\n                Class<?> aClass = Class.forName(((ParameterizedType) type).getRawType().getTypeName());\n                TypeDescription.Generic listType = TypeDescription.Generic.Builder.parameterizedType(aClass, classes).build();\n                list.add(listType);\n            }\n        } catch (ClassNotFoundException e) {\n            throw new BeansException(\"Failed to instantiate [\" + beanClass.getName() + \"]\", e);\n        }\n        return list;\n    }\n```\n\n\n\n## \n\n DynamicType.Unloaded Java  DynamicType.Unloaded  getBytes \n\n jar  saveIn(File)  inject(File)  Jar  ClassLoadingStrategy \n\nClassLoadingStrategyByte BufferClassLoaderClassLoadingStrategy.Default\n\n* WRAPPERWrapping\n* CHILD_FIRST\n* INJECTION\n\n```\n Class<?> dynamicClass = dynamicType\n                .load(Object.class.getClassLoader(), ClassLoadingStrategy.Default.WRAPPER)\n                .getLoaded();\n```\n\n WRAPPER ApplicationClassLoader  \n`getLoaded  Java Class `\n\n## \n\ntoString\n\n### \n\nByteBuddy  net.bytebuddy.matcher.ElementMatcher \n\n```\nFoo dynamicFoo = new ByteBuddy()\n  .subclass(Foo.class)\n  // Foo.class\n  .method(isDeclaredBy(Foo.class)).intercept(FixedValue.value(\"One!\"))\n  // foo\n  .method(named(\"foo\")).intercept(FixedValue.value(\"Two!\"))\n  // foo1\n  .method(named(\"foo\").and(takesArguments(1))).intercept(FixedValue.value(\"Three!\"))\n  .make()\n  .load(getClass().getClassLoader())\n  .getLoaded()\n  .newInstance();\n```\n\n### \n\nMethodDelegationPOJOByte BuddySourceTarget\n\n```\nclass Source {\n  public String hello(String name) { return null; }\n}\n\nclass Target {\n\n  public static String hello(String name) {\n    return \"Hello \" + name + \"!\";\n  }\n}\n\nString helloWorld = new ByteBuddy()\n  .subclass(Source.class)\n  .method(named(\"hello\"))\n  //    \n  .intercept(MethodDelegation.to(Target.class))\n  .make()\n  .load(getClass().getClassLoader())\n  .getLoaded()\n  .newInstance()\n  .hello(\"World\");\n```\n\n Target \n\n```\nclass Target {\n  public static String intercept(String name) { return \"Hello \" + name + \"!\"; }\n  public static String intercept(int i) { return Integer.toString(i); }\n  public static String intercept(Object o) { return o.toString(); }\n}\n```\n\nByte BuddyByte Buddy\n\n* intercept(int)Pass\n*  intercept(String)\n\n public @RuntimeType \n\n```java\n    @RuntimeType\n    public  Object interceptor(@This Object proxy, @Origin Method method,\n                              @SuperMethod Method superMethod,\n                              @AllArguments Object[] args) throws Exception {\n        System.out.println(\"bytebuddy delegate proxy2 before sing \");\n        Object ret = superMethod.invoke(proxy, args);\n        System.out.println(\"bytebuddy delegate proxy2 after sing \");\n        return ret;\n    }\n```\n\n### \n\nTarget intercept ByteBuddy \n\n```\nvoid intercept(Object o1, Object o2)\n// \nvoid intercept(@Argument(0) Object o1, @Argument(1) Object o2)\n```\n\n\n\n* @Argument \n* @AllArguments \n* @This \n* @DefaultCall super\n* @SuperCall \n* @Origin \n* @RuntimeType ByteBuddy\n* @Super \n* @FieldValue \n\n## Agent\n\nJava  1.5  java.lang.instrument Java  API java.lang.instrument  Java AgentJava Agent \n\nByteBuddybytebuddyAgentBuilderagent\n\n```\nclass ToStringAgent {\n  public static void premain(String arguments, Instrumentation instrumentation) {\n    new AgentBuilder.Default()\n        .type(isAnnotatedWith(ToString.class))\n        .transform(new AgentBuilder.Transformer() {\n      @Override\n      public DynamicType.Builder transform(DynamicType.Builder builder,\n                                              TypeDescription typeDescription,\n                                              ClassLoader classloader) {\n        return builder.method(named(\"toString\"))\n                      .intercept(FixedValue.value(\"transformed\"));\n      }\n    }).installOn(instrumentation);\n  }\n}\n```\n\n* type ElementMatcher class\n* transform class\n\n## ElementMatcher\n\nElementMatcherclassbytebuddyElementMatchersclass name\n\nJunctionElementMatcherand  or Matcher\n\n```\n      new AgentBuilder.Default()\n                .type(ElementMatchers.isAnnotatedWith(ToString.class)).and(ElementMatchers.isSubTypeOf(DynamicClass.class)).or(ElementMatchers.named(\"DynamicClass\"))\n                .transform(new AgentBuilder.Transformer() {\n                    public DynamicType.Builder<?> transform(DynamicType.Builder<?> builder, TypeDescription typeDescription, ClassLoader classLoader, JavaModule javaModule) {\n                        return builder\n                                .method(ElementMatchers.named(\"hello\"))\n                                .intercept(MethodDelegation.to(MyServiceInterceptor.class))\n                                ;\n                    }\n                }).installOn(instrumentation);\n```\n\n## [Transformer](https://so.csdn.net/so/search?q=Transformer&spm=1001.2101.3001.7020)\n\nTransformer  transformDynamicType.Builderbuilder ByteBuddyhellohello MyServiceInterceptor\n\n```\npublic class MyServiceInterceptor {\n\n    @RuntimeType\n    public static Object intercept(@Origin Method method, @SuperCall Callable<?> callable) throws Exception {\n        System.out.println(\"intercept\" + method.getName());\n        return callable.call();\n    }\n  \n}\n\n```\n\n## \n\n\n\n## END\n\n****  \n`bytebuddy https://bytebuddy.net/#/tutorial`\n\n`https://juejin.cn/post/6844903965553852423#heading-12`\n","slug":"java-ByteBuddy","published":1,"updated":"2025-04-28T08:41:48.385Z","_id":"cm9s3f3ys0003bfg478vr1fbf","comments":1,"layout":"post","photos":[],"content":"<h1>ByteBuddy</h1>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">      &lt;groupId&gt;net.bytebuddy&lt;/groupId&gt;</span><br><span class=\"line\">      &lt;artifactId&gt;byte-buddy&lt;/artifactId&gt;</span><br><span class=\"line\">      &lt;version&gt;1.11.12&lt;/version&gt;</span><br><span class=\"line\">  &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Hello-World\">Hello World</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Class&lt;?&gt; dynamicType = new ByteBuddy()</span><br><span class=\"line\">                .subclass(Object.class)</span><br><span class=\"line\">                .method(ElementMatchers.named(&quot;toString&quot;))</span><br><span class=\"line\">                .intercept(FixedValue.value(&quot;Hello World&quot;))</span><br><span class=\"line\">                .make()</span><br><span class=\"line\">                .load(HelloWorldBuddy.class.getClassLoader())</span><br><span class=\"line\">                .getLoaded();</span><br><span class=\"line\">Object instance = dynamicType.newInstance();</span><br><span class=\"line\">String toString = instance.toString();</span><br><span class=\"line\">System.out.println(toString);</span><br><span class=\"line\">System.out.println(instance.getClass().getCanonicalName());</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/image-20230619222624-l98xjgi.png\" alt=\"image\"></p>\n<p>ByteBuddyAPIByteBuddy<br>\n</p>\n<ul>\n<li>subclass </li>\n<li>method  Object  toString </li>\n<li>intercept  toString  value</li>\n<li> make </li>\n</ul>\n<p>Byte BuddyByte Buddy  API Java  Java </p>\n<h2 id=\"\"></h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DynamicType.Unloaded&lt;?&gt; dynamicType = new ByteBuddy()</span><br><span class=\"line\">  .subclass(Object.class)</span><br><span class=\"line\">  .name(&quot;com.zlk.learning.bytebuddy.DynamicType&quot;)</span><br><span class=\"line\">  .make();</span><br></pre></td></tr></table></figure>\n<p> Object  Object </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class DynamicTYpe &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>API</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DynamicType.Unloaded&lt;?&gt; dynamicType = new ByteBuddy()</span><br><span class=\"line\">        .subclass(Object.class)</span><br><span class=\"line\">        .name(&quot;com.zlk.learning.bytebuddy.DynamicType&quot;)</span><br><span class=\"line\">        .defineField(&quot;name&quot;, String.class, 1)</span><br><span class=\"line\">        .defineField(&quot;age&quot;, Integer.class, 1)</span><br><span class=\"line\">        .method(ElementMatchers.named(&quot;toString&quot;))</span><br><span class=\"line\">        .intercept(FixedValue.value(&quot;Hello World!&quot;))</span><br><span class=\"line\">        .make();</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/image-20230619222818-5btwdt3.png\" alt=\"image\"></p>\n<p>nameagetoString Hello World!</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">instantiate</span><span class=\"params\">(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">    Class&lt;?&gt; beanClass = beanDefinition.getBeanClass();</span><br><span class=\"line\">    ArrayList&lt;TypeDescription.Generic&gt; list = getGenerics(beanClass);</span><br><span class=\"line\">    <span class=\"type\">Class</span> <span class=\"variable\">clazz</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteBuddy</span>().subclass(beanClass).implement(list)</span><br><span class=\"line\">            .make()</span><br><span class=\"line\">            .load(getClass().getClassLoader())</span><br><span class=\"line\">            .getLoaded();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == ctor) <span class=\"keyword\">return</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> clazz.getDeclaredConstructor(ctor.getParameterTypes()).newInstance(args);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException | InstantiationException | IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BeansException</span>(<span class=\"string\">&quot;Failed to instantiate [&quot;</span> + clazz.getName() + <span class=\"string\">&quot;]&quot;</span>, e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ArrayList&lt;TypeDescription.Generic&gt; getGenerics(Class&lt;?&gt; beanClass) &#123;</span><br><span class=\"line\">    ArrayList&lt;TypeDescription.Generic&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        Type[] genericInterfaces = beanClass.getGenericInterfaces();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Type type : genericInterfaces) &#123;</span><br><span class=\"line\">            Type[] typeArguments = ((ParameterizedType) type).getActualTypeArguments();</span><br><span class=\"line\">            Class&lt;?&gt;[] classes = <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[typeArguments.length];</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; typeArguments.length; i++) &#123;</span><br><span class=\"line\">                classes[i] = Class.forName(typeArguments[i].getTypeName());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Class&lt;?&gt; aClass = Class.forName(((ParameterizedType) type).getRawType().getTypeName());</span><br><span class=\"line\">            TypeDescription.<span class=\"type\">Generic</span> <span class=\"variable\">listType</span> <span class=\"operator\">=</span> TypeDescription.Generic.Builder.parameterizedType(aClass, classes).build();</span><br><span class=\"line\">            list.add(listType);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BeansException</span>(<span class=\"string\">&quot;Failed to instantiate [&quot;</span> + beanClass.getName() + <span class=\"string\">&quot;]&quot;</span>, e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<h2 id=\"\"></h2>\n<p> DynamicType.Unloaded Java  DynamicType.Unloaded  getBytes </p>\n<p> jar  saveIn(File)  inject(File)  Jar  ClassLoadingStrategy </p>\n<p>ClassLoadingStrategyByte BufferClassLoaderClassLoadingStrategy.Default</p>\n<ul>\n<li>WRAPPERWrapping</li>\n<li>CHILD_FIRST</li>\n<li>INJECTION</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Class&lt;?&gt; dynamicClass = dynamicType</span><br><span class=\"line\">               .load(Object.class.getClassLoader(), ClassLoadingStrategy.Default.WRAPPER)</span><br><span class=\"line\">               .getLoaded();</span><br></pre></td></tr></table></figure>\n<p> WRAPPER ApplicationClassLoader<br>\n<code>getLoaded  Java Class </code></p>\n<h2 id=\"\"></h2>\n<p>toString</p>\n<h3 id=\"\"></h3>\n<p>ByteBuddy  net.bytebuddy.matcher.ElementMatcher </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Foo dynamicFoo = new ByteBuddy()</span><br><span class=\"line\">  .subclass(Foo.class)</span><br><span class=\"line\">  // Foo.class</span><br><span class=\"line\">  .method(isDeclaredBy(Foo.class)).intercept(FixedValue.value(&quot;One!&quot;))</span><br><span class=\"line\">  // foo</span><br><span class=\"line\">  .method(named(&quot;foo&quot;)).intercept(FixedValue.value(&quot;Two!&quot;))</span><br><span class=\"line\">  // foo1</span><br><span class=\"line\">  .method(named(&quot;foo&quot;).and(takesArguments(1))).intercept(FixedValue.value(&quot;Three!&quot;))</span><br><span class=\"line\">  .make()</span><br><span class=\"line\">  .load(getClass().getClassLoader())</span><br><span class=\"line\">  .getLoaded()</span><br><span class=\"line\">  .newInstance();</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p>MethodDelegationPOJOByte BuddySourceTarget</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Source &#123;</span><br><span class=\"line\">  public String hello(String name) &#123; return null; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class Target &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  public static String hello(String name) &#123;</span><br><span class=\"line\">    return &quot;Hello &quot; + name + &quot;!&quot;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">String helloWorld = new ByteBuddy()</span><br><span class=\"line\">  .subclass(Source.class)</span><br><span class=\"line\">  .method(named(&quot;hello&quot;))</span><br><span class=\"line\">  //    </span><br><span class=\"line\">  .intercept(MethodDelegation.to(Target.class))</span><br><span class=\"line\">  .make()</span><br><span class=\"line\">  .load(getClass().getClassLoader())</span><br><span class=\"line\">  .getLoaded()</span><br><span class=\"line\">  .newInstance()</span><br><span class=\"line\">  .hello(&quot;World&quot;);</span><br></pre></td></tr></table></figure>\n<p> Target </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Target &#123;</span><br><span class=\"line\">  public static String intercept(String name) &#123; return &quot;Hello &quot; + name + &quot;!&quot;; &#125;</span><br><span class=\"line\">  public static String intercept(int i) &#123; return Integer.toString(i); &#125;</span><br><span class=\"line\">  public static String intercept(Object o) &#123; return o.toString(); &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Byte BuddyByte Buddy</p>\n<ul>\n<li>intercept(int)Pass</li>\n<li> intercept(String)</li>\n</ul>\n<p> public @RuntimeType </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RuntimeType</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>  Object <span class=\"title function_\">interceptor</span><span class=\"params\">(<span class=\"meta\">@This</span> Object proxy, <span class=\"meta\">@Origin</span> Method method,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"meta\">@SuperMethod</span> Method superMethod,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"meta\">@AllArguments</span> Object[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;bytebuddy delegate proxy2 before sing &quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">ret</span> <span class=\"operator\">=</span> superMethod.invoke(proxy, args);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;bytebuddy delegate proxy2 after sing &quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p>Target intercept ByteBuddy </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void intercept(Object o1, Object o2)</span><br><span class=\"line\">// </span><br><span class=\"line\">void intercept(@Argument(0) Object o1, @Argument(1) Object o2)</span><br></pre></td></tr></table></figure>\n<p></p>\n<ul>\n<li>@Argument </li>\n<li>@AllArguments </li>\n<li>@This </li>\n<li>@DefaultCall super</li>\n<li>@SuperCall </li>\n<li>@Origin </li>\n<li>@RuntimeType ByteBuddy</li>\n<li>@Super </li>\n<li>@FieldValue </li>\n</ul>\n<h2 id=\"Agent\">Agent</h2>\n<p>Java  1.5  java.lang.instrument Java  API java.lang.instrument  Java AgentJava Agent </p>\n<p>ByteBuddybytebuddyAgentBuilderagent</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ToStringAgent &#123;</span><br><span class=\"line\">  public static void premain(String arguments, Instrumentation instrumentation) &#123;</span><br><span class=\"line\">    new AgentBuilder.Default()</span><br><span class=\"line\">        .type(isAnnotatedWith(ToString.class))</span><br><span class=\"line\">        .transform(new AgentBuilder.Transformer() &#123;</span><br><span class=\"line\">      @Override</span><br><span class=\"line\">      public DynamicType.Builder transform(DynamicType.Builder builder,</span><br><span class=\"line\">                                              TypeDescription typeDescription,</span><br><span class=\"line\">                                              ClassLoader classloader) &#123;</span><br><span class=\"line\">        return builder.method(named(&quot;toString&quot;))</span><br><span class=\"line\">                      .intercept(FixedValue.value(&quot;transformed&quot;));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;).installOn(instrumentation);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>type ElementMatcher class</li>\n<li>transform class</li>\n</ul>\n<h2 id=\"ElementMatcher\">ElementMatcher</h2>\n<p>ElementMatcherclassbytebuddyElementMatchersclass name</p>\n<p>JunctionElementMatcherand  or Matcher</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">new AgentBuilder.Default()</span><br><span class=\"line\">          .type(ElementMatchers.isAnnotatedWith(ToString.class)).and(ElementMatchers.isSubTypeOf(DynamicClass.class)).or(ElementMatchers.named(&quot;DynamicClass&quot;))</span><br><span class=\"line\">          .transform(new AgentBuilder.Transformer() &#123;</span><br><span class=\"line\">              public DynamicType.Builder&lt;?&gt; transform(DynamicType.Builder&lt;?&gt; builder, TypeDescription typeDescription, ClassLoader classLoader, JavaModule javaModule) &#123;</span><br><span class=\"line\">                  return builder</span><br><span class=\"line\">                          .method(ElementMatchers.named(&quot;hello&quot;))</span><br><span class=\"line\">                          .intercept(MethodDelegation.to(MyServiceInterceptor.class))</span><br><span class=\"line\">                          ;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">          &#125;).installOn(instrumentation);</span><br></pre></td></tr></table></figure>\n<h2 id=\"Transformer\"><a href=\"https://so.csdn.net/so/search?q=Transformer&amp;spm=1001.2101.3001.7020\">Transformer</a></h2>\n<p>Transformer  transformDynamicType.Builderbuilder ByteBuddyhellohello MyServiceInterceptor</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class MyServiceInterceptor &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RuntimeType</span><br><span class=\"line\">    public static Object intercept(@Origin Method method, @SuperCall Callable&lt;?&gt; callable) throws Exception &#123;</span><br><span class=\"line\">        System.out.println(&quot;intercept&quot; + method.getName());</span><br><span class=\"line\">        return callable.call();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<p></p>\n<h2 id=\"END\">END</h2>\n<p><strong></strong><br>\n<code>bytebuddy https://bytebuddy.net/#/tutorial</code></p>\n<p><code>https://juejin.cn/post/6844903965553852423#heading-12</code></p>\n","excerpt":"","more":"<h1>ByteBuddy</h1>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">      &lt;groupId&gt;net.bytebuddy&lt;/groupId&gt;</span><br><span class=\"line\">      &lt;artifactId&gt;byte-buddy&lt;/artifactId&gt;</span><br><span class=\"line\">      &lt;version&gt;1.11.12&lt;/version&gt;</span><br><span class=\"line\">  &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Hello-World\">Hello World</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Class&lt;?&gt; dynamicType = new ByteBuddy()</span><br><span class=\"line\">                .subclass(Object.class)</span><br><span class=\"line\">                .method(ElementMatchers.named(&quot;toString&quot;))</span><br><span class=\"line\">                .intercept(FixedValue.value(&quot;Hello World&quot;))</span><br><span class=\"line\">                .make()</span><br><span class=\"line\">                .load(HelloWorldBuddy.class.getClassLoader())</span><br><span class=\"line\">                .getLoaded();</span><br><span class=\"line\">Object instance = dynamicType.newInstance();</span><br><span class=\"line\">String toString = instance.toString();</span><br><span class=\"line\">System.out.println(toString);</span><br><span class=\"line\">System.out.println(instance.getClass().getCanonicalName());</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/image-20230619222624-l98xjgi.png\" alt=\"image\"></p>\n<p>ByteBuddyAPIByteBuddy<br>\n</p>\n<ul>\n<li>subclass </li>\n<li>method  Object  toString </li>\n<li>intercept  toString  value</li>\n<li> make </li>\n</ul>\n<p>Byte BuddyByte Buddy  API Java  Java </p>\n<h2 id=\"\"></h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DynamicType.Unloaded&lt;?&gt; dynamicType = new ByteBuddy()</span><br><span class=\"line\">  .subclass(Object.class)</span><br><span class=\"line\">  .name(&quot;com.zlk.learning.bytebuddy.DynamicType&quot;)</span><br><span class=\"line\">  .make();</span><br></pre></td></tr></table></figure>\n<p> Object  Object </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class DynamicTYpe &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>API</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DynamicType.Unloaded&lt;?&gt; dynamicType = new ByteBuddy()</span><br><span class=\"line\">        .subclass(Object.class)</span><br><span class=\"line\">        .name(&quot;com.zlk.learning.bytebuddy.DynamicType&quot;)</span><br><span class=\"line\">        .defineField(&quot;name&quot;, String.class, 1)</span><br><span class=\"line\">        .defineField(&quot;age&quot;, Integer.class, 1)</span><br><span class=\"line\">        .method(ElementMatchers.named(&quot;toString&quot;))</span><br><span class=\"line\">        .intercept(FixedValue.value(&quot;Hello World!&quot;))</span><br><span class=\"line\">        .make();</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/image-20230619222818-5btwdt3.png\" alt=\"image\"></p>\n<p>nameagetoString Hello World!</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">instantiate</span><span class=\"params\">(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">    Class&lt;?&gt; beanClass = beanDefinition.getBeanClass();</span><br><span class=\"line\">    ArrayList&lt;TypeDescription.Generic&gt; list = getGenerics(beanClass);</span><br><span class=\"line\">    <span class=\"type\">Class</span> <span class=\"variable\">clazz</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ByteBuddy</span>().subclass(beanClass).implement(list)</span><br><span class=\"line\">            .make()</span><br><span class=\"line\">            .load(getClass().getClassLoader())</span><br><span class=\"line\">            .getLoaded();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == ctor) <span class=\"keyword\">return</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> clazz.getDeclaredConstructor(ctor.getParameterTypes()).newInstance(args);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException | InstantiationException | IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BeansException</span>(<span class=\"string\">&quot;Failed to instantiate [&quot;</span> + clazz.getName() + <span class=\"string\">&quot;]&quot;</span>, e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ArrayList&lt;TypeDescription.Generic&gt; getGenerics(Class&lt;?&gt; beanClass) &#123;</span><br><span class=\"line\">    ArrayList&lt;TypeDescription.Generic&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        Type[] genericInterfaces = beanClass.getGenericInterfaces();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Type type : genericInterfaces) &#123;</span><br><span class=\"line\">            Type[] typeArguments = ((ParameterizedType) type).getActualTypeArguments();</span><br><span class=\"line\">            Class&lt;?&gt;[] classes = <span class=\"keyword\">new</span> <span class=\"title class_\">Class</span>[typeArguments.length];</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; typeArguments.length; i++) &#123;</span><br><span class=\"line\">                classes[i] = Class.forName(typeArguments[i].getTypeName());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Class&lt;?&gt; aClass = Class.forName(((ParameterizedType) type).getRawType().getTypeName());</span><br><span class=\"line\">            TypeDescription.<span class=\"type\">Generic</span> <span class=\"variable\">listType</span> <span class=\"operator\">=</span> TypeDescription.Generic.Builder.parameterizedType(aClass, classes).build();</span><br><span class=\"line\">            list.add(listType);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BeansException</span>(<span class=\"string\">&quot;Failed to instantiate [&quot;</span> + beanClass.getName() + <span class=\"string\">&quot;]&quot;</span>, e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<h2 id=\"\"></h2>\n<p> DynamicType.Unloaded Java  DynamicType.Unloaded  getBytes </p>\n<p> jar  saveIn(File)  inject(File)  Jar  ClassLoadingStrategy </p>\n<p>ClassLoadingStrategyByte BufferClassLoaderClassLoadingStrategy.Default</p>\n<ul>\n<li>WRAPPERWrapping</li>\n<li>CHILD_FIRST</li>\n<li>INJECTION</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Class&lt;?&gt; dynamicClass = dynamicType</span><br><span class=\"line\">               .load(Object.class.getClassLoader(), ClassLoadingStrategy.Default.WRAPPER)</span><br><span class=\"line\">               .getLoaded();</span><br></pre></td></tr></table></figure>\n<p> WRAPPER ApplicationClassLoader<br>\n<code>getLoaded  Java Class </code></p>\n<h2 id=\"\"></h2>\n<p>toString</p>\n<h3 id=\"\"></h3>\n<p>ByteBuddy  net.bytebuddy.matcher.ElementMatcher </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Foo dynamicFoo = new ByteBuddy()</span><br><span class=\"line\">  .subclass(Foo.class)</span><br><span class=\"line\">  // Foo.class</span><br><span class=\"line\">  .method(isDeclaredBy(Foo.class)).intercept(FixedValue.value(&quot;One!&quot;))</span><br><span class=\"line\">  // foo</span><br><span class=\"line\">  .method(named(&quot;foo&quot;)).intercept(FixedValue.value(&quot;Two!&quot;))</span><br><span class=\"line\">  // foo1</span><br><span class=\"line\">  .method(named(&quot;foo&quot;).and(takesArguments(1))).intercept(FixedValue.value(&quot;Three!&quot;))</span><br><span class=\"line\">  .make()</span><br><span class=\"line\">  .load(getClass().getClassLoader())</span><br><span class=\"line\">  .getLoaded()</span><br><span class=\"line\">  .newInstance();</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p>MethodDelegationPOJOByte BuddySourceTarget</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Source &#123;</span><br><span class=\"line\">  public String hello(String name) &#123; return null; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class Target &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  public static String hello(String name) &#123;</span><br><span class=\"line\">    return &quot;Hello &quot; + name + &quot;!&quot;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">String helloWorld = new ByteBuddy()</span><br><span class=\"line\">  .subclass(Source.class)</span><br><span class=\"line\">  .method(named(&quot;hello&quot;))</span><br><span class=\"line\">  //    </span><br><span class=\"line\">  .intercept(MethodDelegation.to(Target.class))</span><br><span class=\"line\">  .make()</span><br><span class=\"line\">  .load(getClass().getClassLoader())</span><br><span class=\"line\">  .getLoaded()</span><br><span class=\"line\">  .newInstance()</span><br><span class=\"line\">  .hello(&quot;World&quot;);</span><br></pre></td></tr></table></figure>\n<p> Target </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Target &#123;</span><br><span class=\"line\">  public static String intercept(String name) &#123; return &quot;Hello &quot; + name + &quot;!&quot;; &#125;</span><br><span class=\"line\">  public static String intercept(int i) &#123; return Integer.toString(i); &#125;</span><br><span class=\"line\">  public static String intercept(Object o) &#123; return o.toString(); &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Byte BuddyByte Buddy</p>\n<ul>\n<li>intercept(int)Pass</li>\n<li> intercept(String)</li>\n</ul>\n<p> public @RuntimeType </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RuntimeType</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>  Object <span class=\"title function_\">interceptor</span><span class=\"params\">(<span class=\"meta\">@This</span> Object proxy, <span class=\"meta\">@Origin</span> Method method,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"meta\">@SuperMethod</span> Method superMethod,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"meta\">@AllArguments</span> Object[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;bytebuddy delegate proxy2 before sing &quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Object</span> <span class=\"variable\">ret</span> <span class=\"operator\">=</span> superMethod.invoke(proxy, args);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;bytebuddy delegate proxy2 after sing &quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p>Target intercept ByteBuddy </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void intercept(Object o1, Object o2)</span><br><span class=\"line\">// </span><br><span class=\"line\">void intercept(@Argument(0) Object o1, @Argument(1) Object o2)</span><br></pre></td></tr></table></figure>\n<p></p>\n<ul>\n<li>@Argument </li>\n<li>@AllArguments </li>\n<li>@This </li>\n<li>@DefaultCall super</li>\n<li>@SuperCall </li>\n<li>@Origin </li>\n<li>@RuntimeType ByteBuddy</li>\n<li>@Super </li>\n<li>@FieldValue </li>\n</ul>\n<h2 id=\"Agent\">Agent</h2>\n<p>Java  1.5  java.lang.instrument Java  API java.lang.instrument  Java AgentJava Agent </p>\n<p>ByteBuddybytebuddyAgentBuilderagent</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ToStringAgent &#123;</span><br><span class=\"line\">  public static void premain(String arguments, Instrumentation instrumentation) &#123;</span><br><span class=\"line\">    new AgentBuilder.Default()</span><br><span class=\"line\">        .type(isAnnotatedWith(ToString.class))</span><br><span class=\"line\">        .transform(new AgentBuilder.Transformer() &#123;</span><br><span class=\"line\">      @Override</span><br><span class=\"line\">      public DynamicType.Builder transform(DynamicType.Builder builder,</span><br><span class=\"line\">                                              TypeDescription typeDescription,</span><br><span class=\"line\">                                              ClassLoader classloader) &#123;</span><br><span class=\"line\">        return builder.method(named(&quot;toString&quot;))</span><br><span class=\"line\">                      .intercept(FixedValue.value(&quot;transformed&quot;));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;).installOn(instrumentation);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>type ElementMatcher class</li>\n<li>transform class</li>\n</ul>\n<h2 id=\"ElementMatcher\">ElementMatcher</h2>\n<p>ElementMatcherclassbytebuddyElementMatchersclass name</p>\n<p>JunctionElementMatcherand  or Matcher</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">new AgentBuilder.Default()</span><br><span class=\"line\">          .type(ElementMatchers.isAnnotatedWith(ToString.class)).and(ElementMatchers.isSubTypeOf(DynamicClass.class)).or(ElementMatchers.named(&quot;DynamicClass&quot;))</span><br><span class=\"line\">          .transform(new AgentBuilder.Transformer() &#123;</span><br><span class=\"line\">              public DynamicType.Builder&lt;?&gt; transform(DynamicType.Builder&lt;?&gt; builder, TypeDescription typeDescription, ClassLoader classLoader, JavaModule javaModule) &#123;</span><br><span class=\"line\">                  return builder</span><br><span class=\"line\">                          .method(ElementMatchers.named(&quot;hello&quot;))</span><br><span class=\"line\">                          .intercept(MethodDelegation.to(MyServiceInterceptor.class))</span><br><span class=\"line\">                          ;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">          &#125;).installOn(instrumentation);</span><br></pre></td></tr></table></figure>\n<h2 id=\"Transformer\"><a href=\"https://so.csdn.net/so/search?q=Transformer&amp;spm=1001.2101.3001.7020\">Transformer</a></h2>\n<p>Transformer  transformDynamicType.Builderbuilder ByteBuddyhellohello MyServiceInterceptor</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class MyServiceInterceptor &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RuntimeType</span><br><span class=\"line\">    public static Object intercept(@Origin Method method, @SuperCall Callable&lt;?&gt; callable) throws Exception &#123;</span><br><span class=\"line\">        System.out.println(&quot;intercept&quot; + method.getName());</span><br><span class=\"line\">        return callable.call();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<p></p>\n<h2 id=\"END\">END</h2>\n<p><strong></strong><br>\n<code>bytebuddy https://bytebuddy.net/#/tutorial</code></p>\n<p><code>https://juejin.cn/post/6844903965553852423#heading-12</code></p>\n"},{"title":"Collection","date":"2022-10-30T05:21:31.000Z","lastmod":"2023-05-27T07:29:52.000Z","_content":"\n# Collection\n\n# Collection\n\n![](/assets/net-img-1596005642573-853dc49e-7632-496d-9221-33e3b7879fea-20221030132325-84wdxkw.jpeg)\n\n![](/assets/net-img-1591690708492-8b43720d-e8dc-4e22-9057-dcc4be2210de-20221030132325-ac88yvu.jpeg)\n\n- Collection  \n  - List   \n    - LinkedList()     \n    - ArrayList(Object )     \n    - Vector(Object )    \n  - Set  \n    - HashSet()\n    - LinkedHashSet()\n      \n    - TreeSet()\n- Map  \n  - Hashtable(+)   \n  - HashMap(1.8 +1.8 )   \n    - LinkedHashMap( HashMap )\n  - TreeMap(())\n\n## Iterable\n\n**Iterator **\n\n- hasNext()\n- next()\n- remove()\n\n## ArrayList  LinkedList \n\n- \n- ArrayList LinkedList 1.6 1.7 \n- ArrayList LinkedList \n- LinkedList ArrayList \n- ArrayList LinkedList  ArrayList \n\n## HashMap  Hashtable \n\n- HashMap HashTable  ( ConcurrentHashMap , hashtable )\n- HashMap null  null HashTable  put  null NullPointerException\n- \n  -   Hashtable ** 11** 2n+1HashMap ** 16** 2 \n  -  Hashtable  HashMap  2 \n- JDK1.8  HashMap  8** 64**Hashtable \n\n## ConcurrentHashMap  Hashtable \n\nConcurrentHashMap  Hashtable \n\n-  JDK1.7  ConcurrentHashMap  **+** JDK1.8  HashMap1.8 **+/**Hashtable  JDK1.8  HashMap  **+**  HashMap \n- \n  -   JDK1.7 ConcurrentHashMap (Segment)  JDK1.8  Segment  Node ++ synchronized  CAS JDK1.6   synchronized   HashMap JDK1.8  Segment \n  -  Hashtable() : synchronized  put  put  get\n\n## HashTable\n\n![](/assets/net-img-1591690708909-03b304db-aa14-40fc-954b-2e5812e31b86-20221030132326-7iwfv9t.png)\n\n## JDK7  ConcurrentHashMap\n\n\n\n `ConcurrentHashMap`  `Segment()` `Segment`  `HashMap`  `Segment`  `HashEntry`  `HashEntry`  `Segment`  `HashEntry`  `HashEntry`  `Segment` \n\n![](/assets/net-img-1591690708399-bf1076aa-bdad-4e5f-ae30-261ccda91da5-20221030132327-4fweook.png)[https://imgchr.com/i/t2J5Kx](https://imgchr.com/i/t2J5Kx)\n\n## JDK1.8  ConcurrentHashMapTreeBin:  Node: `\n\n**`1.8ConcurrentHashMaphashmap1.8hashmapputhashcsasynchronized8`**  `synchronized ` hash  N \n\n![](/assets/net-img-1591690708309-b6db1e95-1bbf-4140-b612-26fefc8d85b5-20221030132327-6s3ed7l.png)\n\n## HashMap  HashSet \n\n**HashSet  HashMap **\n\n|HashMap|HashSet|\n| ----------------------------------| ------------------------------------------------------------------------|\n| Map | Set |\n|||\n| put() map | add() Set |\n|HashMap Key Hashcode|HashSet  hashcode  hashcode |\n","source":"_posts/java/Collection.md","raw":"---\ntitle: Collection\ndate: 2022-10-30T13:21:31Z\nlastmod: 2023-05-27T15:29:52Z\n---\n\n# Collection\n\n# Collection\n\n![](/assets/net-img-1596005642573-853dc49e-7632-496d-9221-33e3b7879fea-20221030132325-84wdxkw.jpeg)\n\n![](/assets/net-img-1591690708492-8b43720d-e8dc-4e22-9057-dcc4be2210de-20221030132325-ac88yvu.jpeg)\n\n- Collection  \n  - List   \n    - LinkedList()     \n    - ArrayList(Object )     \n    - Vector(Object )    \n  - Set  \n    - HashSet()\n    - LinkedHashSet()\n      \n    - TreeSet()\n- Map  \n  - Hashtable(+)   \n  - HashMap(1.8 +1.8 )   \n    - LinkedHashMap( HashMap )\n  - TreeMap(())\n\n## Iterable\n\n**Iterator **\n\n- hasNext()\n- next()\n- remove()\n\n## ArrayList  LinkedList \n\n- \n- ArrayList LinkedList 1.6 1.7 \n- ArrayList LinkedList \n- LinkedList ArrayList \n- ArrayList LinkedList  ArrayList \n\n## HashMap  Hashtable \n\n- HashMap HashTable  ( ConcurrentHashMap , hashtable )\n- HashMap null  null HashTable  put  null NullPointerException\n- \n  -   Hashtable ** 11** 2n+1HashMap ** 16** 2 \n  -  Hashtable  HashMap  2 \n- JDK1.8  HashMap  8** 64**Hashtable \n\n## ConcurrentHashMap  Hashtable \n\nConcurrentHashMap  Hashtable \n\n-  JDK1.7  ConcurrentHashMap  **+** JDK1.8  HashMap1.8 **+/**Hashtable  JDK1.8  HashMap  **+**  HashMap \n- \n  -   JDK1.7 ConcurrentHashMap (Segment)  JDK1.8  Segment  Node ++ synchronized  CAS JDK1.6   synchronized   HashMap JDK1.8  Segment \n  -  Hashtable() : synchronized  put  put  get\n\n## HashTable\n\n![](/assets/net-img-1591690708909-03b304db-aa14-40fc-954b-2e5812e31b86-20221030132326-7iwfv9t.png)\n\n## JDK7  ConcurrentHashMap\n\n\n\n `ConcurrentHashMap`  `Segment()` `Segment`  `HashMap`  `Segment`  `HashEntry`  `HashEntry`  `Segment`  `HashEntry`  `HashEntry`  `Segment` \n\n![](/assets/net-img-1591690708399-bf1076aa-bdad-4e5f-ae30-261ccda91da5-20221030132327-4fweook.png)[https://imgchr.com/i/t2J5Kx](https://imgchr.com/i/t2J5Kx)\n\n## JDK1.8  ConcurrentHashMapTreeBin:  Node: `\n\n**`1.8ConcurrentHashMaphashmap1.8hashmapputhashcsasynchronized8`**  `synchronized ` hash  N \n\n![](/assets/net-img-1591690708309-b6db1e95-1bbf-4140-b612-26fefc8d85b5-20221030132327-6s3ed7l.png)\n\n## HashMap  HashSet \n\n**HashSet  HashMap **\n\n|HashMap|HashSet|\n| ----------------------------------| ------------------------------------------------------------------------|\n| Map | Set |\n|||\n| put() map | add() Set |\n|HashMap Key Hashcode|HashSet  hashcode  hashcode |\n","slug":"java-Collection","published":1,"updated":"2025-04-28T08:41:48.386Z","_id":"cm9s3f3yv0005bfg49hwx0b2y","comments":1,"layout":"post","photos":[],"content":"<h1>Collection</h1>\n<h1>Collection</h1>\n<p><img src=\"/assets/net-img-1596005642573-853dc49e-7632-496d-9221-33e3b7879fea-20221030132325-84wdxkw.jpeg\" alt=\"\"></p>\n<p><img src=\"/assets/net-img-1591690708492-8b43720d-e8dc-4e22-9057-dcc4be2210de-20221030132325-ac88yvu.jpeg\" alt=\"\"></p>\n<ul>\n<li>Collection  \n<ul>\n<li>List   \n<ul>\n<li>LinkedList()     </li>\n<li>ArrayList(Object )     </li>\n<li>Vector(Object )    </li>\n</ul>\n</li>\n<li>Set  \n<ul>\n<li>HashSet()</li>\n<li>LinkedHashSet()<br>\n</li>\n<li>TreeSet()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Map  \n<ul>\n<li>Hashtable(+)   </li>\n<li>HashMap(1.8 +1.8 )   \n<ul>\n<li>LinkedHashMap( HashMap )</li>\n</ul>\n</li>\n<li>TreeMap(())</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Iterable\">Iterable</h2>\n<p><strong>Iterator </strong></p>\n<ul>\n<li>hasNext()</li>\n<li>next()</li>\n<li>remove()</li>\n</ul>\n<h2 id=\"ArrayList--LinkedList-\">ArrayList  LinkedList </h2>\n<ul>\n<li></li>\n<li>ArrayList LinkedList 1.6 1.7 </li>\n<li>ArrayList LinkedList </li>\n<li>LinkedList ArrayList </li>\n<li>ArrayList LinkedList  ArrayList </li>\n</ul>\n<h2 id=\"HashMap--Hashtable-\">HashMap  Hashtable </h2>\n<ul>\n<li>HashMap HashTable  ( ConcurrentHashMap , hashtable )</li>\n<li>HashMap null  null HashTable  put  null NullPointerException</li>\n<li>\n<ul>\n<li>  Hashtable <strong> 11</strong> 2n+1HashMap <strong> 16</strong> 2 </li>\n<li> Hashtable  HashMap  2 </li>\n</ul>\n</li>\n<li>JDK1.8  HashMap  8<strong> 64</strong>Hashtable </li>\n</ul>\n<h2 id=\"ConcurrentHashMap--Hashtable-\">ConcurrentHashMap  Hashtable </h2>\n<p>ConcurrentHashMap  Hashtable </p>\n<ul>\n<li> JDK1.7  ConcurrentHashMap  <strong>+</strong> JDK1.8  HashMap1.8 <strong>+/</strong>Hashtable  JDK1.8  HashMap  <strong>+</strong>  HashMap </li>\n<li>\n<ul>\n<li>  JDK1.7 ConcurrentHashMap (Segment)  JDK1.8  Segment  Node ++ synchronized  CAS JDK1.6   synchronized   HashMap JDK1.8  Segment </li>\n<li> Hashtable() : synchronized  put  put  get</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"HashTable\">HashTable</h2>\n<p><img src=\"/assets/net-img-1591690708909-03b304db-aa14-40fc-954b-2e5812e31b86-20221030132326-7iwfv9t.png\" alt=\"\"></p>\n<h2 id=\"JDK7--ConcurrentHashMap\">JDK7  ConcurrentHashMap</h2>\n<p></p>\n<p> <code>ConcurrentHashMap</code>  <code>Segment()</code> <code>Segment</code>  <code>HashMap</code>  <code>Segment</code>  <code>HashEntry</code>  <code>HashEntry</code>  <code>Segment</code>  <code>HashEntry</code>  <code>HashEntry</code>  <code>Segment</code> </p>\n<p><img src=\"/assets/net-img-1591690708399-bf1076aa-bdad-4e5f-ae30-261ccda91da5-20221030132327-4fweook.png\" alt=\"\"><a href=\"https://imgchr.com/i/t2J5Kx\">https://imgchr.com/i/t2J5Kx</a></p>\n<h2 id=\"JDK1-8--ConcurrentHashMapTreeBin--Node-\">JDK1.8  ConcurrentHashMapTreeBin:  Node: `</h2>\n<p><strong><code>1.8ConcurrentHashMaphashmap1.8hashmapputhashcsasynchronized8</code></strong>  <code>synchronized </code> hash  N </p>\n<p><img src=\"/assets/net-img-1591690708309-b6db1e95-1bbf-4140-b612-26fefc8d85b5-20221030132327-6s3ed7l.png\" alt=\"\"></p>\n<h2 id=\"HashMap--HashSet-\">HashMap  HashSet </h2>\n<p><strong>HashSet  HashMap </strong></p>\n<table>\n<thead>\n<tr>\n<th>HashMap</th>\n<th>HashSet</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td> Map </td>\n<td> Set </td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td> put() map </td>\n<td> add() Set </td>\n</tr>\n<tr>\n<td>HashMap Key Hashcode</td>\n<td>HashSet  hashcode  hashcode </td>\n</tr>\n</tbody>\n</table>\n","excerpt":"","more":"<h1>Collection</h1>\n<h1>Collection</h1>\n<p><img src=\"/assets/net-img-1596005642573-853dc49e-7632-496d-9221-33e3b7879fea-20221030132325-84wdxkw.jpeg\" alt=\"\"></p>\n<p><img src=\"/assets/net-img-1591690708492-8b43720d-e8dc-4e22-9057-dcc4be2210de-20221030132325-ac88yvu.jpeg\" alt=\"\"></p>\n<ul>\n<li>Collection  \n<ul>\n<li>List   \n<ul>\n<li>LinkedList()     </li>\n<li>ArrayList(Object )     </li>\n<li>Vector(Object )    </li>\n</ul>\n</li>\n<li>Set  \n<ul>\n<li>HashSet()</li>\n<li>LinkedHashSet()<br>\n</li>\n<li>TreeSet()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Map  \n<ul>\n<li>Hashtable(+)   </li>\n<li>HashMap(1.8 +1.8 )   \n<ul>\n<li>LinkedHashMap( HashMap )</li>\n</ul>\n</li>\n<li>TreeMap(())</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Iterable\">Iterable</h2>\n<p><strong>Iterator </strong></p>\n<ul>\n<li>hasNext()</li>\n<li>next()</li>\n<li>remove()</li>\n</ul>\n<h2 id=\"ArrayList--LinkedList-\">ArrayList  LinkedList </h2>\n<ul>\n<li></li>\n<li>ArrayList LinkedList 1.6 1.7 </li>\n<li>ArrayList LinkedList </li>\n<li>LinkedList ArrayList </li>\n<li>ArrayList LinkedList  ArrayList </li>\n</ul>\n<h2 id=\"HashMap--Hashtable-\">HashMap  Hashtable </h2>\n<ul>\n<li>HashMap HashTable  ( ConcurrentHashMap , hashtable )</li>\n<li>HashMap null  null HashTable  put  null NullPointerException</li>\n<li>\n<ul>\n<li>  Hashtable <strong> 11</strong> 2n+1HashMap <strong> 16</strong> 2 </li>\n<li> Hashtable  HashMap  2 </li>\n</ul>\n</li>\n<li>JDK1.8  HashMap  8<strong> 64</strong>Hashtable </li>\n</ul>\n<h2 id=\"ConcurrentHashMap--Hashtable-\">ConcurrentHashMap  Hashtable </h2>\n<p>ConcurrentHashMap  Hashtable </p>\n<ul>\n<li> JDK1.7  ConcurrentHashMap  <strong>+</strong> JDK1.8  HashMap1.8 <strong>+/</strong>Hashtable  JDK1.8  HashMap  <strong>+</strong>  HashMap </li>\n<li>\n<ul>\n<li>  JDK1.7 ConcurrentHashMap (Segment)  JDK1.8  Segment  Node ++ synchronized  CAS JDK1.6   synchronized   HashMap JDK1.8  Segment </li>\n<li> Hashtable() : synchronized  put  put  get</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"HashTable\">HashTable</h2>\n<p><img src=\"/assets/net-img-1591690708909-03b304db-aa14-40fc-954b-2e5812e31b86-20221030132326-7iwfv9t.png\" alt=\"\"></p>\n<h2 id=\"JDK7--ConcurrentHashMap\">JDK7  ConcurrentHashMap</h2>\n<p></p>\n<p> <code>ConcurrentHashMap</code>  <code>Segment()</code> <code>Segment</code>  <code>HashMap</code>  <code>Segment</code>  <code>HashEntry</code>  <code>HashEntry</code>  <code>Segment</code>  <code>HashEntry</code>  <code>HashEntry</code>  <code>Segment</code> </p>\n<p><img src=\"/assets/net-img-1591690708399-bf1076aa-bdad-4e5f-ae30-261ccda91da5-20221030132327-4fweook.png\" alt=\"\"><a href=\"https://imgchr.com/i/t2J5Kx\">https://imgchr.com/i/t2J5Kx</a></p>\n<h2 id=\"JDK1-8--ConcurrentHashMapTreeBin--Node-\">JDK1.8  ConcurrentHashMapTreeBin:  Node: `</h2>\n<p><strong><code>1.8ConcurrentHashMaphashmap1.8hashmapputhashcsasynchronized8</code></strong>  <code>synchronized </code> hash  N </p>\n<p><img src=\"/assets/net-img-1591690708309-b6db1e95-1bbf-4140-b612-26fefc8d85b5-20221030132327-6s3ed7l.png\" alt=\"\"></p>\n<h2 id=\"HashMap--HashSet-\">HashMap  HashSet </h2>\n<p><strong>HashSet  HashMap </strong></p>\n<table>\n<thead>\n<tr>\n<th>HashMap</th>\n<th>HashSet</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td> Map </td>\n<td> Set </td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td> put() map </td>\n<td> add() Set </td>\n</tr>\n<tr>\n<td>HashMap Key Hashcode</td>\n<td>HashSet  hashcode  hashcode </td>\n</tr>\n</tbody>\n</table>\n"},{"title":"JVM","date":"2022-10-30T05:39:04.000Z","lastmod":"2023-11-26T06:54:43.000Z","_content":"\n# JVM\n\n## GC\n\n### \n\n> CPUCPU =  / + \n\n* 100199%\n\n* \n\n* STW0.2 + 0.2 = 0.4\n\n### \n\n> GC\n\n* GC100100\n\n* STW\n\n## \n\n- \n- \n- JDK8  HotSpot  JRockit jrockit \n\n## \n\n\n\n* \n* api\n\n\n\n* ClassLoaderClassLoader\n\n## \n\n### \n\n> java.lang.ThreadsetContextClassLoader()\n\n![image](/assets/image-20231117164621-qjdsktw.png)\n\n### \n\n> \n\n## \n\nJavaClassClassgetClassLoader()Class\n\nClassObjectgetClass()ClassJavaclassClass\n\n![](/assets/image-20231119124615-vxa33dm.png)\n\n## toto15\n\nMinor GC`from to`,To,To,,15,\n","source":"_posts/java/JVM.md","raw":"---\ntitle: JVM\ndate: 2022-10-30T13:39:04Z\nlastmod: 2023-11-26T14:54:43Z\n---\n\n# JVM\n\n## GC\n\n### \n\n> CPUCPU =  / + \n\n* 100199%\n\n* \n\n* STW0.2 + 0.2 = 0.4\n\n### \n\n> GC\n\n* GC100100\n\n* STW\n\n## \n\n- \n- \n- JDK8  HotSpot  JRockit jrockit \n\n## \n\n\n\n* \n* api\n\n\n\n* ClassLoaderClassLoader\n\n## \n\n### \n\n> java.lang.ThreadsetContextClassLoader()\n\n![image](/assets/image-20231117164621-qjdsktw.png)\n\n### \n\n> \n\n## \n\nJavaClassClassgetClassLoader()Class\n\nClassObjectgetClass()ClassJavaclassClass\n\n![](/assets/image-20231119124615-vxa33dm.png)\n\n## toto15\n\nMinor GC`from to`,To,To,,15,\n","slug":"java-JVM","published":1,"updated":"2025-04-28T08:41:48.389Z","_id":"cm9s3f3yv0006bfg45rn42dzz","comments":1,"layout":"post","photos":[],"content":"<h1>JVM</h1>\n<h2 id=\"GC\">GC</h2>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>CPUCPU =  / + </p>\n</blockquote>\n<ul>\n<li>\n<p>100199%</p>\n</li>\n<li>\n<p></p>\n</li>\n<li>\n<p>STW0.2 + 0.2 = 0.4</p>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>GC</p>\n</blockquote>\n<ul>\n<li>\n<p>GC100100</p>\n</li>\n<li>\n<p>STW</p>\n</li>\n</ul>\n<h2 id=\"\"></h2>\n<ul>\n<li></li>\n<li></li>\n<li>JDK8  HotSpot  JRockit jrockit </li>\n</ul>\n<h2 id=\"\"></h2>\n<p></p>\n<ul>\n<li></li>\n<li>api</li>\n</ul>\n<p></p>\n<ul>\n<li>ClassLoaderClassLoader</li>\n</ul>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>java.lang.ThreadsetContextClassLoader()</p>\n</blockquote>\n<p><img src=\"/assets/image-20231117164621-qjdsktw.png\" alt=\"image\"></p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"\"></h2>\n<p>JavaClassClassgetClassLoader()Class</p>\n<p>ClassObjectgetClass()ClassJavaclassClass</p>\n<p><img src=\"/assets/image-20231119124615-vxa33dm.png\" alt=\"\"></p>\n<h2 id=\"toto15\">toto15</h2>\n<p>Minor GC<code>from to</code>,To,To,,15,</p>\n","excerpt":"","more":"<h1>JVM</h1>\n<h2 id=\"GC\">GC</h2>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>CPUCPU =  / + </p>\n</blockquote>\n<ul>\n<li>\n<p>100199%</p>\n</li>\n<li>\n<p></p>\n</li>\n<li>\n<p>STW0.2 + 0.2 = 0.4</p>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>GC</p>\n</blockquote>\n<ul>\n<li>\n<p>GC100100</p>\n</li>\n<li>\n<p>STW</p>\n</li>\n</ul>\n<h2 id=\"\"></h2>\n<ul>\n<li></li>\n<li></li>\n<li>JDK8  HotSpot  JRockit jrockit </li>\n</ul>\n<h2 id=\"\"></h2>\n<p></p>\n<ul>\n<li></li>\n<li>api</li>\n</ul>\n<p></p>\n<ul>\n<li>ClassLoaderClassLoader</li>\n</ul>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>java.lang.ThreadsetContextClassLoader()</p>\n</blockquote>\n<p><img src=\"/assets/image-20231117164621-qjdsktw.png\" alt=\"image\"></p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"\"></h2>\n<p>JavaClassClassgetClassLoader()Class</p>\n<p>ClassObjectgetClass()ClassJavaclassClass</p>\n<p><img src=\"/assets/image-20231119124615-vxa33dm.png\" alt=\"\"></p>\n<h2 id=\"toto15\">toto15</h2>\n<p>Minor GC<code>from to</code>,To,To,,15,</p>\n"},{"title":"JavaWeb","date":"2022-10-30T05:27:30.000Z","lastmod":"2022-10-30T05:27:36.000Z","_content":"\n# JavaWeb\n\n\n\n\n","source":"_posts/java/JavaWeb.md","raw":"---\ntitle: JavaWeb\ndate: 2022-10-30T13:27:30Z\nlastmod: 2022-10-30T13:27:36Z\n---\n\n# JavaWeb\n\n\n\n\n","slug":"java-JavaWeb","published":1,"updated":"2025-04-20T00:08:55.553Z","_id":"cm9s3f3yx0007bfg47uroaeyi","comments":1,"layout":"post","photos":[],"content":"<h1>JavaWeb</h1>\n<p></p>\n<p></p>\n","excerpt":"","more":"<h1>JavaWeb</h1>\n<p></p>\n<p></p>\n"},{"title":"thread","date":"2023-05-14T14:53:28.000Z","lastmod":"2023-08-25T08:32:48.000Z","_content":"\n# thread\n\n## \n\n### \n\n  \n  \n![1-1.png](/assets/net-img-1582875290415-c052f229-8c31-4560-acef-300acae2409b-20221030135515-tme9bzx.png)\n\n### \n\n>   \n> \n\n>   \n> \n\n## \n\n![](/assets/net-img-1596249786159-92610d33-5cbb-4d46-b7a5-6f1c8d3d1d92-20221030135516-9i6hh1r.jpeg)  1. \n\n* new \n* JVM \n\n2. \n\n    *  start()\n    * JVM \n3. \n\n    *  CPU  run()\n4. \n\n    * \n5. \n\n    * CPU\n6. \n\n    * CPU\n7. \n\n    *  3 \n    * run() call()\n    *  Exception  Error> stop()\n\n## \n\n()\n\n### \n\n1.   \n    \n2.   \n    )\n3.   \n    \n4.   \n     {Pl, P2, , pn} Pi   P(i+1)i=0, 1, , n-1)Pn  P0 \n\n![1-5.png](/assets/net-img-1582875326094-cb5a96e7-e4c2-421d-83cf-216ca4f7f024-20221030135516-5igfhr6.png)![1-4.png](/assets/net-img-1582875326657-55738037-28bf-4de9-925a-f08034e0c722-20221030135516-j4ktjne.png)\n\n### \n\n### \n\n1.   \n    ````\n2.   \n    \n\n    * \n    *  S  R  S  R\n3.   \n    \n\n    * \n    * \n4.   \n    \n\n### \n\n1.   \n    \n\n```\n\n\n\n```\n\n2.   \n      \n     i  REQUEST [i]![1-6.png](/assets/net-img-1582875381841-0104c814-acd3-4ef3-a3bd-f5331d9a06bc-20221030135516-0716ftg.png)\n\n```\n1. REQUEST [i]<= NEED[ij]2)\n2 .REQUEST [i]<= AVAILABLE[i]3)\n3 .\n   AVAILABLE[i]-=REQUEST[i];//-\n   ALLOCATION[i]+=REQUEST[i];//+\n   NEED[i]-=REQUEST[i];//-\n\n```\n\n3.   \n    ,\n4.   \n      \n    \n\n```\n1) \n2) JavasynchronizedJava5java.util.concurrent\n```\n\n### \n\n****  \n![1-7.png](/assets/net-img-1582875390665-923c52b9-52ce-4e6f-9cee-763046546af3-20221030135517-j4zeqi7.png)\n\n```\nE existing resource vector\nA available resource vectorAi\nC current allocation matrixCiPi\nR request matrixRP\n```\n\n****\n\n```\nPiRiA\nCiA1\n\n\n```\n\n### \n\n*   \n  \n*   \n  \n* \n\n  * \n  * \n\n## Java\n\n*  Thread  extends Thread\n*  Runnable  implements Runnable\n*  Callable  implements Callable\n\n  *  Callable   Runnable \n  *  Callable  FutureTask  FutureTask  Future  `new Thread(objectFutureTask1).start()`\n\n> Future\n\n* cancel()truefalse\n\n  * mayInterruptIfRunningtrue\n  * mayInterruptIfRunningtruefalsefalsefalse\n  * mayInterruptIfRunningtruetruemayInterruptIfRunningfalsefalsemayInterruptIfRunningtruefalsetrue\n* isCancelled() true\n* isDone()true\n* get()\n* get(long timeout, TimeUnit unit)null\n\n> FutureTask\n>\n> RunnableFutureRunnableFutureRunnableFutureRunnablecallable\n\n* \n\n  * \n  * \n\n### \n\n*  Thread \n\n>   \n>  java   \n>   \n>  Runable  Callable  Thread   \n>  java  2  main \n\n* Runnable  Callable \n\n  * \n\n>   \n>   \n>  Thread.start()\n\n* \n\n>  Callable  Runnable   \n> Callable  call() Runnable  run()  \n>  Callable  Future.cancel    Runnable \n\n* \n\n> Callable  FutureTask.get()\n>\n> Runnable, Thread  Thread  run()  run()  Runnable \n","source":"_posts/java/thread.md","raw":"---\ntitle: thread\ndate: 2023-05-14T22:53:28Z\nlastmod: 2023-08-25T16:32:48Z\n---\n\n# thread\n\n## \n\n### \n\n  \n  \n![1-1.png](/assets/net-img-1582875290415-c052f229-8c31-4560-acef-300acae2409b-20221030135515-tme9bzx.png)\n\n### \n\n>   \n> \n\n>   \n> \n\n## \n\n![](/assets/net-img-1596249786159-92610d33-5cbb-4d46-b7a5-6f1c8d3d1d92-20221030135516-9i6hh1r.jpeg)  1. \n\n* new \n* JVM \n\n2. \n\n    *  start()\n    * JVM \n3. \n\n    *  CPU  run()\n4. \n\n    * \n5. \n\n    * CPU\n6. \n\n    * CPU\n7. \n\n    *  3 \n    * run() call()\n    *  Exception  Error> stop()\n\n## \n\n()\n\n### \n\n1.   \n    \n2.   \n    )\n3.   \n    \n4.   \n     {Pl, P2, , pn} Pi   P(i+1)i=0, 1, , n-1)Pn  P0 \n\n![1-5.png](/assets/net-img-1582875326094-cb5a96e7-e4c2-421d-83cf-216ca4f7f024-20221030135516-5igfhr6.png)![1-4.png](/assets/net-img-1582875326657-55738037-28bf-4de9-925a-f08034e0c722-20221030135516-j4ktjne.png)\n\n### \n\n### \n\n1.   \n    ````\n2.   \n    \n\n    * \n    *  S  R  S  R\n3.   \n    \n\n    * \n    * \n4.   \n    \n\n### \n\n1.   \n    \n\n```\n\n\n\n```\n\n2.   \n      \n     i  REQUEST [i]![1-6.png](/assets/net-img-1582875381841-0104c814-acd3-4ef3-a3bd-f5331d9a06bc-20221030135516-0716ftg.png)\n\n```\n1. REQUEST [i]<= NEED[ij]2)\n2 .REQUEST [i]<= AVAILABLE[i]3)\n3 .\n   AVAILABLE[i]-=REQUEST[i];//-\n   ALLOCATION[i]+=REQUEST[i];//+\n   NEED[i]-=REQUEST[i];//-\n\n```\n\n3.   \n    ,\n4.   \n      \n    \n\n```\n1) \n2) JavasynchronizedJava5java.util.concurrent\n```\n\n### \n\n****  \n![1-7.png](/assets/net-img-1582875390665-923c52b9-52ce-4e6f-9cee-763046546af3-20221030135517-j4zeqi7.png)\n\n```\nE existing resource vector\nA available resource vectorAi\nC current allocation matrixCiPi\nR request matrixRP\n```\n\n****\n\n```\nPiRiA\nCiA1\n\n\n```\n\n### \n\n*   \n  \n*   \n  \n* \n\n  * \n  * \n\n## Java\n\n*  Thread  extends Thread\n*  Runnable  implements Runnable\n*  Callable  implements Callable\n\n  *  Callable   Runnable \n  *  Callable  FutureTask  FutureTask  Future  `new Thread(objectFutureTask1).start()`\n\n> Future\n\n* cancel()truefalse\n\n  * mayInterruptIfRunningtrue\n  * mayInterruptIfRunningtruefalsefalsefalse\n  * mayInterruptIfRunningtruetruemayInterruptIfRunningfalsefalsemayInterruptIfRunningtruefalsetrue\n* isCancelled() true\n* isDone()true\n* get()\n* get(long timeout, TimeUnit unit)null\n\n> FutureTask\n>\n> RunnableFutureRunnableFutureRunnableFutureRunnablecallable\n\n* \n\n  * \n  * \n\n### \n\n*  Thread \n\n>   \n>  java   \n>   \n>  Runable  Callable  Thread   \n>  java  2  main \n\n* Runnable  Callable \n\n  * \n\n>   \n>   \n>  Thread.start()\n\n* \n\n>  Callable  Runnable   \n> Callable  call() Runnable  run()  \n>  Callable  Future.cancel    Runnable \n\n* \n\n> Callable  FutureTask.get()\n>\n> Runnable, Thread  Thread  run()  run()  Runnable \n","slug":"java-thread","published":1,"updated":"2025-04-28T08:41:48.394Z","_id":"cm9s3f3yx0008bfg4d2n5e8hf","comments":1,"layout":"post","photos":[],"content":"<h1>thread</h1>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<p><br>\n<br>\n<img src=\"/assets/net-img-1582875290415-c052f229-8c31-4560-acef-300acae2409b-20221030135515-tme9bzx.png\" alt=\"1-1.png\"></p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p><br>\n</p>\n</blockquote>\n<blockquote>\n<p><br>\n</p>\n</blockquote>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1596249786159-92610d33-5cbb-4d46-b7a5-6f1c8d3d1d92-20221030135516-9i6hh1r.jpeg\" alt=\"\">  1. </p>\n<ul>\n<li>new </li>\n<li>JVM </li>\n</ul>\n<ol start=\"2\">\n<li>\n<p></p>\n<ul>\n<li> start()</li>\n<li>JVM </li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li> CPU  run()</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>CPU</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>CPU</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li> 3 </li>\n<li>run() call()</li>\n<li> Exception  Error&gt; stop()</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"\"></h2>\n<p>()</p>\n<h3 id=\"\"></h3>\n<ol>\n<li><br>\n</li>\n<li><br>\n)</li>\n<li><br>\n</li>\n<li><br>\n {Pl, P2, , pn} Pi   P(i+1)i=0, 1, , n-1)Pn  P0 </li>\n</ol>\n<p><img src=\"/assets/net-img-1582875326094-cb5a96e7-e4c2-421d-83cf-216ca4f7f024-20221030135516-5igfhr6.png\" alt=\"1-5.png\"><img src=\"/assets/net-img-1582875326657-55738037-28bf-4de9-925a-f08034e0c722-20221030135516-j4ktjne.png\" alt=\"1-4.png\"></p>\n<h3 id=\"\"></h3>\n<h3 id=\"\"></h3>\n<ol>\n<li>\n<p><br>\n<code></code><code></code></p>\n</li>\n<li>\n<p><br>\n</p>\n<ul>\n<li></li>\n<li> S  R  S  R</li>\n</ul>\n</li>\n<li>\n<p><br>\n</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p><br>\n</p>\n</li>\n</ol>\n<h3 id=\"\"></h3>\n<ol>\n<li><br>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li><br>\n<br>\n i  REQUEST [i]<img src=\"/assets/net-img-1582875381841-0104c814-acd3-4ef3-a3bd-f5331d9a06bc-20221030135516-0716ftg.png\" alt=\"1-6.png\"></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. REQUEST [i]&lt;= NEED[ij]2)</span><br><span class=\"line\">2 .REQUEST [i]&lt;= AVAILABLE[i]3)</span><br><span class=\"line\">3 .</span><br><span class=\"line\">   AVAILABLE[i]-=REQUEST[i];//-</span><br><span class=\"line\">   ALLOCATION[i]+=REQUEST[i];//+</span><br><span class=\"line\">   NEED[i]-=REQUEST[i];//-</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li><br>\n,</li>\n<li><br>\n<br>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) </span><br><span class=\"line\">2) JavasynchronizedJava5java.util.concurrent</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p><strong></strong><br>\n<img src=\"/assets/net-img-1582875390665-923c52b9-52ce-4e6f-9cee-763046546af3-20221030135517-j4zeqi7.png\" alt=\"1-7.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E existing resource vector</span><br><span class=\"line\">A available resource vectorAi</span><br><span class=\"line\">C current allocation matrixCiPi</span><br><span class=\"line\">R request matrixRP</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PiRiA</span><br><span class=\"line\">CiA1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<ul>\n<li>\n<p><br>\n</p>\n</li>\n<li>\n<p><br>\n</p>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Java\">Java</h2>\n<ul>\n<li>\n<p> Thread  extends Thread</p>\n</li>\n<li>\n<p> Runnable  implements Runnable</p>\n</li>\n<li>\n<p> Callable  implements Callable</p>\n<ul>\n<li> Callable   Runnable </li>\n<li> Callable  FutureTask  FutureTask  Future  <code>new Thread(objectFutureTask1).start()</code></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>Future</p>\n</blockquote>\n<ul>\n<li>\n<p>cancel()truefalse</p>\n<ul>\n<li>mayInterruptIfRunningtrue</li>\n<li>mayInterruptIfRunningtruefalsefalsefalse</li>\n<li>mayInterruptIfRunningtruetruemayInterruptIfRunningfalsefalsemayInterruptIfRunningtruefalsetrue</li>\n</ul>\n</li>\n<li>\n<p>isCancelled() true</p>\n</li>\n<li>\n<p>isDone()true</p>\n</li>\n<li>\n<p>get()</p>\n</li>\n<li>\n<p>get(long timeout, TimeUnit unit)null</p>\n</li>\n</ul>\n<blockquote>\n<p>FutureTask</p>\n<p>RunnableFutureRunnableFutureRunnableFutureRunnablecallable</p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li> Thread </li>\n</ul>\n<blockquote>\n<p><br>\n java <br>\n<br>\n Runable  Callable  Thread <br>\n java  2  main </p>\n</blockquote>\n<ul>\n<li>\n<p>Runnable  Callable </p>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p><br>\n<br>\n Thread.start()</p>\n</blockquote>\n<ul>\n<li></li>\n</ul>\n<blockquote>\n<p> Callable  Runnable <br>\nCallable  call() Runnable  run()<br>\n Callable  Future.cancel    Runnable </p>\n</blockquote>\n<ul>\n<li></li>\n</ul>\n<blockquote>\n<p>Callable  FutureTask.get()</p>\n<p>Runnable, Thread  Thread  run()  run()  Runnable </p>\n</blockquote>\n","excerpt":"","more":"<h1>thread</h1>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<p><br>\n<br>\n<img src=\"/assets/net-img-1582875290415-c052f229-8c31-4560-acef-300acae2409b-20221030135515-tme9bzx.png\" alt=\"1-1.png\"></p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p><br>\n</p>\n</blockquote>\n<blockquote>\n<p><br>\n</p>\n</blockquote>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1596249786159-92610d33-5cbb-4d46-b7a5-6f1c8d3d1d92-20221030135516-9i6hh1r.jpeg\" alt=\"\">  1. </p>\n<ul>\n<li>new </li>\n<li>JVM </li>\n</ul>\n<ol start=\"2\">\n<li>\n<p></p>\n<ul>\n<li> start()</li>\n<li>JVM </li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li> CPU  run()</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>CPU</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>CPU</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li> 3 </li>\n<li>run() call()</li>\n<li> Exception  Error&gt; stop()</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"\"></h2>\n<p>()</p>\n<h3 id=\"\"></h3>\n<ol>\n<li><br>\n</li>\n<li><br>\n)</li>\n<li><br>\n</li>\n<li><br>\n {Pl, P2, , pn} Pi   P(i+1)i=0, 1, , n-1)Pn  P0 </li>\n</ol>\n<p><img src=\"/assets/net-img-1582875326094-cb5a96e7-e4c2-421d-83cf-216ca4f7f024-20221030135516-5igfhr6.png\" alt=\"1-5.png\"><img src=\"/assets/net-img-1582875326657-55738037-28bf-4de9-925a-f08034e0c722-20221030135516-j4ktjne.png\" alt=\"1-4.png\"></p>\n<h3 id=\"\"></h3>\n<h3 id=\"\"></h3>\n<ol>\n<li>\n<p><br>\n<code></code><code></code></p>\n</li>\n<li>\n<p><br>\n</p>\n<ul>\n<li></li>\n<li> S  R  S  R</li>\n</ul>\n</li>\n<li>\n<p><br>\n</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p><br>\n</p>\n</li>\n</ol>\n<h3 id=\"\"></h3>\n<ol>\n<li><br>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li><br>\n<br>\n i  REQUEST [i]<img src=\"/assets/net-img-1582875381841-0104c814-acd3-4ef3-a3bd-f5331d9a06bc-20221030135516-0716ftg.png\" alt=\"1-6.png\"></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. REQUEST [i]&lt;= NEED[ij]2)</span><br><span class=\"line\">2 .REQUEST [i]&lt;= AVAILABLE[i]3)</span><br><span class=\"line\">3 .</span><br><span class=\"line\">   AVAILABLE[i]-=REQUEST[i];//-</span><br><span class=\"line\">   ALLOCATION[i]+=REQUEST[i];//+</span><br><span class=\"line\">   NEED[i]-=REQUEST[i];//-</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li><br>\n,</li>\n<li><br>\n<br>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) </span><br><span class=\"line\">2) JavasynchronizedJava5java.util.concurrent</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p><strong></strong><br>\n<img src=\"/assets/net-img-1582875390665-923c52b9-52ce-4e6f-9cee-763046546af3-20221030135517-j4zeqi7.png\" alt=\"1-7.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E existing resource vector</span><br><span class=\"line\">A available resource vectorAi</span><br><span class=\"line\">C current allocation matrixCiPi</span><br><span class=\"line\">R request matrixRP</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PiRiA</span><br><span class=\"line\">CiA1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<ul>\n<li>\n<p><br>\n</p>\n</li>\n<li>\n<p><br>\n</p>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Java\">Java</h2>\n<ul>\n<li>\n<p> Thread  extends Thread</p>\n</li>\n<li>\n<p> Runnable  implements Runnable</p>\n</li>\n<li>\n<p> Callable  implements Callable</p>\n<ul>\n<li> Callable   Runnable </li>\n<li> Callable  FutureTask  FutureTask  Future  <code>new Thread(objectFutureTask1).start()</code></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>Future</p>\n</blockquote>\n<ul>\n<li>\n<p>cancel()truefalse</p>\n<ul>\n<li>mayInterruptIfRunningtrue</li>\n<li>mayInterruptIfRunningtruefalsefalsefalse</li>\n<li>mayInterruptIfRunningtruetruemayInterruptIfRunningfalsefalsemayInterruptIfRunningtruefalsetrue</li>\n</ul>\n</li>\n<li>\n<p>isCancelled() true</p>\n</li>\n<li>\n<p>isDone()true</p>\n</li>\n<li>\n<p>get()</p>\n</li>\n<li>\n<p>get(long timeout, TimeUnit unit)null</p>\n</li>\n</ul>\n<blockquote>\n<p>FutureTask</p>\n<p>RunnableFutureRunnableFutureRunnableFutureRunnablecallable</p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li> Thread </li>\n</ul>\n<blockquote>\n<p><br>\n java <br>\n<br>\n Runable  Callable  Thread <br>\n java  2  main </p>\n</blockquote>\n<ul>\n<li>\n<p>Runnable  Callable </p>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p><br>\n<br>\n Thread.start()</p>\n</blockquote>\n<ul>\n<li></li>\n</ul>\n<blockquote>\n<p> Callable  Runnable <br>\nCallable  call() Runnable  run()<br>\n Callable  Future.cancel    Runnable </p>\n</blockquote>\n<ul>\n<li></li>\n</ul>\n<blockquote>\n<p>Callable  FutureTask.get()</p>\n<p>Runnable, Thread  Thread  run()  run()  Runnable </p>\n</blockquote>\n"},{"title":"JavaStream","date":"2022-10-30T05:27:17.000Z","lastmod":"2023-08-25T12:01:12.000Z","_content":"\n# JavaStream\n\n### Stream\n\n> Stream\n\n-  JavaStream\n- ****  I/O channel generator \n- **** SQL filter, map, reduce, find, match, sorted\n\nStream\n\n- **Pipelining**:   fluent style  (laziness)( short-circuiting)\n- **** IteratorFor-Each,   Stream (Visitor)\n\n### \n\n- stream() -\n- parallelStream()  \n- `Stream.of()` Stream \n\n### \n\n#### map\n\n> \n\n#### flatmap\n\n> , ,\n\n#### filterlamda\n\n> ()\n\n#### limit\n\n> \n\n#### sorted\n\n> **Comparator**\n\n#### distinct\n\n> \n\n#### isPrime()\n\n> \n\n### \n\n#### forEach(Consumer)\n\n> \n\n#### `forEachOrdered(Consumer)`\n\n> \n\n#### collect(Collector)\n\n> `Collector`\n\n#### `collect(Supplier, BiConsumer, BiConsumer)`\n\n> ************\n\n## \n\n#### `allMatch(Predicate)` \n\n>  `Predicate`  true  true false  false \n\n#### `anyMatch(Predicate)`\n\n>  `Predicate`  true  true true  true \n\n#### `noneMatch(Predicate)`\n\n>  `Predicate`  false  true true  true \n","source":"_posts/java/Base/JavaStream.md","raw":"---\ntitle: JavaStream\ndate: 2022-10-30T13:27:17Z\nlastmod: 2023-08-25T20:01:12Z\n---\n\n# JavaStream\n\n### Stream\n\n> Stream\n\n-  JavaStream\n- ****  I/O channel generator \n- **** SQL filter, map, reduce, find, match, sorted\n\nStream\n\n- **Pipelining**:   fluent style  (laziness)( short-circuiting)\n- **** IteratorFor-Each,   Stream (Visitor)\n\n### \n\n- stream() -\n- parallelStream()  \n- `Stream.of()` Stream \n\n### \n\n#### map\n\n> \n\n#### flatmap\n\n> , ,\n\n#### filterlamda\n\n> ()\n\n#### limit\n\n> \n\n#### sorted\n\n> **Comparator**\n\n#### distinct\n\n> \n\n#### isPrime()\n\n> \n\n### \n\n#### forEach(Consumer)\n\n> \n\n#### `forEachOrdered(Consumer)`\n\n> \n\n#### collect(Collector)\n\n> `Collector`\n\n#### `collect(Supplier, BiConsumer, BiConsumer)`\n\n> ************\n\n## \n\n#### `allMatch(Predicate)` \n\n>  `Predicate`  true  true false  false \n\n#### `anyMatch(Predicate)`\n\n>  `Predicate`  true  true true  true \n\n#### `noneMatch(Predicate)`\n\n>  `Predicate`  false  true true  true \n","slug":"java-Base-JavaStream","published":1,"updated":"2025-04-20T00:08:55.544Z","_id":"cm9s3f40e002rbfg4h9fb2dxj","comments":1,"layout":"post","photos":[],"content":"<h1>JavaStream</h1>\n<h3 id=\"Stream\">Stream</h3>\n<blockquote>\n<p>Stream</p>\n</blockquote>\n<ul>\n<li> JavaStream</li>\n<li><strong></strong>  I/O channel generator </li>\n<li><strong></strong> SQL filter, map, reduce, find, match, sorted</li>\n</ul>\n<p>Stream</p>\n<ul>\n<li><strong>Pipelining</strong>:   fluent style  (laziness)( short-circuiting)</li>\n<li><strong></strong> IteratorFor-Each,   Stream (Visitor)</li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li>stream() -</li>\n<li>parallelStream()  </li>\n<li><code>Stream.of()</code> Stream </li>\n</ul>\n<h3 id=\"\"></h3>\n<h4 id=\"map\">map</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"flatmap\">flatmap</h4>\n<blockquote>\n<p>, ,</p>\n</blockquote>\n<h4 id=\"filterlamda\">filterlamda</h4>\n<blockquote>\n<p>()</p>\n</blockquote>\n<h4 id=\"limit\">limit</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"sorted\">sorted</h4>\n<blockquote>\n<p><strong>Comparator</strong></p>\n</blockquote>\n<h4 id=\"distinct\">distinct</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"isPrime\">isPrime()</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"\"></h3>\n<h4 id=\"forEach-Consumer\">forEach(Consumer)</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"forEachOrdered-Consumer\"><code>forEachOrdered(Consumer)</code></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"collect-Collector\">collect(Collector)</h4>\n<blockquote>\n<p><code>Collector</code></p>\n</blockquote>\n<h4 id=\"collect-Supplier-BiConsumer-BiConsumer\"><code>collect(Supplier, BiConsumer, BiConsumer)</code></h4>\n<blockquote>\n<p><strong></strong><strong></strong><strong></strong></p>\n</blockquote>\n<h2 id=\"\"></h2>\n<h4 id=\"allMatch-Predicate-\"><code>allMatch(Predicate)</code> </h4>\n<blockquote>\n<p> <code>Predicate</code>  true  true false  false </p>\n</blockquote>\n<h4 id=\"anyMatch-Predicate-\"><code>anyMatch(Predicate)</code></h4>\n<blockquote>\n<p> <code>Predicate</code>  true  true true  true </p>\n</blockquote>\n<h4 id=\"noneMatch-Predicate-\"><code>noneMatch(Predicate)</code></h4>\n<blockquote>\n<p> <code>Predicate</code>  false  true true  true </p>\n</blockquote>\n","excerpt":"","more":"<h1>JavaStream</h1>\n<h3 id=\"Stream\">Stream</h3>\n<blockquote>\n<p>Stream</p>\n</blockquote>\n<ul>\n<li> JavaStream</li>\n<li><strong></strong>  I/O channel generator </li>\n<li><strong></strong> SQL filter, map, reduce, find, match, sorted</li>\n</ul>\n<p>Stream</p>\n<ul>\n<li><strong>Pipelining</strong>:   fluent style  (laziness)( short-circuiting)</li>\n<li><strong></strong> IteratorFor-Each,   Stream (Visitor)</li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li>stream() -</li>\n<li>parallelStream()  </li>\n<li><code>Stream.of()</code> Stream </li>\n</ul>\n<h3 id=\"\"></h3>\n<h4 id=\"map\">map</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"flatmap\">flatmap</h4>\n<blockquote>\n<p>, ,</p>\n</blockquote>\n<h4 id=\"filterlamda\">filterlamda</h4>\n<blockquote>\n<p>()</p>\n</blockquote>\n<h4 id=\"limit\">limit</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"sorted\">sorted</h4>\n<blockquote>\n<p><strong>Comparator</strong></p>\n</blockquote>\n<h4 id=\"distinct\">distinct</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"isPrime\">isPrime()</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"\"></h3>\n<h4 id=\"forEach-Consumer\">forEach(Consumer)</h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"forEachOrdered-Consumer\"><code>forEachOrdered(Consumer)</code></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"collect-Collector\">collect(Collector)</h4>\n<blockquote>\n<p><code>Collector</code></p>\n</blockquote>\n<h4 id=\"collect-Supplier-BiConsumer-BiConsumer\"><code>collect(Supplier, BiConsumer, BiConsumer)</code></h4>\n<blockquote>\n<p><strong></strong><strong></strong><strong></strong></p>\n</blockquote>\n<h2 id=\"\"></h2>\n<h4 id=\"allMatch-Predicate-\"><code>allMatch(Predicate)</code> </h4>\n<blockquote>\n<p> <code>Predicate</code>  true  true false  false </p>\n</blockquote>\n<h4 id=\"anyMatch-Predicate-\"><code>anyMatch(Predicate)</code></h4>\n<blockquote>\n<p> <code>Predicate</code>  true  true true  true </p>\n</blockquote>\n<h4 id=\"noneMatch-Predicate-\"><code>noneMatch(Predicate)</code></h4>\n<blockquote>\n<p> <code>Predicate</code>  false  true true  true </p>\n</blockquote>\n"},{"title":"ThreadLocal","date":"2023-05-27T11:29:23.000Z","lastmod":"2023-05-29T14:47:04.000Z","_content":"\n# ThreadLocal\n\n## ThreadLocal\n\nThreadLocal  ThreadLocal Connection ThreadLocal \n\n### Entry\n\n,:\n\n* ThreadLocalMap  Thread , Thread \n* ThreadLocalMap  key  ThreadLocal ,,ThreadLocal  ThreadLocalMap ,\n*  ThreadLocal ,,\n\n:\n\n*  ThreadLocal , ThreadLocalMap ,ThreadLocal \n*  ThreadLocal ,ThreadLocalMap  Entry  key  null\n*  ThreadLocalMap  getsetremove , key  null  Entry,\n*  ThreadLocal  ThreadLocalMap ,\n\n### ThreadLocal \n\nThreadLocal&&&&ThreadLocalset/get/remove  \n","source":"_posts/java/Base/ThreadLocal.md","raw":"---\ntitle: ThreadLocal\ndate: 2023-05-27T19:29:23Z\nlastmod: 2023-05-29T22:47:04Z\n---\n\n# ThreadLocal\n\n## ThreadLocal\n\nThreadLocal  ThreadLocal Connection ThreadLocal \n\n### Entry\n\n,:\n\n* ThreadLocalMap  Thread , Thread \n* ThreadLocalMap  key  ThreadLocal ,,ThreadLocal  ThreadLocalMap ,\n*  ThreadLocal ,,\n\n:\n\n*  ThreadLocal , ThreadLocalMap ,ThreadLocal \n*  ThreadLocal ,ThreadLocalMap  Entry  key  null\n*  ThreadLocalMap  getsetremove , key  null  Entry,\n*  ThreadLocal  ThreadLocalMap ,\n\n### ThreadLocal \n\nThreadLocal&&&&ThreadLocalset/get/remove  \n","slug":"java-Base-ThreadLocal","published":1,"updated":"2025-04-20T00:08:55.546Z","_id":"cm9s3f40f002sbfg44me58uks","comments":1,"layout":"post","photos":[],"content":"<h1>ThreadLocal</h1>\n<h2 id=\"ThreadLocal\">ThreadLocal</h2>\n<p>ThreadLocal  ThreadLocal Connection ThreadLocal </p>\n<h3 id=\"Entry\">Entry</h3>\n<p>,:</p>\n<ul>\n<li>ThreadLocalMap  Thread , Thread </li>\n<li>ThreadLocalMap  key  ThreadLocal ,,ThreadLocal  ThreadLocalMap ,</li>\n<li> ThreadLocal ,,</li>\n</ul>\n<p>:</p>\n<ul>\n<li> ThreadLocal , ThreadLocalMap ,ThreadLocal </li>\n<li> ThreadLocal ,ThreadLocalMap  Entry  key  null</li>\n<li> ThreadLocalMap  getsetremove , key  null  Entry,</li>\n<li> ThreadLocal  ThreadLocalMap ,</li>\n</ul>\n<h3 id=\"ThreadLocal-\">ThreadLocal </h3>\n<p>ThreadLocal&amp;&amp;&amp;&amp;ThreadLocalset/get/remove  </p>\n","excerpt":"","more":"<h1>ThreadLocal</h1>\n<h2 id=\"ThreadLocal\">ThreadLocal</h2>\n<p>ThreadLocal  ThreadLocal Connection ThreadLocal </p>\n<h3 id=\"Entry\">Entry</h3>\n<p>,:</p>\n<ul>\n<li>ThreadLocalMap  Thread , Thread </li>\n<li>ThreadLocalMap  key  ThreadLocal ,,ThreadLocal  ThreadLocalMap ,</li>\n<li> ThreadLocal ,,</li>\n</ul>\n<p>:</p>\n<ul>\n<li> ThreadLocal , ThreadLocalMap ,ThreadLocal </li>\n<li> ThreadLocal ,ThreadLocalMap  Entry  key  null</li>\n<li> ThreadLocalMap  getsetremove , key  null  Entry,</li>\n<li> ThreadLocal  ThreadLocalMap ,</li>\n</ul>\n<h3 id=\"ThreadLocal-\">ThreadLocal </h3>\n<p>ThreadLocal&amp;&amp;&amp;&amp;ThreadLocalset/get/remove  </p>\n"},{"title":"Volatile","date":"2022-10-30T05:27:45.000Z","lastmod":"2023-05-27T10:46:40.000Z","_content":"\n# Volatile\n\n## Volatile.\n\n### \n\nCPUCPUCPUCPU\nCPUCPUCPUCPU\n****\n\n```java\ni = i + 1;\n```\n\n2i0i2  \niCPU11i12i01i12i  \ni12  \nCPU  \n2  \n1LOCK\n\n2CPULOCKCPULOCKCPUCPU  i = i +1LCOKCPUi  \nCPU  \nIntel MESIMESICPUCPUCPUCPU\n\n![](/assets/net-img-1639574230606-ee713d6a-1223-4275-bfaa-f60258aa6eea-20221030132914-2yfiwaf.jpeg)\n\n### Java\n\n> Java\n\n#### java\n\n1. \n\njava\n\n```java\nx = 10;         //1\ny = x;         //2\nx++;           //3\nx = x + 1;     //4\n```\n\n1\n110x10\n22xxx x 2\nx++ x = x+13x1\n\n** **\n\n> **jvm32 64longdouble32**\n> **jvm64 jdk8 64longdouble**\n\n2. \n\nvolatile\n\nsynchronizedLocksynchronizedLock\n\n3. \n\nJava\nJavavolatilesynchronizedLocksynchronizedLock\nJava happens-before happens-before\nhappens-before\n\n- \n- unLocklock\n- volatile\n- ABBCAC\n- Threadstart()\n- interrupt()\n- Thread.join()Thread.isAlive()\n- finalize()\n\n### volatile\n\n1. **volatile**\n\nvolatile\n1\n2\n\n> volatile\n> volatile\n> volatile21stopCPUL1L2\n> 1stop1stop\n\n2. **volatile**\n3. **volatile**\n4. **volatile**\n\nJavavolatilevolatilevolatilelock  \nlock3  \n1  \n2  \n3CPU  \n****[https://www.cnblogs.com/dolphin0520/p/3920373.html](https://www.cnblogs.com/dolphin0520/p/3920373.html)\n\n[https://www.zhihu.com/question/296949412/answer/747494794](https://www.zhihu.com/question/296949412/answer/747494794)\n\n[https://blog.csdn.net/wll1228/article/details/107775976](https://blog.csdn.net/wll1228/article/details/107775976)\n\n\n","source":"_posts/java/Base/Volatile.md","raw":"---\ntitle: Volatile\ndate: 2022-10-30T13:27:45Z\nlastmod: 2023-05-27T18:46:40Z\n---\n\n# Volatile\n\n## Volatile.\n\n### \n\nCPUCPUCPUCPU\nCPUCPUCPUCPU\n****\n\n```java\ni = i + 1;\n```\n\n2i0i2  \niCPU11i12i01i12i  \ni12  \nCPU  \n2  \n1LOCK\n\n2CPULOCKCPULOCKCPUCPU  i = i +1LCOKCPUi  \nCPU  \nIntel MESIMESICPUCPUCPUCPU\n\n![](/assets/net-img-1639574230606-ee713d6a-1223-4275-bfaa-f60258aa6eea-20221030132914-2yfiwaf.jpeg)\n\n### Java\n\n> Java\n\n#### java\n\n1. \n\njava\n\n```java\nx = 10;         //1\ny = x;         //2\nx++;           //3\nx = x + 1;     //4\n```\n\n1\n110x10\n22xxx x 2\nx++ x = x+13x1\n\n** **\n\n> **jvm32 64longdouble32**\n> **jvm64 jdk8 64longdouble**\n\n2. \n\nvolatile\n\nsynchronizedLocksynchronizedLock\n\n3. \n\nJava\nJavavolatilesynchronizedLocksynchronizedLock\nJava happens-before happens-before\nhappens-before\n\n- \n- unLocklock\n- volatile\n- ABBCAC\n- Threadstart()\n- interrupt()\n- Thread.join()Thread.isAlive()\n- finalize()\n\n### volatile\n\n1. **volatile**\n\nvolatile\n1\n2\n\n> volatile\n> volatile\n> volatile21stopCPUL1L2\n> 1stop1stop\n\n2. **volatile**\n3. **volatile**\n4. **volatile**\n\nJavavolatilevolatilevolatilelock  \nlock3  \n1  \n2  \n3CPU  \n****[https://www.cnblogs.com/dolphin0520/p/3920373.html](https://www.cnblogs.com/dolphin0520/p/3920373.html)\n\n[https://www.zhihu.com/question/296949412/answer/747494794](https://www.zhihu.com/question/296949412/answer/747494794)\n\n[https://blog.csdn.net/wll1228/article/details/107775976](https://blog.csdn.net/wll1228/article/details/107775976)\n\n\n","slug":"java-Base-Volatile","published":1,"updated":"2025-04-28T08:41:48.383Z","_id":"cm9s3f40g002tbfg47ps2fa45","comments":1,"layout":"post","photos":[],"content":"<h1>Volatile</h1>\n<h2 id=\"Volatile-\">Volatile.</h2>\n<h3 id=\"\"></h3>\n<p>CPUCPUCPUCPU<br>\nCPUCPUCPUCPU<br>\n<strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = i + <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p>2i0i2<br>\niCPU11i12i01i12i<br>\ni12<br>\nCPU<br>\n2<br>\n1LOCK</p>\n<p>2CPULOCKCPULOCKCPUCPU  i = i +1LCOKCPUi<br>\nCPU<br>\nIntel MESIMESICPUCPUCPUCPU</p>\n<p><img src=\"/assets/net-img-1639574230606-ee713d6a-1223-4275-bfaa-f60258aa6eea-20221030132914-2yfiwaf.jpeg\" alt=\"\"></p>\n<h3 id=\"Java\">Java</h3>\n<blockquote>\n<p>Java</p>\n</blockquote>\n<h4 id=\"java\">java</h4>\n<ol>\n<li></li>\n</ol>\n<p>java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = <span class=\"number\">10</span>;         <span class=\"comment\">//1</span></span><br><span class=\"line\">y = x;         <span class=\"comment\">//2</span></span><br><span class=\"line\">x++;           <span class=\"comment\">//3</span></span><br><span class=\"line\">x = x + <span class=\"number\">1</span>;     <span class=\"comment\">//4</span></span><br></pre></td></tr></table></figure>\n<p>1<br>\n110x10<br>\n22xxx x 2<br>\nx++ x = x+13x1</p>\n<p>** **</p>\n<blockquote>\n<p><strong>jvm32 64longdouble32</strong><br>\n<strong>jvm64 jdk8 64longdouble</strong></p>\n</blockquote>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>volatile<br>\n<br>\nsynchronizedLocksynchronizedLock</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>Java<br>\nJavavolatilesynchronizedLocksynchronizedLock<br>\nJava happens-before happens-before<br>\nhappens-before</p>\n<ul>\n<li></li>\n<li>unLocklock</li>\n<li>volatile</li>\n<li>ABBCAC</li>\n<li>Threadstart()</li>\n<li>interrupt()</li>\n<li>Thread.join()Thread.isAlive()</li>\n<li>finalize()</li>\n</ul>\n<h3 id=\"volatile\">volatile</h3>\n<ol>\n<li><strong>volatile</strong></li>\n</ol>\n<p>volatile<br>\n1<br>\n2</p>\n<blockquote>\n<p>volatile<br>\nvolatile<br>\nvolatile21stopCPUL1L2<br>\n1stop1stop</p>\n</blockquote>\n<ol start=\"2\">\n<li><strong>volatile</strong></li>\n<li><strong>volatile</strong></li>\n<li><strong>volatile</strong></li>\n</ol>\n<p>Javavolatilevolatilevolatilelock<br>\nlock3<br>\n1<br>\n2<br>\n3CPU<br>\n<strong></strong><a href=\"https://www.cnblogs.com/dolphin0520/p/3920373.html\">https://www.cnblogs.com/dolphin0520/p/3920373.html</a></p>\n<p><a href=\"https://www.zhihu.com/question/296949412/answer/747494794\">https://www.zhihu.com/question/296949412/answer/747494794</a></p>\n<p><a href=\"https://blog.csdn.net/wll1228/article/details/107775976\">https://blog.csdn.net/wll1228/article/details/107775976</a></p>\n<p></p>\n","excerpt":"","more":"<h1>Volatile</h1>\n<h2 id=\"Volatile-\">Volatile.</h2>\n<h3 id=\"\"></h3>\n<p>CPUCPUCPUCPU<br>\nCPUCPUCPUCPU<br>\n<strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = i + <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p>2i0i2<br>\niCPU11i12i01i12i<br>\ni12<br>\nCPU<br>\n2<br>\n1LOCK</p>\n<p>2CPULOCKCPULOCKCPUCPU  i = i +1LCOKCPUi<br>\nCPU<br>\nIntel MESIMESICPUCPUCPUCPU</p>\n<p><img src=\"/assets/net-img-1639574230606-ee713d6a-1223-4275-bfaa-f60258aa6eea-20221030132914-2yfiwaf.jpeg\" alt=\"\"></p>\n<h3 id=\"Java\">Java</h3>\n<blockquote>\n<p>Java</p>\n</blockquote>\n<h4 id=\"java\">java</h4>\n<ol>\n<li></li>\n</ol>\n<p>java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = <span class=\"number\">10</span>;         <span class=\"comment\">//1</span></span><br><span class=\"line\">y = x;         <span class=\"comment\">//2</span></span><br><span class=\"line\">x++;           <span class=\"comment\">//3</span></span><br><span class=\"line\">x = x + <span class=\"number\">1</span>;     <span class=\"comment\">//4</span></span><br></pre></td></tr></table></figure>\n<p>1<br>\n110x10<br>\n22xxx x 2<br>\nx++ x = x+13x1</p>\n<p>** **</p>\n<blockquote>\n<p><strong>jvm32 64longdouble32</strong><br>\n<strong>jvm64 jdk8 64longdouble</strong></p>\n</blockquote>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>volatile<br>\n<br>\nsynchronizedLocksynchronizedLock</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>Java<br>\nJavavolatilesynchronizedLocksynchronizedLock<br>\nJava happens-before happens-before<br>\nhappens-before</p>\n<ul>\n<li></li>\n<li>unLocklock</li>\n<li>volatile</li>\n<li>ABBCAC</li>\n<li>Threadstart()</li>\n<li>interrupt()</li>\n<li>Thread.join()Thread.isAlive()</li>\n<li>finalize()</li>\n</ul>\n<h3 id=\"volatile\">volatile</h3>\n<ol>\n<li><strong>volatile</strong></li>\n</ol>\n<p>volatile<br>\n1<br>\n2</p>\n<blockquote>\n<p>volatile<br>\nvolatile<br>\nvolatile21stopCPUL1L2<br>\n1stop1stop</p>\n</blockquote>\n<ol start=\"2\">\n<li><strong>volatile</strong></li>\n<li><strong>volatile</strong></li>\n<li><strong>volatile</strong></li>\n</ol>\n<p>Javavolatilevolatilevolatilelock<br>\nlock3<br>\n1<br>\n2<br>\n3CPU<br>\n<strong></strong><a href=\"https://www.cnblogs.com/dolphin0520/p/3920373.html\">https://www.cnblogs.com/dolphin0520/p/3920373.html</a></p>\n<p><a href=\"https://www.zhihu.com/question/296949412/answer/747494794\">https://www.zhihu.com/question/296949412/answer/747494794</a></p>\n<p><a href=\"https://blog.csdn.net/wll1228/article/details/107775976\">https://blog.csdn.net/wll1228/article/details/107775976</a></p>\n<p></p>\n"},{"title":"List","date":"2022-10-30T05:22:01.000Z","lastmod":"2023-05-27T07:43:26.000Z","_content":"\n# List\n\n---\n\n**List **\n\n- ArrayList :\n- LinkedList :\n- Vector:\n\n## ArrayList\n\n### \n\n- ArrayList  AbstractList List\n- ArrayList  RandomAccess  RandomAccess  List  ArrayList \n- ArrayList  Cloneable  clone()\n- ArrayList  java.io.Serializable  ArrayList \n-  Vector ArrayList  ArrayList Vector  CopyOnWriteArrayList\n\n### System.arraycopy() Arrays.copyOf()\n\n#### \n\n****\n\n copyOf() System.arraycopy()\n\n****\n\narraycopy()\n\ncopyOf()\n\n****\n\n- java  length ,, length .\n- java  length()  String , length().\n- java  size(),,!\n\n### \n\n- ArrayList (navite  C/C++)\n- ArrayList  10 1.5 \n-  trimToSize()\n-  null \n\n## LinkedList\n\n### \n\n> ()\n> LinkedList  List  Deque  LinkedList  Deque  LinkedList ; LinkedList  LinkedList  Collections  synchronizedList \n\n## Vector\n\n-  ArrayList \n- Vector \n- Vector  length  10  length   100% ArrayList \n- ArrayList  0.5 Vector  1 \n\n** ArrayList LinkedList**\n\nArrayList ()\n\n add()() ArrayList \n\n ArrayList \n\n ArrayList \n\n## SkipList\n\n## CopyOnWriteArrayList\n\n\n\n### \n\n* ****\n\n\n\n* ****\n\n CopyOnWrite \n\n### \n\n* ****\n\n\n\n* ****\n\nCopyOnWriteArrayList CopyOnWriteArrayList ****\n\n### \n\n* **CopyOnWrite**\n\n CopyOnWriteArrayList  CopyOnWrite  ArrayListCopyOnWrite  Copy****\n\nCopyOnWriteArrayList  CopyOnWrite \n\nCopyOnWriteArrayList addset CopyOnWrite \n\n* ****\n\nArrayList  ConcurrentModificationException CopyOnWriteArrayList CopyOnWriteArrayList  ConcurrentModificationException \n\n### \n\n CopyOnWriteArrayList CopyOnWrite \n\n* ****\n\n CopyOnWrite \n\n* ****\n\n CPU \n\n* ****\n\n CopyOnWrite CopyOnWrite \n\nReentrantLock \n","source":"_posts/java/Collection/List.md","raw":"---\ntitle: List\ndate: 2022-10-30T13:22:01Z\nlastmod: 2023-05-27T15:43:26Z\n---\n\n# List\n\n---\n\n**List **\n\n- ArrayList :\n- LinkedList :\n- Vector:\n\n## ArrayList\n\n### \n\n- ArrayList  AbstractList List\n- ArrayList  RandomAccess  RandomAccess  List  ArrayList \n- ArrayList  Cloneable  clone()\n- ArrayList  java.io.Serializable  ArrayList \n-  Vector ArrayList  ArrayList Vector  CopyOnWriteArrayList\n\n### System.arraycopy() Arrays.copyOf()\n\n#### \n\n****\n\n copyOf() System.arraycopy()\n\n****\n\narraycopy()\n\ncopyOf()\n\n****\n\n- java  length ,, length .\n- java  length()  String , length().\n- java  size(),,!\n\n### \n\n- ArrayList (navite  C/C++)\n- ArrayList  10 1.5 \n-  trimToSize()\n-  null \n\n## LinkedList\n\n### \n\n> ()\n> LinkedList  List  Deque  LinkedList  Deque  LinkedList ; LinkedList  LinkedList  Collections  synchronizedList \n\n## Vector\n\n-  ArrayList \n- Vector \n- Vector  length  10  length   100% ArrayList \n- ArrayList  0.5 Vector  1 \n\n** ArrayList LinkedList**\n\nArrayList ()\n\n add()() ArrayList \n\n ArrayList \n\n ArrayList \n\n## SkipList\n\n## CopyOnWriteArrayList\n\n\n\n### \n\n* ****\n\n\n\n* ****\n\n CopyOnWrite \n\n### \n\n* ****\n\n\n\n* ****\n\nCopyOnWriteArrayList CopyOnWriteArrayList ****\n\n### \n\n* **CopyOnWrite**\n\n CopyOnWriteArrayList  CopyOnWrite  ArrayListCopyOnWrite  Copy****\n\nCopyOnWriteArrayList  CopyOnWrite \n\nCopyOnWriteArrayList addset CopyOnWrite \n\n* ****\n\nArrayList  ConcurrentModificationException CopyOnWriteArrayList CopyOnWriteArrayList  ConcurrentModificationException \n\n### \n\n CopyOnWriteArrayList CopyOnWrite \n\n* ****\n\n CopyOnWrite \n\n* ****\n\n CPU \n\n* ****\n\n CopyOnWrite CopyOnWrite \n\nReentrantLock \n","slug":"java-Collection-List","published":1,"updated":"2025-04-20T00:08:55.548Z","_id":"cm9s3f40g002ubfg45fj24j57","comments":1,"layout":"post","photos":[],"content":"<h1>List</h1>\n<hr>\n<p><strong>List </strong></p>\n<ul>\n<li>ArrayList :</li>\n<li>LinkedList :</li>\n<li>Vector:</li>\n</ul>\n<h2 id=\"ArrayList\">ArrayList</h2>\n<h3 id=\"\"></h3>\n<ul>\n<li>ArrayList  AbstractList List</li>\n<li>ArrayList  RandomAccess  RandomAccess  List  ArrayList </li>\n<li>ArrayList  Cloneable  clone()</li>\n<li>ArrayList  java.io.Serializable  ArrayList </li>\n<li> Vector ArrayList  ArrayList Vector  CopyOnWriteArrayList</li>\n</ul>\n<h3 id=\"System-arraycopy--Arrays-copyOf-\">System.arraycopy() Arrays.copyOf()</h3>\n<h4 id=\"\"></h4>\n<p><strong></strong></p>\n<p> copyOf() System.arraycopy()</p>\n<p><strong></strong></p>\n<p>arraycopy()</p>\n<p>copyOf()</p>\n<p><strong></strong></p>\n<ul>\n<li>java  length ,, length .</li>\n<li>java  length()  String , length().</li>\n<li>java  size(),,!</li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li>ArrayList (navite  C/C++)</li>\n<li>ArrayList  10 1.5 </li>\n<li> trimToSize()</li>\n<li> null </li>\n</ul>\n<h2 id=\"LinkedList\">LinkedList</h2>\n<h3 id=\"-2\"></h3>\n<blockquote>\n<p>()<br>\nLinkedList  List  Deque  LinkedList  Deque  LinkedList ; LinkedList  LinkedList  Collections  synchronizedList </p>\n</blockquote>\n<h2 id=\"Vector\">Vector</h2>\n<ul>\n<li> ArrayList </li>\n<li>Vector </li>\n<li>Vector  length  10  length   100% ArrayList </li>\n<li>ArrayList  0.5 Vector  1 </li>\n</ul>\n<p><strong> ArrayList LinkedList</strong></p>\n<p>ArrayList ()</p>\n<p> add()() ArrayList </p>\n<p> ArrayList </p>\n<p> ArrayList </p>\n<h2 id=\"SkipList\">SkipList</h2>\n<h2 id=\"CopyOnWriteArrayList\">CopyOnWriteArrayList</h2>\n<p></p>\n<h3 id=\"\"></h3>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CopyOnWrite </p>\n<h3 id=\"\"></h3>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p>CopyOnWriteArrayList CopyOnWriteArrayList <strong></strong></p>\n<h3 id=\"\"></h3>\n<ul>\n<li><strong>CopyOnWrite</strong></li>\n</ul>\n<p> CopyOnWriteArrayList  CopyOnWrite  ArrayListCopyOnWrite  Copy<strong></strong></p>\n<p>CopyOnWriteArrayList  CopyOnWrite </p>\n<p>CopyOnWriteArrayList addset CopyOnWrite </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p>ArrayList  ConcurrentModificationException CopyOnWriteArrayList CopyOnWriteArrayList  ConcurrentModificationException </p>\n<h3 id=\"\"></h3>\n<p> CopyOnWriteArrayList CopyOnWrite </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CopyOnWrite </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CPU </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CopyOnWrite CopyOnWrite </p>\n<p>ReentrantLock </p>\n","excerpt":"","more":"<h1>List</h1>\n<hr>\n<p><strong>List </strong></p>\n<ul>\n<li>ArrayList :</li>\n<li>LinkedList :</li>\n<li>Vector:</li>\n</ul>\n<h2 id=\"ArrayList\">ArrayList</h2>\n<h3 id=\"\"></h3>\n<ul>\n<li>ArrayList  AbstractList List</li>\n<li>ArrayList  RandomAccess  RandomAccess  List  ArrayList </li>\n<li>ArrayList  Cloneable  clone()</li>\n<li>ArrayList  java.io.Serializable  ArrayList </li>\n<li> Vector ArrayList  ArrayList Vector  CopyOnWriteArrayList</li>\n</ul>\n<h3 id=\"System-arraycopy--Arrays-copyOf-\">System.arraycopy() Arrays.copyOf()</h3>\n<h4 id=\"\"></h4>\n<p><strong></strong></p>\n<p> copyOf() System.arraycopy()</p>\n<p><strong></strong></p>\n<p>arraycopy()</p>\n<p>copyOf()</p>\n<p><strong></strong></p>\n<ul>\n<li>java  length ,, length .</li>\n<li>java  length()  String , length().</li>\n<li>java  size(),,!</li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li>ArrayList (navite  C/C++)</li>\n<li>ArrayList  10 1.5 </li>\n<li> trimToSize()</li>\n<li> null </li>\n</ul>\n<h2 id=\"LinkedList\">LinkedList</h2>\n<h3 id=\"-2\"></h3>\n<blockquote>\n<p>()<br>\nLinkedList  List  Deque  LinkedList  Deque  LinkedList ; LinkedList  LinkedList  Collections  synchronizedList </p>\n</blockquote>\n<h2 id=\"Vector\">Vector</h2>\n<ul>\n<li> ArrayList </li>\n<li>Vector </li>\n<li>Vector  length  10  length   100% ArrayList </li>\n<li>ArrayList  0.5 Vector  1 </li>\n</ul>\n<p><strong> ArrayList LinkedList</strong></p>\n<p>ArrayList ()</p>\n<p> add()() ArrayList </p>\n<p> ArrayList </p>\n<p> ArrayList </p>\n<h2 id=\"SkipList\">SkipList</h2>\n<h2 id=\"CopyOnWriteArrayList\">CopyOnWriteArrayList</h2>\n<p></p>\n<h3 id=\"\"></h3>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CopyOnWrite </p>\n<h3 id=\"\"></h3>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p>CopyOnWriteArrayList CopyOnWriteArrayList <strong></strong></p>\n<h3 id=\"\"></h3>\n<ul>\n<li><strong>CopyOnWrite</strong></li>\n</ul>\n<p> CopyOnWriteArrayList  CopyOnWrite  ArrayListCopyOnWrite  Copy<strong></strong></p>\n<p>CopyOnWriteArrayList  CopyOnWrite </p>\n<p>CopyOnWriteArrayList addset CopyOnWrite </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p>ArrayList  ConcurrentModificationException CopyOnWriteArrayList CopyOnWriteArrayList  ConcurrentModificationException </p>\n<h3 id=\"\"></h3>\n<p> CopyOnWriteArrayList CopyOnWrite </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CopyOnWrite </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CPU </p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> CopyOnWrite CopyOnWrite </p>\n<p>ReentrantLock </p>\n"},{"title":"Map","date":"2022-10-30T05:21:46.000Z","lastmod":"2022-10-30T05:21:46.000Z","_content":"\n# Map\n\n## HashMap\n\nJDK1.8  HashMap  ****  ****HashMap  key  hashCode  hash  (n - 1) & hash  n  hash  key \n\n HashMap  hash  hash  hashCode()  \n\n### JDK1.8 \n\n \n\n### JDK1.8 \n\n 8 64\n\n![](/assets/net-img-1591690908749-8d13658b-f28f-4a16-9787-5d802366b2bb-20221030132339-jhzqts2.png)\n\n> TreeMapTreeSet  JDK1.8  HashMap \n\n## ConcurrentHashMap\n\n1.8\n\n> 1. tabletableSynchronizedCAS\n> 2. + +\n\n1. CurrentHashMap\n\n```java\nprivate static final int MAXIMUM_CAPACITY = 1 << 30; //  \n\nprivate static final int DEFAULT_CAPACITY = 16; //  \n\nstatic final int TREEIFY_THRESHOLD = 8; //  \n\nstatic final int UNTREEIFY_THRESHOLD = 6; //  \n\nstatic final int MIN_TREEIFY_CAPACITY = 64; // \n\nstatic final int MOVED     = -1;  //  \n\nstatic final int TREEBIN   = -2; //  \n\nstatic final int RESERVED  = -3; // hash for transient reservations \n\nstatic final int HASH_BITS = 0x7fffffff; // hash\n\ntransient volatile Node<K,V>[] table;//  \n\nprivate transient volatile Node<K,V>[] nextTable; //  \n\nstatic final int NCPU = Runtime.getRuntime().availableProcessors();// CPU \n\nprivate transient volatile Node<K,V>[] nextTable; //  null \n\nprivate transient volatile long baseCount; // HashMap  size \nprivate transient volatile int sizeCtl; \n//sizeCtl = 0\n//sizeCtl > 0()\n//sizeCtl = -1,\n//sizeCtl = 0.75n ,\n//sizeCtl < 0 : or()\n//sizeCtl = (resizeStamp(n) << RESIZE_STAMP_SHIFT) + 2 :\n```\n\n2. \n\n> - nextTable:  nextTable Map, nextTable\n> - sizeCtl: sizeCtlConcurrentHashMap\n>   - CASsizeCtlConcurrentHashMap\n> - transferIndex: table\n>   - ? \n> - ForwardingNode: ,hash-1\n>   - Map,\n>   - Map,find\n\n****\n\n- put\n- A CAS`transferindex`,,`transferindex`\n  - `transferindex`:  - 1 -> \n- hash2`nextTable[i]``nextTable[i+n]`ntable\n  - hashhash,\n  - hashhash,i +n( + )\n- hash,`ForwardingNode`,\n- 2`ForwardingNode`2putremove\n  - 2get`ForwardingNode`find`nextTable`\n\n3. put\n\n> put CAS + synchronized \n\n```java\n// Node  hashHashMaphashcurrenthashmap\n/** Implementation for put and putIfAbsent */\n    final V putVal(K key, V value, boolean onlyIfAbsent) {\n        if (key == null || value == null) throw new NullPointerException();\n        int hash = spread(key.hashCode());// hash\n        int binCount = 0;\n        for (Node<K,V>[] tab = table;;) { //\n            Node<K,V> f; int n, i, fh; K fk; V fv;\n            if (tab == null || (n = tab.length) == 0)\n                tab = initTable(); //  ,\n            else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {\n                //// \n                if (casTabAt(tab, i, null, new Node<K,V>(hash, key, value)))\n                    break;                    // CAS \n            }\n            else if ((fh = f.hash) == MOVED)\n                //f.hash == MOVED ForwardingNode\n                //\n                //,\n                //  \n                tab = helpTransfer(tab, f);\n            else if (onlyIfAbsent //jdk  key value check first node without acquiring lock\n                     && fh == hash\n                     && ((fk = f.key) == key || (fk != null && key.equals(fk)))\n                     && (fv = f.val) != null)\n                return fv;\n            else {\n                V oldVal = null;// \n                synchronized (f) {\n                    if (tabAt(tab, i) == f) {\n                        if (fh >= 0) {//  hash\n                            binCount = 1;\n                            for (Node<K,V> e = f;; ++binCount) {\n                                K ek;\n                                // key \n                                if (e.hash == hash &&\n                                    ((ek = e.key) == key ||\n                                     (ek != null && key.equals(ek)))) {\n                                    oldVal = e.val;\n                                    if (!onlyIfAbsent)\n                                        e.val = value;\n                                    break;\n                                }\n                                Node<K,V> pred = e;\n                                if ((e = e.next) == null) {// \n                                    pred.next = new Node<K,V>(hash, key, value);\n                                    break;\n                                }\n                            }\n                        }\n                        else if (f instanceof TreeBin) {// TreeBin\n                            Node<K,V> p;\n                            binCount = 2;\n                            if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key,\n                                                           value)) != null) {\n                                 // \n                                oldVal = p.val;\n                                if (!onlyIfAbsent)\n                                    p.val = value;\n                            }\n                        }\n                        else if (f instanceof ReservationNode)\n                            throw new IllegalStateException(\"Recursive update\");\n                    }\n                }\n                if (binCount != 0) {// \n                    if (binCount >= TREEIFY_THRESHOLD)\n                        treeifyBin(tab, i);//  \n                    if (oldVal != null)\n                        return oldVal;\n                    break;\n                }\n            }\n        }\n        addCount(1L, binCount); //  \n        return null;\n    }\n```\n\ninitTabletabAtcasTabAthelpTransferputTreeValtreeifyBinaddCount\n\n3. initTable\n\n>  ****  CPU Thread.yieldtablesizeCtlszieCtltable16sizeCtltable\n\n```java\n//  \nprivate final Node<K,V>[] initTable() {\n    Node<K,V>[] tab; int sc;\n    while ((tab = table)  null || tab.length  0) {\n        if ((sc = sizeCtl) < 0) // -1-N \n            Thread.yield(); // \n     //  CPU  CPU \n     // \n        else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) { \n          //  sizeCtlsc -1 ,\n            try {\n                if ((tab = table)  null || tab.length  0) {\n                    int n = (sc > 0) ? sc : DEFAULT_CAPACITY; // 16\n                    @SuppressWarnings(\"unchecked\")\n                    Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n];\n                    table = tab = nt;\n                    sc = n - (n >>> 2); \n                }\n            } finally {\n                sizeCtl = sc; //sizeCtl threshold\n            }\n            break;\n        }\n    }\n    return tab;\n}\n```\n","source":"_posts/java/Collection/Map.md","raw":"---\ntitle: Map\ndate: 2022-10-30T13:21:46Z\nlastmod: 2022-10-30T13:21:46Z\n---\n\n# Map\n\n## HashMap\n\nJDK1.8  HashMap  ****  ****HashMap  key  hashCode  hash  (n - 1) & hash  n  hash  key \n\n HashMap  hash  hash  hashCode()  \n\n### JDK1.8 \n\n \n\n### JDK1.8 \n\n 8 64\n\n![](/assets/net-img-1591690908749-8d13658b-f28f-4a16-9787-5d802366b2bb-20221030132339-jhzqts2.png)\n\n> TreeMapTreeSet  JDK1.8  HashMap \n\n## ConcurrentHashMap\n\n1.8\n\n> 1. tabletableSynchronizedCAS\n> 2. + +\n\n1. CurrentHashMap\n\n```java\nprivate static final int MAXIMUM_CAPACITY = 1 << 30; //  \n\nprivate static final int DEFAULT_CAPACITY = 16; //  \n\nstatic final int TREEIFY_THRESHOLD = 8; //  \n\nstatic final int UNTREEIFY_THRESHOLD = 6; //  \n\nstatic final int MIN_TREEIFY_CAPACITY = 64; // \n\nstatic final int MOVED     = -1;  //  \n\nstatic final int TREEBIN   = -2; //  \n\nstatic final int RESERVED  = -3; // hash for transient reservations \n\nstatic final int HASH_BITS = 0x7fffffff; // hash\n\ntransient volatile Node<K,V>[] table;//  \n\nprivate transient volatile Node<K,V>[] nextTable; //  \n\nstatic final int NCPU = Runtime.getRuntime().availableProcessors();// CPU \n\nprivate transient volatile Node<K,V>[] nextTable; //  null \n\nprivate transient volatile long baseCount; // HashMap  size \nprivate transient volatile int sizeCtl; \n//sizeCtl = 0\n//sizeCtl > 0()\n//sizeCtl = -1,\n//sizeCtl = 0.75n ,\n//sizeCtl < 0 : or()\n//sizeCtl = (resizeStamp(n) << RESIZE_STAMP_SHIFT) + 2 :\n```\n\n2. \n\n> - nextTable:  nextTable Map, nextTable\n> - sizeCtl: sizeCtlConcurrentHashMap\n>   - CASsizeCtlConcurrentHashMap\n> - transferIndex: table\n>   - ? \n> - ForwardingNode: ,hash-1\n>   - Map,\n>   - Map,find\n\n****\n\n- put\n- A CAS`transferindex`,,`transferindex`\n  - `transferindex`:  - 1 -> \n- hash2`nextTable[i]``nextTable[i+n]`ntable\n  - hashhash,\n  - hashhash,i +n( + )\n- hash,`ForwardingNode`,\n- 2`ForwardingNode`2putremove\n  - 2get`ForwardingNode`find`nextTable`\n\n3. put\n\n> put CAS + synchronized \n\n```java\n// Node  hashHashMaphashcurrenthashmap\n/** Implementation for put and putIfAbsent */\n    final V putVal(K key, V value, boolean onlyIfAbsent) {\n        if (key == null || value == null) throw new NullPointerException();\n        int hash = spread(key.hashCode());// hash\n        int binCount = 0;\n        for (Node<K,V>[] tab = table;;) { //\n            Node<K,V> f; int n, i, fh; K fk; V fv;\n            if (tab == null || (n = tab.length) == 0)\n                tab = initTable(); //  ,\n            else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {\n                //// \n                if (casTabAt(tab, i, null, new Node<K,V>(hash, key, value)))\n                    break;                    // CAS \n            }\n            else if ((fh = f.hash) == MOVED)\n                //f.hash == MOVED ForwardingNode\n                //\n                //,\n                //  \n                tab = helpTransfer(tab, f);\n            else if (onlyIfAbsent //jdk  key value check first node without acquiring lock\n                     && fh == hash\n                     && ((fk = f.key) == key || (fk != null && key.equals(fk)))\n                     && (fv = f.val) != null)\n                return fv;\n            else {\n                V oldVal = null;// \n                synchronized (f) {\n                    if (tabAt(tab, i) == f) {\n                        if (fh >= 0) {//  hash\n                            binCount = 1;\n                            for (Node<K,V> e = f;; ++binCount) {\n                                K ek;\n                                // key \n                                if (e.hash == hash &&\n                                    ((ek = e.key) == key ||\n                                     (ek != null && key.equals(ek)))) {\n                                    oldVal = e.val;\n                                    if (!onlyIfAbsent)\n                                        e.val = value;\n                                    break;\n                                }\n                                Node<K,V> pred = e;\n                                if ((e = e.next) == null) {// \n                                    pred.next = new Node<K,V>(hash, key, value);\n                                    break;\n                                }\n                            }\n                        }\n                        else if (f instanceof TreeBin) {// TreeBin\n                            Node<K,V> p;\n                            binCount = 2;\n                            if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key,\n                                                           value)) != null) {\n                                 // \n                                oldVal = p.val;\n                                if (!onlyIfAbsent)\n                                    p.val = value;\n                            }\n                        }\n                        else if (f instanceof ReservationNode)\n                            throw new IllegalStateException(\"Recursive update\");\n                    }\n                }\n                if (binCount != 0) {// \n                    if (binCount >= TREEIFY_THRESHOLD)\n                        treeifyBin(tab, i);//  \n                    if (oldVal != null)\n                        return oldVal;\n                    break;\n                }\n            }\n        }\n        addCount(1L, binCount); //  \n        return null;\n    }\n```\n\ninitTabletabAtcasTabAthelpTransferputTreeValtreeifyBinaddCount\n\n3. initTable\n\n>  ****  CPU Thread.yieldtablesizeCtlszieCtltable16sizeCtltable\n\n```java\n//  \nprivate final Node<K,V>[] initTable() {\n    Node<K,V>[] tab; int sc;\n    while ((tab = table)  null || tab.length  0) {\n        if ((sc = sizeCtl) < 0) // -1-N \n            Thread.yield(); // \n     //  CPU  CPU \n     // \n        else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) { \n          //  sizeCtlsc -1 ,\n            try {\n                if ((tab = table)  null || tab.length  0) {\n                    int n = (sc > 0) ? sc : DEFAULT_CAPACITY; // 16\n                    @SuppressWarnings(\"unchecked\")\n                    Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n];\n                    table = tab = nt;\n                    sc = n - (n >>> 2); \n                }\n            } finally {\n                sizeCtl = sc; //sizeCtl threshold\n            }\n            break;\n        }\n    }\n    return tab;\n}\n```\n","slug":"java-Collection-Map","published":1,"updated":"2025-04-28T08:41:48.387Z","_id":"cm9s3f40h002vbfg4fv1oherx","comments":1,"layout":"post","photos":[],"content":"<h1>Map</h1>\n<h2 id=\"HashMap\">HashMap</h2>\n<p>JDK1.8  HashMap  <strong></strong>  <strong></strong>HashMap  key  hashCode  hash  (n - 1) &amp; hash  n  hash  key </p>\n<p> HashMap  hash  hash  hashCode()  </p>\n<h3 id=\"JDK1-8-\">JDK1.8 </h3>\n<p> </p>\n<h3 id=\"JDK1-8-\">JDK1.8 </h3>\n<p> 8 64</p>\n<p><img src=\"/assets/net-img-1591690908749-8d13658b-f28f-4a16-9787-5d802366b2bb-20221030132339-jhzqts2.png\" alt=\"\"></p>\n<blockquote>\n<p>TreeMapTreeSet  JDK1.8  HashMap </p>\n</blockquote>\n<h2 id=\"ConcurrentHashMap\">ConcurrentHashMap</h2>\n<p>1.8</p>\n<blockquote>\n<ol>\n<li>tabletableSynchronizedCAS</li>\n<li>+ +</li>\n</ol>\n</blockquote>\n<ol>\n<li>CurrentHashMap</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MAXIMUM_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">30</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">16</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">8</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">UNTREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">6</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MIN_TREEIFY_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">64</span>; <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MOVED</span>     <span class=\"operator\">=</span> -<span class=\"number\">1</span>;  <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TREEBIN</span>   <span class=\"operator\">=</span> -<span class=\"number\">2</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">RESERVED</span>  <span class=\"operator\">=</span> -<span class=\"number\">3</span>; <span class=\"comment\">// hash for transient reservations </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">HASH_BITS</span> <span class=\"operator\">=</span> <span class=\"number\">0x7fffffff</span>; <span class=\"comment\">// hash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Node&lt;K,V&gt;[] table;<span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Node&lt;K,V&gt;[] nextTable; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">NCPU</span> <span class=\"operator\">=</span> Runtime.getRuntime().availableProcessors();<span class=\"comment\">// CPU </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Node&lt;K,V&gt;[] nextTable; <span class=\"comment\">//  null </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> <span class=\"type\">long</span> baseCount; <span class=\"comment\">// HashMap  size </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> sizeCtl; </span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = 0</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl &gt; 0()</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = -1,</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = 0.75n ,</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl &lt; 0 : or()</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = (resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) + 2 :</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li></li>\n</ol>\n<blockquote>\n<ul>\n<li>nextTable:  nextTable Map, nextTable</li>\n<li>sizeCtl: sizeCtlConcurrentHashMap\n<ul>\n<li>CASsizeCtlConcurrentHashMap</li>\n</ul>\n</li>\n<li>transferIndex: table\n<ul>\n<li>? </li>\n</ul>\n</li>\n<li>ForwardingNode: ,hash-1\n<ul>\n<li>Map,</li>\n<li>Map,find</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p><strong></strong></p>\n<ul>\n<li>put</li>\n<li>A CAS<code>transferindex</code>,,<code>transferindex</code>\n<ul>\n<li><code>transferindex</code>:  - 1 -&gt; </li>\n</ul>\n</li>\n<li>hash2<code>nextTable[i]</code><code>nextTable[i+n]</code>ntable\n<ul>\n<li>hashhash,</li>\n<li>hashhash,i +n( + )</li>\n</ul>\n</li>\n<li>hash,<code>ForwardingNode</code>,</li>\n<li>2<code>ForwardingNode</code>2putremove\n<ul>\n<li>2get<code>ForwardingNode</code>find<code>nextTable</code></li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>put</li>\n</ol>\n<blockquote>\n<p>put CAS + synchronized </p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Node  hashHashMaphashcurrenthashmap</span></span><br><span class=\"line\"><span class=\"comment\">/** Implementation for put and putIfAbsent */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (key == <span class=\"literal\">null</span> || value == <span class=\"literal\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">hash</span> <span class=\"operator\">=</span> spread(key.hashCode());<span class=\"comment\">// hash</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123; <span class=\"comment\">//</span></span><br><span class=\"line\">            Node&lt;K,V&gt; f; <span class=\"type\">int</span> n, i, fh; K fk; V fv;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tab == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">                tab = initTable(); <span class=\"comment\">//  ,</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((f = tabAt(tab, i = (n - <span class=\"number\">1</span>) &amp; hash)) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//// </span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (casTabAt(tab, i, <span class=\"literal\">null</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value)))</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;                    <span class=\"comment\">// CAS </span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((fh = f.hash) == MOVED)</span><br><span class=\"line\">                <span class=\"comment\">//f.hash == MOVED ForwardingNode</span></span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"comment\">//,</span></span><br><span class=\"line\">                <span class=\"comment\">//  </span></span><br><span class=\"line\">                tab = helpTransfer(tab, f);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (onlyIfAbsent <span class=\"comment\">//jdk  key value check first node without acquiring lock</span></span><br><span class=\"line\">                     &amp;&amp; fh == hash</span><br><span class=\"line\">                     &amp;&amp; ((fk = f.key) == key || (fk != <span class=\"literal\">null</span> &amp;&amp; key.equals(fk)))</span><br><span class=\"line\">                     &amp;&amp; (fv = f.val) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> fv;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">V</span> <span class=\"variable\">oldVal</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;<span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (f) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (fh &gt;= <span class=\"number\">0</span>) &#123;<span class=\"comment\">//  hash</span></span><br><span class=\"line\">                            binCount = <span class=\"number\">1</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class=\"line\">                                K ek;</span><br><span class=\"line\">                                <span class=\"comment\">// key </span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                                    ((ek = e.key) == key ||</span><br><span class=\"line\">                                     (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class=\"line\">                                    oldVal = e.val;</span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                        e.val = value;</span><br><span class=\"line\">                                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                                Node&lt;K,V&gt; pred = e;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> ((e = e.next) == <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// </span></span><br><span class=\"line\">                                    pred.next = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value);</span><br><span class=\"line\">                                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> TreeBin) &#123;<span class=\"comment\">// TreeBin</span></span><br><span class=\"line\">                            Node&lt;K,V&gt; p;</span><br><span class=\"line\">                            binCount = <span class=\"number\">2</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class=\"line\">                                                           value)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                                 <span class=\"comment\">// </span></span><br><span class=\"line\">                                oldVal = p.val;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                    p.val = value;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> ReservationNode)</span><br><span class=\"line\">                            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Recursive update&quot;</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (binCount != <span class=\"number\">0</span>) &#123;<span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class=\"line\">                        treeifyBin(tab, i);<span class=\"comment\">//  </span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (oldVal != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> oldVal;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        addCount(<span class=\"number\">1L</span>, binCount); <span class=\"comment\">//  </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>initTabletabAtcasTabAthelpTransferputTreeValtreeifyBinaddCount</p>\n<ol start=\"3\">\n<li>initTable</li>\n</ol>\n<blockquote>\n<p><strong></strong>  CPU Thread.yieldtablesizeCtlszieCtltable16sizeCtltable</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; <span class=\"type\">int</span> sc;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((tab = table)  <span class=\"literal\">null</span> || tab.length  <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((sc = sizeCtl) &lt; <span class=\"number\">0</span>) <span class=\"comment\">// -1-N </span></span><br><span class=\"line\">            Thread.<span class=\"keyword\">yield</span>(); <span class=\"comment\">// </span></span><br><span class=\"line\">     <span class=\"comment\">//  CPU  CPU </span></span><br><span class=\"line\">     <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (U.compareAndSwapInt(<span class=\"built_in\">this</span>, SIZECTL, sc, -<span class=\"number\">1</span>)) &#123; </span><br><span class=\"line\">          <span class=\"comment\">//  sizeCtlsc -1 ,</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((tab = table)  <span class=\"literal\">null</span> || tab.length  <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> (sc &gt; <span class=\"number\">0</span>) ? sc : DEFAULT_CAPACITY; <span class=\"comment\">// 16</span></span><br><span class=\"line\">                    <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;?,?&gt;[n];</span><br><span class=\"line\">                    table = tab = nt;</span><br><span class=\"line\">                    sc = n - (n &gt;&gt;&gt; <span class=\"number\">2</span>); </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                sizeCtl = sc; <span class=\"comment\">//sizeCtl threshold</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> tab;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h1>Map</h1>\n<h2 id=\"HashMap\">HashMap</h2>\n<p>JDK1.8  HashMap  <strong></strong>  <strong></strong>HashMap  key  hashCode  hash  (n - 1) &amp; hash  n  hash  key </p>\n<p> HashMap  hash  hash  hashCode()  </p>\n<h3 id=\"JDK1-8-\">JDK1.8 </h3>\n<p> </p>\n<h3 id=\"JDK1-8-\">JDK1.8 </h3>\n<p> 8 64</p>\n<p><img src=\"/assets/net-img-1591690908749-8d13658b-f28f-4a16-9787-5d802366b2bb-20221030132339-jhzqts2.png\" alt=\"\"></p>\n<blockquote>\n<p>TreeMapTreeSet  JDK1.8  HashMap </p>\n</blockquote>\n<h2 id=\"ConcurrentHashMap\">ConcurrentHashMap</h2>\n<p>1.8</p>\n<blockquote>\n<ol>\n<li>tabletableSynchronizedCAS</li>\n<li>+ +</li>\n</ol>\n</blockquote>\n<ol>\n<li>CurrentHashMap</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MAXIMUM_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">30</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">16</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">8</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">UNTREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">6</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MIN_TREEIFY_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">64</span>; <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MOVED</span>     <span class=\"operator\">=</span> -<span class=\"number\">1</span>;  <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TREEBIN</span>   <span class=\"operator\">=</span> -<span class=\"number\">2</span>; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">RESERVED</span>  <span class=\"operator\">=</span> -<span class=\"number\">3</span>; <span class=\"comment\">// hash for transient reservations </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">HASH_BITS</span> <span class=\"operator\">=</span> <span class=\"number\">0x7fffffff</span>; <span class=\"comment\">// hash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Node&lt;K,V&gt;[] table;<span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Node&lt;K,V&gt;[] nextTable; <span class=\"comment\">//  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">NCPU</span> <span class=\"operator\">=</span> Runtime.getRuntime().availableProcessors();<span class=\"comment\">// CPU </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> Node&lt;K,V&gt;[] nextTable; <span class=\"comment\">//  null </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> <span class=\"type\">long</span> baseCount; <span class=\"comment\">// HashMap  size </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> sizeCtl; </span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = 0</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl &gt; 0()</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = -1,</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = 0.75n ,</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl &lt; 0 : or()</span></span><br><span class=\"line\"><span class=\"comment\">//sizeCtl = (resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) + 2 :</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li></li>\n</ol>\n<blockquote>\n<ul>\n<li>nextTable:  nextTable Map, nextTable</li>\n<li>sizeCtl: sizeCtlConcurrentHashMap\n<ul>\n<li>CASsizeCtlConcurrentHashMap</li>\n</ul>\n</li>\n<li>transferIndex: table\n<ul>\n<li>? </li>\n</ul>\n</li>\n<li>ForwardingNode: ,hash-1\n<ul>\n<li>Map,</li>\n<li>Map,find</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p><strong></strong></p>\n<ul>\n<li>put</li>\n<li>A CAS<code>transferindex</code>,,<code>transferindex</code>\n<ul>\n<li><code>transferindex</code>:  - 1 -&gt; </li>\n</ul>\n</li>\n<li>hash2<code>nextTable[i]</code><code>nextTable[i+n]</code>ntable\n<ul>\n<li>hashhash,</li>\n<li>hashhash,i +n( + )</li>\n</ul>\n</li>\n<li>hash,<code>ForwardingNode</code>,</li>\n<li>2<code>ForwardingNode</code>2putremove\n<ul>\n<li>2get<code>ForwardingNode</code>find<code>nextTable</code></li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>put</li>\n</ol>\n<blockquote>\n<p>put CAS + synchronized </p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Node  hashHashMaphashcurrenthashmap</span></span><br><span class=\"line\"><span class=\"comment\">/** Implementation for put and putIfAbsent */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (key == <span class=\"literal\">null</span> || value == <span class=\"literal\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">hash</span> <span class=\"operator\">=</span> spread(key.hashCode());<span class=\"comment\">// hash</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123; <span class=\"comment\">//</span></span><br><span class=\"line\">            Node&lt;K,V&gt; f; <span class=\"type\">int</span> n, i, fh; K fk; V fv;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tab == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">                tab = initTable(); <span class=\"comment\">//  ,</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((f = tabAt(tab, i = (n - <span class=\"number\">1</span>) &amp; hash)) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//// </span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (casTabAt(tab, i, <span class=\"literal\">null</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value)))</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;                    <span class=\"comment\">// CAS </span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((fh = f.hash) == MOVED)</span><br><span class=\"line\">                <span class=\"comment\">//f.hash == MOVED ForwardingNode</span></span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"comment\">//,</span></span><br><span class=\"line\">                <span class=\"comment\">//  </span></span><br><span class=\"line\">                tab = helpTransfer(tab, f);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (onlyIfAbsent <span class=\"comment\">//jdk  key value check first node without acquiring lock</span></span><br><span class=\"line\">                     &amp;&amp; fh == hash</span><br><span class=\"line\">                     &amp;&amp; ((fk = f.key) == key || (fk != <span class=\"literal\">null</span> &amp;&amp; key.equals(fk)))</span><br><span class=\"line\">                     &amp;&amp; (fv = f.val) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> fv;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">V</span> <span class=\"variable\">oldVal</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;<span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (f) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (fh &gt;= <span class=\"number\">0</span>) &#123;<span class=\"comment\">//  hash</span></span><br><span class=\"line\">                            binCount = <span class=\"number\">1</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class=\"line\">                                K ek;</span><br><span class=\"line\">                                <span class=\"comment\">// key </span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                                    ((ek = e.key) == key ||</span><br><span class=\"line\">                                     (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class=\"line\">                                    oldVal = e.val;</span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                        e.val = value;</span><br><span class=\"line\">                                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                                Node&lt;K,V&gt; pred = e;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> ((e = e.next) == <span class=\"literal\">null</span>) &#123;<span class=\"comment\">// </span></span><br><span class=\"line\">                                    pred.next = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value);</span><br><span class=\"line\">                                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> TreeBin) &#123;<span class=\"comment\">// TreeBin</span></span><br><span class=\"line\">                            Node&lt;K,V&gt; p;</span><br><span class=\"line\">                            binCount = <span class=\"number\">2</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class=\"line\">                                                           value)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                                 <span class=\"comment\">// </span></span><br><span class=\"line\">                                oldVal = p.val;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                    p.val = value;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> ReservationNode)</span><br><span class=\"line\">                            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Recursive update&quot;</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (binCount != <span class=\"number\">0</span>) &#123;<span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class=\"line\">                        treeifyBin(tab, i);<span class=\"comment\">//  </span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (oldVal != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> oldVal;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        addCount(<span class=\"number\">1L</span>, binCount); <span class=\"comment\">//  </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>initTabletabAtcasTabAthelpTransferputTreeValtreeifyBinaddCount</p>\n<ol start=\"3\">\n<li>initTable</li>\n</ol>\n<blockquote>\n<p><strong></strong>  CPU Thread.yieldtablesizeCtlszieCtltable16sizeCtltable</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; <span class=\"type\">int</span> sc;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((tab = table)  <span class=\"literal\">null</span> || tab.length  <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((sc = sizeCtl) &lt; <span class=\"number\">0</span>) <span class=\"comment\">// -1-N </span></span><br><span class=\"line\">            Thread.<span class=\"keyword\">yield</span>(); <span class=\"comment\">// </span></span><br><span class=\"line\">     <span class=\"comment\">//  CPU  CPU </span></span><br><span class=\"line\">     <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (U.compareAndSwapInt(<span class=\"built_in\">this</span>, SIZECTL, sc, -<span class=\"number\">1</span>)) &#123; </span><br><span class=\"line\">          <span class=\"comment\">//  sizeCtlsc -1 ,</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((tab = table)  <span class=\"literal\">null</span> || tab.length  <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> (sc &gt; <span class=\"number\">0</span>) ? sc : DEFAULT_CAPACITY; <span class=\"comment\">// 16</span></span><br><span class=\"line\">                    <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;?,?&gt;[n];</span><br><span class=\"line\">                    table = tab = nt;</span><br><span class=\"line\">                    sc = n - (n &gt;&gt;&gt; <span class=\"number\">2</span>); </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                sizeCtl = sc; <span class=\"comment\">//sizeCtl threshold</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> tab;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"Queue","date":"2022-10-30T05:22:56.000Z","lastmod":"2023-05-27T07:51:10.000Z","_content":"\n# Queue\n\n## Queue \t![image](/assets/image-20230527154724-v674duu.png)\n\n** null  poll() null  null **\n\n## PriorityQueue() `extends AbstractQueue`\n\n> \n> \n> PriorityQueue  Queue  null  complete binary tree  PriorityQueue \n>  PriorityQueue  Comparable PriorityQueue \n\n## Deque `extends Queue`()\n\n** Deque **\n\n|| Deque |\n| ---------| -----------------|\n|add(e)|addLast(e)|\n|offer(e)|offerLast(e)|\n|remove()|removeFirst()|\n|poll()|pollFirst()|\n|element()|getFirst()|\n|peek()|peekFirst()|\n\n## ArrayDeque `implements Deque` ()\n\n## ArrayBlockingQueue\n\n## SynchronousQueue\n\n## PriorityBlockingQueue\n\n## DelayQueue\n","source":"_posts/java/Collection/Queue.md","raw":"---\ntitle: Queue\ndate: 2022-10-30T13:22:56Z\nlastmod: 2023-05-27T15:51:10Z\n---\n\n# Queue\n\n## Queue \t![image](/assets/image-20230527154724-v674duu.png)\n\n** null  poll() null  null **\n\n## PriorityQueue() `extends AbstractQueue`\n\n> \n> \n> PriorityQueue  Queue  null  complete binary tree  PriorityQueue \n>  PriorityQueue  Comparable PriorityQueue \n\n## Deque `extends Queue`()\n\n** Deque **\n\n|| Deque |\n| ---------| -----------------|\n|add(e)|addLast(e)|\n|offer(e)|offerLast(e)|\n|remove()|removeFirst()|\n|poll()|pollFirst()|\n|element()|getFirst()|\n|peek()|peekFirst()|\n\n## ArrayDeque `implements Deque` ()\n\n## ArrayBlockingQueue\n\n## SynchronousQueue\n\n## PriorityBlockingQueue\n\n## DelayQueue\n","slug":"java-Collection-Queue","published":1,"updated":"2025-04-28T08:41:48.388Z","_id":"cm9s3f40i002wbfg41b4hcgsc","comments":1,"layout":"post","photos":[],"content":"<h1>Queue</h1>\n<h2 id=\"Queue-image\">Queue \t<img src=\"/assets/image-20230527154724-v674duu.png\" alt=\"image\"></h2>\n<p><strong> null  poll() null  null </strong></p>\n<h2 id=\"PriorityQueue--extends-AbstractQueue\">PriorityQueue() <code>extends AbstractQueue</code></h2>\n<blockquote>\n<p><br>\n<br>\nPriorityQueue  Queue  null  complete binary tree  PriorityQueue <br>\n PriorityQueue  Comparable PriorityQueue </p>\n</blockquote>\n<h2 id=\"Deque-extends-Queue-\">Deque <code>extends Queue</code>()</h2>\n<p><strong> Deque </strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th> Deque </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>add(e)</td>\n<td>addLast(e)</td>\n</tr>\n<tr>\n<td>offer(e)</td>\n<td>offerLast(e)</td>\n</tr>\n<tr>\n<td>remove()</td>\n<td>removeFirst()</td>\n</tr>\n<tr>\n<td>poll()</td>\n<td>pollFirst()</td>\n</tr>\n<tr>\n<td>element()</td>\n<td>getFirst()</td>\n</tr>\n<tr>\n<td>peek()</td>\n<td>peekFirst()</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ArrayDeque-implements-Deque-\">ArrayDeque <code>implements Deque</code> ()</h2>\n<h2 id=\"ArrayBlockingQueue\">ArrayBlockingQueue</h2>\n<h2 id=\"SynchronousQueue\">SynchronousQueue</h2>\n<h2 id=\"PriorityBlockingQueue\">PriorityBlockingQueue</h2>\n<h2 id=\"DelayQueue\">DelayQueue</h2>\n","excerpt":"","more":"<h1>Queue</h1>\n<h2 id=\"Queue-image\">Queue \t<img src=\"/assets/image-20230527154724-v674duu.png\" alt=\"image\"></h2>\n<p><strong> null  poll() null  null </strong></p>\n<h2 id=\"PriorityQueue--extends-AbstractQueue\">PriorityQueue() <code>extends AbstractQueue</code></h2>\n<blockquote>\n<p><br>\n<br>\nPriorityQueue  Queue  null  complete binary tree  PriorityQueue <br>\n PriorityQueue  Comparable PriorityQueue </p>\n</blockquote>\n<h2 id=\"Deque-extends-Queue-\">Deque <code>extends Queue</code>()</h2>\n<p><strong> Deque </strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th> Deque </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>add(e)</td>\n<td>addLast(e)</td>\n</tr>\n<tr>\n<td>offer(e)</td>\n<td>offerLast(e)</td>\n</tr>\n<tr>\n<td>remove()</td>\n<td>removeFirst()</td>\n</tr>\n<tr>\n<td>poll()</td>\n<td>pollFirst()</td>\n</tr>\n<tr>\n<td>element()</td>\n<td>getFirst()</td>\n</tr>\n<tr>\n<td>peek()</td>\n<td>peekFirst()</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ArrayDeque-implements-Deque-\">ArrayDeque <code>implements Deque</code> ()</h2>\n<h2 id=\"ArrayBlockingQueue\">ArrayBlockingQueue</h2>\n<h2 id=\"SynchronousQueue\">SynchronousQueue</h2>\n<h2 id=\"PriorityBlockingQueue\">PriorityBlockingQueue</h2>\n<h2 id=\"DelayQueue\">DelayQueue</h2>\n"},{"title":"Set","date":"2022-10-30T05:22:31.000Z","lastmod":"2022-10-30T05:22:31.000Z","_content":"\n# Set\n\n---\n\n## HashSet \n\n> () + \n\n****\n\n-  Set \n- \n-  null\n-  HashMap \n- \n- \n\nHashSet  HashMap HashSet  HashMap\n\n [HashMap](map.md##HashMap)\n\n## TreeSet \n\n> ()\n\n\n\n****\n\n- NavigableSet\n- \n- TreeMap\n- \n\n## LinkedHashSet \n\n> ()\n","source":"_posts/java/Collection/Set.md","raw":"---\ntitle: Set\ndate: 2022-10-30T13:22:31Z\nlastmod: 2022-10-30T13:22:31Z\n---\n\n# Set\n\n---\n\n## HashSet \n\n> () + \n\n****\n\n-  Set \n- \n-  null\n-  HashMap \n- \n- \n\nHashSet  HashMap HashSet  HashMap\n\n [HashMap](map.md##HashMap)\n\n## TreeSet \n\n> ()\n\n\n\n****\n\n- NavigableSet\n- \n- TreeMap\n- \n\n## LinkedHashSet \n\n> ()\n","slug":"java-Collection-Set","published":1,"updated":"2025-04-20T00:08:55.549Z","_id":"cm9s3f40j002xbfg44nml29lz","comments":1,"layout":"post","photos":[],"content":"<h1>Set</h1>\n<hr>\n<h2 id=\"HashSet-\">HashSet </h2>\n<blockquote>\n<p>() + </p>\n</blockquote>\n<p><strong></strong></p>\n<ul>\n<li> Set </li>\n<li></li>\n<li> null</li>\n<li> HashMap </li>\n<li></li>\n<li></li>\n</ul>\n<p>HashSet  HashMap HashSet  HashMap</p>\n<p> <a href=\"map.md##HashMap\">HashMap</a></p>\n<h2 id=\"TreeSet-\">TreeSet </h2>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p></p>\n<p><strong></strong></p>\n<ul>\n<li>NavigableSet</li>\n<li></li>\n<li>TreeMap</li>\n<li></li>\n</ul>\n<h2 id=\"LinkedHashSet-\">LinkedHashSet </h2>\n<blockquote>\n<p>()</p>\n</blockquote>\n","excerpt":"","more":"<h1>Set</h1>\n<hr>\n<h2 id=\"HashSet-\">HashSet </h2>\n<blockquote>\n<p>() + </p>\n</blockquote>\n<p><strong></strong></p>\n<ul>\n<li> Set </li>\n<li></li>\n<li> null</li>\n<li> HashMap </li>\n<li></li>\n<li></li>\n</ul>\n<p>HashSet  HashMap HashSet  HashMap</p>\n<p> <a href=\"map.md##HashMap\">HashMap</a></p>\n<h2 id=\"TreeSet-\">TreeSet </h2>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p></p>\n<p><strong></strong></p>\n<ul>\n<li>NavigableSet</li>\n<li></li>\n<li>TreeMap</li>\n<li></li>\n</ul>\n<h2 id=\"LinkedHashSet-\">LinkedHashSet </h2>\n<blockquote>\n<p>()</p>\n</blockquote>\n"},{"title":"Java","date":"2022-10-30T05:42:05.000Z","lastmod":"2023-08-25T12:01:25.000Z","_content":"\n# Java\n\njava  \n![image.png](/assets/net-img-1631431982904-ce964c3b-4c64-4915-84a9-a3799dd2cf92-20230330213415-i9cgn1s.png)\n\n******\n\n## \n\n- \n- javabooleanbytecharshortintfloatreferencereturnAddress\n\n**reference javareference** \n\n\n1. java\n2. \n\n**returnAddress**\n\n## \n\n![image.png](/assets/net-img-1631436389678-e6910ed9-8e3c-4d73-93bf-362566a4ebb0-20230330213421-crfgpeh.png)\n **_   _**\n\n## \n\n## \n\n## \n","source":"_posts/java/JVM/Java.md","raw":"---\ntitle: Java\ndate: 2022-10-30T13:42:05Z\nlastmod: 2023-08-25T20:01:25Z\n---\n\n# Java\n\njava  \n![image.png](/assets/net-img-1631431982904-ce964c3b-4c64-4915-84a9-a3799dd2cf92-20230330213415-i9cgn1s.png)\n\n******\n\n## \n\n- \n- javabooleanbytecharshortintfloatreferencereturnAddress\n\n**reference javareference** \n\n\n1. java\n2. \n\n**returnAddress**\n\n## \n\n![image.png](/assets/net-img-1631436389678-e6910ed9-8e3c-4d73-93bf-362566a4ebb0-20230330213421-crfgpeh.png)\n **_   _**\n\n## \n\n## \n\n## \n","slug":"java-JVM-Java","published":1,"updated":"2025-04-28T08:41:48.390Z","_id":"cm9s3f40j002ybfg4ezjh7een","comments":1,"layout":"post","photos":[],"content":"<h1>Java</h1>\n<p>java<br>\n<img src=\"/assets/net-img-1631431982904-ce964c3b-4c64-4915-84a9-a3799dd2cf92-20230330213415-i9cgn1s.png\" alt=\"image.png\"></p>\n<p><em><strong></strong></em></p>\n<h2 id=\"\"></h2>\n<ul>\n<li></li>\n<li>javabooleanbytecharshortintfloatreferencereturnAddress</li>\n</ul>\n<p><strong>reference javareference</strong><br>\n</p>\n<ol>\n<li>java</li>\n<li></li>\n</ol>\n<p><strong>returnAddress</strong></p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1631436389678-e6910ed9-8e3c-4d73-93bf-362566a4ebb0-20230330213421-crfgpeh.png\" alt=\"image.png\"><br>\n<strong>_   _</strong></p>\n<h2 id=\"\"></h2>\n<h2 id=\"\"></h2>\n<h2 id=\"\"></h2>\n","excerpt":"","more":"<h1>Java</h1>\n<p>java<br>\n<img src=\"/assets/net-img-1631431982904-ce964c3b-4c64-4915-84a9-a3799dd2cf92-20230330213415-i9cgn1s.png\" alt=\"image.png\"></p>\n<p><em><strong></strong></em></p>\n<h2 id=\"\"></h2>\n<ul>\n<li></li>\n<li>javabooleanbytecharshortintfloatreferencereturnAddress</li>\n</ul>\n<p><strong>reference javareference</strong><br>\n</p>\n<ol>\n<li>java</li>\n<li></li>\n</ol>\n<p><strong>returnAddress</strong></p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1631436389678-e6910ed9-8e3c-4d73-93bf-362566a4ebb0-20230330213421-crfgpeh.png\" alt=\"image.png\"><br>\n<strong>_   _</strong></p>\n<h2 id=\"\"></h2>\n<h2 id=\"\"></h2>\n<h2 id=\"\"></h2>\n"},{"title":"","date":"2022-10-30T05:38:14.000Z","lastmod":"2023-12-02T04:34:15.000Z","_content":"\n# \n\n\n\n## \n\n![image.png](/assets/net-img-1629870852837-ca139768-9f26-412a-8940-49ed6e38f57a-20230330213513-n1dmxgm.png)\n**\n_____**** ___\n_****_\n\n-  new getstaticputstaticinvokestaticjava\n  - new \n  - final\n  - \n- java.lang.reflect \n- \n- main() \n- JDK 8default \n- ** JDK 7**\n\n### \n\n Java\n\n- \n- \n- java.lang.Class \n\n### \n\n- Class\n  - 0xCAFEBABE Java\n  - tag\n  - \n  - CONSTANT_Utf8_infoUTF-8\n  - Class\n  - ........ \n- \n  - java.lang.Object\n  - final\n  - \n  - final \n  - ...........\n- \n  -  intlong\n  - \n  -  \n  - \n-    \n  - \n  - \n  - privateprotectedpublic \n  -  \n\n### \n\nstatic\nConstantValueConstantValue\n\n> - ConstantValue21\n> - ConstantValuefinal\n> - ConstantValue\n\nint x =123; static int x = 123;\n\n> - \n> - static\n>   - <init>\n> - static\n>   - <clinit>ConstantValue\n>     - final staticStringConstantValue\n>     - finalString<clinit>\n\n### \n\n \n\n> Symbolic References  Java Class\n> Direct References   \n\n### \n\n### \n\n## \n\n![](/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230330213516-hs7yexh.svg)\n\n### \n\n1. \n   1. \n   2. \n   3. \n2. \n   1. java\n   2. \n\n> SerialParNewCMS\n\n\n\n- CAS+\n- TLABJAVA\n\n> TLABTLAB\n\n3. \n   1. \n4. \n5. init\n\n### \n\nJava\n\n****\n\n1. \n2. \n3. Class\n\n### \n\n![](/assets/image-20231202123415-e2licnx.jpeg)\n\n**jvmclass pointer 4**  \n markword  instance data  padding 8  \n![image.png](/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20230330213518-3fydrb9.png)  \n  \n![image.png](/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20230330213518-2ptpa3a.png)  \nhotspot markword\n\n||||\n| ------------------------------------| ------| ----------------|\n||01||\n||00||\n||10||\n||11|gc|\n|id|01||\n\n![image.png](/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20230330213519-1im5mrq.png)\n\n## \n\n![image](/assets/image-20231117162020-0zic8ee.png)\n\n![image](/assets/image-20231117162030-ue9pyz9.png)\n\n### jdk8\n\n1. \n2. \n3. \n\n### jdk9\n\n1. \n2. \n3. \n\n### jdk9\n\nJDK 9\n\n1. platform class loaderClassLoadergetPlatformClassLoader()\n\nJDK 9  rt.jar  tools.jar  JMOD  Java  <JAVA_HOME>\\lib\\ext  java.ext.dirs  JDK \n\n2.  java.net.URLClassLoader  \n     jdk.internal.loader.BuiltinClassLoader\n\n![image](/assets/image-20231119124040-5kytmcz.png)\n\n URLClassLoader  JDK 9  JDK \n\n3. Java 9getName()platformapp\n4. jvmjava C++nullBootClassLoader\n5.   \n    \n\n\n\n\n\n![image](/assets/image-20231119124137-6apottn.png)\n\n  \n Java   \n  \njava.base                        java.security.sasl  \njava.datatransfer                java.xml  \njava.desktop                     jdk.httpserver  \njava.instrument                  jdk.internal.vm.ci  \njava.logging                     jdk.management  \njava.management                  jdk.management.agent  \njava.management.rmi              jdk.naming.rmi  \njava.naming                      jdk.net  \njava.prefs                       jdk.sctp  \njava.rmi                         jdk.unsupported\n\n  \njava.activation*                jdk.accessibility  \njava.compiler*                  jdk.charsets  \njava.corba*                     jdk.crypto.cryptoki  \njava.scripting                  jdk.crypto.ec  \njava.se                         jdk.dynalink  \njava.se.ee                      jdk.incubator.httpclient  \njava.security.jgss              jdk.internal.vm.compiler*  \njava.smartcardio                jdk.jsobject  \njava.sql                        jdk.localedata  \njava.sql.rowset                 jdk.naming.dns  \njava.transaction*               jdk.scripting.nashorn  \njava.xml.bind*                  jdk.security.auth  \njava.xml.crypto                 jdk.security.jgss  \njava.xml.ws*                    jdk.xml.dom  \njava.xml.ws.annotation*         jdk.zipfs\n\n  \njdk.aot                         jdk.jdeps  \njdk.attach                      jdk.jdi  \njdk.compiler                    jdk.jdwp.agent  \njdk.editpad                     jdk.jlink  \njdk.hotspot.agent               jdk.jshell  \njdk.internal.ed                 jdk.jstatd  \njdk.internal.jvmstat            jdk.pack  \njdk.internal.le                 jdk.policytool  \njdk.internal.opt                jdk.rmic  \njdk.jartool                     jdk.scripting.nashorn.shell  \njdk.javadoc                     jdk.xml.bind*  \njdk.jcmd                        jdk.xml.ws*  \njdk.jconsole\n\n\n","source":"_posts/java/JVM/.md","raw":"---\ntitle: \ndate: 2022-10-30T13:38:14Z\nlastmod: 2023-12-02T12:34:15Z\n---\n\n# \n\n\n\n## \n\n![image.png](/assets/net-img-1629870852837-ca139768-9f26-412a-8940-49ed6e38f57a-20230330213513-n1dmxgm.png)\n**\n_____**** ___\n_****_\n\n-  new getstaticputstaticinvokestaticjava\n  - new \n  - final\n  - \n- java.lang.reflect \n- \n- main() \n- JDK 8default \n- ** JDK 7**\n\n### \n\n Java\n\n- \n- \n- java.lang.Class \n\n### \n\n- Class\n  - 0xCAFEBABE Java\n  - tag\n  - \n  - CONSTANT_Utf8_infoUTF-8\n  - Class\n  - ........ \n- \n  - java.lang.Object\n  - final\n  - \n  - final \n  - ...........\n- \n  -  intlong\n  - \n  -  \n  - \n-    \n  - \n  - \n  - privateprotectedpublic \n  -  \n\n### \n\nstatic\nConstantValueConstantValue\n\n> - ConstantValue21\n> - ConstantValuefinal\n> - ConstantValue\n\nint x =123; static int x = 123;\n\n> - \n> - static\n>   - <init>\n> - static\n>   - <clinit>ConstantValue\n>     - final staticStringConstantValue\n>     - finalString<clinit>\n\n### \n\n \n\n> Symbolic References  Java Class\n> Direct References   \n\n### \n\n### \n\n## \n\n![](/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230330213516-hs7yexh.svg)\n\n### \n\n1. \n   1. \n   2. \n   3. \n2. \n   1. java\n   2. \n\n> SerialParNewCMS\n\n\n\n- CAS+\n- TLABJAVA\n\n> TLABTLAB\n\n3. \n   1. \n4. \n5. init\n\n### \n\nJava\n\n****\n\n1. \n2. \n3. Class\n\n### \n\n![](/assets/image-20231202123415-e2licnx.jpeg)\n\n**jvmclass pointer 4**  \n markword  instance data  padding 8  \n![image.png](/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20230330213518-3fydrb9.png)  \n  \n![image.png](/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20230330213518-2ptpa3a.png)  \nhotspot markword\n\n||||\n| ------------------------------------| ------| ----------------|\n||01||\n||00||\n||10||\n||11|gc|\n|id|01||\n\n![image.png](/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20230330213519-1im5mrq.png)\n\n## \n\n![image](/assets/image-20231117162020-0zic8ee.png)\n\n![image](/assets/image-20231117162030-ue9pyz9.png)\n\n### jdk8\n\n1. \n2. \n3. \n\n### jdk9\n\n1. \n2. \n3. \n\n### jdk9\n\nJDK 9\n\n1. platform class loaderClassLoadergetPlatformClassLoader()\n\nJDK 9  rt.jar  tools.jar  JMOD  Java  <JAVA_HOME>\\lib\\ext  java.ext.dirs  JDK \n\n2.  java.net.URLClassLoader  \n     jdk.internal.loader.BuiltinClassLoader\n\n![image](/assets/image-20231119124040-5kytmcz.png)\n\n URLClassLoader  JDK 9  JDK \n\n3. Java 9getName()platformapp\n4. jvmjava C++nullBootClassLoader\n5.   \n    \n\n\n\n\n\n![image](/assets/image-20231119124137-6apottn.png)\n\n  \n Java   \n  \njava.base                        java.security.sasl  \njava.datatransfer                java.xml  \njava.desktop                     jdk.httpserver  \njava.instrument                  jdk.internal.vm.ci  \njava.logging                     jdk.management  \njava.management                  jdk.management.agent  \njava.management.rmi              jdk.naming.rmi  \njava.naming                      jdk.net  \njava.prefs                       jdk.sctp  \njava.rmi                         jdk.unsupported\n\n  \njava.activation*                jdk.accessibility  \njava.compiler*                  jdk.charsets  \njava.corba*                     jdk.crypto.cryptoki  \njava.scripting                  jdk.crypto.ec  \njava.se                         jdk.dynalink  \njava.se.ee                      jdk.incubator.httpclient  \njava.security.jgss              jdk.internal.vm.compiler*  \njava.smartcardio                jdk.jsobject  \njava.sql                        jdk.localedata  \njava.sql.rowset                 jdk.naming.dns  \njava.transaction*               jdk.scripting.nashorn  \njava.xml.bind*                  jdk.security.auth  \njava.xml.crypto                 jdk.security.jgss  \njava.xml.ws*                    jdk.xml.dom  \njava.xml.ws.annotation*         jdk.zipfs\n\n  \njdk.aot                         jdk.jdeps  \njdk.attach                      jdk.jdi  \njdk.compiler                    jdk.jdwp.agent  \njdk.editpad                     jdk.jlink  \njdk.hotspot.agent               jdk.jshell  \njdk.internal.ed                 jdk.jstatd  \njdk.internal.jvmstat            jdk.pack  \njdk.internal.le                 jdk.policytool  \njdk.internal.opt                jdk.rmic  \njdk.jartool                     jdk.scripting.nashorn.shell  \njdk.javadoc                     jdk.xml.bind*  \njdk.jcmd                        jdk.xml.ws*  \njdk.jconsole\n\n\n","slug":"java-JVM-","published":1,"updated":"2025-04-28T08:41:48.391Z","_id":"cm9s3f40k002zbfg47g4cdort","comments":1,"layout":"post","photos":[],"content":"<h1></h1>\n<p></p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1629870852837-ca139768-9f26-412a-8940-49ed6e38f57a-20230330213513-n1dmxgm.png\" alt=\"image.png\"><br>\n<em></em><br>\n<em>___</em><strong></strong> <em>__<br>\n</em><strong></strong>_</p>\n<ul>\n<li> new getstaticputstaticinvokestaticjava\n<ul>\n<li>new </li>\n<li>final</li>\n<li></li>\n</ul>\n</li>\n<li>java.lang.reflect </li>\n<li></li>\n<li>main() </li>\n<li>JDK 8default </li>\n<li>** JDK 7**</li>\n</ul>\n<h3 id=\"\"></h3>\n<p>Java</p>\n<ul>\n<li></li>\n<li></li>\n<li>java.lang.Class </li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li>Class\n<ul>\n<li>0xCAFEBABE Java</li>\n<li>tag</li>\n<li></li>\n<li>CONSTANT_Utf8_infoUTF-8</li>\n<li>Class</li>\n<li> </li>\n</ul>\n</li>\n<li>\n<ul>\n<li>java.lang.Object</li>\n<li>final</li>\n<li></li>\n<li>final </li>\n<li></li>\n</ul>\n</li>\n<li>\n<ul>\n<li> intlong</li>\n<li></li>\n<li> </li>\n<li></li>\n</ul>\n</li>\n<li>   \n<ul>\n<li></li>\n<li></li>\n<li>privateprotectedpublic </li>\n<li> </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<p>static<br>\nConstantValueConstantValue</p>\n<blockquote>\n<ul>\n<li>ConstantValue21</li>\n<li>ConstantValuefinal</li>\n<li>ConstantValue</li>\n</ul>\n</blockquote>\n<p>int x =123; static int x = 123;</p>\n<blockquote>\n<ul>\n<li></li>\n<li>static\n<ul>\n<li><init></li>\n</ul>\n</li>\n<li>static\n<ul>\n<li><clinit>ConstantValue\n<ul>\n<li>final staticStringConstantValue</li>\n<li>finalString<clinit></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"\"></h3>\n<p></p>\n<blockquote>\n<p>Symbolic References  Java Class<br>\nDirect References   </p>\n</blockquote>\n<h3 id=\"\"></h3>\n<h3 id=\"\"></h3>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230330213516-hs7yexh.svg\" alt=\"\"></p>\n<h3 id=\"\"></h3>\n<ol>\n<li>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n<li>\n<ol>\n<li>java</li>\n<li></li>\n</ol>\n</li>\n</ol>\n<blockquote>\n<p>SerialParNewCMS</p>\n</blockquote>\n<p></p>\n<ul>\n<li>CAS+</li>\n<li>TLABJAVA</li>\n</ul>\n<blockquote>\n<p>TLABTLAB</p>\n</blockquote>\n<ol start=\"3\">\n<li>\n<ol>\n<li></li>\n</ol>\n</li>\n<li></li>\n<li>init</li>\n</ol>\n<h3 id=\"\"></h3>\n<p>Java<br>\n<br>\n<strong></strong></p>\n<ol>\n<li></li>\n<li></li>\n<li>Class</li>\n</ol>\n<h3 id=\"\"></h3>\n<p><img src=\"/assets/image-20231202123415-e2licnx.jpeg\" alt=\"\"></p>\n<p><strong>jvmclass pointer 4</strong><br>\n markword  instance data  padding 8<br>\n<img src=\"/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20230330213518-3fydrb9.png\" alt=\"image.png\"><br>\n<br>\n<img src=\"/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20230330213518-2ptpa3a.png\" alt=\"image.png\"><br>\nhotspot markword</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td>01</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>00</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>10</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>11</td>\n<td>gc</td>\n</tr>\n<tr>\n<td>id</td>\n<td>01</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20230330213519-1im5mrq.png\" alt=\"image.png\"></p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/image-20231117162020-0zic8ee.png\" alt=\"image\"></p>\n<p><img src=\"/assets/image-20231117162030-ue9pyz9.png\" alt=\"image\"></p>\n<h3 id=\"jdk8\">jdk8</h3>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h3 id=\"jdk9\">jdk9</h3>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h3 id=\"jdk9\">jdk9</h3>\n<p>JDK 9</p>\n<ol>\n<li>platform class loaderClassLoadergetPlatformClassLoader()</li>\n</ol>\n<p>JDK 9  rt.jar  tools.jar  JMOD  Java  &lt;JAVA_HOME&gt;\\lib\\ext  java.ext.dirs  JDK </p>\n<ol start=\"2\">\n<li> java.net.URLClassLoader<br>\n jdk.internal.loader.BuiltinClassLoader</li>\n</ol>\n<p><img src=\"/assets/image-20231119124040-5kytmcz.png\" alt=\"image\"></p>\n<p> URLClassLoader  JDK 9  JDK </p>\n<ol start=\"3\">\n<li>Java 9getName()platformapp</li>\n<li>jvmjava C++nullBootClassLoader</li>\n<li><br>\n</li>\n</ol>\n<p></p>\n<p></p>\n<p><img src=\"/assets/image-20231119124137-6apottn.png\" alt=\"image\"></p>\n<p><br>\n Java <br>\n<br>\njava.base                        java.security.sasl<br>\njava.datatransfer                java.xml<br>\njava.desktop                     jdk.httpserver<br>\njava.instrument                  <a href=\"http://jdk.internal.vm.ci\">jdk.internal.vm.ci</a><br>\njava.logging                     jdk.management<br>\njava.management                  jdk.management.agent<br>\njava.management.rmi              jdk.naming.rmi<br>\njava.naming                      <a href=\"http://jdk.net\">jdk.net</a><br>\njava.prefs                       jdk.sctp<br>\njava.rmi                         jdk.unsupported</p>\n<p><br>\njava.activation*                jdk.accessibility<br>\njava.compiler*                  jdk.charsets<br>\njava.corba*                     jdk.crypto.cryptoki<br>\njava.scripting                  <a href=\"http://jdk.crypto.ec\">jdk.crypto.ec</a><br>\n<a href=\"http://java.se\">java.se</a>                         jdk.dynalink<br>\n<a href=\"http://java.se.ee\">java.se.ee</a>                      jdk.incubator.httpclient<br>\njava.security.jgss              jdk.internal.vm.compiler*<br>\njava.smartcardio                jdk.jsobject<br>\njava.sql                        jdk.localedata<br>\njava.sql.rowset                 jdk.naming.dns<br>\njava.transaction*               jdk.scripting.nashorn<br>\njava.xml.bind*                  jdk.security.auth<br>\njava.xml.crypto                 jdk.security.jgss<br>\n<a href=\"http://java.xml.ws\">java.xml.ws</a>*                    jdk.xml.dom<br>\njava.xml.ws.annotation*         jdk.zipfs</p>\n<p><br>\njdk.aot                         jdk.jdeps<br>\njdk.attach                      jdk.jdi<br>\njdk.compiler                    jdk.jdwp.agent<br>\njdk.editpad                     jdk.jlink<br>\njdk.hotspot.agent               jdk.jshell<br>\njdk.internal.ed                 jdk.jstatd<br>\njdk.internal.jvmstat            jdk.pack<br>\njdk.internal.le                 jdk.policytool<br>\njdk.internal.opt                jdk.rmic<br>\njdk.jartool                     jdk.scripting.nashorn.shell<br>\njdk.javadoc                     jdk.xml.bind*<br>\njdk.jcmd                        <a href=\"http://jdk.xml.ws\">jdk.xml.ws</a>*<br>\njdk.jconsole</p>\n<p></p>\n","excerpt":"","more":"<h1></h1>\n<p></p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1629870852837-ca139768-9f26-412a-8940-49ed6e38f57a-20230330213513-n1dmxgm.png\" alt=\"image.png\"><br>\n<em></em><br>\n<em>___</em><strong></strong> <em>__<br>\n</em><strong></strong>_</p>\n<ul>\n<li> new getstaticputstaticinvokestaticjava\n<ul>\n<li>new </li>\n<li>final</li>\n<li></li>\n</ul>\n</li>\n<li>java.lang.reflect </li>\n<li></li>\n<li>main() </li>\n<li>JDK 8default </li>\n<li>** JDK 7**</li>\n</ul>\n<h3 id=\"\"></h3>\n<p>Java</p>\n<ul>\n<li></li>\n<li></li>\n<li>java.lang.Class </li>\n</ul>\n<h3 id=\"\"></h3>\n<ul>\n<li>Class\n<ul>\n<li>0xCAFEBABE Java</li>\n<li>tag</li>\n<li></li>\n<li>CONSTANT_Utf8_infoUTF-8</li>\n<li>Class</li>\n<li> </li>\n</ul>\n</li>\n<li>\n<ul>\n<li>java.lang.Object</li>\n<li>final</li>\n<li></li>\n<li>final </li>\n<li></li>\n</ul>\n</li>\n<li>\n<ul>\n<li> intlong</li>\n<li></li>\n<li> </li>\n<li></li>\n</ul>\n</li>\n<li>   \n<ul>\n<li></li>\n<li></li>\n<li>privateprotectedpublic </li>\n<li> </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<p>static<br>\nConstantValueConstantValue</p>\n<blockquote>\n<ul>\n<li>ConstantValue21</li>\n<li>ConstantValuefinal</li>\n<li>ConstantValue</li>\n</ul>\n</blockquote>\n<p>int x =123; static int x = 123;</p>\n<blockquote>\n<ul>\n<li></li>\n<li>static\n<ul>\n<li><init></li>\n</ul>\n</li>\n<li>static\n<ul>\n<li><clinit>ConstantValue\n<ul>\n<li>final staticStringConstantValue</li>\n<li>finalString<clinit></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"\"></h3>\n<p></p>\n<blockquote>\n<p>Symbolic References  Java Class<br>\nDirect References   </p>\n</blockquote>\n<h3 id=\"\"></h3>\n<h3 id=\"\"></h3>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-4122e8fc2d6e2995074ede61ff44aef4-20230330213516-hs7yexh.svg\" alt=\"\"></p>\n<h3 id=\"\"></h3>\n<ol>\n<li>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n<li>\n<ol>\n<li>java</li>\n<li></li>\n</ol>\n</li>\n</ol>\n<blockquote>\n<p>SerialParNewCMS</p>\n</blockquote>\n<p></p>\n<ul>\n<li>CAS+</li>\n<li>TLABJAVA</li>\n</ul>\n<blockquote>\n<p>TLABTLAB</p>\n</blockquote>\n<ol start=\"3\">\n<li>\n<ol>\n<li></li>\n</ol>\n</li>\n<li></li>\n<li>init</li>\n</ol>\n<h3 id=\"\"></h3>\n<p>Java<br>\n<br>\n<strong></strong></p>\n<ol>\n<li></li>\n<li></li>\n<li>Class</li>\n</ol>\n<h3 id=\"\"></h3>\n<p><img src=\"/assets/image-20231202123415-e2licnx.jpeg\" alt=\"\"></p>\n<p><strong>jvmclass pointer 4</strong><br>\n markword  instance data  padding 8<br>\n<img src=\"/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20230330213518-3fydrb9.png\" alt=\"image.png\"><br>\n<br>\n<img src=\"/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20230330213518-2ptpa3a.png\" alt=\"image.png\"><br>\nhotspot markword</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td>01</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>00</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>10</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>11</td>\n<td>gc</td>\n</tr>\n<tr>\n<td>id</td>\n<td>01</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20230330213519-1im5mrq.png\" alt=\"image.png\"></p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/image-20231117162020-0zic8ee.png\" alt=\"image\"></p>\n<p><img src=\"/assets/image-20231117162030-ue9pyz9.png\" alt=\"image\"></p>\n<h3 id=\"jdk8\">jdk8</h3>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h3 id=\"jdk9\">jdk9</h3>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h3 id=\"jdk9\">jdk9</h3>\n<p>JDK 9</p>\n<ol>\n<li>platform class loaderClassLoadergetPlatformClassLoader()</li>\n</ol>\n<p>JDK 9  rt.jar  tools.jar  JMOD  Java  &lt;JAVA_HOME&gt;\\lib\\ext  java.ext.dirs  JDK </p>\n<ol start=\"2\">\n<li> java.net.URLClassLoader<br>\n jdk.internal.loader.BuiltinClassLoader</li>\n</ol>\n<p><img src=\"/assets/image-20231119124040-5kytmcz.png\" alt=\"image\"></p>\n<p> URLClassLoader  JDK 9  JDK </p>\n<ol start=\"3\">\n<li>Java 9getName()platformapp</li>\n<li>jvmjava C++nullBootClassLoader</li>\n<li><br>\n</li>\n</ol>\n<p></p>\n<p></p>\n<p><img src=\"/assets/image-20231119124137-6apottn.png\" alt=\"image\"></p>\n<p><br>\n Java <br>\n<br>\njava.base                        java.security.sasl<br>\njava.datatransfer                java.xml<br>\njava.desktop                     jdk.httpserver<br>\njava.instrument                  <a href=\"http://jdk.internal.vm.ci\">jdk.internal.vm.ci</a><br>\njava.logging                     jdk.management<br>\njava.management                  jdk.management.agent<br>\njava.management.rmi              jdk.naming.rmi<br>\njava.naming                      <a href=\"http://jdk.net\">jdk.net</a><br>\njava.prefs                       jdk.sctp<br>\njava.rmi                         jdk.unsupported</p>\n<p><br>\njava.activation*                jdk.accessibility<br>\njava.compiler*                  jdk.charsets<br>\njava.corba*                     jdk.crypto.cryptoki<br>\njava.scripting                  <a href=\"http://jdk.crypto.ec\">jdk.crypto.ec</a><br>\n<a href=\"http://java.se\">java.se</a>                         jdk.dynalink<br>\n<a href=\"http://java.se.ee\">java.se.ee</a>                      jdk.incubator.httpclient<br>\njava.security.jgss              jdk.internal.vm.compiler*<br>\njava.smartcardio                jdk.jsobject<br>\njava.sql                        jdk.localedata<br>\njava.sql.rowset                 jdk.naming.dns<br>\njava.transaction*               jdk.scripting.nashorn<br>\njava.xml.bind*                  jdk.security.auth<br>\njava.xml.crypto                 jdk.security.jgss<br>\n<a href=\"http://java.xml.ws\">java.xml.ws</a>*                    jdk.xml.dom<br>\njava.xml.ws.annotation*         jdk.zipfs</p>\n<p><br>\njdk.aot                         jdk.jdeps<br>\njdk.attach                      jdk.jdi<br>\njdk.compiler                    jdk.jdwp.agent<br>\njdk.editpad                     jdk.jlink<br>\njdk.hotspot.agent               jdk.jshell<br>\njdk.internal.ed                 jdk.jstatd<br>\njdk.internal.jvmstat            jdk.pack<br>\njdk.internal.le                 jdk.policytool<br>\njdk.internal.opt                jdk.rmic<br>\njdk.jartool                     jdk.scripting.nashorn.shell<br>\njdk.javadoc                     jdk.xml.bind*<br>\njdk.jcmd                        <a href=\"http://jdk.xml.ws\">jdk.xml.ws</a>*<br>\njdk.jconsole</p>\n<p></p>\n"},{"title":"","date":"2022-10-30T05:40:49.000Z","lastmod":"2023-11-26T08:16:40.000Z","_content":"\n# \n\n## \n\n### \n\n#### \n\n> AA A 11A 0A\n\n* \n\n  * \n* \n\n  * \n  * \n  * \n\n####  \n\n>  GC RootsGC Roots\n\n\n\n* (GC Roots)\n* (Reference Chain)\n* \n* \n\n\"GC Roots\"\n\n* \n* java \n* \n* JNINative\n* JavaClass\n* \n* javaJMXBeanJVMTI\n\n**GCStop The World\n\n### \n\n#### \n\n> CollectorHeader  \n> CollectorHeader\n\n* \n* GC\n* \n\n#### \n\n> \n\n* \n\n  * \n* \n\n  * \n  * G1regionGCGCregion\n\n,\n\n#### \n\n>   \n> \n\n* \n\n  * /JVM\n  * \n* \n\n  * \n  * \n  * \n  * STW\n\n#### \n\n> Java\n\n#### \n\n> \n\n\n\n#### \n\n> \n\n### JVM\n\n#### \n\nGC  \n\n\n> new \n\n#### SoftReference<Object>(obj);\n\nGC  \n\n\n> \n\n#### WeakReference<Object>(obj)\n\nGC  \n\n\n>  WeakReference\n\n#### PhantomReference<>(new Object(),new ReferenceQueue<>())\n\n  \n\n\n> 1. \n\n> \n\n> \n\n> \n\n## JVM GC \n\n> [JVM](https://www.yuque.com/pride_yang/blog/qsgy0z#vfjXH)\n\n> Minor GC  GC\n\n> Major GC/Full GC\n\n1. eden\n2. eden\n3. edenminor GC(young GC),survivor0eden mark-sweepedenmark-copy  survivor0\n4. edenminor GCedens0s1toS0edenS0 s1edenS0minor GCedenS0\n5. edenminor GCs0s0s1edens1s0edens1edens1\n6. s0s1gc(age)3(eden,s0,s1)11+1young(-XX:MaxTenuringThreshold15)\n7. major GCFull GC--\n\n![](/assets/net-img-1646740660775-762fcaa3-26b5-4d95-ac43-5cca58540969-20230330213439-sxz1b5i.png)\n\n## \n\n![](.//assets/image-20231126145713-0pou43f.png)\n\n1.   \n    Serial/Serial OldSerial/CMSParNew/Serial OldParNew/CMSParallel Scavenge/Serial OldParallel Scavenge/Parallel OldG1\n2. Serial OldCMS\"Concurrent Mode Failure\"\n3. ()JDK 8Serial+CMSParNew+Serial OldJEP 173JDK 9JEP214\n4. ()JDK 14Parallel ScavengeSerialOld GC JEP 366\n5. ()JDK 14CMS JEP 363\n\n### \n\n#### Serial /Serial Old \n\n>  \n\n![image.png](/assets/net-img-1629558034184-e1fe6601-777e-4a34-afe5-df37e5a9b720-20230330213445-e5uive7.png \"\")\n\n#### ParNew /Serial Old \n\n> CPU \n\n![image.png](/assets/net-img-1629559055065-5ad8d49f-81b6-45f3-87f8-c98716f799ed-20230330213451-7nkjlzc.png \"\")\n\n#### Parallel Scavenge/Parallel Old\n\n>  jdk8\n\n![image.png](/assets/net-img-1629559366006-0194df18-86f2-45fd-bd85-6f675b19bdb0-20230330213459-p7i5mm5.png \"\")\n\n#### CMS\n\n> CMSMark-Sweep\n>\n> CMSMark-CompactSerial OldConcurrent Mode FailureSerial OldFull GC\n\n![image.png](/assets/net-img-1629560137959-ab93eb78-c083-4c80-8283-4cfc470c8af0-20230330213504-cteixk9.png \"\")\n\n* STWGC Roots\n* GC Roots\n* STW\n* \n\n#### G1 \n\n> CPUGCJDK9 \n\n![](/assets/image-20231126155909-4zbslm1.png)\n\n##### \n\n1. GC Young GC\n\n    1. \n\n2.  Concurrent Marking\n\n3. Mixed GC\n\n4. Full GCGC\n\n![ (2)](/assets/image-20231126161709-b35di3t.png)\n\nyoung gc -> young gc + concurrent mark-> Mixed GC\n\n##### \n\n*  \n\n  * G1\n\n  ****\n\n  * G1GCSTW\n\n* ****\n\n  * G1EdenSurvivorEden\n  * Region,\n  * \n\n* \n\n  * CMS-GC\n  * G1regionregionRegion-Mark-Compact GCJavaG1\n* \n\n  * G1\n  * G1  Region Region G1 \n  * CMS GCG1CMS\n\n**G1FootprintOverloadCMSCMSG1G16-8GB**\n\n\n","source":"_posts/java/JVM/.md","raw":"---\ntitle: \ndate: 2022-10-30T13:40:49Z\nlastmod: 2023-11-26T16:16:40Z\n---\n\n# \n\n## \n\n### \n\n#### \n\n> AA A 11A 0A\n\n* \n\n  * \n* \n\n  * \n  * \n  * \n\n####  \n\n>  GC RootsGC Roots\n\n\n\n* (GC Roots)\n* (Reference Chain)\n* \n* \n\n\"GC Roots\"\n\n* \n* java \n* \n* JNINative\n* JavaClass\n* \n* javaJMXBeanJVMTI\n\n**GCStop The World\n\n### \n\n#### \n\n> CollectorHeader  \n> CollectorHeader\n\n* \n* GC\n* \n\n#### \n\n> \n\n* \n\n  * \n* \n\n  * \n  * G1regionGCGCregion\n\n,\n\n#### \n\n>   \n> \n\n* \n\n  * /JVM\n  * \n* \n\n  * \n  * \n  * \n  * STW\n\n#### \n\n> Java\n\n#### \n\n> \n\n\n\n#### \n\n> \n\n### JVM\n\n#### \n\nGC  \n\n\n> new \n\n#### SoftReference<Object>(obj);\n\nGC  \n\n\n> \n\n#### WeakReference<Object>(obj)\n\nGC  \n\n\n>  WeakReference\n\n#### PhantomReference<>(new Object(),new ReferenceQueue<>())\n\n  \n\n\n> 1. \n\n> \n\n> \n\n> \n\n## JVM GC \n\n> [JVM](https://www.yuque.com/pride_yang/blog/qsgy0z#vfjXH)\n\n> Minor GC  GC\n\n> Major GC/Full GC\n\n1. eden\n2. eden\n3. edenminor GC(young GC),survivor0eden mark-sweepedenmark-copy  survivor0\n4. edenminor GCedens0s1toS0edenS0 s1edenS0minor GCedenS0\n5. edenminor GCs0s0s1edens1s0edens1edens1\n6. s0s1gc(age)3(eden,s0,s1)11+1young(-XX:MaxTenuringThreshold15)\n7. major GCFull GC--\n\n![](/assets/net-img-1646740660775-762fcaa3-26b5-4d95-ac43-5cca58540969-20230330213439-sxz1b5i.png)\n\n## \n\n![](.//assets/image-20231126145713-0pou43f.png)\n\n1.   \n    Serial/Serial OldSerial/CMSParNew/Serial OldParNew/CMSParallel Scavenge/Serial OldParallel Scavenge/Parallel OldG1\n2. Serial OldCMS\"Concurrent Mode Failure\"\n3. ()JDK 8Serial+CMSParNew+Serial OldJEP 173JDK 9JEP214\n4. ()JDK 14Parallel ScavengeSerialOld GC JEP 366\n5. ()JDK 14CMS JEP 363\n\n### \n\n#### Serial /Serial Old \n\n>  \n\n![image.png](/assets/net-img-1629558034184-e1fe6601-777e-4a34-afe5-df37e5a9b720-20230330213445-e5uive7.png \"\")\n\n#### ParNew /Serial Old \n\n> CPU \n\n![image.png](/assets/net-img-1629559055065-5ad8d49f-81b6-45f3-87f8-c98716f799ed-20230330213451-7nkjlzc.png \"\")\n\n#### Parallel Scavenge/Parallel Old\n\n>  jdk8\n\n![image.png](/assets/net-img-1629559366006-0194df18-86f2-45fd-bd85-6f675b19bdb0-20230330213459-p7i5mm5.png \"\")\n\n#### CMS\n\n> CMSMark-Sweep\n>\n> CMSMark-CompactSerial OldConcurrent Mode FailureSerial OldFull GC\n\n![image.png](/assets/net-img-1629560137959-ab93eb78-c083-4c80-8283-4cfc470c8af0-20230330213504-cteixk9.png \"\")\n\n* STWGC Roots\n* GC Roots\n* STW\n* \n\n#### G1 \n\n> CPUGCJDK9 \n\n![](/assets/image-20231126155909-4zbslm1.png)\n\n##### \n\n1. GC Young GC\n\n    1. \n\n2.  Concurrent Marking\n\n3. Mixed GC\n\n4. Full GCGC\n\n![ (2)](/assets/image-20231126161709-b35di3t.png)\n\nyoung gc -> young gc + concurrent mark-> Mixed GC\n\n##### \n\n*  \n\n  * G1\n\n  ****\n\n  * G1GCSTW\n\n* ****\n\n  * G1EdenSurvivorEden\n  * Region,\n  * \n\n* \n\n  * CMS-GC\n  * G1regionregionRegion-Mark-Compact GCJavaG1\n* \n\n  * G1\n  * G1  Region Region G1 \n  * CMS GCG1CMS\n\n**G1FootprintOverloadCMSCMSG1G16-8GB**\n\n\n","slug":"java-JVM-","published":1,"updated":"2025-04-28T08:41:48.391Z","_id":"cm9s3f40l0030bfg46bwnbb86","comments":1,"layout":"post","photos":[],"content":"<h1></h1>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>AA A 11A 0A</p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"></h4>\n<blockquote>\n<p> GC RootsGC Roots</p>\n</blockquote>\n<p></p>\n<ul>\n<li>(GC Roots)</li>\n<li>(Reference Chain)</li>\n<li></li>\n<li></li>\n</ul>\n<p>&quot;GC Roots&quot;</p>\n<ul>\n<li></li>\n<li>java </li>\n<li></li>\n<li>JNINative</li>\n<li>JavaClass</li>\n<li></li>\n<li>javaJMXBeanJVMTI</li>\n</ul>\n<p><em></em>GCStop The World</p>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>CollectorHeader<br>\nCollectorHeader</p>\n</blockquote>\n<ul>\n<li></li>\n<li>GC</li>\n<li></li>\n</ul>\n<h4 id=\"\"></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li>G1regionGCGCregion</li>\n</ul>\n</li>\n</ul>\n<p>,</p>\n<h4 id=\"\"></h4>\n<blockquote>\n<p><br>\n</p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li>/JVM</li>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>STW</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>Java</p>\n</blockquote>\n<h4 id=\"\"></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<p></p>\n<h4 id=\"\"></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"JVM\">JVM</h3>\n<h4 id=\"\"></h4>\n<p>GC<br>\n</p>\n<blockquote>\n<p>new </p>\n</blockquote>\n<h4 id=\"SoftReference-Object-obj\">SoftReference<Object>(obj);</h4>\n<p>GC<br>\n</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"WeakReference-Object-obj\">WeakReference<Object>(obj)</h4>\n<p>GC<br>\n</p>\n<blockquote>\n<p> WeakReference</p>\n</blockquote>\n<h4 id=\"PhantomReference-new-Object-new-ReferenceQueue\">PhantomReference&lt;&gt;(new Object(),new ReferenceQueue&lt;&gt;())</h4>\n<p><br>\n</p>\n<blockquote>\n<ol>\n<li></li>\n</ol>\n</blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"JVM-GC-\">JVM GC </h2>\n<blockquote>\n<p><a href=\"https://www.yuque.com/pride_yang/blog/qsgy0z#vfjXH\">JVM</a></p>\n</blockquote>\n<blockquote>\n<p>Minor GC  GC</p>\n</blockquote>\n<blockquote>\n<p>Major GC/Full GC</p>\n</blockquote>\n<ol>\n<li>eden</li>\n<li>eden</li>\n<li>edenminor GC(young GC),survivor0eden mark-sweepedenmark-copy  survivor0</li>\n<li>edenminor GCedens0s1toS0edenS0 s1edenS0minor GCedenS0</li>\n<li>edenminor GCs0s0s1edens1s0edens1edens1</li>\n<li>s0s1gc(age)3(eden,s0,s1)11+1young(-XX:MaxTenuringThreshold15)</li>\n<li>major GCFull GC--</li>\n</ol>\n<p><img src=\"/assets/net-img-1646740660775-762fcaa3-26b5-4d95-ac43-5cca58540969-20230330213439-sxz1b5i.png\" alt=\"\"></p>\n<h2 id=\"\"></h2>\n<p><img src=\".//assets/image-20231126145713-0pou43f.png\" alt=\"\"></p>\n<ol>\n<li><br>\nSerial/Serial OldSerial/CMSParNew/Serial OldParNew/CMSParallel Scavenge/Serial OldParallel Scavenge/Parallel OldG1</li>\n<li>Serial OldCMS&quot;Concurrent Mode Failure&quot;</li>\n<li>()JDK 8Serial+CMSParNew+Serial OldJEP 173JDK 9JEP214</li>\n<li>()JDK 14Parallel ScavengeSerialOld GC JEP 366</li>\n<li>()JDK 14CMS JEP 363</li>\n</ol>\n<h3 id=\"\"></h3>\n<h4 id=\"Serial--Serial-Old-\">Serial /Serial Old </h4>\n<blockquote>\n<p> </p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629558034184-e1fe6601-777e-4a34-afe5-df37e5a9b720-20230330213445-e5uive7.png\" alt=\"image.png\" title=\"\"></p>\n<h4 id=\"ParNew--Serial-Old-\">ParNew /Serial Old </h4>\n<blockquote>\n<p>CPU </p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629559055065-5ad8d49f-81b6-45f3-87f8-c98716f799ed-20230330213451-7nkjlzc.png\" alt=\"image.png\" title=\"\"></p>\n<h4 id=\"Parallel-Scavenge-Parallel-Old\">Parallel Scavenge/Parallel Old</h4>\n<blockquote>\n<p> jdk8</p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629559366006-0194df18-86f2-45fd-bd85-6f675b19bdb0-20230330213459-p7i5mm5.png\" alt=\"image.png\" title=\"\"></p>\n<h4 id=\"CMS\">CMS</h4>\n<blockquote>\n<p>CMSMark-Sweep</p>\n<p>CMSMark-CompactSerial OldConcurrent Mode FailureSerial OldFull GC</p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629560137959-ab93eb78-c083-4c80-8283-4cfc470c8af0-20230330213504-cteixk9.png\" alt=\"image.png\" title=\"\"></p>\n<ul>\n<li>STWGC Roots</li>\n<li>GC Roots</li>\n<li>STW</li>\n<li></li>\n</ul>\n<h4 id=\"G1-\">G1 </h4>\n<blockquote>\n<p>CPUGCJDK9 </p>\n</blockquote>\n<p><img src=\"/assets/image-20231126155909-4zbslm1.png\" alt=\"\"></p>\n<h5 id=\"\"></h5>\n<ol>\n<li>\n<p>GC Young GC</p>\n<ol>\n<li></li>\n</ol>\n</li>\n<li>\n<p> Concurrent Marking</p>\n</li>\n<li>\n<p>Mixed GC</p>\n</li>\n<li>\n<p>Full GCGC</p>\n</li>\n</ol>\n<p><img src=\"/assets/image-20231126161709-b35di3t.png\" alt=\" (2)\"></p>\n<p>young gc -&gt; young gc + concurrent mark-&gt; Mixed GC</p>\n<h5 id=\"\"></h5>\n<ul>\n<li></li>\n<li>\n<p>G1</p>\n</li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li>\n<p>G1GCSTW</p>\n</li>\n<li>\n<p><strong></strong></p>\n<ul>\n<li>G1EdenSurvivorEden</li>\n<li>Region,</li>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>CMS-GC</li>\n<li>G1regionregionRegion-Mark-Compact GCJavaG1</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>G1</li>\n<li>G1  Region Region G1 </li>\n<li>CMS GCG1CMS</li>\n</ul>\n</li>\n</ul>\n<p><strong>G1FootprintOverloadCMSCMSG1G16-8GB</strong></p>\n<p></p>\n","excerpt":"","more":"<h1></h1>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>AA A 11A 0A</p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"></h4>\n<blockquote>\n<p> GC RootsGC Roots</p>\n</blockquote>\n<p></p>\n<ul>\n<li>(GC Roots)</li>\n<li>(Reference Chain)</li>\n<li></li>\n<li></li>\n</ul>\n<p>&quot;GC Roots&quot;</p>\n<ul>\n<li></li>\n<li>java </li>\n<li></li>\n<li>JNINative</li>\n<li>JavaClass</li>\n<li></li>\n<li>javaJMXBeanJVMTI</li>\n</ul>\n<p><em></em>GCStop The World</p>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>CollectorHeader<br>\nCollectorHeader</p>\n</blockquote>\n<ul>\n<li></li>\n<li>GC</li>\n<li></li>\n</ul>\n<h4 id=\"\"></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li>G1regionGCGCregion</li>\n</ul>\n</li>\n</ul>\n<p>,</p>\n<h4 id=\"\"></h4>\n<blockquote>\n<p><br>\n</p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n<ul>\n<li>/JVM</li>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>STW</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>Java</p>\n</blockquote>\n<h4 id=\"\"></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<p></p>\n<h4 id=\"\"></h4>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"JVM\">JVM</h3>\n<h4 id=\"\"></h4>\n<p>GC<br>\n</p>\n<blockquote>\n<p>new </p>\n</blockquote>\n<h4 id=\"SoftReference-Object-obj\">SoftReference<Object>(obj);</h4>\n<p>GC<br>\n</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"WeakReference-Object-obj\">WeakReference<Object>(obj)</h4>\n<p>GC<br>\n</p>\n<blockquote>\n<p> WeakReference</p>\n</blockquote>\n<h4 id=\"PhantomReference-new-Object-new-ReferenceQueue\">PhantomReference&lt;&gt;(new Object(),new ReferenceQueue&lt;&gt;())</h4>\n<p><br>\n</p>\n<blockquote>\n<ol>\n<li></li>\n</ol>\n</blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"JVM-GC-\">JVM GC </h2>\n<blockquote>\n<p><a href=\"https://www.yuque.com/pride_yang/blog/qsgy0z#vfjXH\">JVM</a></p>\n</blockquote>\n<blockquote>\n<p>Minor GC  GC</p>\n</blockquote>\n<blockquote>\n<p>Major GC/Full GC</p>\n</blockquote>\n<ol>\n<li>eden</li>\n<li>eden</li>\n<li>edenminor GC(young GC),survivor0eden mark-sweepedenmark-copy  survivor0</li>\n<li>edenminor GCedens0s1toS0edenS0 s1edenS0minor GCedenS0</li>\n<li>edenminor GCs0s0s1edens1s0edens1edens1</li>\n<li>s0s1gc(age)3(eden,s0,s1)11+1young(-XX:MaxTenuringThreshold15)</li>\n<li>major GCFull GC--</li>\n</ol>\n<p><img src=\"/assets/net-img-1646740660775-762fcaa3-26b5-4d95-ac43-5cca58540969-20230330213439-sxz1b5i.png\" alt=\"\"></p>\n<h2 id=\"\"></h2>\n<p><img src=\".//assets/image-20231126145713-0pou43f.png\" alt=\"\"></p>\n<ol>\n<li><br>\nSerial/Serial OldSerial/CMSParNew/Serial OldParNew/CMSParallel Scavenge/Serial OldParallel Scavenge/Parallel OldG1</li>\n<li>Serial OldCMS&quot;Concurrent Mode Failure&quot;</li>\n<li>()JDK 8Serial+CMSParNew+Serial OldJEP 173JDK 9JEP214</li>\n<li>()JDK 14Parallel ScavengeSerialOld GC JEP 366</li>\n<li>()JDK 14CMS JEP 363</li>\n</ol>\n<h3 id=\"\"></h3>\n<h4 id=\"Serial--Serial-Old-\">Serial /Serial Old </h4>\n<blockquote>\n<p> </p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629558034184-e1fe6601-777e-4a34-afe5-df37e5a9b720-20230330213445-e5uive7.png\" alt=\"image.png\" title=\"\"></p>\n<h4 id=\"ParNew--Serial-Old-\">ParNew /Serial Old </h4>\n<blockquote>\n<p>CPU </p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629559055065-5ad8d49f-81b6-45f3-87f8-c98716f799ed-20230330213451-7nkjlzc.png\" alt=\"image.png\" title=\"\"></p>\n<h4 id=\"Parallel-Scavenge-Parallel-Old\">Parallel Scavenge/Parallel Old</h4>\n<blockquote>\n<p> jdk8</p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629559366006-0194df18-86f2-45fd-bd85-6f675b19bdb0-20230330213459-p7i5mm5.png\" alt=\"image.png\" title=\"\"></p>\n<h4 id=\"CMS\">CMS</h4>\n<blockquote>\n<p>CMSMark-Sweep</p>\n<p>CMSMark-CompactSerial OldConcurrent Mode FailureSerial OldFull GC</p>\n</blockquote>\n<p><img src=\"/assets/net-img-1629560137959-ab93eb78-c083-4c80-8283-4cfc470c8af0-20230330213504-cteixk9.png\" alt=\"image.png\" title=\"\"></p>\n<ul>\n<li>STWGC Roots</li>\n<li>GC Roots</li>\n<li>STW</li>\n<li></li>\n</ul>\n<h4 id=\"G1-\">G1 </h4>\n<blockquote>\n<p>CPUGCJDK9 </p>\n</blockquote>\n<p><img src=\"/assets/image-20231126155909-4zbslm1.png\" alt=\"\"></p>\n<h5 id=\"\"></h5>\n<ol>\n<li>\n<p>GC Young GC</p>\n<ol>\n<li></li>\n</ol>\n</li>\n<li>\n<p> Concurrent Marking</p>\n</li>\n<li>\n<p>Mixed GC</p>\n</li>\n<li>\n<p>Full GCGC</p>\n</li>\n</ol>\n<p><img src=\"/assets/image-20231126161709-b35di3t.png\" alt=\" (2)\"></p>\n<p>young gc -&gt; young gc + concurrent mark-&gt; Mixed GC</p>\n<h5 id=\"\"></h5>\n<ul>\n<li></li>\n<li>\n<p>G1</p>\n</li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li>\n<p>G1GCSTW</p>\n</li>\n<li>\n<p><strong></strong></p>\n<ul>\n<li>G1EdenSurvivorEden</li>\n<li>Region,</li>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>CMS-GC</li>\n<li>G1regionregionRegion-Mark-Compact GCJavaG1</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>G1</li>\n<li>G1  Region Region G1 </li>\n<li>CMS GCG1CMS</li>\n</ul>\n</li>\n</ul>\n<p><strong>G1FootprintOverloadCMSCMSG1G16-8GB</strong></p>\n<p></p>\n"},{"title":"","date":"2022-10-30T05:40:27.000Z","lastmod":"2023-11-25T05:15:42.000Z","_content":"\n# \n\n## \n\n![](/assets/image-20231119154230-3g5nidd.png)\n\n![](/assets/image-20231119154304-hwfdw8h.jpeg)\n\n### \n\n>  \n\njava \n\n\n### Java\n\n> Java\n\nJava[(1)](https://www.yuque.com/pride_yang/blog/gngtxy)  \n\n\njavabooleanbytecharshortintfloatdubbolongreferencereturnAddress\n\n**slot**  64long double  \n\n  \nJava  StackOverflowErrorOutOfMemoryError  \n\n### \n\n>  Native   Native Method  java  java \n\n**HotSpot**\n\n```bash\n-Xss  jdk11 windows 180k Linux228k \n```\n\n### Java\n\n> \n\n- javaGCG1EdenFrom SurvivorTo Survivor\n- javaTLAB\n\n```bash\n-Xmx \n-Xms \n-XX:+HeapDumpOnOutOfMemoryError OOMdump\n-XX:HeapDumpPath=./ \n```\n\n#### jvm\n\n![](/assets/net-img-1646742883104-4eef3a95-3655-44f4-8887-2f5f1628732e-20230330213506-2xv20ln.png)\n  \n  \neden 8/10 \nsurvivor0 : 1/10 \nsurvivor1 : 1/10 from \n\n****\n\n  \n jdk 1.7 \n\nJDK8 \n\n#### gc\n\n##### MinorGC\n\n* Minor GCEdenSurvivorGC Minor GC )\n*  Java  Minor GC \n* Minor GCSTW\n\n##### MajorGC\n\n* GCMajor GCFull GC\n\n  * Major GCMinor GCParallel ScavengeMajor GC\n  * Minor GCMajor GC\n\n* Major GCMinor GC10STW\n\n* Major GC OOM\n\n##### FullGC\n\n* System.gc()Full GC\n* \n* \n* Minor GC\n* Edensurvivor space0From Spacesurvivor space1To SpaceTo Space\n\n### \n\n> \n\n#### \n\n* \n* \n\n  * public, private, protected, static, final, volatile, transient\n* \n\n  * \n  * ( void)\n  * ()\n  * (public, private, protected, static, final, synchronized, native, abstract)\n  * (bytecodes) abstractnative\n  * abstractnative\n\n    * \n* non-final\n* \n\n**HotSpotjdk1.8 jdk7**\n\n**20m**\n\n```bash\n-XX:MaxMetaspaceSize -1 \n-XX:MetaspaceSize  \n-MinMetaspaceFreeRatio\n-MinMetaspaceFreeRatio\n```\n\n#### \n\n>   \n> ****\n\n** **\n\n### ()\n\n```bash\n-XX:MaxDirectMemorySize  java\n```\n\n##\n","source":"_posts/java/JVM/.md","raw":"---\ntitle: \ndate: 2022-10-30T13:40:27Z\nlastmod: 2023-11-25T13:15:42Z\n---\n\n# \n\n## \n\n![](/assets/image-20231119154230-3g5nidd.png)\n\n![](/assets/image-20231119154304-hwfdw8h.jpeg)\n\n### \n\n>  \n\njava \n\n\n### Java\n\n> Java\n\nJava[(1)](https://www.yuque.com/pride_yang/blog/gngtxy)  \n\n\njavabooleanbytecharshortintfloatdubbolongreferencereturnAddress\n\n**slot**  64long double  \n\n  \nJava  StackOverflowErrorOutOfMemoryError  \n\n### \n\n>  Native   Native Method  java  java \n\n**HotSpot**\n\n```bash\n-Xss  jdk11 windows 180k Linux228k \n```\n\n### Java\n\n> \n\n- javaGCG1EdenFrom SurvivorTo Survivor\n- javaTLAB\n\n```bash\n-Xmx \n-Xms \n-XX:+HeapDumpOnOutOfMemoryError OOMdump\n-XX:HeapDumpPath=./ \n```\n\n#### jvm\n\n![](/assets/net-img-1646742883104-4eef3a95-3655-44f4-8887-2f5f1628732e-20230330213506-2xv20ln.png)\n  \n  \neden 8/10 \nsurvivor0 : 1/10 \nsurvivor1 : 1/10 from \n\n****\n\n  \n jdk 1.7 \n\nJDK8 \n\n#### gc\n\n##### MinorGC\n\n* Minor GCEdenSurvivorGC Minor GC )\n*  Java  Minor GC \n* Minor GCSTW\n\n##### MajorGC\n\n* GCMajor GCFull GC\n\n  * Major GCMinor GCParallel ScavengeMajor GC\n  * Minor GCMajor GC\n\n* Major GCMinor GC10STW\n\n* Major GC OOM\n\n##### FullGC\n\n* System.gc()Full GC\n* \n* \n* Minor GC\n* Edensurvivor space0From Spacesurvivor space1To SpaceTo Space\n\n### \n\n> \n\n#### \n\n* \n* \n\n  * public, private, protected, static, final, volatile, transient\n* \n\n  * \n  * ( void)\n  * ()\n  * (public, private, protected, static, final, synchronized, native, abstract)\n  * (bytecodes) abstractnative\n  * abstractnative\n\n    * \n* non-final\n* \n\n**HotSpotjdk1.8 jdk7**\n\n**20m**\n\n```bash\n-XX:MaxMetaspaceSize -1 \n-XX:MetaspaceSize  \n-MinMetaspaceFreeRatio\n-MinMetaspaceFreeRatio\n```\n\n#### \n\n>   \n> ****\n\n** **\n\n### ()\n\n```bash\n-XX:MaxDirectMemorySize  java\n```\n\n##\n","slug":"java-JVM-","published":1,"updated":"2025-04-28T08:41:48.393Z","_id":"cm9s3f40l0031bfg4az7cd8y2","comments":1,"layout":"post","photos":[],"content":"<h1></h1>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/image-20231119154230-3g5nidd.png\" alt=\"\"></p>\n<p><img src=\"/assets/image-20231119154304-hwfdw8h.jpeg\" alt=\"\"></p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p> </p>\n</blockquote>\n<p>java <br>\n</p>\n<h3 id=\"Java\">Java</h3>\n<blockquote>\n<p>Java</p>\n</blockquote>\n<p>Java<a href=\"https://www.yuque.com/pride_yang/blog/gngtxy\">(1)</a><br>\n</p>\n<p>javabooleanbytecharshortintfloatdubbolongreferencereturnAddress</p>\n<p><strong>slot</strong>  64long double  </p>\n<p><br>\nJava  StackOverflowErrorOutOfMemoryError</p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p> Native   Native Method  java  java </p>\n</blockquote>\n<p><strong>HotSpot</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xss  jdk11 windows 180k Linux228k </span><br></pre></td></tr></table></figure>\n<h3 id=\"Java\">Java</h3>\n<blockquote>\n<p></p>\n</blockquote>\n<ul>\n<li>javaGCG1EdenFrom SurvivorTo Survivor</li>\n<li>javaTLAB</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xmx </span><br><span class=\"line\">-Xms </span><br><span class=\"line\">-XX:+HeapDumpOnOutOfMemoryError OOMdump</span><br><span class=\"line\">-XX:HeapDumpPath=./ </span><br></pre></td></tr></table></figure>\n<h4 id=\"jvm\">jvm</h4>\n<p><img src=\"/assets/net-img-1646742883104-4eef3a95-3655-44f4-8887-2f5f1628732e-20230330213506-2xv20ln.png\" alt=\"\"><br>\n  <br>\n  <br>\neden 8/10 <br>\nsurvivor0 : 1/10 <br>\nsurvivor1 : 1/10 from </p>\n<p><strong></strong></p>\n<p> jdk 1.7 </p>\n<p>JDK8 </p>\n<h4 id=\"gc\">gc</h4>\n<h5 id=\"MinorGC\">MinorGC</h5>\n<ul>\n<li>Minor GCEdenSurvivorGC Minor GC )</li>\n<li> Java  Minor GC </li>\n<li>Minor GCSTW</li>\n</ul>\n<h5 id=\"MajorGC\">MajorGC</h5>\n<ul>\n<li>\n<p>GCMajor GCFull GC</p>\n<ul>\n<li>Major GCMinor GCParallel ScavengeMajor GC</li>\n<li>Minor GCMajor GC</li>\n</ul>\n</li>\n<li>\n<p>Major GCMinor GC10STW</p>\n</li>\n<li>\n<p>Major GC OOM</p>\n</li>\n</ul>\n<h5 id=\"FullGC\">FullGC</h5>\n<ul>\n<li>System.gc()Full GC</li>\n<li></li>\n<li></li>\n<li>Minor GC</li>\n<li>Edensurvivor space0From Spacesurvivor space1To SpaceTo Space</li>\n</ul>\n<h3 id=\"\"></h3>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"\"></h4>\n<ul>\n<li>\n<p></p>\n</li>\n<li>\n<p></p>\n<ul>\n<li>public, private, protected, static, final, volatile, transient</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>\n<p></p>\n</li>\n<li>\n<p>( void)</p>\n</li>\n<li>\n<p>()</p>\n</li>\n<li>\n<p>(public, private, protected, static, final, synchronized, native, abstract)</p>\n</li>\n<li>\n<p>(bytecodes) abstractnative</p>\n</li>\n<li>\n<p>abstractnative</p>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>non-final</p>\n</li>\n<li>\n<p></p>\n</li>\n</ul>\n<p><strong>HotSpotjdk1.8 jdk7</strong></p>\n<p><strong>20m</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-XX:MaxMetaspaceSize -1 </span><br><span class=\"line\">-XX:MetaspaceSize  </span><br><span class=\"line\">-MinMetaspaceFreeRatio</span><br><span class=\"line\">-MinMetaspaceFreeRatio</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<blockquote>\n<p><br>\n<strong></strong></p>\n</blockquote>\n<p><strong> </strong></p>\n<h3 id=\"-\">()</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-XX:MaxDirectMemorySize  java</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n","excerpt":"","more":"<h1></h1>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/image-20231119154230-3g5nidd.png\" alt=\"\"></p>\n<p><img src=\"/assets/image-20231119154304-hwfdw8h.jpeg\" alt=\"\"></p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p> </p>\n</blockquote>\n<p>java <br>\n</p>\n<h3 id=\"Java\">Java</h3>\n<blockquote>\n<p>Java</p>\n</blockquote>\n<p>Java<a href=\"https://www.yuque.com/pride_yang/blog/gngtxy\">(1)</a><br>\n</p>\n<p>javabooleanbytecharshortintfloatdubbolongreferencereturnAddress</p>\n<p><strong>slot</strong>  64long double  </p>\n<p><br>\nJava  StackOverflowErrorOutOfMemoryError</p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p> Native   Native Method  java  java </p>\n</blockquote>\n<p><strong>HotSpot</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xss  jdk11 windows 180k Linux228k </span><br></pre></td></tr></table></figure>\n<h3 id=\"Java\">Java</h3>\n<blockquote>\n<p></p>\n</blockquote>\n<ul>\n<li>javaGCG1EdenFrom SurvivorTo Survivor</li>\n<li>javaTLAB</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Xmx </span><br><span class=\"line\">-Xms </span><br><span class=\"line\">-XX:+HeapDumpOnOutOfMemoryError OOMdump</span><br><span class=\"line\">-XX:HeapDumpPath=./ </span><br></pre></td></tr></table></figure>\n<h4 id=\"jvm\">jvm</h4>\n<p><img src=\"/assets/net-img-1646742883104-4eef3a95-3655-44f4-8887-2f5f1628732e-20230330213506-2xv20ln.png\" alt=\"\"><br>\n  <br>\n  <br>\neden 8/10 <br>\nsurvivor0 : 1/10 <br>\nsurvivor1 : 1/10 from </p>\n<p><strong></strong></p>\n<p> jdk 1.7 </p>\n<p>JDK8 </p>\n<h4 id=\"gc\">gc</h4>\n<h5 id=\"MinorGC\">MinorGC</h5>\n<ul>\n<li>Minor GCEdenSurvivorGC Minor GC )</li>\n<li> Java  Minor GC </li>\n<li>Minor GCSTW</li>\n</ul>\n<h5 id=\"MajorGC\">MajorGC</h5>\n<ul>\n<li>\n<p>GCMajor GCFull GC</p>\n<ul>\n<li>Major GCMinor GCParallel ScavengeMajor GC</li>\n<li>Minor GCMajor GC</li>\n</ul>\n</li>\n<li>\n<p>Major GCMinor GC10STW</p>\n</li>\n<li>\n<p>Major GC OOM</p>\n</li>\n</ul>\n<h5 id=\"FullGC\">FullGC</h5>\n<ul>\n<li>System.gc()Full GC</li>\n<li></li>\n<li></li>\n<li>Minor GC</li>\n<li>Edensurvivor space0From Spacesurvivor space1To SpaceTo Space</li>\n</ul>\n<h3 id=\"\"></h3>\n<blockquote>\n<p></p>\n</blockquote>\n<h4 id=\"\"></h4>\n<ul>\n<li>\n<p></p>\n</li>\n<li>\n<p></p>\n<ul>\n<li>public, private, protected, static, final, volatile, transient</li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>\n<p></p>\n</li>\n<li>\n<p>( void)</p>\n</li>\n<li>\n<p>()</p>\n</li>\n<li>\n<p>(public, private, protected, static, final, synchronized, native, abstract)</p>\n</li>\n<li>\n<p>(bytecodes) abstractnative</p>\n</li>\n<li>\n<p>abstractnative</p>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>non-final</p>\n</li>\n<li>\n<p></p>\n</li>\n</ul>\n<p><strong>HotSpotjdk1.8 jdk7</strong></p>\n<p><strong>20m</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-XX:MaxMetaspaceSize -1 </span><br><span class=\"line\">-XX:MetaspaceSize  </span><br><span class=\"line\">-MinMetaspaceFreeRatio</span><br><span class=\"line\">-MinMetaspaceFreeRatio</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<blockquote>\n<p><br>\n<strong></strong></p>\n</blockquote>\n<p><strong> </strong></p>\n<h3 id=\"-\">()</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-XX:MaxDirectMemorySize  java</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n"},{"title":"Filter","date":"2022-10-30T05:27:28.000Z","lastmod":"2022-10-30T05:27:28.000Z","_content":"\n# Filter\n\n### \n\nFilterdoFilter\n\n#### doFilter\n\n- ServletRequestHTTPgetHeadergetCookiesServletRequest HttpServletRequest\n- ServletResponse\n  -  servletJSPresponse.getWriter\n  - servlet JSPserlvetJSP \n- FilterChaindoFilterservletJSPdoFilterservletJSP\n","source":"_posts/java/JavaWeb/Filter.md","raw":"---\ntitle: Filter\ndate: 2022-10-30T13:27:28Z\nlastmod: 2022-10-30T13:27:28Z\n---\n\n# Filter\n\n### \n\nFilterdoFilter\n\n#### doFilter\n\n- ServletRequestHTTPgetHeadergetCookiesServletRequest HttpServletRequest\n- ServletResponse\n  -  servletJSPresponse.getWriter\n  - servlet JSPserlvetJSP \n- FilterChaindoFilterservletJSPdoFilterservletJSP\n","slug":"java-JavaWeb-Filter","published":1,"updated":"2025-04-20T00:08:55.554Z","_id":"cm9s3f40m0032bfg40x2w6zz5","comments":1,"layout":"post","photos":[],"content":"<h1>Filter</h1>\n<h3 id=\"\"></h3>\n<p>FilterdoFilter</p>\n<h4 id=\"doFilter\">doFilter</h4>\n<ul>\n<li>ServletRequestHTTPgetHeadergetCookiesServletRequest HttpServletRequest</li>\n<li>ServletResponse\n<ul>\n<li> servletJSPresponse.getWriter</li>\n<li>servlet JSPserlvetJSP </li>\n</ul>\n</li>\n<li>FilterChaindoFilterservletJSPdoFilterservletJSP</li>\n</ul>\n","excerpt":"","more":"<h1>Filter</h1>\n<h3 id=\"\"></h3>\n<p>FilterdoFilter</p>\n<h4 id=\"doFilter\">doFilter</h4>\n<ul>\n<li>ServletRequestHTTPgetHeadergetCookiesServletRequest HttpServletRequest</li>\n<li>ServletResponse\n<ul>\n<li> servletJSPresponse.getWriter</li>\n<li>servlet JSPserlvetJSP </li>\n</ul>\n</li>\n<li>FilterChaindoFilterservletJSPdoFilterservletJSP</li>\n</ul>\n"},{"title":"","date":"2023-05-14T14:53:28.000Z","lastmod":"2023-05-27T07:18:35.000Z","_content":"\n# \n\n 7 \n\n* // synchronized  mark word \n\n  * \n\n    * \n  * \n\n    * \n  * \n\n    * JVM synchronized  CAS \n* /\n\n  * \n  * \n* /\n\n  * \n  * \n* /\n\n  * \n  * \n* /\n\n  * \n  *  CAS \n* /\n\n  *  CPU \n  * \n* /\n\n  *  Java synchronized  ReentrantLock  lockInterruptibly \n\n## Synchronized\n\n### :\n\nmonitormonitormonitorentermonitorexitmonitorentermonitorexitmonitorentermonitormonitor0\n\nSynchronizedSynchronizedClass\n\n**Synchronized**\n\n0CASIDID0IDIDstatus1status1status0\n\n### \n\n**jvmclass pointer 4**  \n markword  instance data  padding 8  \n![image.png](/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20221030135532-u420fpk.png)  \n  \n![image.png](/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20221030135532-6itdbiz.png)\n\n### \n\nMONITORENTER \nMONITOREXIT \njvm\n\n### \n\n|||25||31|||1|4bit|1bit|2bit||\n| --------------| -| -----------------------------| -| ----------------------| -| -----| ------| --------| ----------------| ----------| -|\n|new||unused||hashcode|||unused||0|0|1|\n|||||||||||||\n|||54||||2|1|4bit|1bit|2bit||\n|||||||Epoch|unused||1|0|1|\n|||||||||||||\n|||62||||||||2bit||\n|||Lock Record||||||||0|0|\n|||||||||||1|0|\n|GC||CMS||||||||1|1|\n\n![image.png](/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20221030135532-iwc3p25.png)\n\n#### (hashcodeLock Record)\n\n1. new\n2. id\n3. CASCASCPU\n4. jdk1.610CPU jvm\n\nCPU\n\n#### \n\njvmjvmforappend\n\n#### \n\njvmStringBufferappend\n\n## \n\n![1-12.png](/assets/net-img-1582875478351-18a69ed7-cb09-4a5a-a020-097490219718-20221030135517-0h9pq4n.png)\n\n```\nLockReadWriteLock\nLock  ReentrantLockReadLockWriteLock\nReadWriteLock ReentrantReadWriteLock\n```\n\n### Lock \n\n#### ReentrantLock\n\nReentrantLock\n\n```java\n\t//boolean,truecreatefalse\n        ReentrantLock(boolean fair) \n  \n\t//\n\tint getQueueLength()\n\n\t//\n\tboolean hasQueuedThreads()\n\n\t//\n\tboolean hasQueuedThread(Thread thread)\n\n\t//0\n\tint getHoldCount()\n\n\t//\n\tboolean isLocked()\n\t \n\t //\n\tboolean isFair() \n\n```\n\nCondition \n\n```java\npublic interface Condition {\n\t/**\n\t*Condition,signal()signalAll()\n\t*\n\t*Lockawait()ReentrantLock\n\t*Conditionwaitlock.lock\n\t*/\n    void await() throws InterruptedException;\n\n    //Condition,signal()signalAll()\n    void awaitUninterruptibly();\n\n    //await()\n    long awaitNanos(long nanosTimeout) throws InterruptedException;\n\n\t//awaitNanos(long nanosTimeout);truefalse\n    boolean await(long time, TimeUnit unit) throws InterruptedException;\n\n   //await(long time, TimeUnit unit) \n    boolean awaitUntil(Date deadline) throws InterruptedException;\n\n   //\n    void signal();\n\n    //\n    void signalAll();\n}\n\n```\n\n> ConditionLocknewCondition()ConditionCondition\n\n> ReentrantLock.Condition  \n> \t1. **ReentrantLock.Conditionsignal()await()signalAll()lock()**[unlock()]Objectnotify()wait()notifyAll()ObjectsynchronizedIllegalMonitorStateException  \n> \t2. **ReentrantLock.Conditionsignal()await()signalAll()Objectnotify()wait()notifyAll()IllegalMonitorStateException`;\n\n#### ReentrantReadWriteLock\n\n##### \n\n(volatile)3216161616\n\n*   \n          (0)  \n  ReentrantLock\n\n*   \n         1stateThreadLocal  \n  \n\n##### \n\n\n\n## \n\n### CAS Compare and Swap\n\nCAS\n\nCAS\n\n\ti k kii \n\n\n\n### \n\n> \n\n![image](/assets/image-20230527140729-waan312.png)\n\n  CPU  \n\n CPU  CPU \n\n* \n\n  *  Runnable \n\n* \n\n  * \n\n### \n\n\n\n****\n\n**ABA**\n\n### \n\n CPU \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## \n\n### Synchronized  Lock \n\n```\nsynchronizedjavajvmLockjava\nsynchronizedLock\nsynchronized(a b )Lockfinallyunlock()\nsynchronized121212Lock\nsynchronizedLock\nLocksynchronized\n```\n\n\n","source":"_posts/java/thread/.md","raw":"---\ntitle: \ndate: 2023-05-14T22:53:28Z\nlastmod: 2023-05-27T15:18:35Z\n---\n\n# \n\n 7 \n\n* // synchronized  mark word \n\n  * \n\n    * \n  * \n\n    * \n  * \n\n    * JVM synchronized  CAS \n* /\n\n  * \n  * \n* /\n\n  * \n  * \n* /\n\n  * \n  * \n* /\n\n  * \n  *  CAS \n* /\n\n  *  CPU \n  * \n* /\n\n  *  Java synchronized  ReentrantLock  lockInterruptibly \n\n## Synchronized\n\n### :\n\nmonitormonitormonitorentermonitorexitmonitorentermonitorexitmonitorentermonitormonitor0\n\nSynchronizedSynchronizedClass\n\n**Synchronized**\n\n0CASIDID0IDIDstatus1status1status0\n\n### \n\n**jvmclass pointer 4**  \n markword  instance data  padding 8  \n![image.png](/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20221030135532-u420fpk.png)  \n  \n![image.png](/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20221030135532-6itdbiz.png)\n\n### \n\nMONITORENTER \nMONITOREXIT \njvm\n\n### \n\n|||25||31|||1|4bit|1bit|2bit||\n| --------------| -| -----------------------------| -| ----------------------| -| -----| ------| --------| ----------------| ----------| -|\n|new||unused||hashcode|||unused||0|0|1|\n|||||||||||||\n|||54||||2|1|4bit|1bit|2bit||\n|||||||Epoch|unused||1|0|1|\n|||||||||||||\n|||62||||||||2bit||\n|||Lock Record||||||||0|0|\n|||||||||||1|0|\n|GC||CMS||||||||1|1|\n\n![image.png](/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20221030135532-iwc3p25.png)\n\n#### (hashcodeLock Record)\n\n1. new\n2. id\n3. CASCASCPU\n4. jdk1.610CPU jvm\n\nCPU\n\n#### \n\njvmjvmforappend\n\n#### \n\njvmStringBufferappend\n\n## \n\n![1-12.png](/assets/net-img-1582875478351-18a69ed7-cb09-4a5a-a020-097490219718-20221030135517-0h9pq4n.png)\n\n```\nLockReadWriteLock\nLock  ReentrantLockReadLockWriteLock\nReadWriteLock ReentrantReadWriteLock\n```\n\n### Lock \n\n#### ReentrantLock\n\nReentrantLock\n\n```java\n\t//boolean,truecreatefalse\n        ReentrantLock(boolean fair) \n  \n\t//\n\tint getQueueLength()\n\n\t//\n\tboolean hasQueuedThreads()\n\n\t//\n\tboolean hasQueuedThread(Thread thread)\n\n\t//0\n\tint getHoldCount()\n\n\t//\n\tboolean isLocked()\n\t \n\t //\n\tboolean isFair() \n\n```\n\nCondition \n\n```java\npublic interface Condition {\n\t/**\n\t*Condition,signal()signalAll()\n\t*\n\t*Lockawait()ReentrantLock\n\t*Conditionwaitlock.lock\n\t*/\n    void await() throws InterruptedException;\n\n    //Condition,signal()signalAll()\n    void awaitUninterruptibly();\n\n    //await()\n    long awaitNanos(long nanosTimeout) throws InterruptedException;\n\n\t//awaitNanos(long nanosTimeout);truefalse\n    boolean await(long time, TimeUnit unit) throws InterruptedException;\n\n   //await(long time, TimeUnit unit) \n    boolean awaitUntil(Date deadline) throws InterruptedException;\n\n   //\n    void signal();\n\n    //\n    void signalAll();\n}\n\n```\n\n> ConditionLocknewCondition()ConditionCondition\n\n> ReentrantLock.Condition  \n> \t1. **ReentrantLock.Conditionsignal()await()signalAll()lock()**[unlock()]Objectnotify()wait()notifyAll()ObjectsynchronizedIllegalMonitorStateException  \n> \t2. **ReentrantLock.Conditionsignal()await()signalAll()Objectnotify()wait()notifyAll()IllegalMonitorStateException`;\n\n#### ReentrantReadWriteLock\n\n##### \n\n(volatile)3216161616\n\n*   \n          (0)  \n  ReentrantLock\n\n*   \n         1stateThreadLocal  \n  \n\n##### \n\n\n\n## \n\n### CAS Compare and Swap\n\nCAS\n\nCAS\n\n\ti k kii \n\n\n\n### \n\n> \n\n![image](/assets/image-20230527140729-waan312.png)\n\n  CPU  \n\n CPU  CPU \n\n* \n\n  *  Runnable \n\n* \n\n  * \n\n### \n\n\n\n****\n\n**ABA**\n\n### \n\n CPU \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## \n\n### Synchronized  Lock \n\n```\nsynchronizedjavajvmLockjava\nsynchronizedLock\nsynchronized(a b )Lockfinallyunlock()\nsynchronized121212Lock\nsynchronizedLock\nLocksynchronized\n```\n\n\n","slug":"java-thread-","published":1,"updated":"2025-04-28T08:41:48.396Z","_id":"cm9s3f40n0033bfg4c8u83b89","comments":1,"layout":"post","photos":[],"content":"<h1></h1>\n<p> 7 </p>\n<ul>\n<li>\n<p>// synchronized  mark word </p>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>JVM synchronized  CAS </li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li> CAS </li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li> CPU </li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li> Java synchronized  ReentrantLock  lockInterruptibly </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Synchronized\">Synchronized</h2>\n<h3 id=\"\">:</h3>\n<p>monitormonitormonitorentermonitorexitmonitorentermonitorexitmonitorentermonitormonitor0</p>\n<p>SynchronizedSynchronizedClass</p>\n<p><strong>Synchronized</strong></p>\n<p>0CASIDID0IDIDstatus1status1status0</p>\n<h3 id=\"\"></h3>\n<p><strong>jvmclass pointer 4</strong><br>\n markword  instance data  padding 8<br>\n<img src=\"/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20221030135532-u420fpk.png\" alt=\"image.png\"><br>\n<br>\n<img src=\"/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20221030135532-6itdbiz.png\" alt=\"image.png\"></p>\n<h3 id=\"\"></h3>\n<p>MONITORENTER <br>\nMONITOREXIT <br>\njvm</p>\n<h3 id=\"\"></h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th>25</th>\n<th></th>\n<th>31</th>\n<th></th>\n<th></th>\n<th>1</th>\n<th>4bit</th>\n<th>1bit</th>\n<th>2bit</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>new</td>\n<td></td>\n<td>unused</td>\n<td></td>\n<td>hashcode</td>\n<td></td>\n<td></td>\n<td>unused</td>\n<td></td>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>54</td>\n<td></td>\n<td></td>\n<td></td>\n<td>2</td>\n<td>1</td>\n<td>4bit</td>\n<td>1bit</td>\n<td>2bit</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>Epoch</td>\n<td>unused</td>\n<td></td>\n<td>1</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>62</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>2bit</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>Lock Record</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>1</td>\n<td>0</td>\n</tr>\n<tr>\n<td>GC</td>\n<td></td>\n<td>CMS</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>1</td>\n<td>1</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20221030135532-iwc3p25.png\" alt=\"image.png\"></p>\n<h4 id=\"-hashcodeLock-Record\">(hashcodeLock Record)</h4>\n<ol>\n<li>new</li>\n<li>id</li>\n<li>CASCASCPU</li>\n<li>jdk1.610CPU jvm</li>\n</ol>\n<p>CPU</p>\n<h4 id=\"\"></h4>\n<p>jvmjvmforappend</p>\n<h4 id=\"\"></h4>\n<p>jvmStringBufferappend</p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1582875478351-18a69ed7-cb09-4a5a-a020-097490219718-20221030135517-0h9pq4n.png\" alt=\"1-12.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LockReadWriteLock</span><br><span class=\"line\">Lock  ReentrantLockReadLockWriteLock</span><br><span class=\"line\">ReadWriteLock ReentrantReadWriteLock</span><br></pre></td></tr></table></figure>\n<h3 id=\"Lock-\">Lock </h3>\n<h4 id=\"ReentrantLock\">ReentrantLock</h4>\n<p>ReentrantLock</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//boolean,truecreatefalse</span></span><br><span class=\"line\">       ReentrantLock(<span class=\"type\">boolean</span> fair) </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">getQueueLength</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">hasQueuedThreads</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">hasQueuedThread</span><span class=\"params\">(Thread thread)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//0</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">getHoldCount</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">isLocked</span><span class=\"params\">()</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">isFair</span><span class=\"params\">()</span> </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Condition </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Condition</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t*Condition,signal()signalAll()</span></span><br><span class=\"line\"><span class=\"comment\">\t*</span></span><br><span class=\"line\"><span class=\"comment\">\t*Lockawait()ReentrantLock</span></span><br><span class=\"line\"><span class=\"comment\">\t*Conditionwaitlock.lock</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">await</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Condition,signal()signalAll()</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">awaitUninterruptibly</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//await()</span></span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"title function_\">awaitNanos</span><span class=\"params\">(<span class=\"type\">long</span> nanosTimeout)</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//awaitNanos(long nanosTimeout);truefalse</span></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">await</span><span class=\"params\">(<span class=\"type\">long</span> time, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//await(long time, TimeUnit unit) </span></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">awaitUntil</span><span class=\"params\">(Date deadline)</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">signal</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">signalAll</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ConditionLocknewCondition()ConditionCondition</p>\n</blockquote>\n<blockquote>\n<p>ReentrantLock.Condition</p>\n<ol>\n<li><strong>ReentrantLock.Conditionsignal()await()signalAll()lock()</strong>[unlock()]Objectnotify()wait()notifyAll()ObjectsynchronizedIllegalMonitorStateException</li>\n<li>**ReentrantLock.Conditionsignal()await()signalAll()Objectnotify()wait()notifyAll()IllegalMonitorStateException`;</li>\n</ol>\n</blockquote>\n<h4 id=\"ReentrantReadWriteLock\">ReentrantReadWriteLock</h4>\n<h5 id=\"\"></h5>\n<p>(volatile)3216161616</p>\n<ul>\n<li>\n<p><br>\n(0)<br>\nReentrantLock</p>\n</li>\n<li>\n<p><br>\n1stateThreadLocal<br>\n</p>\n</li>\n</ul>\n<h5 id=\"\"></h5>\n<p></p>\n<h2 id=\"\"></h2>\n<h3 id=\"CAS-Compare-and-Swap\">CAS Compare and Swap</h3>\n<p>CAS</p>\n<p>CAS</p>\n<p>i k kii </p>\n<p></p>\n<h3 id=\"-2\"></h3>\n<blockquote>\n<p></p>\n</blockquote>\n<p><img src=\"/assets/image-20230527140729-waan312.png\" alt=\"image\"></p>\n<p>  CPU  </p>\n<p> CPU  CPU </p>\n<ul>\n<li>\n<p></p>\n<ul>\n<li> Runnable </li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<p></p>\n<p><strong></strong></p>\n<p><strong>ABA</strong></p>\n<h3 id=\"\"></h3>\n<p> CPU </p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<h2 id=\"\"></h2>\n<h3 id=\"Synchronized--Lock-\">Synchronized  Lock </h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">synchronizedjavajvmLockjava</span><br><span class=\"line\">synchronizedLock</span><br><span class=\"line\">synchronized(a b )Lockfinallyunlock()</span><br><span class=\"line\">synchronized121212Lock</span><br><span class=\"line\">synchronizedLock</span><br><span class=\"line\">Locksynchronized</span><br></pre></td></tr></table></figure>\n<p></p>\n","excerpt":"","more":"<h1></h1>\n<p> 7 </p>\n<ul>\n<li>\n<p>// synchronized  mark word </p>\n<ul>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li>JVM synchronized  CAS </li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li></li>\n<li> CAS </li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li> CPU </li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>/</p>\n<ul>\n<li> Java synchronized  ReentrantLock  lockInterruptibly </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Synchronized\">Synchronized</h2>\n<h3 id=\"\">:</h3>\n<p>monitormonitormonitorentermonitorexitmonitorentermonitorexitmonitorentermonitormonitor0</p>\n<p>SynchronizedSynchronizedClass</p>\n<p><strong>Synchronized</strong></p>\n<p>0CASIDID0IDIDstatus1status1status0</p>\n<h3 id=\"\"></h3>\n<p><strong>jvmclass pointer 4</strong><br>\n markword  instance data  padding 8<br>\n<img src=\"/assets/net-img-1615611389351-2cfaa4d5-b52c-4a2e-a170-c32ce97d17a6-20221030135532-u420fpk.png\" alt=\"image.png\"><br>\n<br>\n<img src=\"/assets/net-img-1615611419969-14ba7126-9f92-482c-a851-9898cece7e8f-20221030135532-6itdbiz.png\" alt=\"image.png\"></p>\n<h3 id=\"\"></h3>\n<p>MONITORENTER <br>\nMONITOREXIT <br>\njvm</p>\n<h3 id=\"\"></h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th>25</th>\n<th></th>\n<th>31</th>\n<th></th>\n<th></th>\n<th>1</th>\n<th>4bit</th>\n<th>1bit</th>\n<th>2bit</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>new</td>\n<td></td>\n<td>unused</td>\n<td></td>\n<td>hashcode</td>\n<td></td>\n<td></td>\n<td>unused</td>\n<td></td>\n<td>0</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>54</td>\n<td></td>\n<td></td>\n<td></td>\n<td>2</td>\n<td>1</td>\n<td>4bit</td>\n<td>1bit</td>\n<td>2bit</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>Epoch</td>\n<td>unused</td>\n<td></td>\n<td>1</td>\n<td>0</td>\n<td>1</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>62</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>2bit</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>Lock Record</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>1</td>\n<td>0</td>\n</tr>\n<tr>\n<td>GC</td>\n<td></td>\n<td>CMS</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>1</td>\n<td>1</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"/assets/net-img-1615614053644-2e45ea92-d426-42ca-a609-91b095ff7e83-20221030135532-iwc3p25.png\" alt=\"image.png\"></p>\n<h4 id=\"-hashcodeLock-Record\">(hashcodeLock Record)</h4>\n<ol>\n<li>new</li>\n<li>id</li>\n<li>CASCASCPU</li>\n<li>jdk1.610CPU jvm</li>\n</ol>\n<p>CPU</p>\n<h4 id=\"\"></h4>\n<p>jvmjvmforappend</p>\n<h4 id=\"\"></h4>\n<p>jvmStringBufferappend</p>\n<h2 id=\"\"></h2>\n<p><img src=\"/assets/net-img-1582875478351-18a69ed7-cb09-4a5a-a020-097490219718-20221030135517-0h9pq4n.png\" alt=\"1-12.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LockReadWriteLock</span><br><span class=\"line\">Lock  ReentrantLockReadLockWriteLock</span><br><span class=\"line\">ReadWriteLock ReentrantReadWriteLock</span><br></pre></td></tr></table></figure>\n<h3 id=\"Lock-\">Lock </h3>\n<h4 id=\"ReentrantLock\">ReentrantLock</h4>\n<p>ReentrantLock</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//boolean,truecreatefalse</span></span><br><span class=\"line\">       ReentrantLock(<span class=\"type\">boolean</span> fair) </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">getQueueLength</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">hasQueuedThreads</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">hasQueuedThread</span><span class=\"params\">(Thread thread)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//0</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">getHoldCount</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">isLocked</span><span class=\"params\">()</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">isFair</span><span class=\"params\">()</span> </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Condition </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Condition</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t*Condition,signal()signalAll()</span></span><br><span class=\"line\"><span class=\"comment\">\t*</span></span><br><span class=\"line\"><span class=\"comment\">\t*Lockawait()ReentrantLock</span></span><br><span class=\"line\"><span class=\"comment\">\t*Conditionwaitlock.lock</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">await</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Condition,signal()signalAll()</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">awaitUninterruptibly</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//await()</span></span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"title function_\">awaitNanos</span><span class=\"params\">(<span class=\"type\">long</span> nanosTimeout)</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//awaitNanos(long nanosTimeout);truefalse</span></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">await</span><span class=\"params\">(<span class=\"type\">long</span> time, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//await(long time, TimeUnit unit) </span></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">awaitUntil</span><span class=\"params\">(Date deadline)</span> <span class=\"keyword\">throws</span> InterruptedException;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">signal</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">signalAll</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ConditionLocknewCondition()ConditionCondition</p>\n</blockquote>\n<blockquote>\n<p>ReentrantLock.Condition</p>\n<ol>\n<li><strong>ReentrantLock.Conditionsignal()await()signalAll()lock()</strong>[unlock()]Objectnotify()wait()notifyAll()ObjectsynchronizedIllegalMonitorStateException</li>\n<li>**ReentrantLock.Conditionsignal()await()signalAll()Objectnotify()wait()notifyAll()IllegalMonitorStateException`;</li>\n</ol>\n</blockquote>\n<h4 id=\"ReentrantReadWriteLock\">ReentrantReadWriteLock</h4>\n<h5 id=\"\"></h5>\n<p>(volatile)3216161616</p>\n<ul>\n<li>\n<p><br>\n(0)<br>\nReentrantLock</p>\n</li>\n<li>\n<p><br>\n1stateThreadLocal<br>\n</p>\n</li>\n</ul>\n<h5 id=\"\"></h5>\n<p></p>\n<h2 id=\"\"></h2>\n<h3 id=\"CAS-Compare-and-Swap\">CAS Compare and Swap</h3>\n<p>CAS</p>\n<p>CAS</p>\n<p>i k kii </p>\n<p></p>\n<h3 id=\"-2\"></h3>\n<blockquote>\n<p></p>\n</blockquote>\n<p><img src=\"/assets/image-20230527140729-waan312.png\" alt=\"image\"></p>\n<p>  CPU  </p>\n<p> CPU  CPU </p>\n<ul>\n<li>\n<p></p>\n<ul>\n<li> Runnable </li>\n</ul>\n</li>\n<li>\n<p></p>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<p></p>\n<p><strong></strong></p>\n<p><strong>ABA</strong></p>\n<h3 id=\"\"></h3>\n<p> CPU </p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<h2 id=\"\"></h2>\n<h3 id=\"Synchronized--Lock-\">Synchronized  Lock </h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">synchronizedjavajvmLockjava</span><br><span class=\"line\">synchronizedLock</span><br><span class=\"line\">synchronized(a b )Lockfinallyunlock()</span><br><span class=\"line\">synchronized121212Lock</span><br><span class=\"line\">synchronizedLock</span><br><span class=\"line\">Locksynchronized</span><br></pre></td></tr></table></figure>\n<p></p>\n"},{"title":"","date":"2023-05-14T14:53:28.000Z","lastmod":"2023-05-14T14:53:28.000Z","_content":"\n#  \n\n## \n\n1. Executor \n    execute(Runnable runnable)\n2. ExecutorService \n    Executor submitinvokeAllinvokeAny  shutDown \n3. AbstractExecutorService \n    ExecutorService  ExecutorService \n4. ScheduledExecutorService \n    ExecutorService \n5. ThreadPoolExecutor \n    AbstractExecutorService executesubmitshutdownshutdownNow \n6. ScheduledThreadPoolExecutor \n    ThreadPoolExecutor  ScheduledExecutorService \n7. Executors \n   \n\n## Executor \n\nExecutor ExecutorExecutorsExecutorServiceCompletionServiceFutureCallable \n\nExecutor  executeRunnable command Runable \n\nExecutorService  Executor \n\n1. submit()FutureisDone()Futureget()Futurecancel()pending\n2. shutdown()shutdownNow()\n\n****\n\n- \n- \n  ****\n- \n- \n\n### ThreadPoolExecutor \n\n Java  ThreadPoolExecutor\n\n```java\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue<Runnable> workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler) {\n```\n\n\n\n* `corePoolSize`\n* `maximumPoolSize`\n* `workQueue` 2 \n\n  * `SynchronousQueue<Runnable>``SynchronousQueue`  `SynchronousQueue`  `maximumPoolSizes` \n  * `LinkedBlockingQueue<Runnable>` `Executors` \n* `keepAliveTime`\n* `unit` `keepAliveTime` \n* `handler` `workQueue`  `maximumPoolSize` \n\n  1.  `corePoolSize`\n  2.  `corePoolSize` ****\n  3.  `maximumPoolSize`\n  4.  `maximumPoolSize` `handler` \n* `threadFactory`\n\n### \n\n#### `ThreadPoolExecutor.AbortPolicy()`\n\n `RejectedExecutionException`\n\n#### `ThreadPoolExecutor.CallerRunsPolicy()`\n\n\n\n#### `ThreadPoolExecutor.DiscardOldestPolicy()`\n\n\n\n#### `ThreadPoolExecutor.DiscardPolicy()`\n\n\n\n### \n\n* `ArrayBlockingQueue`ArrayBlockingQueue\n* `LinkedBlockingQueue`ArrayBlockingQueueLinkedBlockingQueue\n* `SynchronousQueue`\n* `PriorityBlockingQueue`CompatorComparablePriorityBlockingQueue\n* `DelayQueue`QueueDelayQueueDelayedDelayQueue\n\n![image](/assets/image-20230519215732-zz9jpqo.png)\n\n### ExecutorService\n\nThreadPoolExecutor JavaSE  Executors Eexcutors \n\n#### newCachedThreadPool\n\n\n\n\n1. .(, Interger. MAX_VALUE)\n2. \n3.  CachedThreadPool \n\n#### newFixedThreadPool\n\n\n\n\n\n#### newSingleThreadExecutor\n\n Executor(FIFO, LIFO,)\n\n\n#### newScheduleThreadPool\n\n\n\n> FixedThreadPoolSingleThreadPoolLinkedBlockingQueueOOMChachedTheadPoolInteger.MAX_VALUEOOMScheduledThreadPoolSingleThreadScheduledPoolDelayedWorkQueueOOM\n\n## \n\n### java,blockingQueue,queue\n\n\n","source":"_posts/java/thread/.md","raw":"---\ntitle:  \ndate: 2023-05-14T22:53:28Z\nlastmod: 2023-05-14T22:53:28Z\n---\n\n#  \n\n## \n\n1. Executor \n    execute(Runnable runnable)\n2. ExecutorService \n    Executor submitinvokeAllinvokeAny  shutDown \n3. AbstractExecutorService \n    ExecutorService  ExecutorService \n4. ScheduledExecutorService \n    ExecutorService \n5. ThreadPoolExecutor \n    AbstractExecutorService executesubmitshutdownshutdownNow \n6. ScheduledThreadPoolExecutor \n    ThreadPoolExecutor  ScheduledExecutorService \n7. Executors \n   \n\n## Executor \n\nExecutor ExecutorExecutorsExecutorServiceCompletionServiceFutureCallable \n\nExecutor  executeRunnable command Runable \n\nExecutorService  Executor \n\n1. submit()FutureisDone()Futureget()Futurecancel()pending\n2. shutdown()shutdownNow()\n\n****\n\n- \n- \n  ****\n- \n- \n\n### ThreadPoolExecutor \n\n Java  ThreadPoolExecutor\n\n```java\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue<Runnable> workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler) {\n```\n\n\n\n* `corePoolSize`\n* `maximumPoolSize`\n* `workQueue` 2 \n\n  * `SynchronousQueue<Runnable>``SynchronousQueue`  `SynchronousQueue`  `maximumPoolSizes` \n  * `LinkedBlockingQueue<Runnable>` `Executors` \n* `keepAliveTime`\n* `unit` `keepAliveTime` \n* `handler` `workQueue`  `maximumPoolSize` \n\n  1.  `corePoolSize`\n  2.  `corePoolSize` ****\n  3.  `maximumPoolSize`\n  4.  `maximumPoolSize` `handler` \n* `threadFactory`\n\n### \n\n#### `ThreadPoolExecutor.AbortPolicy()`\n\n `RejectedExecutionException`\n\n#### `ThreadPoolExecutor.CallerRunsPolicy()`\n\n\n\n#### `ThreadPoolExecutor.DiscardOldestPolicy()`\n\n\n\n#### `ThreadPoolExecutor.DiscardPolicy()`\n\n\n\n### \n\n* `ArrayBlockingQueue`ArrayBlockingQueue\n* `LinkedBlockingQueue`ArrayBlockingQueueLinkedBlockingQueue\n* `SynchronousQueue`\n* `PriorityBlockingQueue`CompatorComparablePriorityBlockingQueue\n* `DelayQueue`QueueDelayQueueDelayedDelayQueue\n\n![image](/assets/image-20230519215732-zz9jpqo.png)\n\n### ExecutorService\n\nThreadPoolExecutor JavaSE  Executors Eexcutors \n\n#### newCachedThreadPool\n\n\n\n\n1. .(, Interger. MAX_VALUE)\n2. \n3.  CachedThreadPool \n\n#### newFixedThreadPool\n\n\n\n\n\n#### newSingleThreadExecutor\n\n Executor(FIFO, LIFO,)\n\n\n#### newScheduleThreadPool\n\n\n\n> FixedThreadPoolSingleThreadPoolLinkedBlockingQueueOOMChachedTheadPoolInteger.MAX_VALUEOOMScheduledThreadPoolSingleThreadScheduledPoolDelayedWorkQueueOOM\n\n## \n\n### java,blockingQueue,queue\n\n\n","slug":"java-thread-","published":1,"updated":"2025-04-28T08:41:48.396Z","_id":"cm9s3f40n0034bfg42z1u6wyi","comments":1,"layout":"post","photos":[],"content":"<h1></h1>\n<h2 id=\"\"></h2>\n<ol>\n<li>Executor <br>\n execute(Runnable runnable)</li>\n<li>ExecutorService <br>\n Executor submitinvokeAllinvokeAny  shutDown </li>\n<li>AbstractExecutorService <br>\n ExecutorService  ExecutorService </li>\n<li>ScheduledExecutorService <br>\n ExecutorService </li>\n<li>ThreadPoolExecutor <br>\n AbstractExecutorService executesubmitshutdownshutdownNow </li>\n<li>ScheduledThreadPoolExecutor <br>\n ThreadPoolExecutor  ScheduledExecutorService </li>\n<li>Executors <br>\n</li>\n</ol>\n<h2 id=\"Executor-\">Executor </h2>\n<p>Executor ExecutorExecutorsExecutorServiceCompletionServiceFutureCallable </p>\n<p>Executor  executeRunnable command Runable </p>\n<p>ExecutorService  Executor </p>\n<ol>\n<li>submit()FutureisDone()Futureget()Futurecancel()pending</li>\n<li>shutdown()shutdownNow()</li>\n</ol>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li><br>\n<strong></strong></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"ThreadPoolExecutor-\">ThreadPoolExecutor </h3>\n<p> Java  ThreadPoolExecutor</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"type\">int</span> corePoolSize,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"type\">int</span> maximumPoolSize,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"type\">long</span> keepAliveTime,</span></span><br><span class=\"line\"><span class=\"params\">                          TimeUnit unit,</span></span><br><span class=\"line\"><span class=\"params\">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class=\"line\"><span class=\"params\">                          ThreadFactory threadFactory,</span></span><br><span class=\"line\"><span class=\"params\">                          RejectedExecutionHandler handler)</span> &#123;</span><br></pre></td></tr></table></figure>\n<p></p>\n<ul>\n<li>\n<p><code>corePoolSize</code></p>\n</li>\n<li>\n<p><code>maximumPoolSize</code></p>\n</li>\n<li>\n<p><code>workQueue</code> 2 </p>\n<ul>\n<li><code>SynchronousQueue&lt;Runnable&gt;</code><code>SynchronousQueue</code>  <code>SynchronousQueue</code>  <code>maximumPoolSizes</code> </li>\n<li><code>LinkedBlockingQueue&lt;Runnable&gt;</code> <code>Executors</code> </li>\n</ul>\n</li>\n<li>\n<p><code>keepAliveTime</code></p>\n</li>\n<li>\n<p><code>unit</code> <code>keepAliveTime</code> </p>\n</li>\n<li>\n<p><code>handler</code> <code>workQueue</code>  <code>maximumPoolSize</code> </p>\n<ol>\n<li> <code>corePoolSize</code></li>\n<li> <code>corePoolSize</code> <strong></strong></li>\n<li> <code>maximumPoolSize</code></li>\n<li> <code>maximumPoolSize</code> <code>handler</code> </li>\n</ol>\n</li>\n<li>\n<p><code>threadFactory</code></p>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<h4 id=\"ThreadPoolExecutor-AbortPolicy-\"><code>ThreadPoolExecutor.AbortPolicy()</code></h4>\n<p> <code>RejectedExecutionException</code></p>\n<h4 id=\"ThreadPoolExecutor-CallerRunsPolicy-\"><code>ThreadPoolExecutor.CallerRunsPolicy()</code></h4>\n<p></p>\n<h4 id=\"ThreadPoolExecutor-DiscardOldestPolicy-\"><code>ThreadPoolExecutor.DiscardOldestPolicy()</code></h4>\n<p></p>\n<h4 id=\"ThreadPoolExecutor-DiscardPolicy-\"><code>ThreadPoolExecutor.DiscardPolicy()</code></h4>\n<p></p>\n<h3 id=\"\"></h3>\n<ul>\n<li><code>ArrayBlockingQueue</code>ArrayBlockingQueue</li>\n<li><code>LinkedBlockingQueue</code>ArrayBlockingQueueLinkedBlockingQueue</li>\n<li><code>SynchronousQueue</code></li>\n<li><code>PriorityBlockingQueue</code>CompatorComparablePriorityBlockingQueue</li>\n<li><code>DelayQueue</code>QueueDelayQueueDelayedDelayQueue</li>\n</ul>\n<p><img src=\"/assets/image-20230519215732-zz9jpqo.png\" alt=\"image\"></p>\n<h3 id=\"ExecutorService\">ExecutorService</h3>\n<p>ThreadPoolExecutor JavaSE  Executors Eexcutors </p>\n<h4 id=\"newCachedThreadPool\">newCachedThreadPool</h4>\n<p><br>\n</p>\n<ol>\n<li>.(, Interger. MAX_VALUE)</li>\n<li></li>\n<li> CachedThreadPool </li>\n</ol>\n<h4 id=\"newFixedThreadPool\">newFixedThreadPool</h4>\n<p><br>\n<br>\n</p>\n<h4 id=\"newSingleThreadExecutor\">newSingleThreadExecutor</h4>\n<p> Executor(FIFO, LIFO,)<br>\n</p>\n<h4 id=\"newScheduleThreadPool\">newScheduleThreadPool</h4>\n<p></p>\n<blockquote>\n<p>FixedThreadPoolSingleThreadPoolLinkedBlockingQueueOOMChachedTheadPoolInteger.MAX_VALUEOOMScheduledThreadPoolSingleThreadScheduledPoolDelayedWorkQueueOOM</p>\n</blockquote>\n<h2 id=\"\"></h2>\n<h3 id=\"java-blockingQueue-queue\">java,blockingQueue,queue</h3>\n<p></p>\n","excerpt":"","more":"<h1></h1>\n<h2 id=\"\"></h2>\n<ol>\n<li>Executor <br>\n execute(Runnable runnable)</li>\n<li>ExecutorService <br>\n Executor submitinvokeAllinvokeAny  shutDown </li>\n<li>AbstractExecutorService <br>\n ExecutorService  ExecutorService </li>\n<li>ScheduledExecutorService <br>\n ExecutorService </li>\n<li>ThreadPoolExecutor <br>\n AbstractExecutorService executesubmitshutdownshutdownNow </li>\n<li>ScheduledThreadPoolExecutor <br>\n ThreadPoolExecutor  ScheduledExecutorService </li>\n<li>Executors <br>\n</li>\n</ol>\n<h2 id=\"Executor-\">Executor </h2>\n<p>Executor ExecutorExecutorsExecutorServiceCompletionServiceFutureCallable </p>\n<p>Executor  executeRunnable command Runable </p>\n<p>ExecutorService  Executor </p>\n<ol>\n<li>submit()FutureisDone()Futureget()Futurecancel()pending</li>\n<li>shutdown()shutdownNow()</li>\n</ol>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li><br>\n<strong></strong></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"ThreadPoolExecutor-\">ThreadPoolExecutor </h3>\n<p> Java  ThreadPoolExecutor</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"type\">int</span> corePoolSize,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"type\">int</span> maximumPoolSize,</span></span><br><span class=\"line\"><span class=\"params\">                          <span class=\"type\">long</span> keepAliveTime,</span></span><br><span class=\"line\"><span class=\"params\">                          TimeUnit unit,</span></span><br><span class=\"line\"><span class=\"params\">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class=\"line\"><span class=\"params\">                          ThreadFactory threadFactory,</span></span><br><span class=\"line\"><span class=\"params\">                          RejectedExecutionHandler handler)</span> &#123;</span><br></pre></td></tr></table></figure>\n<p></p>\n<ul>\n<li>\n<p><code>corePoolSize</code></p>\n</li>\n<li>\n<p><code>maximumPoolSize</code></p>\n</li>\n<li>\n<p><code>workQueue</code> 2 </p>\n<ul>\n<li><code>SynchronousQueue&lt;Runnable&gt;</code><code>SynchronousQueue</code>  <code>SynchronousQueue</code>  <code>maximumPoolSizes</code> </li>\n<li><code>LinkedBlockingQueue&lt;Runnable&gt;</code> <code>Executors</code> </li>\n</ul>\n</li>\n<li>\n<p><code>keepAliveTime</code></p>\n</li>\n<li>\n<p><code>unit</code> <code>keepAliveTime</code> </p>\n</li>\n<li>\n<p><code>handler</code> <code>workQueue</code>  <code>maximumPoolSize</code> </p>\n<ol>\n<li> <code>corePoolSize</code></li>\n<li> <code>corePoolSize</code> <strong></strong></li>\n<li> <code>maximumPoolSize</code></li>\n<li> <code>maximumPoolSize</code> <code>handler</code> </li>\n</ol>\n</li>\n<li>\n<p><code>threadFactory</code></p>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<h4 id=\"ThreadPoolExecutor-AbortPolicy-\"><code>ThreadPoolExecutor.AbortPolicy()</code></h4>\n<p> <code>RejectedExecutionException</code></p>\n<h4 id=\"ThreadPoolExecutor-CallerRunsPolicy-\"><code>ThreadPoolExecutor.CallerRunsPolicy()</code></h4>\n<p></p>\n<h4 id=\"ThreadPoolExecutor-DiscardOldestPolicy-\"><code>ThreadPoolExecutor.DiscardOldestPolicy()</code></h4>\n<p></p>\n<h4 id=\"ThreadPoolExecutor-DiscardPolicy-\"><code>ThreadPoolExecutor.DiscardPolicy()</code></h4>\n<p></p>\n<h3 id=\"\"></h3>\n<ul>\n<li><code>ArrayBlockingQueue</code>ArrayBlockingQueue</li>\n<li><code>LinkedBlockingQueue</code>ArrayBlockingQueueLinkedBlockingQueue</li>\n<li><code>SynchronousQueue</code></li>\n<li><code>PriorityBlockingQueue</code>CompatorComparablePriorityBlockingQueue</li>\n<li><code>DelayQueue</code>QueueDelayQueueDelayedDelayQueue</li>\n</ul>\n<p><img src=\"/assets/image-20230519215732-zz9jpqo.png\" alt=\"image\"></p>\n<h3 id=\"ExecutorService\">ExecutorService</h3>\n<p>ThreadPoolExecutor JavaSE  Executors Eexcutors </p>\n<h4 id=\"newCachedThreadPool\">newCachedThreadPool</h4>\n<p><br>\n</p>\n<ol>\n<li>.(, Interger. MAX_VALUE)</li>\n<li></li>\n<li> CachedThreadPool </li>\n</ol>\n<h4 id=\"newFixedThreadPool\">newFixedThreadPool</h4>\n<p><br>\n<br>\n</p>\n<h4 id=\"newSingleThreadExecutor\">newSingleThreadExecutor</h4>\n<p> Executor(FIFO, LIFO,)<br>\n</p>\n<h4 id=\"newScheduleThreadPool\">newScheduleThreadPool</h4>\n<p></p>\n<blockquote>\n<p>FixedThreadPoolSingleThreadPoolLinkedBlockingQueueOOMChachedTheadPoolInteger.MAX_VALUEOOMScheduledThreadPoolSingleThreadScheduledPoolDelayedWorkQueueOOM</p>\n</blockquote>\n<h2 id=\"\"></h2>\n<h3 id=\"java-blockingQueue-queue\">java,blockingQueue,queue</h3>\n<p></p>\n"},{"title":"","date":"2023-05-14T14:53:28.000Z","lastmod":"2023-05-14T14:33:08.000Z","_content":"\n#  \n\n---\n\n## \n\n- \n  - \n- \n  - \n- \n  - \n\n## \n\n### \n\n> \"( Publish)\",\n\n1. \n\n```java\npublic class Person(){\n    private String name;\n    private int age;\n}\n\npublic class Record{\n    Person p;\n}\n\n```\n\n2. \n\n```java\npublic class Person(){\n    private String name;\n    private int age;\n\n    public Person get(){\n        return new Person();\n    }\n}\n```\n\n3. \n\n```java\npublic class Person(){\n    private String name;\n    private int age;\n}\n\npublic class Record{\n    private void getPersonMessage(Person p){\n        .....\n    }\n}\n```\n\n### \n\n> ,( Escape).\n\n1. \n\n```java\nclass UnsafeStates{\n    private String[] states = {\"AK\",\"AL\",...};\n    public String[] getStates(){\n        return states;\n    }\n}\n//statespublicstates\n```\n\n2. this\n\n```java\npublic class ThisEscape{\n    public ThisEscape(EventSource source){\n        source.registerListener(\n            new EventListener(){\n                public void onEvent(Event e){\n                    dosomething(e);\n                }\n            })\n        //count1\n        count = 1;\n    }\n}\n//ThisEscapeEventListenerThisEscapeThisEscape\n//thisThisEscapeThisEscapecount=1;ThisEscapecount,\n```\n\n**this**\n\n```java\npublic class SafeListener{\n    private final EventListener listener;\n    private SafeListener(){\n        listener = new EventListener(){\n            public void onEvent(Event e){\n                dosomething(e);\n            }\n        };\n    }\n    public static SafeListener newInstance(EventSource source){\n        SafeListener safe = new SafeListener();\n        source.registerListener(safe.listener);\n        return safe;\n    }\n}\n//\n```\n\n## \n\n1. Ad-hoc\n\n> \n\nAd-hoc  volatile   volatile  volatile  -  - \n\n2. \n\n\n\n3. ThreadLocal\n\n## \n\nJava  java.util.concurrent.atomic \n\n- AtomicIntegerAtomicBooleanAtomicLong\n- AtomicIntegerArrayAtomicLongArray\n- AtomicReferenceAtomicStampedReference \n- AtomicIntegerFieldUpdaterAtomicLongFieldUpdater\n\n\n\n### \n\ni++\n\n```java\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic class AtomicClass {\n    static int n = 0;\n    public static void main(String[] args) throws InterruptedException {\n        int j = 0;\n        while(j<100){\n            n = 0;\n            Thread t1 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n++;\n                    }\n                }\n            };\n            Thread t2 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n++;\n                    }\n                }\n            };\n            t1.start();\n            t2.start();\n            t1.join();\n            t2.join();\n            System.out.println(\"n\"+n);\n            j++;\n        }\n\n    }\n}\n```\n\n 2000\n\n### \n\n```java\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic class AtomicClass {\n    static AtomicInteger n;\n    public static void main(String[] args) throws InterruptedException {\n        int j = 0;\n        while(j<100){\n            n = new AtomicInteger(0);\n            Thread t1 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n.getAndIncrement();\n                    }\n                }\n            };\n            Thread t2 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n.getAndIncrement();\n                    }\n                }\n            };\n            t1.start();\n            t2.start();\n            t1.join();\n            t2.join();\n            System.out.println(\"n\"+n);\n            j++;\n        }\n\n    }\n}\n```\n\n****\n\n![1-10.png](/assets/net-img-1582875462202-61de3608-d606-44f6-b8d0-c82da3a7acd8-20221030135541-a1152vd.png)\n\n### CAS  ABA \n\n A B  A A\n\n![1-11.png](/assets/net-img-1582875470139-ea71ffbe-3cbd-44d8-8560-1e72b3a4bab4-20221030135541-hkuw6hs.png)\n\n### AtomicStampedReference  ABA \n\n```\nAtomicStampedReference()\ngetStamp\ngetReference\ncompareAndSet()CAS\n```\n\n```java\nimport java.util.concurrent.atomic.AtomicInteger;\nimport java.util.concurrent.atomic.AtomicStampedReference;\n\npublic class AtomicClass {\n    static AtomicStampedReference<Integer> n;\n    public static void main(String[] args) throws InterruptedException {\n        int j = 0;\n        while(j<100){\n            n = new AtomicStampedReference<Integer>(0,0);\n            Thread t1 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        int stamp;\n                        Integer reference;\n                        do{\n                            stamp = n.getStamp();\n                            reference = n.getReference();\n                        } while(!n.compareAndSet(reference, reference+1, stamp, stamp+1));\n                    }\n                }\n            };\n            Thread t2 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        int stamp;\n                        Integer reference;\n                        do{\n                            stamp = n.getStamp();\n                            reference = n.getReference();\n\n                        } while(!n.compareAndSet(reference, reference+1, stamp, stamp+1));\n                    }\n                }\n            };\n            t1.start();\n            t2.start();\n            t1.join();\n            t2.join();\n            System.out.println(\"n\"+n.getReference());\n            j++;\n        }\n\n    }\n}\n```\n\n** AtomicStampedReference **\n\n\n","source":"_posts/java/thread/.md","raw":"---\ntitle:  \ndate: 2023-05-14T22:53:28Z\nlastmod: 2023-05-14T22:33:08Z\n---\n\n#  \n\n---\n\n## \n\n- \n  - \n- \n  - \n- \n  - \n\n## \n\n### \n\n> \"( Publish)\",\n\n1. \n\n```java\npublic class Person(){\n    private String name;\n    private int age;\n}\n\npublic class Record{\n    Person p;\n}\n\n```\n\n2. \n\n```java\npublic class Person(){\n    private String name;\n    private int age;\n\n    public Person get(){\n        return new Person();\n    }\n}\n```\n\n3. \n\n```java\npublic class Person(){\n    private String name;\n    private int age;\n}\n\npublic class Record{\n    private void getPersonMessage(Person p){\n        .....\n    }\n}\n```\n\n### \n\n> ,( Escape).\n\n1. \n\n```java\nclass UnsafeStates{\n    private String[] states = {\"AK\",\"AL\",...};\n    public String[] getStates(){\n        return states;\n    }\n}\n//statespublicstates\n```\n\n2. this\n\n```java\npublic class ThisEscape{\n    public ThisEscape(EventSource source){\n        source.registerListener(\n            new EventListener(){\n                public void onEvent(Event e){\n                    dosomething(e);\n                }\n            })\n        //count1\n        count = 1;\n    }\n}\n//ThisEscapeEventListenerThisEscapeThisEscape\n//thisThisEscapeThisEscapecount=1;ThisEscapecount,\n```\n\n**this**\n\n```java\npublic class SafeListener{\n    private final EventListener listener;\n    private SafeListener(){\n        listener = new EventListener(){\n            public void onEvent(Event e){\n                dosomething(e);\n            }\n        };\n    }\n    public static SafeListener newInstance(EventSource source){\n        SafeListener safe = new SafeListener();\n        source.registerListener(safe.listener);\n        return safe;\n    }\n}\n//\n```\n\n## \n\n1. Ad-hoc\n\n> \n\nAd-hoc  volatile   volatile  volatile  -  - \n\n2. \n\n\n\n3. ThreadLocal\n\n## \n\nJava  java.util.concurrent.atomic \n\n- AtomicIntegerAtomicBooleanAtomicLong\n- AtomicIntegerArrayAtomicLongArray\n- AtomicReferenceAtomicStampedReference \n- AtomicIntegerFieldUpdaterAtomicLongFieldUpdater\n\n\n\n### \n\ni++\n\n```java\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic class AtomicClass {\n    static int n = 0;\n    public static void main(String[] args) throws InterruptedException {\n        int j = 0;\n        while(j<100){\n            n = 0;\n            Thread t1 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n++;\n                    }\n                }\n            };\n            Thread t2 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n++;\n                    }\n                }\n            };\n            t1.start();\n            t2.start();\n            t1.join();\n            t2.join();\n            System.out.println(\"n\"+n);\n            j++;\n        }\n\n    }\n}\n```\n\n 2000\n\n### \n\n```java\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic class AtomicClass {\n    static AtomicInteger n;\n    public static void main(String[] args) throws InterruptedException {\n        int j = 0;\n        while(j<100){\n            n = new AtomicInteger(0);\n            Thread t1 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n.getAndIncrement();\n                    }\n                }\n            };\n            Thread t2 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        n.getAndIncrement();\n                    }\n                }\n            };\n            t1.start();\n            t2.start();\n            t1.join();\n            t2.join();\n            System.out.println(\"n\"+n);\n            j++;\n        }\n\n    }\n}\n```\n\n****\n\n![1-10.png](/assets/net-img-1582875462202-61de3608-d606-44f6-b8d0-c82da3a7acd8-20221030135541-a1152vd.png)\n\n### CAS  ABA \n\n A B  A A\n\n![1-11.png](/assets/net-img-1582875470139-ea71ffbe-3cbd-44d8-8560-1e72b3a4bab4-20221030135541-hkuw6hs.png)\n\n### AtomicStampedReference  ABA \n\n```\nAtomicStampedReference()\ngetStamp\ngetReference\ncompareAndSet()CAS\n```\n\n```java\nimport java.util.concurrent.atomic.AtomicInteger;\nimport java.util.concurrent.atomic.AtomicStampedReference;\n\npublic class AtomicClass {\n    static AtomicStampedReference<Integer> n;\n    public static void main(String[] args) throws InterruptedException {\n        int j = 0;\n        while(j<100){\n            n = new AtomicStampedReference<Integer>(0,0);\n            Thread t1 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        int stamp;\n                        Integer reference;\n                        do{\n                            stamp = n.getStamp();\n                            reference = n.getReference();\n                        } while(!n.compareAndSet(reference, reference+1, stamp, stamp+1));\n                    }\n                }\n            };\n            Thread t2 = new Thread(){\n                public void run(){\n                    for(int i=0; i<1000; i++){\n                        int stamp;\n                        Integer reference;\n                        do{\n                            stamp = n.getStamp();\n                            reference = n.getReference();\n\n                        } while(!n.compareAndSet(reference, reference+1, stamp, stamp+1));\n                    }\n                }\n            };\n            t1.start();\n            t2.start();\n            t1.join();\n            t2.join();\n            System.out.println(\"n\"+n.getReference());\n            j++;\n        }\n\n    }\n}\n```\n\n** AtomicStampedReference **\n\n\n","slug":"java-thread-","published":1,"updated":"2025-04-28T08:41:48.395Z","_id":"cm9s3f40o0035bfg4bcv4fem0","comments":1,"layout":"post","photos":[],"content":"<h1></h1>\n<hr>\n<h2 id=\"\"></h2>\n<ul>\n<li>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>&quot;( Publish)&quot;,</p>\n</blockquote>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Record</span>&#123;</span><br><span class=\"line\">    Person p;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">get</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Record</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">getPersonMessage</span><span class=\"params\">(Person p)</span>&#123;</span><br><span class=\"line\">        .....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>,( Escape).</p>\n</blockquote>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">UnsafeStates</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String[] states = &#123;<span class=\"string\">&quot;AK&quot;</span>,<span class=\"string\">&quot;AL&quot;</span>,...&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String[] getStates()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> states;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//statespublicstates</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>this</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThisEscape</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ThisEscape</span><span class=\"params\">(EventSource source)</span>&#123;</span><br><span class=\"line\">        source.registerListener(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">EventListener</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onEvent</span><span class=\"params\">(Event e)</span>&#123;</span><br><span class=\"line\">                    dosomething(e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        <span class=\"comment\">//count1</span></span><br><span class=\"line\">        count = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//ThisEscapeEventListenerThisEscapeThisEscape</span></span><br><span class=\"line\"><span class=\"comment\">//thisThisEscapeThisEscapecount=1;ThisEscapecount,</span></span><br></pre></td></tr></table></figure>\n<p><strong>this</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SafeListener</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> EventListener listener;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">SafeListener</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        listener = <span class=\"keyword\">new</span> <span class=\"title class_\">EventListener</span>()&#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onEvent</span><span class=\"params\">(Event e)</span>&#123;</span><br><span class=\"line\">                dosomething(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SafeListener <span class=\"title function_\">newInstance</span><span class=\"params\">(EventSource source)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">SafeListener</span> <span class=\"variable\">safe</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SafeListener</span>();</span><br><span class=\"line\">        source.registerListener(safe.listener);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> safe;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<ol>\n<li>Ad-hoc</li>\n</ol>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Ad-hoc  volatile   volatile  volatile  -  - </p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p></p>\n<ol start=\"3\">\n<li>ThreadLocal</li>\n</ol>\n<h2 id=\"\"></h2>\n<p>Java  java.util.concurrent.atomic </p>\n<ul>\n<li>AtomicIntegerAtomicBooleanAtomicLong</li>\n<li>AtomicIntegerArrayAtomicLongArray</li>\n<li>AtomicReferenceAtomicStampedReference </li>\n<li>AtomicIntegerFieldUpdaterAtomicLongFieldUpdater</li>\n</ul>\n<p></p>\n<h3 id=\"\"></h3>\n<p>i++</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AtomicClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(j&lt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            n = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n++;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n++;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            t1.start();</span><br><span class=\"line\">            t2.start();</span><br><span class=\"line\">            t1.join();</span><br><span class=\"line\">            t2.join();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;n&quot;</span>+n);</span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 2000</p>\n<h3 id=\"\"></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AtomicClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> AtomicInteger n;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(j&lt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            n = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n.getAndIncrement();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n.getAndIncrement();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            t1.start();</span><br><span class=\"line\">            t2.start();</span><br><span class=\"line\">            t1.join();</span><br><span class=\"line\">            t2.join();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;n&quot;</span>+n);</span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<p><img src=\"/assets/net-img-1582875462202-61de3608-d606-44f6-b8d0-c82da3a7acd8-20221030135541-a1152vd.png\" alt=\"1-10.png\"></p>\n<h3 id=\"CAS--ABA-\">CAS  ABA </h3>\n<p> A B  A A</p>\n<p><img src=\"/assets/net-img-1582875470139-ea71ffbe-3cbd-44d8-8560-1e72b3a4bab4-20221030135541-hkuw6hs.png\" alt=\"1-11.png\"></p>\n<h3 id=\"AtomicStampedReference--ABA-\">AtomicStampedReference  ABA </h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AtomicStampedReference()</span><br><span class=\"line\">getStamp</span><br><span class=\"line\">getReference</span><br><span class=\"line\">compareAndSet()CAS</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicStampedReference;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AtomicClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> AtomicStampedReference&lt;Integer&gt; n;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(j&lt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            n = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicStampedReference</span>&lt;Integer&gt;(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> stamp;</span><br><span class=\"line\">                        Integer reference;</span><br><span class=\"line\">                        <span class=\"keyword\">do</span>&#123;</span><br><span class=\"line\">                            stamp = n.getStamp();</span><br><span class=\"line\">                            reference = n.getReference();</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">while</span>(!n.compareAndSet(reference, reference+<span class=\"number\">1</span>, stamp, stamp+<span class=\"number\">1</span>));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> stamp;</span><br><span class=\"line\">                        Integer reference;</span><br><span class=\"line\">                        <span class=\"keyword\">do</span>&#123;</span><br><span class=\"line\">                            stamp = n.getStamp();</span><br><span class=\"line\">                            reference = n.getReference();</span><br><span class=\"line\"></span><br><span class=\"line\">                        &#125; <span class=\"keyword\">while</span>(!n.compareAndSet(reference, reference+<span class=\"number\">1</span>, stamp, stamp+<span class=\"number\">1</span>));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            t1.start();</span><br><span class=\"line\">            t2.start();</span><br><span class=\"line\">            t1.join();</span><br><span class=\"line\">            t2.join();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;n&quot;</span>+n.getReference());</span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong> AtomicStampedReference </strong></p>\n<p></p>\n","excerpt":"","more":"<h1></h1>\n<hr>\n<h2 id=\"\"></h2>\n<ul>\n<li>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<ul>\n<li></li>\n</ul>\n</li>\n<li>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>&quot;( Publish)&quot;,</p>\n</blockquote>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Record</span>&#123;</span><br><span class=\"line\">    Person p;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Person <span class=\"title function_\">get</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Record</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">getPersonMessage</span><span class=\"params\">(Person p)</span>&#123;</span><br><span class=\"line\">        .....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>,( Escape).</p>\n</blockquote>\n<ol>\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">UnsafeStates</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String[] states = &#123;<span class=\"string\">&quot;AK&quot;</span>,<span class=\"string\">&quot;AL&quot;</span>,...&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String[] getStates()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> states;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//statespublicstates</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>this</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThisEscape</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ThisEscape</span><span class=\"params\">(EventSource source)</span>&#123;</span><br><span class=\"line\">        source.registerListener(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">EventListener</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onEvent</span><span class=\"params\">(Event e)</span>&#123;</span><br><span class=\"line\">                    dosomething(e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        <span class=\"comment\">//count1</span></span><br><span class=\"line\">        count = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//ThisEscapeEventListenerThisEscapeThisEscape</span></span><br><span class=\"line\"><span class=\"comment\">//thisThisEscapeThisEscapecount=1;ThisEscapecount,</span></span><br></pre></td></tr></table></figure>\n<p><strong>this</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SafeListener</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> EventListener listener;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">SafeListener</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        listener = <span class=\"keyword\">new</span> <span class=\"title class_\">EventListener</span>()&#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onEvent</span><span class=\"params\">(Event e)</span>&#123;</span><br><span class=\"line\">                dosomething(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SafeListener <span class=\"title function_\">newInstance</span><span class=\"params\">(EventSource source)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">SafeListener</span> <span class=\"variable\">safe</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SafeListener</span>();</span><br><span class=\"line\">        source.registerListener(safe.listener);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> safe;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<ol>\n<li>Ad-hoc</li>\n</ol>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Ad-hoc  volatile   volatile  volatile  -  - </p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p></p>\n<ol start=\"3\">\n<li>ThreadLocal</li>\n</ol>\n<h2 id=\"\"></h2>\n<p>Java  java.util.concurrent.atomic </p>\n<ul>\n<li>AtomicIntegerAtomicBooleanAtomicLong</li>\n<li>AtomicIntegerArrayAtomicLongArray</li>\n<li>AtomicReferenceAtomicStampedReference </li>\n<li>AtomicIntegerFieldUpdaterAtomicLongFieldUpdater</li>\n</ul>\n<p></p>\n<h3 id=\"\"></h3>\n<p>i++</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AtomicClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(j&lt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            n = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n++;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n++;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            t1.start();</span><br><span class=\"line\">            t2.start();</span><br><span class=\"line\">            t1.join();</span><br><span class=\"line\">            t2.join();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;n&quot;</span>+n);</span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 2000</p>\n<h3 id=\"\"></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AtomicClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> AtomicInteger n;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(j&lt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            n = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n.getAndIncrement();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        n.getAndIncrement();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            t1.start();</span><br><span class=\"line\">            t2.start();</span><br><span class=\"line\">            t1.join();</span><br><span class=\"line\">            t2.join();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;n&quot;</span>+n);</span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<p><img src=\"/assets/net-img-1582875462202-61de3608-d606-44f6-b8d0-c82da3a7acd8-20221030135541-a1152vd.png\" alt=\"1-10.png\"></p>\n<h3 id=\"CAS--ABA-\">CAS  ABA </h3>\n<p> A B  A A</p>\n<p><img src=\"/assets/net-img-1582875470139-ea71ffbe-3cbd-44d8-8560-1e72b3a4bab4-20221030135541-hkuw6hs.png\" alt=\"1-11.png\"></p>\n<h3 id=\"AtomicStampedReference--ABA-\">AtomicStampedReference  ABA </h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AtomicStampedReference()</span><br><span class=\"line\">getStamp</span><br><span class=\"line\">getReference</span><br><span class=\"line\">compareAndSet()CAS</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicStampedReference;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AtomicClass</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> AtomicStampedReference&lt;Integer&gt; n;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(j&lt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">            n = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicStampedReference</span>&lt;Integer&gt;(<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> stamp;</span><br><span class=\"line\">                        Integer reference;</span><br><span class=\"line\">                        <span class=\"keyword\">do</span>&#123;</span><br><span class=\"line\">                            stamp = n.getStamp();</span><br><span class=\"line\">                            reference = n.getReference();</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">while</span>(!n.compareAndSet(reference, reference+<span class=\"number\">1</span>, stamp, stamp+<span class=\"number\">1</span>));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">1000</span>; i++)&#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> stamp;</span><br><span class=\"line\">                        Integer reference;</span><br><span class=\"line\">                        <span class=\"keyword\">do</span>&#123;</span><br><span class=\"line\">                            stamp = n.getStamp();</span><br><span class=\"line\">                            reference = n.getReference();</span><br><span class=\"line\"></span><br><span class=\"line\">                        &#125; <span class=\"keyword\">while</span>(!n.compareAndSet(reference, reference+<span class=\"number\">1</span>, stamp, stamp+<span class=\"number\">1</span>));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            t1.start();</span><br><span class=\"line\">            t2.start();</span><br><span class=\"line\">            t1.join();</span><br><span class=\"line\">            t2.join();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;n&quot;</span>+n.getReference());</span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong> AtomicStampedReference </strong></p>\n<p></p>\n"},{"title":"","date":"2023-05-14T14:53:28.000Z","lastmod":"2023-05-14T14:41:00.000Z","_content":"\n# \n\n## \n\n### \n\n1. \n   1. object  waitnotifynotifyAll\n   2. Condition  awaitsignalsignalAll\n2. CountDownLatch A \n   - CountDownLatch \n   - CountDownLatch   \n  ![1-8.png](/assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png)\n\n 1 0 \n1. CyclicBarrier\n\n- CyclicBarrier \n- CyclicBarrier  ReentrantLock  Condition \n\n4. Semaphore\n\n**Object  Condition **\n\n1. object wait() synchronized\n2. object wait() Nodify()\n3. condition await()  Lock/\n4. condition await()  signal() \n\n**sleep  wait **\n\n||wait|sleep|\n| ----------| -----------------------------------------------------------------------------| ----------------------------------------------------|\n|| wait  llegalMonitorstateException ||\n||wait  Object |sleep  java.lang.thread |\n||||\n|| notify() notifyAll()| Interrupt()|\n||wait |sleep |\n\n**wait  notify **\n\n* wait  notify  Object \n* wait  notify \n* wait \n* notify \n\n## Volatile \n\n### 64\n\nVolatile64doublelongJVM6432longdoubleVolatile\n\n### \n\nJavaJMMvolatilevolatilevolatile\n\n### \n\n>  volatile \n\n* \n* \n\n  *  volatile \n  *  volatile  volatile \n\n### \n\n**MESI CPU**  \n  \n![image.png](//assets/net-img-1615619423077-dea312ee-787e-4a28-b723-199f76a214f7-20221030135542-mx20k3e.png)  \n![image.png](//assets/net-img-1615619453470-bdab6e23-1385-4538-9c91-ceefcd05aa27-20221030135542-vyoxljv.png)****\n\n volatile  volatile \n\n* \n* \n*   \n  ****   \n  \n\n```java\nvolatile boolean flag = false;\n\nwhile(!flag){\ndoSomething();\n}\n\npublic void setFlag() {\nflag = true;\n}\n\n\nvolatile boolean inited = false;\n//1:\ncontext = loadContext();\ninited = true;\n\n//2:\nwhile(!inited ){\nsleep()\n}\ndoSomethingwithconfig(context);\n```\n\n\n\n```java\nclass Singleton{\nprivate volatile static Singleton instance = null;\n\nprivate Singleton() {\n\n}\n\npublic static Singleton getInstance() {\nif(instance==null) {\nsynchronized (Singleton.class) {\nif(instance==null)\ninstance = new Singleton();\n}\n}\nreturn instance;\n}\n}\n```\n\n### \n\nVolatile\n\n\n","source":"_posts/java/thread/.md","raw":"---\ntitle: \ndate: 2023-05-14T22:53:28Z\nlastmod: 2023-05-14T22:41:00Z\n---\n\n# \n\n## \n\n### \n\n1. \n   1. object  waitnotifynotifyAll\n   2. Condition  awaitsignalsignalAll\n2. CountDownLatch A \n   - CountDownLatch \n   - CountDownLatch   \n  ![1-8.png](/assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png)\n\n 1 0 \n1. CyclicBarrier\n\n- CyclicBarrier \n- CyclicBarrier  ReentrantLock  Condition \n\n4. Semaphore\n\n**Object  Condition **\n\n1. object wait() synchronized\n2. object wait() Nodify()\n3. condition await()  Lock/\n4. condition await()  signal() \n\n**sleep  wait **\n\n||wait|sleep|\n| ----------| -----------------------------------------------------------------------------| ----------------------------------------------------|\n|| wait  llegalMonitorstateException ||\n||wait  Object |sleep  java.lang.thread |\n||||\n|| notify() notifyAll()| Interrupt()|\n||wait |sleep |\n\n**wait  notify **\n\n* wait  notify  Object \n* wait  notify \n* wait \n* notify \n\n## Volatile \n\n### 64\n\nVolatile64doublelongJVM6432longdoubleVolatile\n\n### \n\nJavaJMMvolatilevolatilevolatile\n\n### \n\n>  volatile \n\n* \n* \n\n  *  volatile \n  *  volatile  volatile \n\n### \n\n**MESI CPU**  \n  \n![image.png](//assets/net-img-1615619423077-dea312ee-787e-4a28-b723-199f76a214f7-20221030135542-mx20k3e.png)  \n![image.png](//assets/net-img-1615619453470-bdab6e23-1385-4538-9c91-ceefcd05aa27-20221030135542-vyoxljv.png)****\n\n volatile  volatile \n\n* \n* \n*   \n  ****   \n  \n\n```java\nvolatile boolean flag = false;\n\nwhile(!flag){\ndoSomething();\n}\n\npublic void setFlag() {\nflag = true;\n}\n\n\nvolatile boolean inited = false;\n//1:\ncontext = loadContext();\ninited = true;\n\n//2:\nwhile(!inited ){\nsleep()\n}\ndoSomethingwithconfig(context);\n```\n\n\n\n```java\nclass Singleton{\nprivate volatile static Singleton instance = null;\n\nprivate Singleton() {\n\n}\n\npublic static Singleton getInstance() {\nif(instance==null) {\nsynchronized (Singleton.class) {\nif(instance==null)\ninstance = new Singleton();\n}\n}\nreturn instance;\n}\n}\n```\n\n### \n\nVolatile\n\n\n","slug":"java-thread-","published":1,"updated":"2025-04-28T08:41:48.397Z","_id":"cm9s3f40p0036bfg4eao7bjij","comments":1,"layout":"post","photos":[],"content":"<h1></h1>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<ol>\n<li>\n<ol>\n<li>object  waitnotifynotifyAll</li>\n<li>Condition  awaitsignalsignalAll</li>\n</ol>\n</li>\n<li>CountDownLatch A \n<ul>\n<li>CountDownLatch </li>\n<li>CountDownLatch <br>\n<img src=\"/assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png\" alt=\"1-8.png\"></li>\n</ul>\n</li>\n</ol>\n<p> 1 0 </p>\n<ol>\n<li>CyclicBarrier</li>\n</ol>\n<ul>\n<li>CyclicBarrier </li>\n<li>CyclicBarrier  ReentrantLock  Condition </li>\n</ul>\n<ol start=\"4\">\n<li>Semaphore</li>\n</ol>\n<p><strong>Object  Condition </strong></p>\n<ol>\n<li>object wait() synchronized</li>\n<li>object wait() Nodify()</li>\n<li>condition await()  Lock/</li>\n<li>condition await()  signal() </li>\n</ol>\n<p><strong>sleep  wait </strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>wait</th>\n<th>sleep</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td> wait  llegalMonitorstateException </td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>wait  Object </td>\n<td>sleep  java.lang.thread </td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td> notify() notifyAll()</td>\n<td> Interrupt()</td>\n</tr>\n<tr>\n<td></td>\n<td>wait </td>\n<td>sleep </td>\n</tr>\n</tbody>\n</table>\n<p><strong>wait  notify </strong></p>\n<ul>\n<li>wait  notify  Object </li>\n<li>wait  notify </li>\n<li>wait </li>\n<li>notify </li>\n</ul>\n<h2 id=\"Volatile-\">Volatile </h2>\n<h3 id=\"64\">64</h3>\n<p>Volatile64doublelongJVM6432longdoubleVolatile</p>\n<h3 id=\"\"></h3>\n<p>JavaJMMvolatilevolatilevolatile</p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p> volatile </p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n</li>\n<li>\n<p></p>\n<ul>\n<li> volatile </li>\n<li> volatile  volatile </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<p><strong>MESI CPU</strong><br>\n<br>\n<img src=\"//assets/net-img-1615619423077-dea312ee-787e-4a28-b723-199f76a214f7-20221030135542-mx20k3e.png\" alt=\"image.png\"><br>\n<img src=\"//assets/net-img-1615619453470-bdab6e23-1385-4538-9c91-ceefcd05aa27-20221030135542-vyoxljv.png\" alt=\"image.png\"><strong></strong></p>\n<p> volatile  volatile </p>\n<ul>\n<li></li>\n<li></li>\n<li><br>\n<strong></strong><br>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!flag)&#123;</span><br><span class=\"line\">doSomething();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setFlag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">inited</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();</span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Singleton</span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> <span class=\"type\">Singleton</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"title function_\">Singleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">synchronized</span> (Singleton.class) &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>)</span><br><span class=\"line\">instance = <span class=\"keyword\">new</span> <span class=\"title class_\">Singleton</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p>Volatile</p>\n<p></p>\n","excerpt":"","more":"<h1></h1>\n<h2 id=\"\"></h2>\n<h3 id=\"\"></h3>\n<ol>\n<li>\n<ol>\n<li>object  waitnotifynotifyAll</li>\n<li>Condition  awaitsignalsignalAll</li>\n</ol>\n</li>\n<li>CountDownLatch A \n<ul>\n<li>CountDownLatch </li>\n<li>CountDownLatch <br>\n<img src=\"/assets/net-img-1582875399701-d03e5b25-a1c9-498e-85d6-18f86f41e38f-20221030135517-a6hu6sv.png\" alt=\"1-8.png\"></li>\n</ul>\n</li>\n</ol>\n<p> 1 0 </p>\n<ol>\n<li>CyclicBarrier</li>\n</ol>\n<ul>\n<li>CyclicBarrier </li>\n<li>CyclicBarrier  ReentrantLock  Condition </li>\n</ul>\n<ol start=\"4\">\n<li>Semaphore</li>\n</ol>\n<p><strong>Object  Condition </strong></p>\n<ol>\n<li>object wait() synchronized</li>\n<li>object wait() Nodify()</li>\n<li>condition await()  Lock/</li>\n<li>condition await()  signal() </li>\n</ol>\n<p><strong>sleep  wait </strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>wait</th>\n<th>sleep</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td> wait  llegalMonitorstateException </td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>wait  Object </td>\n<td>sleep  java.lang.thread </td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td> notify() notifyAll()</td>\n<td> Interrupt()</td>\n</tr>\n<tr>\n<td></td>\n<td>wait </td>\n<td>sleep </td>\n</tr>\n</tbody>\n</table>\n<p><strong>wait  notify </strong></p>\n<ul>\n<li>wait  notify  Object </li>\n<li>wait  notify </li>\n<li>wait </li>\n<li>notify </li>\n</ul>\n<h2 id=\"Volatile-\">Volatile </h2>\n<h3 id=\"64\">64</h3>\n<p>Volatile64doublelongJVM6432longdoubleVolatile</p>\n<h3 id=\"\"></h3>\n<p>JavaJMMvolatilevolatilevolatile</p>\n<h3 id=\"\"></h3>\n<blockquote>\n<p> volatile </p>\n</blockquote>\n<ul>\n<li>\n<p></p>\n</li>\n<li>\n<p></p>\n<ul>\n<li> volatile </li>\n<li> volatile  volatile </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"></h3>\n<p><strong>MESI CPU</strong><br>\n<br>\n<img src=\"//assets/net-img-1615619423077-dea312ee-787e-4a28-b723-199f76a214f7-20221030135542-mx20k3e.png\" alt=\"image.png\"><br>\n<img src=\"//assets/net-img-1615619453470-bdab6e23-1385-4538-9c91-ceefcd05aa27-20221030135542-vyoxljv.png\" alt=\"image.png\"><strong></strong></p>\n<p> volatile  volatile </p>\n<ul>\n<li></li>\n<li></li>\n<li><br>\n<strong></strong><br>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!flag)&#123;</span><br><span class=\"line\">doSomething();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setFlag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">inited</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();</span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Singleton</span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> <span class=\"type\">Singleton</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"title function_\">Singleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">synchronized</span> (Singleton.class) &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>)</span><br><span class=\"line\">instance = <span class=\"keyword\">new</span> <span class=\"title class_\">Singleton</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<p>Volatile</p>\n<p></p>\n"},{"title":"WSLkali","date":"2025-05-01T08:57:07.000Z","lastmod":"2025-05-01T08:57:07.000Z","_content":"# WSLkali\n## \n\nC\n\n```powershell\nwsl --install -d kali-linux --name kali --location E:\\Hyper\\kali\\\n```\n\n## \n\n```bash\nsed -i \"s@http://http.kali.org/kali@https://mirrors.tuna.tsinghua.edu.cn/kali@g\" /etc/apt/sources.list\n```\n\n## \n\n```bash\nsudo apt install -y kali-win-kex\n```\n\n## Windows\n\n```powershell\nwsl -d kali kex --esm --wtstart -s\n```\n\n","source":"_posts/20250501/1.md","raw":"---\ntitle: WSLkali\ndate: 2025-05-01 16:57:07\nlastmod: 2025-05-01 16:57:07\ntags: [WSL,Kali]\ncategory: WSL\n---\n# WSLkali\n## \n\nC\n\n```powershell\nwsl --install -d kali-linux --name kali --location E:\\Hyper\\kali\\\n```\n\n## \n\n```bash\nsed -i \"s@http://http.kali.org/kali@https://mirrors.tuna.tsinghua.edu.cn/kali@g\" /etc/apt/sources.list\n```\n\n## \n\n```bash\nsudo apt install -y kali-win-kex\n```\n\n## Windows\n\n```powershell\nwsl -d kali kex --esm --wtstart -s\n```\n\n","slug":"20250501-1","published":1,"updated":"2025-05-01T09:02:07.672Z","comments":1,"layout":"post","photos":[],"_id":"cma56nfvk0000isjj1wo3gapa","content":"<h1>WSLkali</h1>\n<h2 id=\"\"></h2>\n<p>C</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl <span class=\"literal\">--install</span> <span class=\"literal\">-d</span> kali<span class=\"literal\">-linux</span> <span class=\"literal\">--name</span> kali <span class=\"literal\">--location</span> E:\\Hyper\\kali\\</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i <span class=\"string\">&quot;s@http://http.kali.org/kali@https://mirrors.tuna.tsinghua.edu.cn/kali@g&quot;</span> /etc/apt/sources.list</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt install -y kali-win-kex</span><br></pre></td></tr></table></figure>\n<h2 id=\"Windows\">Windows</h2>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl <span class=\"literal\">-d</span> kali kex <span class=\"literal\">--esm</span> <span class=\"literal\">--wtstart</span> <span class=\"literal\">-s</span></span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h1>WSLkali</h1>\n<h2 id=\"\"></h2>\n<p>C</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl <span class=\"literal\">--install</span> <span class=\"literal\">-d</span> kali<span class=\"literal\">-linux</span> <span class=\"literal\">--name</span> kali <span class=\"literal\">--location</span> E:\\Hyper\\kali\\</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i <span class=\"string\">&quot;s@http://http.kali.org/kali@https://mirrors.tuna.tsinghua.edu.cn/kali@g&quot;</span> /etc/apt/sources.list</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt install -y kali-win-kex</span><br></pre></td></tr></table></figure>\n<h2 id=\"Windows\">Windows</h2>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl <span class=\"literal\">-d</span> kali kex <span class=\"literal\">--esm</span> <span class=\"literal\">--wtstart</span> <span class=\"literal\">-s</span></span><br></pre></td></tr></table></figure>\n"},{"title":"spring-logback ","date":"2025-05-01T08:57:07.000Z","lastmod":"2025-05-01T08:57:07.000Z","_content":"\n```xml\n<!--  OFF  FATAL  ERROR  WARN  INFO  DEBUG  TRACE  ALL -->\n<!--  ROOT root  -->\n<!--   filter filter  -->\n<!-- scan truetrue -->\n<!-- scanPeriod scantrue1 -->\n<!-- debug truelogbacklogbackfalse -->\n<configuration scan=\"true\" scanPeriod=\"60 seconds\" debug=\"false\">\n  <!--  -->\n  <!--  <jmxConfigurator/>-->\n  <!--   -->\n\n  <property name=\"log.path\" value=\"${catalina.base}/logs/\"/>\n  <!--  30 -->\n  <property name=\"maxHistory\" value=\"30\"/>\n  <!--  -->\n  <property name=\"CONSOLE_LOG_PATTERN\"\n    value=\"%d{yyyy-MM-dd HH:mm:ss.SSS} %highlight(${LOG_LEVEL_PATTERN:-%5p}) %magenta(${PID:-}) [%X{RequestId}] [%yellow(%thread)] [%cyan(%logger{50} - %method:%line)] - %highlight(%msg%n)\"/>\n  <property name=\"LOG_PATTERN\"\n    value=\"%d{yyyy-MM-dd HH:mm:ss.SSS} ${LOG_LEVEL_PATTERN:-%5p} ${PID:-} [%X{RequestId}] [%thread] [%logger{50} - %method:%line] - %msg%n\"/>\n\n  <!-- ConsoleAppender  -->\n  <appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\">\n    <!--appender-->\n\n    <encoder>\n      <pattern>${CONSOLE_LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n\n  <!-- ERROR -->\n  <!--  RollingFileAppender -->\n  <appender name=\"ERROR\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/error.log</file>\n    <!-- WARN -->\n    <!-- onMath  onMismatch -->\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <!--  -->\n      <level>ERROR</level>\n      <!--  -->\n      <onMatch>ACCEPT</onMatch>\n      <!--  -->\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!-- . -->\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/error/error-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n\n  <!-- INFO appender -->\n  <appender name=\"INFO\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/info.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>INFO</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/info/info-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n  <!-- WARN appender -->\n  <appender name=\"WARN\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/warn.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>WARN</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/warn/warn-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n  <!-- DEBUG appender -->\n  <appender name=\"DEBUG\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/DEBUG.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>DEBUG</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/debug/debug-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n  <!-- TRACE appender -->\n  <appender name=\"TRACE\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/TRACE.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>TRACE</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/trace/trace-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n\n      <!-- sql -->\n    <appender name=\"SQL\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <File>${logPath}sql.log</File>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n             <fileNamePattern>${log.path}/SQL/sql-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n             <maxFileSize>10MB</maxFileSize>\n             <totalSizeCap>1GB</totalSizeCap>\n             <maxHistory>10</maxHistory>\n             <cleanHistoryOnStart>true</cleanHistoryOnStart>\n        </rollingPolicy>\n        <encoder>\n            <pattern>${pattern}</pattern>\n            <charset>UTF-8</charset>\n        </encoder>\n    </appender>\n  <!--\n    <logger>\n    <appender><logger>name\n    leveladdtivity\n    name:logger\n    level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF\n          INHERITEDNULL\n          logger\n    addtivity:loggertrue\n    <logger name=\"org.springframework.web\" level=\"info\"/>\n    <logger name=\"org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor\" level=\"INFO\"/>\n  -->\n\n  <!--\n      mybatissqldebuginfosql\n      <root level=\"info\"><root level=\"DEBUG\">sql\n      daodebugsqlinfo\n      logging.level.org.mybatis=debug logging.level.dao=debug\n   -->\n\n  <!--\n      rootlevel\n      level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF\n      INHERITEDNULLDEBUG\n      appenderlogger\n  -->\n  <!-- 4  \n                   (root) + profile, loggerpackage(root)-->\n  <!-- root DEBUG -->\n  <root>\n    <!-- debug -->\n    <level value=\"INFO\"/>\n    <!--  -->\n    <appender-ref ref=\"console\"/>\n    <!--  -->\n    <appender-ref ref=\"ERROR\"/>\n    <appender-ref ref=\"WARN\"/>\n    <appender-ref ref=\"INFO\"/>\n  </root>\n\n  <logger name=\"org.hibernate.type.descriptor.sql.BasicBinder\" level=\"TRACE\"/>\n<!--  <logger name=\"org.hibernate.type.descriptor.sql.BasicExtractor\" level=\"TRACE\"/>-->\n  <logger name=\"org.hibernate.engine.QueryParameters\" level=\"DEBUG\"/>\n  <logger name=\"org.hibernate.engine.query.HQLQueryPlan\" level=\"DEBUG\"/>\n  <logger name=\"org.hibernate.SQL\" level=\"DEBUG\"/>\n  <!-- , warn -->\n  <logger name=\"org.springframework.jdbc.core.JdbcTemplate\" level=\"TRACE\"/>\n  <!-- info, application -->\n</configuration>\n```","source":"_posts/20250501/3.md","raw":"---\ntitle: spring-logback \ndate: 2025-05-01 16:57:07\nlastmod: 2025-05-01 16:57:07\ntags: [logback,log]\ncategory: Java\n---\n\n```xml\n<!--  OFF  FATAL  ERROR  WARN  INFO  DEBUG  TRACE  ALL -->\n<!--  ROOT root  -->\n<!--   filter filter  -->\n<!-- scan truetrue -->\n<!-- scanPeriod scantrue1 -->\n<!-- debug truelogbacklogbackfalse -->\n<configuration scan=\"true\" scanPeriod=\"60 seconds\" debug=\"false\">\n  <!--  -->\n  <!--  <jmxConfigurator/>-->\n  <!--   -->\n\n  <property name=\"log.path\" value=\"${catalina.base}/logs/\"/>\n  <!--  30 -->\n  <property name=\"maxHistory\" value=\"30\"/>\n  <!--  -->\n  <property name=\"CONSOLE_LOG_PATTERN\"\n    value=\"%d{yyyy-MM-dd HH:mm:ss.SSS} %highlight(${LOG_LEVEL_PATTERN:-%5p}) %magenta(${PID:-}) [%X{RequestId}] [%yellow(%thread)] [%cyan(%logger{50} - %method:%line)] - %highlight(%msg%n)\"/>\n  <property name=\"LOG_PATTERN\"\n    value=\"%d{yyyy-MM-dd HH:mm:ss.SSS} ${LOG_LEVEL_PATTERN:-%5p} ${PID:-} [%X{RequestId}] [%thread] [%logger{50} - %method:%line] - %msg%n\"/>\n\n  <!-- ConsoleAppender  -->\n  <appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\">\n    <!--appender-->\n\n    <encoder>\n      <pattern>${CONSOLE_LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n\n  <!-- ERROR -->\n  <!--  RollingFileAppender -->\n  <appender name=\"ERROR\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/error.log</file>\n    <!-- WARN -->\n    <!-- onMath  onMismatch -->\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <!--  -->\n      <level>ERROR</level>\n      <!--  -->\n      <onMatch>ACCEPT</onMatch>\n      <!--  -->\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!-- . -->\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/error/error-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n\n  <!-- INFO appender -->\n  <appender name=\"INFO\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/info.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>INFO</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/info/info-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n  <!-- WARN appender -->\n  <appender name=\"WARN\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/warn.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>WARN</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/warn/warn-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n  <!-- DEBUG appender -->\n  <appender name=\"DEBUG\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/DEBUG.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>DEBUG</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/debug/debug-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n  <!-- TRACE appender -->\n  <appender name=\"TRACE\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!---->\n    <file>${log.path}/TRACE.log</file>\n    <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n      <level>TRACE</level>\n      <onMatch>ACCEPT</onMatch>\n      <onMismatch>DENY</onMismatch>\n    </filter>\n    <!---->\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n      <fileNamePattern>${log.path}/trace/trace-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n      <maxFileSize>10MB</maxFileSize>\n      <totalSizeCap>1GB</totalSizeCap>\n      <maxHistory>10</maxHistory>\n      <cleanHistoryOnStart>true</cleanHistoryOnStart>\n    </rollingPolicy>\n\n    <encoder>\n      <pattern>${LOG_PATTERN}</pattern>\n      <charset>UTF-8</charset>\n    </encoder>\n  </appender>\n\n      <!-- sql -->\n    <appender name=\"SQL\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <File>${logPath}sql.log</File>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n             <fileNamePattern>${log.path}/SQL/sql-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n             <maxFileSize>10MB</maxFileSize>\n             <totalSizeCap>1GB</totalSizeCap>\n             <maxHistory>10</maxHistory>\n             <cleanHistoryOnStart>true</cleanHistoryOnStart>\n        </rollingPolicy>\n        <encoder>\n            <pattern>${pattern}</pattern>\n            <charset>UTF-8</charset>\n        </encoder>\n    </appender>\n  <!--\n    <logger>\n    <appender><logger>name\n    leveladdtivity\n    name:logger\n    level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF\n          INHERITEDNULL\n          logger\n    addtivity:loggertrue\n    <logger name=\"org.springframework.web\" level=\"info\"/>\n    <logger name=\"org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor\" level=\"INFO\"/>\n  -->\n\n  <!--\n      mybatissqldebuginfosql\n      <root level=\"info\"><root level=\"DEBUG\">sql\n      daodebugsqlinfo\n      logging.level.org.mybatis=debug logging.level.dao=debug\n   -->\n\n  <!--\n      rootlevel\n      level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF\n      INHERITEDNULLDEBUG\n      appenderlogger\n  -->\n  <!-- 4  \n                   (root) + profile, loggerpackage(root)-->\n  <!-- root DEBUG -->\n  <root>\n    <!-- debug -->\n    <level value=\"INFO\"/>\n    <!--  -->\n    <appender-ref ref=\"console\"/>\n    <!--  -->\n    <appender-ref ref=\"ERROR\"/>\n    <appender-ref ref=\"WARN\"/>\n    <appender-ref ref=\"INFO\"/>\n  </root>\n\n  <logger name=\"org.hibernate.type.descriptor.sql.BasicBinder\" level=\"TRACE\"/>\n<!--  <logger name=\"org.hibernate.type.descriptor.sql.BasicExtractor\" level=\"TRACE\"/>-->\n  <logger name=\"org.hibernate.engine.QueryParameters\" level=\"DEBUG\"/>\n  <logger name=\"org.hibernate.engine.query.HQLQueryPlan\" level=\"DEBUG\"/>\n  <logger name=\"org.hibernate.SQL\" level=\"DEBUG\"/>\n  <!-- , warn -->\n  <logger name=\"org.springframework.jdbc.core.JdbcTemplate\" level=\"TRACE\"/>\n  <!-- info, application -->\n</configuration>\n```","slug":"20250501-3","published":1,"updated":"2025-05-01T09:29:50.778Z","comments":1,"layout":"post","photos":[],"_id":"cma56nfvn0001isjj99f3c6ak","content":"<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  OFF  FATAL  ERROR  WARN  INFO  DEBUG  TRACE  ALL --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  ROOT root  --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--   filter filter  --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- scan truetrue --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- scanPeriod scantrue1 --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- debug truelogbacklogbackfalse --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span> <span class=\"attr\">scan</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">scanPeriod</span>=<span class=\"string\">&quot;60 seconds&quot;</span> <span class=\"attr\">debug</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  &lt;jmxConfigurator/&gt;--&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--   --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;log.path&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;catalina.base&#125;/logs/&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  30 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;maxHistory&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;30&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">value</span>=<span class=\"string\">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %highlight($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %magenta($&#123;PID:-&#125;) [%X&#123;RequestId&#125;] [%yellow(%thread)] [%cyan(%logger&#123;50&#125; - %method:%line)] - %highlight(%msg%n)&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;LOG_PATTERN&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">value</span>=<span class=\"string\">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; $&#123;LOG_LEVEL_PATTERN:-%5p&#125; $&#123;PID:-&#125; [%X&#123;RequestId&#125;] [%thread] [%logger&#123;50&#125; - %method:%line] - %msg%n&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- ConsoleAppender  --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;console&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--appender--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- ERROR --&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  RollingFileAppender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;ERROR&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/error.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- WARN --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- onMath  onMismatch --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>ERROR<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- . --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/error/error-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- INFO appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;INFO&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/info.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>INFO<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/info/info-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- WARN appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;WARN&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/warn.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>WARN<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/warn/warn-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- DEBUG appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;DEBUG&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/DEBUG.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/debug/debug-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- TRACE appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;TRACE&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/TRACE.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>TRACE<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/trace/trace-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!-- sql --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;SQL&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">File</span>&gt;</span>$&#123;logPath&#125;sql.log<span class=\"tag\">&lt;/<span class=\"name\">File</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/SQL/sql-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;pattern&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;logger&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;appender&gt;&lt;logger&gt;name</span></span><br><span class=\"line\"><span class=\"comment\">    leveladdtivity</span></span><br><span class=\"line\"><span class=\"comment\">    name:logger</span></span><br><span class=\"line\"><span class=\"comment\">    level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF</span></span><br><span class=\"line\"><span class=\"comment\">          INHERITEDNULL</span></span><br><span class=\"line\"><span class=\"comment\">          logger</span></span><br><span class=\"line\"><span class=\"comment\">    addtivity:loggertrue</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;logger name=&quot;org.springframework.web&quot; level=&quot;info&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;logger name=&quot;org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor&quot; level=&quot;INFO&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">  --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">      mybatissqldebuginfosql</span></span><br><span class=\"line\"><span class=\"comment\">      &lt;root level=&quot;info&quot;&gt;&lt;root level=&quot;DEBUG&quot;&gt;sql</span></span><br><span class=\"line\"><span class=\"comment\">      daodebugsqlinfo</span></span><br><span class=\"line\"><span class=\"comment\">      logging.level.org.mybatis=debug logging.level.dao=debug</span></span><br><span class=\"line\"><span class=\"comment\">   --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">      rootlevel</span></span><br><span class=\"line\"><span class=\"comment\">      level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF</span></span><br><span class=\"line\"><span class=\"comment\">      INHERITEDNULLDEBUG</span></span><br><span class=\"line\"><span class=\"comment\">      appenderlogger</span></span><br><span class=\"line\"><span class=\"comment\">  --&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 4  </span></span><br><span class=\"line\"><span class=\"comment\">                   (root) + profile, loggerpackage(root)--&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- root DEBUG --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- debug --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">level</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;INFO&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;console&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;ERROR&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;WARN&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;INFO&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.type.descriptor.sql.BasicBinder&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;TRACE&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  &lt;logger name=&quot;org.hibernate.type.descriptor.sql.BasicExtractor&quot; level=&quot;TRACE&quot;/&gt;--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.engine.QueryParameters&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.engine.query.HQLQueryPlan&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.SQL&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- , warn --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;TRACE&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- info, application --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>","excerpt":"","more":"<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  OFF  FATAL  ERROR  WARN  INFO  DEBUG  TRACE  ALL --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  ROOT root  --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--   filter filter  --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- scan truetrue --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- scanPeriod scantrue1 --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- debug truelogbacklogbackfalse --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span> <span class=\"attr\">scan</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">scanPeriod</span>=<span class=\"string\">&quot;60 seconds&quot;</span> <span class=\"attr\">debug</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  &lt;jmxConfigurator/&gt;--&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--   --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;log.path&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;catalina.base&#125;/logs/&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  30 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;maxHistory&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;30&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">value</span>=<span class=\"string\">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %highlight($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %magenta($&#123;PID:-&#125;) [%X&#123;RequestId&#125;] [%yellow(%thread)] [%cyan(%logger&#123;50&#125; - %method:%line)] - %highlight(%msg%n)&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;LOG_PATTERN&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">value</span>=<span class=\"string\">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; $&#123;LOG_LEVEL_PATTERN:-%5p&#125; $&#123;PID:-&#125; [%X&#123;RequestId&#125;] [%thread] [%logger&#123;50&#125; - %method:%line] - %msg%n&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- ConsoleAppender  --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;console&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--appender--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- ERROR --&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--  RollingFileAppender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;ERROR&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/error.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- WARN --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- onMath  onMismatch --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>ERROR<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- . --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/error/error-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- INFO appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;INFO&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/info.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>INFO<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/info/info-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- WARN appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;WARN&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/warn.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>WARN<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/warn/warn-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- DEBUG appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;DEBUG&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/DEBUG.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/debug/debug-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- TRACE appender --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;TRACE&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/TRACE.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>TRACE<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/trace/trace-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">&lt;!-- sql --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;SQL&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">File</span>&gt;</span>$&#123;logPath&#125;sql.log<span class=\"tag\">&lt;/<span class=\"name\">File</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/SQL/sql-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>10MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">totalSizeCap</span>&gt;</span>1GB<span class=\"tag\">&lt;/<span class=\"name\">totalSizeCap</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">cleanHistoryOnStart</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cleanHistoryOnStart</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;pattern&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;logger&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;appender&gt;&lt;logger&gt;name</span></span><br><span class=\"line\"><span class=\"comment\">    leveladdtivity</span></span><br><span class=\"line\"><span class=\"comment\">    name:logger</span></span><br><span class=\"line\"><span class=\"comment\">    level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF</span></span><br><span class=\"line\"><span class=\"comment\">          INHERITEDNULL</span></span><br><span class=\"line\"><span class=\"comment\">          logger</span></span><br><span class=\"line\"><span class=\"comment\">    addtivity:loggertrue</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;logger name=&quot;org.springframework.web&quot; level=&quot;info&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;logger name=&quot;org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor&quot; level=&quot;INFO&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">  --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">      mybatissqldebuginfosql</span></span><br><span class=\"line\"><span class=\"comment\">      &lt;root level=&quot;info&quot;&gt;&lt;root level=&quot;DEBUG&quot;&gt;sql</span></span><br><span class=\"line\"><span class=\"comment\">      daodebugsqlinfo</span></span><br><span class=\"line\"><span class=\"comment\">      logging.level.org.mybatis=debug logging.level.dao=debug</span></span><br><span class=\"line\"><span class=\"comment\">   --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">      rootlevel</span></span><br><span class=\"line\"><span class=\"comment\">      level:TRACE, DEBUG, INFO, WARN, ERROR, ALL  OFF</span></span><br><span class=\"line\"><span class=\"comment\">      INHERITEDNULLDEBUG</span></span><br><span class=\"line\"><span class=\"comment\">      appenderlogger</span></span><br><span class=\"line\"><span class=\"comment\">  --&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 4  </span></span><br><span class=\"line\"><span class=\"comment\">                   (root) + profile, loggerpackage(root)--&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- root DEBUG --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- debug --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">level</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;INFO&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;console&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;ERROR&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;WARN&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;INFO&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.type.descriptor.sql.BasicBinder&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;TRACE&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  &lt;logger name=&quot;org.hibernate.type.descriptor.sql.BasicExtractor&quot; level=&quot;TRACE&quot;/&gt;--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.engine.QueryParameters&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.engine.query.HQLQueryPlan&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.hibernate.SQL&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- , warn --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;TRACE&quot;</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- info, application --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"Redis ","date":"2025-05-01T08:57:07.000Z","lastmod":"2025-05-01T08:57:07.000Z","_content":"#  Redis \n## \n\n```bash\nwget http://download.redis.io/releases/redis-5.0.14.tar.gz\nwget https://download.redis.io/releases/redis-6.2.7.tar.gz\ntar xzf redis-5.0.14.tar.gz\ncd redis-5.0.14\nmake MALLOC=libc\n```\n\n### redis-server \n\n`redis.conf``daemonize no``daemonize yes`\n\n###  redis\n\n`redis.conf` `bind 127.0.0.1` \n\n###  redis \n\n`redis.conf`  database\n**Redisdb0**\n\n## Redis-cluster\n\n> redis5 redis-trib.rb\n\n### \n\n> Redis-Cluster\n> \n\n### \n\n> RedisRedis Sentinel\n> Redis SentinelRedis Sentinel\n\n### \n\n> Redis-clusterkey\n> 16384slotkey-valueslotslotkeyslot_number=crc16(key)%16384crc1616\n> 01638316384\n\n### redirect\n\n> Redis\n> \n> \n\n### \n\n#### \n\n```bash\n# redis.conf\nbind 0.0.0.0\nport 7001\ndaemonize yes\npidfile /var/run/redis_7001.pid\ndir \"./\" # node.conf\nlogfile \"/var/log/redis/7001/redis.log\"\nappendonly yes # \n\n# appendfsync always     #AOF,Redis\n# appendfsync everysec  #\n# appendfsync no      #\n\nappendfsync always\n\ncluster-enabled yes\ncluster-config-file nodes-7001.conf # \n```\n\n> node.confcluster-config\n\n#### \n\n> redis\n\n```bash\nredis-cli --cluster create ip:7001 ip:7002 127.0.0.1:7003 ip:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 \n# --cluster-replicas 1  11:1\n```\n\n#### \n\n#### \n\n> -c\n\n```bash\nredis-cli -c -h 127.0.0.1 -p 7001 cluster nodes\n```\n\n\n\n* -credis\n* -hIP\n* -p\n* cluster nodes\n* cluster info\n\n```bash\n\n/redis-cli --cluster check 127.0.0.1:7001\n```\n\n### \n\n#### \n\n```bash\nredis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-master-id node_id \n```\n\n#### hash\n\nhashredis16384\n\n```bash\nredis-cli --cluster reshard host:port --cluster-from node_id --cluster-to node_id --cluster-slots <args> --cluster-yes \n```\n\n#### \n\n```bash\nredis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-slave --cluster-master-id node_id \n```\n\n#### \n\n```bash\nredis-cli --cluster  del-node host:port node_id\n```\n\n### \n\n> -ca","source":"_posts/20250501/2.md","raw":"---\ntitle: Redis \ndate: 2025-05-01 16:57:07\nlastmod: 2025-05-01 16:57:07\ntags: [Redis,Linux]\ncategory: Redis\n---\n#  Redis \n## \n\n```bash\nwget http://download.redis.io/releases/redis-5.0.14.tar.gz\nwget https://download.redis.io/releases/redis-6.2.7.tar.gz\ntar xzf redis-5.0.14.tar.gz\ncd redis-5.0.14\nmake MALLOC=libc\n```\n\n### redis-server \n\n`redis.conf``daemonize no``daemonize yes`\n\n###  redis\n\n`redis.conf` `bind 127.0.0.1` \n\n###  redis \n\n`redis.conf`  database\n**Redisdb0**\n\n## Redis-cluster\n\n> redis5 redis-trib.rb\n\n### \n\n> Redis-Cluster\n> \n\n### \n\n> RedisRedis Sentinel\n> Redis SentinelRedis Sentinel\n\n### \n\n> Redis-clusterkey\n> 16384slotkey-valueslotslotkeyslot_number=crc16(key)%16384crc1616\n> 01638316384\n\n### redirect\n\n> Redis\n> \n> \n\n### \n\n#### \n\n```bash\n# redis.conf\nbind 0.0.0.0\nport 7001\ndaemonize yes\npidfile /var/run/redis_7001.pid\ndir \"./\" # node.conf\nlogfile \"/var/log/redis/7001/redis.log\"\nappendonly yes # \n\n# appendfsync always     #AOF,Redis\n# appendfsync everysec  #\n# appendfsync no      #\n\nappendfsync always\n\ncluster-enabled yes\ncluster-config-file nodes-7001.conf # \n```\n\n> node.confcluster-config\n\n#### \n\n> redis\n\n```bash\nredis-cli --cluster create ip:7001 ip:7002 127.0.0.1:7003 ip:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 \n# --cluster-replicas 1  11:1\n```\n\n#### \n\n#### \n\n> -c\n\n```bash\nredis-cli -c -h 127.0.0.1 -p 7001 cluster nodes\n```\n\n\n\n* -credis\n* -hIP\n* -p\n* cluster nodes\n* cluster info\n\n```bash\n\n/redis-cli --cluster check 127.0.0.1:7001\n```\n\n### \n\n#### \n\n```bash\nredis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-master-id node_id \n```\n\n#### hash\n\nhashredis16384\n\n```bash\nredis-cli --cluster reshard host:port --cluster-from node_id --cluster-to node_id --cluster-slots <args> --cluster-yes \n```\n\n#### \n\n```bash\nredis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-slave --cluster-master-id node_id \n```\n\n#### \n\n```bash\nredis-cli --cluster  del-node host:port node_id\n```\n\n### \n\n> -ca","slug":"20250501-2","published":1,"updated":"2025-05-01T09:12:14.022Z","comments":1,"layout":"post","photos":[],"_id":"cma56nfvs0004isjj2ege7b7j","content":"<h1>Redis </h1>\n<h2 id=\"\"></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://download.redis.io/releases/redis-5.0.14.tar.gz</span><br><span class=\"line\">wget https://download.redis.io/releases/redis-6.2.7.tar.gz</span><br><span class=\"line\">tar xzf redis-5.0.14.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> redis-5.0.14</span><br><span class=\"line\">make MALLOC=libc</span><br></pre></td></tr></table></figure>\n<h3 id=\"redis-server-\">redis-server </h3>\n<p><code>redis.conf</code><code>daemonize no</code><code>daemonize yes</code></p>\n<h3 id=\"-redis\"> redis</h3>\n<p><code>redis.conf</code> <code>bind 127.0.0.1</code> </p>\n<h3 id=\"-redis-\"> redis </h3>\n<p><code>redis.conf</code>  database<br>\n<strong>Redisdb0</strong></p>\n<h2 id=\"Redis-cluster\">Redis-cluster</h2>\n<blockquote>\n<p>redis5 redis-trib.rb</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>Redis-Cluster<br>\n</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>RedisRedis Sentinel<br>\nRedis SentinelRedis Sentinel</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>Redis-clusterkey<br>\n16384slotkey-valueslotslotkeyslot_number=crc16(key)%16384crc1616<br>\n01638316384</p>\n</blockquote>\n<h3 id=\"redirect\">redirect</h3>\n<blockquote>\n<p>Redis<br>\n<br>\n</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># redis.conf</span></span><br><span class=\"line\"><span class=\"built_in\">bind</span> 0.0.0.0</span><br><span class=\"line\">port 7001</span><br><span class=\"line\">daemonize <span class=\"built_in\">yes</span></span><br><span class=\"line\">pidfile /var/run/redis_7001.pid</span><br><span class=\"line\"><span class=\"built_in\">dir</span> <span class=\"string\">&quot;./&quot;</span> <span class=\"comment\"># node.conf</span></span><br><span class=\"line\">logfile <span class=\"string\">&quot;/var/log/redis/7001/redis.log&quot;</span></span><br><span class=\"line\">appendonly <span class=\"built_in\">yes</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># appendfsync always     #AOF,Redis</span></span><br><span class=\"line\"><span class=\"comment\"># appendfsync everysec  #</span></span><br><span class=\"line\"><span class=\"comment\"># appendfsync no      #</span></span><br><span class=\"line\"></span><br><span class=\"line\">appendfsync always</span><br><span class=\"line\"></span><br><span class=\"line\">cluster-enabled <span class=\"built_in\">yes</span></span><br><span class=\"line\">cluster-config-file nodes-7001.conf <span class=\"comment\"># </span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>node.confcluster-config</p>\n</blockquote>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>redis</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster create ip:7001 ip:7002 127.0.0.1:7003 ip:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 </span><br><span class=\"line\"><span class=\"comment\"># --cluster-replicas 1  11:1</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>-c</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli -c -h 127.0.0.1 -p 7001 cluster nodes</span><br></pre></td></tr></table></figure>\n<p></p>\n<ul>\n<li>-credis</li>\n<li>-hIP</li>\n<li>-p</li>\n<li>cluster nodes</li>\n<li>cluster info</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">/redis-cli --cluster check 127.0.0.1:7001</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-master-id node_id </span><br></pre></td></tr></table></figure>\n<h4 id=\"hash\">hash</h4>\n<p>hashredis16384</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster reshard host:port --cluster-from node_id --cluster-to node_id --cluster-slots &lt;args&gt; --cluster-yes </span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-slave --cluster-master-id node_id </span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster  del-node host:port node_id</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>-ca</p>\n</blockquote>\n","excerpt":"","more":"<h1>Redis </h1>\n<h2 id=\"\"></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://download.redis.io/releases/redis-5.0.14.tar.gz</span><br><span class=\"line\">wget https://download.redis.io/releases/redis-6.2.7.tar.gz</span><br><span class=\"line\">tar xzf redis-5.0.14.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> redis-5.0.14</span><br><span class=\"line\">make MALLOC=libc</span><br></pre></td></tr></table></figure>\n<h3 id=\"redis-server-\">redis-server </h3>\n<p><code>redis.conf</code><code>daemonize no</code><code>daemonize yes</code></p>\n<h3 id=\"-redis\"> redis</h3>\n<p><code>redis.conf</code> <code>bind 127.0.0.1</code> </p>\n<h3 id=\"-redis-\"> redis </h3>\n<p><code>redis.conf</code>  database<br>\n<strong>Redisdb0</strong></p>\n<h2 id=\"Redis-cluster\">Redis-cluster</h2>\n<blockquote>\n<p>redis5 redis-trib.rb</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>Redis-Cluster<br>\n</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>RedisRedis Sentinel<br>\nRedis SentinelRedis Sentinel</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>Redis-clusterkey<br>\n16384slotkey-valueslotslotkeyslot_number=crc16(key)%16384crc1616<br>\n01638316384</p>\n</blockquote>\n<h3 id=\"redirect\">redirect</h3>\n<blockquote>\n<p>Redis<br>\n<br>\n</p>\n</blockquote>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># redis.conf</span></span><br><span class=\"line\"><span class=\"built_in\">bind</span> 0.0.0.0</span><br><span class=\"line\">port 7001</span><br><span class=\"line\">daemonize <span class=\"built_in\">yes</span></span><br><span class=\"line\">pidfile /var/run/redis_7001.pid</span><br><span class=\"line\"><span class=\"built_in\">dir</span> <span class=\"string\">&quot;./&quot;</span> <span class=\"comment\"># node.conf</span></span><br><span class=\"line\">logfile <span class=\"string\">&quot;/var/log/redis/7001/redis.log&quot;</span></span><br><span class=\"line\">appendonly <span class=\"built_in\">yes</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># appendfsync always     #AOF,Redis</span></span><br><span class=\"line\"><span class=\"comment\"># appendfsync everysec  #</span></span><br><span class=\"line\"><span class=\"comment\"># appendfsync no      #</span></span><br><span class=\"line\"></span><br><span class=\"line\">appendfsync always</span><br><span class=\"line\"></span><br><span class=\"line\">cluster-enabled <span class=\"built_in\">yes</span></span><br><span class=\"line\">cluster-config-file nodes-7001.conf <span class=\"comment\"># </span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>node.confcluster-config</p>\n</blockquote>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>redis</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster create ip:7001 ip:7002 127.0.0.1:7003 ip:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 </span><br><span class=\"line\"><span class=\"comment\"># --cluster-replicas 1  11:1</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<h4 id=\"\"></h4>\n<blockquote>\n<p>-c</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli -c -h 127.0.0.1 -p 7001 cluster nodes</span><br></pre></td></tr></table></figure>\n<p></p>\n<ul>\n<li>-credis</li>\n<li>-hIP</li>\n<li>-p</li>\n<li>cluster nodes</li>\n<li>cluster info</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">/redis-cli --cluster check 127.0.0.1:7001</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-master-id node_id </span><br></pre></td></tr></table></figure>\n<h4 id=\"hash\">hash</h4>\n<p>hashredis16384</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster reshard host:port --cluster-from node_id --cluster-to node_id --cluster-slots &lt;args&gt; --cluster-yes </span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster add-node new_host:new_port existing_host:existing_port --cluster-slave --cluster-master-id node_id </span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --cluster  del-node host:port node_id</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"></h3>\n<blockquote>\n<p>-ca</p>\n</blockquote>\n"},{"title":"js ","date":"2025-05-01T08:57:07.000Z","lastmod":"2025-05-01T08:57:07.000Z","_content":"\n```js\nFunction.prototype.__constructor_back = Function.prototype.constructor ;\nFunction.prototype.constructor = function() {\n  if(arguments && typeof arguments[0]==='string'){\n    //alert(\"new function: \"+ arguments[0]);\n    if( \"debugger\" === arguments[0]){\n      //arguments[0]=\"consoLe.Log(\\\"anti debugger\\\");\";\n      //arguments[0]=\";\";\n      return\n    }\n  }\n  return Function.prototype.__constructor_back.apply(this,arguments);\n}\n```","source":"_posts/20250501/4.md","raw":"---\ntitle: js \ndate: 2025-05-01 16:57:07\nlastmod: 2025-05-01 16:57:07\ntags: [Javascript]\ncategory: Javascript\n---\n\n```js\nFunction.prototype.__constructor_back = Function.prototype.constructor ;\nFunction.prototype.constructor = function() {\n  if(arguments && typeof arguments[0]==='string'){\n    //alert(\"new function: \"+ arguments[0]);\n    if( \"debugger\" === arguments[0]){\n      //arguments[0]=\"consoLe.Log(\\\"anti debugger\\\");\";\n      //arguments[0]=\";\";\n      return\n    }\n  }\n  return Function.prototype.__constructor_back.apply(this,arguments);\n}\n```","slug":"20250501-4","published":1,"updated":"2025-05-01T09:31:37.986Z","comments":1,"layout":"post","photos":[],"_id":"cma56nfvs0005isjj2cea5i9y","content":"<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">__constructor_back</span> = <span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">constructor</span> ;</span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">constructor</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable language_\">arguments</span> &amp;&amp; <span class=\"keyword\">typeof</span> <span class=\"variable language_\">arguments</span>[<span class=\"number\">0</span>]===<span class=\"string\">&#x27;string&#x27;</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//alert(&quot;new function: &quot;+ arguments[0]);</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"string\">&quot;debugger&quot;</span> === <span class=\"variable language_\">arguments</span>[<span class=\"number\">0</span>])&#123;</span><br><span class=\"line\">      <span class=\"comment\">//arguments[0]=&quot;consoLe.Log(\\&quot;anti debugger\\&quot;);&quot;;</span></span><br><span class=\"line\">      <span class=\"comment\">//arguments[0]=&quot;;&quot;;</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">__constructor_back</span>.<span class=\"title function_\">apply</span>(<span class=\"variable language_\">this</span>,<span class=\"variable language_\">arguments</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">__constructor_back</span> = <span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">constructor</span> ;</span><br><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">constructor</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable language_\">arguments</span> &amp;&amp; <span class=\"keyword\">typeof</span> <span class=\"variable language_\">arguments</span>[<span class=\"number\">0</span>]===<span class=\"string\">&#x27;string&#x27;</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//alert(&quot;new function: &quot;+ arguments[0]);</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"string\">&quot;debugger&quot;</span> === <span class=\"variable language_\">arguments</span>[<span class=\"number\">0</span>])&#123;</span><br><span class=\"line\">      <span class=\"comment\">//arguments[0]=&quot;consoLe.Log(\\&quot;anti debugger\\&quot;);&quot;;</span></span><br><span class=\"line\">      <span class=\"comment\">//arguments[0]=&quot;;&quot;;</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">__constructor_back</span>.<span class=\"title function_\">apply</span>(<span class=\"variable language_\">this</span>,<span class=\"variable language_\">arguments</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"EMQX K3s ","date":"2025-05-01T08:57:07.000Z","lastmod":"2025-05-01T08:57:07.000Z","_content":"\n\n\n#  EMQX MQTT  K8S \n\n<iframe src=\"/widgets/metadata/\" data-src=\"/widgets/metadata/\" data-subtype=\"widget\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"height: 441px;\"></iframe>\n\n---\n\n*  EMQX MQTT  K8S  - www.emqx.com\n* [https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster](https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster)\n*  EMQX MQTT  K8S \n* 2024-06-28 10:42:05\n\n---\n\nEMQX Team  Helm chart  kubernetes  EMQX [MQTT ](https://www.emqx.com/zh/products/emqx),  EMQX Team  kubernetes  k3s  EMQX MQTT   yaml  EMQX MQTT  K8S , \n\n kubernetes  kubernetes \n\n##  K8S  EMQX MQTT\n\n###  Pod  EMQX Broker\n\nKubernetes [Pod](https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-overview/)Pod  Kubernetes  Kubernetes Pod  [](https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-cluster) \n\nEMQX Broker  [docker hub](https://hub.docker.com/r/emqx/emqx) ,  pod  EMQX Broker `kubectl run`  EMQX Broker  Pod\n\n```\n$ kubectl run emqx --image=emqx/emqx:v4.1-rc.1  --generator=run-pod/v1\npod/emqx created\n```\n\n EMQX Broker \n\n```\n$ kubectl get pods -o wide\nNAME   READY   STATUS    RESTARTS   AGE\nemqx   1/1     Running   0          3m13s\n\n$ kubectl exec emqx -- emqx_ctl status\nNode 'emqx@192.168.77.108' is started\nemqx 4.1-rc.1 is running\n```\n\n Pod\n\n```\n$ kubectl delete pods emqx\npod \"emqx\" deleted\n```\n\nPod  Pod\n\n###  Deoloyment  Pod\n\n[Deployment](https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/)  Pod  ReplicaSet declarative[ReplicationController](https://www.kubernetes.org.cn/replication-controller-kubernetes) \n\n* DeploymentPodReplicaSet\n* \n* \n* Deployment\n\n Deployment  EMQX Broker Pod\n\n*  Deployment\n\n  ```\n  $ cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 1\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n  ```\n*  Deployment\n\n  ```\n  $  kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n  ```\n* \n\n  ```\n  $ kubectl get deployment\n  NAME                              READY   UP-TO-DATE   AVAILABLE   AGE\n  deployment.apps/emqx-deployment   3/3     3            3           74s\n\n  $ kubectl get pods\n  NAME                                  READY   STATUS    RESTARTS   AGE\n  pod/emqx-deployment-7c44dbd68-8j77l   1/1     Running   0          74s\n\n  $ kubectl exec pod/emqx-deployment-7c44dbd68-8j77l -- emqx_ctl status\n  Node 'emqx-deployment-7c44dbd68-8j77l@192.168.77.117' is started\n  emqx 4.1-rc.1 is running\n  ```\n*  Pod\n\n  ```\n  $ kubectl delete pods emqx-deployment-7c44dbd68-8j77l\n  pod \"emqx-deployment-7c44dbd68-8j77l\" deleted\n\n  $ kubectl get pods\n  NAME                              READY   STATUS    RESTARTS   AGE\n  emqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          59s\n  ```\n\n   Deployment  EMQX Broker Pod Pod Deployment  Pod\n\n###  Services  EMQX Broker Pod \n\nKubernetes [Pods](https://kubernetes.io/docs/concepts/workloads/pods/)   [Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)  Pod\n\n Pod  IP  Deployment  Pod  Pod \n\n EMQX Broker Pod  **MQTT ** IP  EMQX Broker \n\nService\n\nService  [Pods](https://kubernetes.io/docs/concepts/workloads/pods/) \n\n Service  EMQX Broker Pod \n\n*  Service\n\n  ```\n  $cat service.yaml\n\n  apiVersion: v1\n  kind: Service\n  metadata:\n    name: emqx-service\n  spec:\n    selector:\n      app: emqx\n    ports:\n      - name: mqtt\n        port: 1883\n        protocol: TCP\n        targetPort: mqtt\n      - name: mqttssl\n        port: 8883\n        protocol: TCP\n        targetPort: mqttssl\n      - name: mgmt\n        port: 8081\n        protocol: TCP\n        targetPort: mgmt\n      - name: ws\n        port: 8083\n        protocol: TCP\n        targetPort: ws\n      - name: wss\n        port: 8084\n        protocol: TCP\n        targetPort: wss\n      - name: dashboard\n        port: 18083\n        protocol: TCP\n        targetPort: dashboard\n  ```\n*  Service\n\n  ```\n  $ kubectl apply -f service.yaml\n  service/emqx-service created\n  ```\n* \n\n  ```\n  $ kubectl get svc\n  NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                                        AGE\n  emqx-service   ClusterIP   10.96.54.205   <none>        1883/TCP,8883/TCP,8081/TCP,8083/TCP,8084/TCP,18083/TCP   58s\n  ```\n*  Service  IP  EMQX Broker  API\n\n  ```\n  $ curl 10.96.54.205:8081/status\n  Node emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120 is started\n  emqx is running\n  ```\n\n EMQX Broker  kubernetes  Deployment  EMQX Broker Pod Service  EMQX Broker \n\n##  kubernetes  EMQX MQTT \n\n Deployment  EMQX Broker Pod Deployment  Pod  `kubectl scale deployment ${deployment_name} --replicas ${numer}`  Pod  EMQX Broker Pod  3 \n\n```\n$ kubectl scale deployment emqx-deployment --replicas 3\ndeployment.apps/emqx-deployment scaled\n\n$ kubectl get pods\nNAME                               READY   STATUS    RESTARTS   AGE\nemqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          18m\nemqx-deployment-68fcb4bfd6-mpvch   1/1     Running   0          6s\nemqx-deployment-68fcb4bfd6-mx55q   1/1     Running   0          6s\n\n$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl status\nNode 'emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120' is started\nemqx 4.1-rc.1 is running\n\n$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl cluster status\nCluster status: #{running_nodes =>\n                      ['emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120'],\n                  stopped_nodes => []}\n```\n\n EMQX Broker Pod  3  Pod  kubernetes  EMQX Broker Pod\n\n###  EMQX Broker \n\n EMQX Broker [](https://docs.emqx.com/zh/emqx/latest/deploy/cluster/introduction.html) EMQX Broker \n\n```\ncluster.discovery = kubernetes\ncluster.kubernetes.apiserver = http://10.110.111.204:8080\ncluster.kubernetes.service_name = ekka\ncluster.kubernetes.address_type = ip\ncluster.kubernetes.app_name = ekka\n```\n\n `cluster.kubernetes.apiserver`  kubernetes apiserver  `kubectl cluster-info` `cluster.kubernetes.service_name`  Service  name `cluster.kubernetes.app_name`  EMQX Broker  `node.name`  `@`  EMQX Broker  `node.name` \n\nEMQX Broker  docker  [docker hub](https://hub.docker.com/r/emqx/emqx)  [Github](https://github.com/emqx/emqx-rel/blob/master/deploy/docker/README.md)\n\n*  Deployment  yaml \n\n  ```\n  $ cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          env:\n          - name: EMQX_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__DISCOVERY\n            value: k8s\n          - name: EMQX_CLUSTER__K8S__APP_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__K8S__SERVICE_NAME\n            value: emqx-service\n          - name: EMQX_CLUSTER__K8S__APISERVER\n            value: \"https://kubernetes.default.svc:443\"\n          - name: EMQX_CLUSTER__K8S__NAMESPACE\n            value: default\n  ```\n\n  >  ``kubectl scale deployment ${deployment_name} --replicas ${numer}` yaml  yaml `spec.replicas: 3` \n  >\n  > Pod  kubernetes  DNS  `https://kubernetes.default.svc:443`  kubernetes apiserver  \n  >\n*  Deployment\n\n  ```\n  $ kubectl delete deployment emqx-deployment\n  deployment.apps \"emqx-deployment\" deleted\n\n  $ kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n  ```\n\n###  Pod  kubernetes apiserver \n\n Deployment  EMQX Broker  EMQX Broker  EMQX Broker Pod  log\n\n```\n$ kubectl get pods\nNAME                               READY   STATUS    RESTARTS   AGE\nemqx-deployment-5c8cfc4d75-67lmt   1/1     Running   0          5s\nemqx-deployment-5c8cfc4d75-r6jgb   1/1     Running   0          5s\nemqx-deployment-5c8cfc4d75-wv2hj   1/1     Running   0          5s\n\n$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl status\nNode 'emqx@192.168.87.150' is started\nemqx 4.1-rc.1 is running\n\n$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl cluster status\nCluster status: #{running_nodes => ['emqx@192.168.87.150'],\n                  stopped_nodes => []}\n\n$ kubectl logs emqx-deployment-76f6895c46-4684f\n\n\n(emqx@192.168.87.150)1> 2020-05-20 01:48:39.726 [error] Ekka(AutoCluster): Discovery error: {403,\n                                     \"{\\\"kind\\\":\\\"Status\\\",\\\"apiVersion\\\":\\\"v1\\\",\\\"metadata\\\":{},\\\"status\\\":\\\"Failure\\\",\\\"message\\\":\\\"endpoints \\\\\\\"emqx-service\\\\\\\" is forbidden: User \\\\\\\"system:serviceaccount:default:default\\\\\\\" cannot get resource \\\\\\\"endpoints\\\\\\\" in API group \\\\\\\"\\\\\\\" in the namespace \\\\\\\"default\\\\\\\"\\\",\\\"reason\\\":\\\"Forbidden\\\",\\\"details\\\":{\\\"name\\\":\\\"emqx-service\\\",\\\"kind\\\":\\\"endpoints\\\"},\\\"code\\\":403}\\n\"}\n\n```\n\nPod  kubernetes apiserver  HTTP 403\n\n Pod  kubernetes apiserver  kubernetes apiserver  http  ServiceAccountRole  RoleBinding  RBAC \n\n*   ServiceAccountRole  RoleBinding\n\n  ```\n  $ cat rbac.yaml\n\n  apiVersion: v1\n  kind: ServiceAccount\n  metadata:\n    namespace: default\n    name: emqx\n  ---\n  kind: Role\n  apiVersion: rbac.authorization.kubernetes.io/v1beta1\n  metadata:\n    namespace: default\n    name: emqx\n  rules:\n  - apiGroups:\n    - \"\"\n    resources:\n    - endpoints \n    verbs: \n    - get\n    - watch\n    - list\n  ---\n  kind: RoleBinding\n  apiVersion: rbac.authorization.kubernetes.io/v1beta1\n  metadata:\n    namespace: default\n    name: emqx\n  subjects:\n    - kind: ServiceAccount\n      name: emqx\n      namespace: default\n  roleRef:\n    kind: Role\n    name: emqx\n    apiGroup: rbac.authorization.kubernetes.io\n  ```\n* \n\n  ```\n  $ kubectl apply -f rbac.yaml\n  serviceaccount/emqx created\n  role.rbac.authorization.kubernetes.io/emqx created\n  rolebinding.rbac.authorization.kubernetes.io/emqx created\n  ```\n*  Deployment  yaml  `spec.template.spec.serviceAccountName`\n\n  ```\n  $cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          env:\n          - name: EMQX_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__DISCOVERY\n            value: kubernetes\n          - name: EMQX_CLUSTER__K8S__APP_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__K8S__SERVICE_NAME\n            value: emqx-service\n          - name: EMQX_CLUSTER__K8S__APISERVER\n            value: \"https://kubernetes.default.svc:443\"\n          - name: EMQX_CLUSTER__K8S__NAMESPACE\n            value: default\n\n  $ kubectl delete deployment emqx-deployment\n  deployment.apps \"emqx-deployment\" deleted\n\n  $ kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n  ```\n* \n\n  ```\n  $ kubectl get pods\n  NAME                              READY   STATUS    RESTARTS   AGE\n  emqx-deployment-6b854486c-dhd7p   1/1     Running   0          10s\n  emqx-deployment-6b854486c-psv2r   1/1     Running   0          10s\n  emqx-deployment-6b854486c-tdzld   1/1     Running   0          10s\n\n  $ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl status\n  Node 'emqx@192.168.77.92' is started\n  emqx 4.1-rc.1 is running\n\n  $ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.115','emqx@192.168.77.92',\n                         'emqx@192.168.87.157'],\n                    stopped_nodes => []}\n  ```\n*  Pod\n\n  ```\n  $ kubectl delete pods emqx-deployment-6b854486c-dhd7p\n  pod \"emqx-deployment-6b854486c-dhd7p\" deleted\n\n  $ kubectl get pods\n  NAME                              READY   STATUS    RESTARTS   AGE\n  emqx-deployment-6b854486c-846v7   1/1     Running   0          56s\n  emqx-deployment-6b854486c-psv2r   1/1     Running   0          3m50s\n  emqx-deployment-6b854486c-tdzld   1/1     Running   0          3m50s\n\n  $ kubectl exec emqx-deployment-6b854486c-846v7 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.115','emqx@192.168.77.84',\n                         'emqx@192.168.87.157'],\n                    stopped_nodes => ['emqx@192.168.77.92']}\n  ```\n\n   EMQX Broker  Pod Deployment  Pod \n\nEMQX Broker  kubernetes \n\n##  EMQX Broker \n\n Deployment  Pod Pod  Pod  EMQX Broker  EMQX Broker  Pod EMQX Broker \n\n### ConfigMap\n\n[ConfigMap](https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/)  configMap  API \n\nConfigMap  [](https://kubernetes.io/docs/concepts/overview/#why-containers) \n\n> ConfigMap  [Secret](https://kubernetes.io/docs/concepts/configuration/secret/)  ConfigMap\n\n ConfigMap  EMQX Broker  Deployment \n\n*  Configmap\n\n  ```\n  $cat configmap.yaml\n\n  apiVersion: v1\n  kind: ConfigMap\n  metadata:\n    name: emqx-config\n  data:\n    EMQX_CLUSTER__K8S__ADDRESS_TYPE: \"hostname\"\n    EMQX_CLUSTER__K8S__APISERVER: \"https://kubernetes.default.svc:443\"\n    EMQX_CLUSTER__K8S__SUFFIX: \"svc.cluster.local\"\n\n  $ kubectl apply -f configmap.yaml\n  configmap/emqx-config created\n  ```\n*  Deployment  Configmap\n\n  ```\n  $cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          envFrom:\n            - configMapRef:\n                name: emqx-config\n  ```\n*  Deployment\n\n  ```\n  $ kubectl delete -f deployment.yaml\n  deployment.apps \"emqx-deployment\" deleted\n\n  $ kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n\n  $ kubectl get pods\n  NAME                               READY   STATUS    RESTARTS   AGE\n  emqx-deployment-5c7696b5d7-k9lzj   1/1     Running   0          3s\n  emqx-deployment-5c7696b5d7-mdwkt   1/1     Running   0          3s\n  emqx-deployment-5c7696b5d7-z57z7   1/1     Running   0          3s\n\n  $ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl status\n  Node 'emqx@192.168.87.149' is started\n  emqx 4.1-rc.1 is running\n\n  $ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.106','emqx@192.168.77.107',\n                         'emqx@192.168.87.149'],\n                    stopped_nodes => []}\n  ```\n\nEMQX Broker  Configmap  Configmap Pod \n\n### StatefulSet\n\n[StatefulSet](https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/)  Deployments  ReplicaSets \n\n*  Pod  PVC \n*  Pod  PodName  HostName  Headless ServiceCluster IPService\n*  Pod 0N-1Pod Pod  Running  Ready  init containers \n* N-10\n\nStatefulSet\n\n* DNS domain Headless Service\n*  PersistentVolumes  volumeClaimTemplates\n*  StatefulSet\n\nStatefulSet  Pod  DNS  `statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local` \n\n* `serviceName`  Headless Service \n* `0..N-1`  Pod  0  N-1\n* `statefulSetName` StatefulSet\n* `namespace`  namespaceHeadless Servic  StatefulSet  namespace\n* `.cluster.local`  Cluster Domain\n\n StatefulSet  Deployment  Pod\n\n*  Deployment\n\n  ```\n  $ kubectl delete deployment emqx-deployment\n  deployment.apps \"emqx-deployment\" deleted\n  ```\n*  StatefulSet\n\n  ```\n  $cat statefulset.yaml\n\n  apiVersion: apps/v1\n  kind: StatefulSet\n  metadata:\n    name: emqx-statefulset\n    labels:\n      app: emqx\n  spec:\n    serviceName: emqx-headless\n    updateStrategy:\n      type: RollingUpdate\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          envFrom:\n            - configMapRef:\n                name: emqx-config\n  ```\n\n  StatefulSet  Headless Service  Service\n\n  ```\n  $cat headless.yaml\n\n  apiVersion: v1\n  kind: Service\n  metadata:\n    name: emqx-headless\n  spec:\n    type: ClusterIP\n    clusterIP: None\n    selector:\n      app: emqx\n    ports:\n    - name: mqtt\n      port: 1883\n      protocol: TCP\n      targetPort: 1883\n    - name: mqttssl\n      port: 8883\n      protocol: TCP\n      targetPort: 8883\n    - name: mgmt\n      port: 8081\n      protocol: TCP\n      targetPort: 8081\n    - name: websocket\n      port: 8083\n      protocol: TCP\n      targetPort: 8083\n    - name: wss\n      port: 8084\n      protocol: TCP\n      targetPort: 8084\n    - name: dashboard\n      port: 18083\n      protocol: TCP\n      targetPort: 18083\n  ```\n\n   Headless Service  IP `clusterIP: None` \n* \n\n  ```\n  $ kubectl apply -f headless-service.yaml\n  service/emqx-headless created\n\n  $ kubectl apply -f statefulset.yaml\n  statefulset.apps/emqx-deployment created\n\n  $ kubectl get pods\n  NAME                               READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0                 1/1     Running   0          2m59s\n  emqx-statefulset-1                 1/1     Running   0          2m57s\n  emqx-statefulset-2                 1/1     Running   0          2m54s\n\n  $ kubectl exec emqx-statefulset-0 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.105','emqx@192.168.87.153',\n                         'emqx@192.168.87.155'],\n                    stopped_nodes => []}\n  ```\n*  Configmap  \n  StatefulSet EMQX Broker  hostname  dns  IP  hostname  `emqx.conf`\n\n  ```\n  cluster.kubernetes.address_type = hostname\n  cluster.kubernetes.suffix = \"svc.cluster.local\"\n  ```\n\n  kubernetes  Pod  DNS EMQX Broker   `cluster.kubernetes.suffix`  DNS  DNS `statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local` DNS  serviceName  StatefulSet  Headless Service `cluster.kubernetes.service_name`   Headless Service Name  \n   Configmap \n\n  ```\n  EMQX_CLUSTER__K8S__ADDRESS_TYPE: \"hostname\"\n  EMQX_CLUSTER__K8S__SUFFIX: \"svc.cluster.local\"\n  EMQX_CLUSTER__K8S__SERVICE_NAME: emqx-headless\n  ```\n\n  Configmap  `$ kubectl edit configmap emqx-config`  Configmap\n*  StatefulSet  \n  Configmap  Pod  StatefulSet\n\n  ```\n  $ kubectl delete statefulset emqx-statefulset\n  statefulset.apps \"emqx-statefulset\" deleted\n\n  $ kubectl apply -f statefulset.yaml\n  statefulset.apps/emqx-statefulset created\n\n  $ kubectl get pods\n  NAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          115s\n  emqx-statefulset-1   1/1     Running   0          112s\n  emqx-statefulset-2   1/1     Running   0          110s\n\n  $ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local'],\n                    stopped_nodes => []}\n  ```\n\n   EMQX Broker \n*  Pod  \n  StatefulSet  Pod  PodName  HostName \n\n  ```\n  $ kubectl get pods\n  kuNAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          6m20s\n  emqx-statefulset-1   1/1     Running   0          6m17s\n  emqx-statefulset-2   1/1     Running   0          6m15s\n\n  $ kubectl delete pod emqx-statefulset-0\n  pod \"emqx-statefulset-0\" deleted\n\n  $ kubectl get pods\n  NAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          27s\n  emqx-statefulset-1   1/1     Running   0          9m45s\n  emqx-statefulset-2   1/1     Running   0          9m43s\n\n  $ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local'],\n                    stopped_nodes => []}\n  ```\n\n  StatefulSet  PodPod  EMQX Broker \n\n## StorageClassesPersistentVolume  PersistentVolumeClaim\n\nPersistentVolumePVPV  PV  Volume  PV  Pod  API   NFSiSCSI \n\nPersistentVolumeClaimPVC Pod Pod PVC  PV Pod CPU / \n\nStorageClass  \"class\"   class   Kubernetes  class  \n\n EMQX Broker  PV  StorageClass PVC  EMQX Broker  `/opt/emqx/data/mnesia` PodsEMQX  `/opt/emqx/data/mnesia`  EMQX Broker \n\n*  StatefulSet\n\n  ```\n  $cat statefulset.yaml\n\n  apiVersion: apps/v1\n  kind: StatefulSet\n  metadata:\n    name: emqx-statefulset\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    serviceName: emqx-headless\n    updateStrategy:\n      type: RollingUpdate\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        volumes:\n        - name: emqx-data\n          persistentVolumeClaim:\n            claimName: emqx-pvc\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          envFrom:\n            - configMapRef:\n                name: emqx-config\n          volumeMounts:\n          - name: emqx-data\n            mountPath: \"/opt/emqx/data/mnesia\"\n    volumeClaimTemplates:\n    - metadata:\n        name: emqx-pvc\n        annotations:\n          volume.alpha.kubernetes.io/storage-class: manual\n      spec:\n        accessModes: [ \"ReadWriteOnce\" ]\n        resources:\n          requests:\n            storage: 1Gi\n  ```\n\n   `volumeClaimTemplates`  StorageClass  name  manual  emqx-pvc  PVC PVC  `ReadWriteOnce` 1Gi  PVC  name  emqx-data  volumes volumes  Pod  `/opt/emqx/data/mnesia`  \n*   \n   StatefulSet  kubernetes \n\n  ```\n  $ kubectl apply -f statefulset.yaml\n  statefulset.apps/emqx-statefulset created\n\n  $ kubectl get pods\n  NAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          27s\n  emqx-statefulset-1   1/1     Running   0          9m45s\n  emqx-statefulset-2   1/1     Running   0          9m43s\n\n  $ kubectl get pvc\n  NAME                                 STATUS    VOLUME                                 CAPACITY   ACCESS MODES   STORAGECLASS   AGE\n  emqx-data-emqx-statefulset-0   Bound     pvc-8094cd75-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            2m11s\n  emqx-data-emqx-statefulset-0   Bound     pvc-9325441d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            99s\n  emqx-data-emqx-statefulset-0   Bound     pvc-ad425e9d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            56s\n  ```\n\n   PVC  BoundPVC  Pod EMQX Broker  PVC \n\nEMQX Broker  kubernetes  Demo [kubernetes ](https://kubernetes.io/zh-cn/docs/home/)   EMQX Team  [Helm chart ](https://github.com/emqx/emqx-rel/tree/master/deploy/charts/emqx)  Github  issuepull requests  start\n\n\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: emqx-deployment\n  labels:\n    app: emqx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: emqx\n  template:\n    metadata:\n      labels:\n        app: emqx\n    spec:\n      containers:\n      - name: emqx\n        image: emqx/emqx:5.7\n        ports:\n        - name: mqtt\n          containerPort: 1883\n        - name: mqttssl\n          containerPort: 8883\n        - name: mgmt\n          containerPort: 8081\n        - name: ws\n          containerPort: 8083\n        - name: wss\n          containerPort: 8084\n        - name: dashboard\n          containerPort: 18083\n\n```\n","source":"_posts/20250501/5.md","raw":"---\ntitle: EMQX K3s \ndate: 2025-05-01 16:57:07\nlastmod: 2025-05-01 16:57:07\ntags: [K3S,EMQX]\ncategory: K3S\n---\n\n\n\n#  EMQX MQTT  K8S \n\n<iframe src=\"/widgets/metadata/\" data-src=\"/widgets/metadata/\" data-subtype=\"widget\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"height: 441px;\"></iframe>\n\n---\n\n*  EMQX MQTT  K8S  - www.emqx.com\n* [https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster](https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster)\n*  EMQX MQTT  K8S \n* 2024-06-28 10:42:05\n\n---\n\nEMQX Team  Helm chart  kubernetes  EMQX [MQTT ](https://www.emqx.com/zh/products/emqx),  EMQX Team  kubernetes  k3s  EMQX MQTT   yaml  EMQX MQTT  K8S , \n\n kubernetes  kubernetes \n\n##  K8S  EMQX MQTT\n\n###  Pod  EMQX Broker\n\nKubernetes [Pod](https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-overview/)Pod  Kubernetes  Kubernetes Pod  [](https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-cluster) \n\nEMQX Broker  [docker hub](https://hub.docker.com/r/emqx/emqx) ,  pod  EMQX Broker `kubectl run`  EMQX Broker  Pod\n\n```\n$ kubectl run emqx --image=emqx/emqx:v4.1-rc.1  --generator=run-pod/v1\npod/emqx created\n```\n\n EMQX Broker \n\n```\n$ kubectl get pods -o wide\nNAME   READY   STATUS    RESTARTS   AGE\nemqx   1/1     Running   0          3m13s\n\n$ kubectl exec emqx -- emqx_ctl status\nNode 'emqx@192.168.77.108' is started\nemqx 4.1-rc.1 is running\n```\n\n Pod\n\n```\n$ kubectl delete pods emqx\npod \"emqx\" deleted\n```\n\nPod  Pod\n\n###  Deoloyment  Pod\n\n[Deployment](https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/)  Pod  ReplicaSet declarative[ReplicationController](https://www.kubernetes.org.cn/replication-controller-kubernetes) \n\n* DeploymentPodReplicaSet\n* \n* \n* Deployment\n\n Deployment  EMQX Broker Pod\n\n*  Deployment\n\n  ```\n  $ cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 1\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n  ```\n*  Deployment\n\n  ```\n  $  kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n  ```\n* \n\n  ```\n  $ kubectl get deployment\n  NAME                              READY   UP-TO-DATE   AVAILABLE   AGE\n  deployment.apps/emqx-deployment   3/3     3            3           74s\n\n  $ kubectl get pods\n  NAME                                  READY   STATUS    RESTARTS   AGE\n  pod/emqx-deployment-7c44dbd68-8j77l   1/1     Running   0          74s\n\n  $ kubectl exec pod/emqx-deployment-7c44dbd68-8j77l -- emqx_ctl status\n  Node 'emqx-deployment-7c44dbd68-8j77l@192.168.77.117' is started\n  emqx 4.1-rc.1 is running\n  ```\n*  Pod\n\n  ```\n  $ kubectl delete pods emqx-deployment-7c44dbd68-8j77l\n  pod \"emqx-deployment-7c44dbd68-8j77l\" deleted\n\n  $ kubectl get pods\n  NAME                              READY   STATUS    RESTARTS   AGE\n  emqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          59s\n  ```\n\n   Deployment  EMQX Broker Pod Pod Deployment  Pod\n\n###  Services  EMQX Broker Pod \n\nKubernetes [Pods](https://kubernetes.io/docs/concepts/workloads/pods/)   [Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)  Pod\n\n Pod  IP  Deployment  Pod  Pod \n\n EMQX Broker Pod  **MQTT ** IP  EMQX Broker \n\nService\n\nService  [Pods](https://kubernetes.io/docs/concepts/workloads/pods/) \n\n Service  EMQX Broker Pod \n\n*  Service\n\n  ```\n  $cat service.yaml\n\n  apiVersion: v1\n  kind: Service\n  metadata:\n    name: emqx-service\n  spec:\n    selector:\n      app: emqx\n    ports:\n      - name: mqtt\n        port: 1883\n        protocol: TCP\n        targetPort: mqtt\n      - name: mqttssl\n        port: 8883\n        protocol: TCP\n        targetPort: mqttssl\n      - name: mgmt\n        port: 8081\n        protocol: TCP\n        targetPort: mgmt\n      - name: ws\n        port: 8083\n        protocol: TCP\n        targetPort: ws\n      - name: wss\n        port: 8084\n        protocol: TCP\n        targetPort: wss\n      - name: dashboard\n        port: 18083\n        protocol: TCP\n        targetPort: dashboard\n  ```\n*  Service\n\n  ```\n  $ kubectl apply -f service.yaml\n  service/emqx-service created\n  ```\n* \n\n  ```\n  $ kubectl get svc\n  NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                                        AGE\n  emqx-service   ClusterIP   10.96.54.205   <none>        1883/TCP,8883/TCP,8081/TCP,8083/TCP,8084/TCP,18083/TCP   58s\n  ```\n*  Service  IP  EMQX Broker  API\n\n  ```\n  $ curl 10.96.54.205:8081/status\n  Node emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120 is started\n  emqx is running\n  ```\n\n EMQX Broker  kubernetes  Deployment  EMQX Broker Pod Service  EMQX Broker \n\n##  kubernetes  EMQX MQTT \n\n Deployment  EMQX Broker Pod Deployment  Pod  `kubectl scale deployment ${deployment_name} --replicas ${numer}`  Pod  EMQX Broker Pod  3 \n\n```\n$ kubectl scale deployment emqx-deployment --replicas 3\ndeployment.apps/emqx-deployment scaled\n\n$ kubectl get pods\nNAME                               READY   STATUS    RESTARTS   AGE\nemqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          18m\nemqx-deployment-68fcb4bfd6-mpvch   1/1     Running   0          6s\nemqx-deployment-68fcb4bfd6-mx55q   1/1     Running   0          6s\n\n$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl status\nNode 'emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120' is started\nemqx 4.1-rc.1 is running\n\n$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl cluster status\nCluster status: #{running_nodes =>\n                      ['emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120'],\n                  stopped_nodes => []}\n```\n\n EMQX Broker Pod  3  Pod  kubernetes  EMQX Broker Pod\n\n###  EMQX Broker \n\n EMQX Broker [](https://docs.emqx.com/zh/emqx/latest/deploy/cluster/introduction.html) EMQX Broker \n\n```\ncluster.discovery = kubernetes\ncluster.kubernetes.apiserver = http://10.110.111.204:8080\ncluster.kubernetes.service_name = ekka\ncluster.kubernetes.address_type = ip\ncluster.kubernetes.app_name = ekka\n```\n\n `cluster.kubernetes.apiserver`  kubernetes apiserver  `kubectl cluster-info` `cluster.kubernetes.service_name`  Service  name `cluster.kubernetes.app_name`  EMQX Broker  `node.name`  `@`  EMQX Broker  `node.name` \n\nEMQX Broker  docker  [docker hub](https://hub.docker.com/r/emqx/emqx)  [Github](https://github.com/emqx/emqx-rel/blob/master/deploy/docker/README.md)\n\n*  Deployment  yaml \n\n  ```\n  $ cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          env:\n          - name: EMQX_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__DISCOVERY\n            value: k8s\n          - name: EMQX_CLUSTER__K8S__APP_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__K8S__SERVICE_NAME\n            value: emqx-service\n          - name: EMQX_CLUSTER__K8S__APISERVER\n            value: \"https://kubernetes.default.svc:443\"\n          - name: EMQX_CLUSTER__K8S__NAMESPACE\n            value: default\n  ```\n\n  >  ``kubectl scale deployment ${deployment_name} --replicas ${numer}` yaml  yaml `spec.replicas: 3` \n  >\n  > Pod  kubernetes  DNS  `https://kubernetes.default.svc:443`  kubernetes apiserver  \n  >\n*  Deployment\n\n  ```\n  $ kubectl delete deployment emqx-deployment\n  deployment.apps \"emqx-deployment\" deleted\n\n  $ kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n  ```\n\n###  Pod  kubernetes apiserver \n\n Deployment  EMQX Broker  EMQX Broker  EMQX Broker Pod  log\n\n```\n$ kubectl get pods\nNAME                               READY   STATUS    RESTARTS   AGE\nemqx-deployment-5c8cfc4d75-67lmt   1/1     Running   0          5s\nemqx-deployment-5c8cfc4d75-r6jgb   1/1     Running   0          5s\nemqx-deployment-5c8cfc4d75-wv2hj   1/1     Running   0          5s\n\n$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl status\nNode 'emqx@192.168.87.150' is started\nemqx 4.1-rc.1 is running\n\n$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl cluster status\nCluster status: #{running_nodes => ['emqx@192.168.87.150'],\n                  stopped_nodes => []}\n\n$ kubectl logs emqx-deployment-76f6895c46-4684f\n\n\n(emqx@192.168.87.150)1> 2020-05-20 01:48:39.726 [error] Ekka(AutoCluster): Discovery error: {403,\n                                     \"{\\\"kind\\\":\\\"Status\\\",\\\"apiVersion\\\":\\\"v1\\\",\\\"metadata\\\":{},\\\"status\\\":\\\"Failure\\\",\\\"message\\\":\\\"endpoints \\\\\\\"emqx-service\\\\\\\" is forbidden: User \\\\\\\"system:serviceaccount:default:default\\\\\\\" cannot get resource \\\\\\\"endpoints\\\\\\\" in API group \\\\\\\"\\\\\\\" in the namespace \\\\\\\"default\\\\\\\"\\\",\\\"reason\\\":\\\"Forbidden\\\",\\\"details\\\":{\\\"name\\\":\\\"emqx-service\\\",\\\"kind\\\":\\\"endpoints\\\"},\\\"code\\\":403}\\n\"}\n\n```\n\nPod  kubernetes apiserver  HTTP 403\n\n Pod  kubernetes apiserver  kubernetes apiserver  http  ServiceAccountRole  RoleBinding  RBAC \n\n*   ServiceAccountRole  RoleBinding\n\n  ```\n  $ cat rbac.yaml\n\n  apiVersion: v1\n  kind: ServiceAccount\n  metadata:\n    namespace: default\n    name: emqx\n  ---\n  kind: Role\n  apiVersion: rbac.authorization.kubernetes.io/v1beta1\n  metadata:\n    namespace: default\n    name: emqx\n  rules:\n  - apiGroups:\n    - \"\"\n    resources:\n    - endpoints \n    verbs: \n    - get\n    - watch\n    - list\n  ---\n  kind: RoleBinding\n  apiVersion: rbac.authorization.kubernetes.io/v1beta1\n  metadata:\n    namespace: default\n    name: emqx\n  subjects:\n    - kind: ServiceAccount\n      name: emqx\n      namespace: default\n  roleRef:\n    kind: Role\n    name: emqx\n    apiGroup: rbac.authorization.kubernetes.io\n  ```\n* \n\n  ```\n  $ kubectl apply -f rbac.yaml\n  serviceaccount/emqx created\n  role.rbac.authorization.kubernetes.io/emqx created\n  rolebinding.rbac.authorization.kubernetes.io/emqx created\n  ```\n*  Deployment  yaml  `spec.template.spec.serviceAccountName`\n\n  ```\n  $cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          env:\n          - name: EMQX_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__DISCOVERY\n            value: kubernetes\n          - name: EMQX_CLUSTER__K8S__APP_NAME\n            value: emqx\n          - name: EMQX_CLUSTER__K8S__SERVICE_NAME\n            value: emqx-service\n          - name: EMQX_CLUSTER__K8S__APISERVER\n            value: \"https://kubernetes.default.svc:443\"\n          - name: EMQX_CLUSTER__K8S__NAMESPACE\n            value: default\n\n  $ kubectl delete deployment emqx-deployment\n  deployment.apps \"emqx-deployment\" deleted\n\n  $ kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n  ```\n* \n\n  ```\n  $ kubectl get pods\n  NAME                              READY   STATUS    RESTARTS   AGE\n  emqx-deployment-6b854486c-dhd7p   1/1     Running   0          10s\n  emqx-deployment-6b854486c-psv2r   1/1     Running   0          10s\n  emqx-deployment-6b854486c-tdzld   1/1     Running   0          10s\n\n  $ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl status\n  Node 'emqx@192.168.77.92' is started\n  emqx 4.1-rc.1 is running\n\n  $ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.115','emqx@192.168.77.92',\n                         'emqx@192.168.87.157'],\n                    stopped_nodes => []}\n  ```\n*  Pod\n\n  ```\n  $ kubectl delete pods emqx-deployment-6b854486c-dhd7p\n  pod \"emqx-deployment-6b854486c-dhd7p\" deleted\n\n  $ kubectl get pods\n  NAME                              READY   STATUS    RESTARTS   AGE\n  emqx-deployment-6b854486c-846v7   1/1     Running   0          56s\n  emqx-deployment-6b854486c-psv2r   1/1     Running   0          3m50s\n  emqx-deployment-6b854486c-tdzld   1/1     Running   0          3m50s\n\n  $ kubectl exec emqx-deployment-6b854486c-846v7 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.115','emqx@192.168.77.84',\n                         'emqx@192.168.87.157'],\n                    stopped_nodes => ['emqx@192.168.77.92']}\n  ```\n\n   EMQX Broker  Pod Deployment  Pod \n\nEMQX Broker  kubernetes \n\n##  EMQX Broker \n\n Deployment  Pod Pod  Pod  EMQX Broker  EMQX Broker  Pod EMQX Broker \n\n### ConfigMap\n\n[ConfigMap](https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/)  configMap  API \n\nConfigMap  [](https://kubernetes.io/docs/concepts/overview/#why-containers) \n\n> ConfigMap  [Secret](https://kubernetes.io/docs/concepts/configuration/secret/)  ConfigMap\n\n ConfigMap  EMQX Broker  Deployment \n\n*  Configmap\n\n  ```\n  $cat configmap.yaml\n\n  apiVersion: v1\n  kind: ConfigMap\n  metadata:\n    name: emqx-config\n  data:\n    EMQX_CLUSTER__K8S__ADDRESS_TYPE: \"hostname\"\n    EMQX_CLUSTER__K8S__APISERVER: \"https://kubernetes.default.svc:443\"\n    EMQX_CLUSTER__K8S__SUFFIX: \"svc.cluster.local\"\n\n  $ kubectl apply -f configmap.yaml\n  configmap/emqx-config created\n  ```\n*  Deployment  Configmap\n\n  ```\n  $cat deployment.yaml\n\n  apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: emqx-deployment\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          envFrom:\n            - configMapRef:\n                name: emqx-config\n  ```\n*  Deployment\n\n  ```\n  $ kubectl delete -f deployment.yaml\n  deployment.apps \"emqx-deployment\" deleted\n\n  $ kubectl apply -f deployment.yaml\n  deployment.apps/emqx-deployment created\n\n  $ kubectl get pods\n  NAME                               READY   STATUS    RESTARTS   AGE\n  emqx-deployment-5c7696b5d7-k9lzj   1/1     Running   0          3s\n  emqx-deployment-5c7696b5d7-mdwkt   1/1     Running   0          3s\n  emqx-deployment-5c7696b5d7-z57z7   1/1     Running   0          3s\n\n  $ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl status\n  Node 'emqx@192.168.87.149' is started\n  emqx 4.1-rc.1 is running\n\n  $ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.106','emqx@192.168.77.107',\n                         'emqx@192.168.87.149'],\n                    stopped_nodes => []}\n  ```\n\nEMQX Broker  Configmap  Configmap Pod \n\n### StatefulSet\n\n[StatefulSet](https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/)  Deployments  ReplicaSets \n\n*  Pod  PVC \n*  Pod  PodName  HostName  Headless ServiceCluster IPService\n*  Pod 0N-1Pod Pod  Running  Ready  init containers \n* N-10\n\nStatefulSet\n\n* DNS domain Headless Service\n*  PersistentVolumes  volumeClaimTemplates\n*  StatefulSet\n\nStatefulSet  Pod  DNS  `statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local` \n\n* `serviceName`  Headless Service \n* `0..N-1`  Pod  0  N-1\n* `statefulSetName` StatefulSet\n* `namespace`  namespaceHeadless Servic  StatefulSet  namespace\n* `.cluster.local`  Cluster Domain\n\n StatefulSet  Deployment  Pod\n\n*  Deployment\n\n  ```\n  $ kubectl delete deployment emqx-deployment\n  deployment.apps \"emqx-deployment\" deleted\n  ```\n*  StatefulSet\n\n  ```\n  $cat statefulset.yaml\n\n  apiVersion: apps/v1\n  kind: StatefulSet\n  metadata:\n    name: emqx-statefulset\n    labels:\n      app: emqx\n  spec:\n    serviceName: emqx-headless\n    updateStrategy:\n      type: RollingUpdate\n    replicas: 3\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          envFrom:\n            - configMapRef:\n                name: emqx-config\n  ```\n\n  StatefulSet  Headless Service  Service\n\n  ```\n  $cat headless.yaml\n\n  apiVersion: v1\n  kind: Service\n  metadata:\n    name: emqx-headless\n  spec:\n    type: ClusterIP\n    clusterIP: None\n    selector:\n      app: emqx\n    ports:\n    - name: mqtt\n      port: 1883\n      protocol: TCP\n      targetPort: 1883\n    - name: mqttssl\n      port: 8883\n      protocol: TCP\n      targetPort: 8883\n    - name: mgmt\n      port: 8081\n      protocol: TCP\n      targetPort: 8081\n    - name: websocket\n      port: 8083\n      protocol: TCP\n      targetPort: 8083\n    - name: wss\n      port: 8084\n      protocol: TCP\n      targetPort: 8084\n    - name: dashboard\n      port: 18083\n      protocol: TCP\n      targetPort: 18083\n  ```\n\n   Headless Service  IP `clusterIP: None` \n* \n\n  ```\n  $ kubectl apply -f headless-service.yaml\n  service/emqx-headless created\n\n  $ kubectl apply -f statefulset.yaml\n  statefulset.apps/emqx-deployment created\n\n  $ kubectl get pods\n  NAME                               READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0                 1/1     Running   0          2m59s\n  emqx-statefulset-1                 1/1     Running   0          2m57s\n  emqx-statefulset-2                 1/1     Running   0          2m54s\n\n  $ kubectl exec emqx-statefulset-0 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@192.168.77.105','emqx@192.168.87.153',\n                         'emqx@192.168.87.155'],\n                    stopped_nodes => []}\n  ```\n*  Configmap  \n  StatefulSet EMQX Broker  hostname  dns  IP  hostname  `emqx.conf`\n\n  ```\n  cluster.kubernetes.address_type = hostname\n  cluster.kubernetes.suffix = \"svc.cluster.local\"\n  ```\n\n  kubernetes  Pod  DNS EMQX Broker   `cluster.kubernetes.suffix`  DNS  DNS `statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local` DNS  serviceName  StatefulSet  Headless Service `cluster.kubernetes.service_name`   Headless Service Name  \n   Configmap \n\n  ```\n  EMQX_CLUSTER__K8S__ADDRESS_TYPE: \"hostname\"\n  EMQX_CLUSTER__K8S__SUFFIX: \"svc.cluster.local\"\n  EMQX_CLUSTER__K8S__SERVICE_NAME: emqx-headless\n  ```\n\n  Configmap  `$ kubectl edit configmap emqx-config`  Configmap\n*  StatefulSet  \n  Configmap  Pod  StatefulSet\n\n  ```\n  $ kubectl delete statefulset emqx-statefulset\n  statefulset.apps \"emqx-statefulset\" deleted\n\n  $ kubectl apply -f statefulset.yaml\n  statefulset.apps/emqx-statefulset created\n\n  $ kubectl get pods\n  NAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          115s\n  emqx-statefulset-1   1/1     Running   0          112s\n  emqx-statefulset-2   1/1     Running   0          110s\n\n  $ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local'],\n                    stopped_nodes => []}\n  ```\n\n   EMQX Broker \n*  Pod  \n  StatefulSet  Pod  PodName  HostName \n\n  ```\n  $ kubectl get pods\n  kuNAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          6m20s\n  emqx-statefulset-1   1/1     Running   0          6m17s\n  emqx-statefulset-2   1/1     Running   0          6m15s\n\n  $ kubectl delete pod emqx-statefulset-0\n  pod \"emqx-statefulset-0\" deleted\n\n  $ kubectl get pods\n  NAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          27s\n  emqx-statefulset-1   1/1     Running   0          9m45s\n  emqx-statefulset-2   1/1     Running   0          9m43s\n\n  $ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status\n  Cluster status: #{running_nodes =>\n                        ['emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local',\n                         'emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local'],\n                    stopped_nodes => []}\n  ```\n\n  StatefulSet  PodPod  EMQX Broker \n\n## StorageClassesPersistentVolume  PersistentVolumeClaim\n\nPersistentVolumePVPV  PV  Volume  PV  Pod  API   NFSiSCSI \n\nPersistentVolumeClaimPVC Pod Pod PVC  PV Pod CPU / \n\nStorageClass  \"class\"   class   Kubernetes  class  \n\n EMQX Broker  PV  StorageClass PVC  EMQX Broker  `/opt/emqx/data/mnesia` PodsEMQX  `/opt/emqx/data/mnesia`  EMQX Broker \n\n*  StatefulSet\n\n  ```\n  $cat statefulset.yaml\n\n  apiVersion: apps/v1\n  kind: StatefulSet\n  metadata:\n    name: emqx-statefulset\n    labels:\n      app: emqx\n  spec:\n    replicas: 3\n    serviceName: emqx-headless\n    updateStrategy:\n      type: RollingUpdate\n    selector:\n      matchLabels:\n        app: emqx\n    template:\n      metadata:\n        labels:\n          app: emqx\n      spec:\n        volumes:\n        - name: emqx-data\n          persistentVolumeClaim:\n            claimName: emqx-pvc\n        serviceAccountName: emqx\n        containers:\n        - name: emqx\n          image: emqx/emqx:v4.1-rc.1\n          ports:\n          - name: mqtt\n            containerPort: 1883\n          - name: mqttssl\n            containerPort: 8883\n          - name: mgmt\n            containerPort: 8081\n          - name: ws\n            containerPort: 8083\n          - name: wss\n            containerPort: 8084\n          - name: dashboard\n            containerPort: 18083\n          envFrom:\n            - configMapRef:\n                name: emqx-config\n          volumeMounts:\n          - name: emqx-data\n            mountPath: \"/opt/emqx/data/mnesia\"\n    volumeClaimTemplates:\n    - metadata:\n        name: emqx-pvc\n        annotations:\n          volume.alpha.kubernetes.io/storage-class: manual\n      spec:\n        accessModes: [ \"ReadWriteOnce\" ]\n        resources:\n          requests:\n            storage: 1Gi\n  ```\n\n   `volumeClaimTemplates`  StorageClass  name  manual  emqx-pvc  PVC PVC  `ReadWriteOnce` 1Gi  PVC  name  emqx-data  volumes volumes  Pod  `/opt/emqx/data/mnesia`  \n*   \n   StatefulSet  kubernetes \n\n  ```\n  $ kubectl apply -f statefulset.yaml\n  statefulset.apps/emqx-statefulset created\n\n  $ kubectl get pods\n  NAME                 READY   STATUS    RESTARTS   AGE\n  emqx-statefulset-0   1/1     Running   0          27s\n  emqx-statefulset-1   1/1     Running   0          9m45s\n  emqx-statefulset-2   1/1     Running   0          9m43s\n\n  $ kubectl get pvc\n  NAME                                 STATUS    VOLUME                                 CAPACITY   ACCESS MODES   STORAGECLASS   AGE\n  emqx-data-emqx-statefulset-0   Bound     pvc-8094cd75-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            2m11s\n  emqx-data-emqx-statefulset-0   Bound     pvc-9325441d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            99s\n  emqx-data-emqx-statefulset-0   Bound     pvc-ad425e9d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            56s\n  ```\n\n   PVC  BoundPVC  Pod EMQX Broker  PVC \n\nEMQX Broker  kubernetes  Demo [kubernetes ](https://kubernetes.io/zh-cn/docs/home/)   EMQX Team  [Helm chart ](https://github.com/emqx/emqx-rel/tree/master/deploy/charts/emqx)  Github  issuepull requests  start\n\n\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: emqx-deployment\n  labels:\n    app: emqx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: emqx\n  template:\n    metadata:\n      labels:\n        app: emqx\n    spec:\n      containers:\n      - name: emqx\n        image: emqx/emqx:5.7\n        ports:\n        - name: mqtt\n          containerPort: 1883\n        - name: mqttssl\n          containerPort: 8883\n        - name: mgmt\n          containerPort: 8081\n        - name: ws\n          containerPort: 8083\n        - name: wss\n          containerPort: 8084\n        - name: dashboard\n          containerPort: 18083\n\n```\n","slug":"20250501-5","published":1,"updated":"2025-05-01T09:38:56.124Z","comments":1,"layout":"post","photos":[],"_id":"cma56nfvt0006isjjfwyu6rwf","content":"<h1> EMQX MQTT  K8S </h1>\n<iframe src=\"/widgets/metadata/\" data-src=\"/widgets/metadata/\" data-subtype=\"widget\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"height: 441px;\"></iframe>\n<hr>\n<ul>\n<li> EMQX MQTT  K8S  - <a href=\"http://www.emqx.com\">www.emqx.com</a></li>\n<li><a href=\"https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster\">https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster</a></li>\n<li> EMQX MQTT  K8S </li>\n<li>2024-06-28 10:42:05</li>\n</ul>\n<hr>\n<p>EMQX Team  Helm chart  kubernetes  EMQX <a href=\"https://www.emqx.com/zh/products/emqx\">MQTT </a>,  EMQX Team  kubernetes  k3s  EMQX MQTT   yaml  EMQX MQTT  K8S , </p>\n<p> kubernetes  kubernetes </p>\n<h2 id=\"-K8S--EMQX-MQTT\"> K8S  EMQX MQTT</h2>\n<h3 id=\"-Pod--EMQX-Broker\"> Pod  EMQX Broker</h3>\n<p>Kubernetes <a href=\"https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-overview/\">Pod</a>Pod  Kubernetes  Kubernetes Pod  <a href=\"https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-cluster\"></a> </p>\n<p>EMQX Broker  <a href=\"https://hub.docker.com/r/emqx/emqx\">docker hub</a> ,  pod  EMQX Broker <code>kubectl run</code>  EMQX Broker  Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl run emqx --image=emqx/emqx:v4.1-rc.1  --generator=run-pod/v1</span><br><span class=\"line\">pod/emqx created</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods -o wide</span><br><span class=\"line\">NAME   READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx   1/1     Running   0          3m13s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.77.108&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br></pre></td></tr></table></figure>\n<p> Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete pods emqx</span><br><span class=\"line\">pod &quot;emqx&quot; deleted</span><br></pre></td></tr></table></figure>\n<p>Pod  Pod</p>\n<h3 id=\"-Deoloyment--Pod\"> Deoloyment  Pod</h3>\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/\">Deployment</a>  Pod  ReplicaSet declarative<a href=\"https://www.kubernetes.org.cn/replication-controller-kubernetes\">ReplicationController</a> </p>\n<ul>\n<li>DeploymentPodReplicaSet</li>\n<li></li>\n<li></li>\n<li>Deployment</li>\n</ul>\n<p> Deployment  EMQX Broker Pod</p>\n<ul>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 1</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get deployment</span><br><span class=\"line\">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/emqx-deployment   3/3     3            3           74s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/emqx-deployment-7c44dbd68-8j77l   1/1     Running   0          74s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec pod/emqx-deployment-7c44dbd68-8j77l -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx-deployment-7c44dbd68-8j77l@192.168.77.117&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete pods emqx-deployment-7c44dbd68-8j77l</span><br><span class=\"line\">pod &quot;emqx-deployment-7c44dbd68-8j77l&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          59s</span><br></pre></td></tr></table></figure>\n<p> Deployment  EMQX Broker Pod Pod Deployment  Pod</p>\n</li>\n</ul>\n<h3 id=\"-Services--EMQX-Broker-Pod-\"> Services  EMQX Broker Pod </h3>\n<p>Kubernetes <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/\">Pods</a>   <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/\">Deployment</a>  Pod</p>\n<p> Pod  IP  Deployment  Pod  Pod </p>\n<p> EMQX Broker Pod  <strong>MQTT </strong> IP  EMQX Broker </p>\n<p>Service</p>\n<p>Service  <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/\">Pods</a> </p>\n<p> Service  EMQX Broker Pod </p>\n<ul>\n<li>\n<p> Service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat service.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Service</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-service</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - name: mqtt</span><br><span class=\"line\">      port: 1883</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: mqtt</span><br><span class=\"line\">    - name: mqttssl</span><br><span class=\"line\">      port: 8883</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: mqttssl</span><br><span class=\"line\">    - name: mgmt</span><br><span class=\"line\">      port: 8081</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: mgmt</span><br><span class=\"line\">    - name: ws</span><br><span class=\"line\">      port: 8083</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: ws</span><br><span class=\"line\">    - name: wss</span><br><span class=\"line\">      port: 8084</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: wss</span><br><span class=\"line\">    - name: dashboard</span><br><span class=\"line\">      port: 18083</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: dashboard</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f service.yaml</span><br><span class=\"line\">service/emqx-service created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get svc</span><br><span class=\"line\">NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                                        AGE</span><br><span class=\"line\">emqx-service   ClusterIP   10.96.54.205   &lt;none&gt;        1883/TCP,8883/TCP,8081/TCP,8083/TCP,8084/TCP,18083/TCP   58s</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Service  IP  EMQX Broker  API</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl 10.96.54.205:8081/status</span><br><span class=\"line\">Node emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120 is started</span><br><span class=\"line\">emqx is running</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p> EMQX Broker  kubernetes  Deployment  EMQX Broker Pod Service  EMQX Broker </p>\n<h2 id=\"-kubernetes--EMQX-MQTT-\"> kubernetes  EMQX MQTT </h2>\n<p> Deployment  EMQX Broker Pod Deployment  Pod  <code>kubectl scale deployment $&#123;deployment_name&#125; --replicas $&#123;numer&#125;</code>  Pod  EMQX Broker Pod  3 </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl scale deployment emqx-deployment --replicas 3</span><br><span class=\"line\">deployment.apps/emqx-deployment scaled</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          18m</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-mpvch   1/1     Running   0          6s</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-mx55q   1/1     Running   0          6s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker Pod  3  Pod  kubernetes  EMQX Broker Pod</p>\n<h3 id=\"-EMQX-Broker-\"> EMQX Broker </h3>\n<p> EMQX Broker <a href=\"https://docs.emqx.com/zh/emqx/latest/deploy/cluster/introduction.html\"></a> EMQX Broker </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cluster.discovery = kubernetes</span><br><span class=\"line\">cluster.kubernetes.apiserver = http://10.110.111.204:8080</span><br><span class=\"line\">cluster.kubernetes.service_name = ekka</span><br><span class=\"line\">cluster.kubernetes.address_type = ip</span><br><span class=\"line\">cluster.kubernetes.app_name = ekka</span><br></pre></td></tr></table></figure>\n<p> <code>cluster.kubernetes.apiserver</code>  kubernetes apiserver  <code>kubectl cluster-info</code> <code>cluster.kubernetes.service_name</code>  Service  name <code>cluster.kubernetes.app_name</code>  EMQX Broker  <code>node.name</code>  <code>@</code>  EMQX Broker  <code>node.name</code> </p>\n<p>EMQX Broker  docker  <a href=\"https://hub.docker.com/r/emqx/emqx\">docker hub</a>  <a href=\"https://github.com/emqx/emqx-rel/blob/master/deploy/docker/README.md\">Github</a></p>\n<ul>\n<li>\n<p> Deployment  yaml </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        env:</span><br><span class=\"line\">        - name: EMQX_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__DISCOVERY</span><br><span class=\"line\">          value: k8s</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APP_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__SERVICE_NAME</span><br><span class=\"line\">          value: emqx-service</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APISERVER</span><br><span class=\"line\">          value: &quot;https://kubernetes.default.svc:443&quot;</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__NAMESPACE</span><br><span class=\"line\">          value: default</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p> ``kubectl scale deployment ${deployment_name} --replicas ${numer}<code> yaml  yaml </code>spec.replicas: 3` </p>\n<p>Pod  kubernetes  DNS  <code>https://kubernetes.default.svc:443</code>  kubernetes apiserver  </p>\n</blockquote>\n</li>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete deployment emqx-deployment</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"-Pod--kubernetes-apiserver-\"> Pod  kubernetes apiserver </h3>\n<p> Deployment  EMQX Broker  EMQX Broker  EMQX Broker Pod  log</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-5c8cfc4d75-67lmt   1/1     Running   0          5s</span><br><span class=\"line\">emqx-deployment-5c8cfc4d75-r6jgb   1/1     Running   0          5s</span><br><span class=\"line\">emqx-deployment-5c8cfc4d75-wv2hj   1/1     Running   0          5s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.87.150&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt; [&#x27;emqx@192.168.87.150&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl logs emqx-deployment-76f6895c46-4684f</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">(emqx@192.168.87.150)1&gt; 2020-05-20 01:48:39.726 [error] Ekka(AutoCluster): Discovery error: &#123;403,</span><br><span class=\"line\">                                     &quot;&#123;\\&quot;kind\\&quot;:\\&quot;Status\\&quot;,\\&quot;apiVersion\\&quot;:\\&quot;v1\\&quot;,\\&quot;metadata\\&quot;:&#123;&#125;,\\&quot;status\\&quot;:\\&quot;Failure\\&quot;,\\&quot;message\\&quot;:\\&quot;endpoints \\\\\\&quot;emqx-service\\\\\\&quot; is forbidden: User \\\\\\&quot;system:serviceaccount:default:default\\\\\\&quot; cannot get resource \\\\\\&quot;endpoints\\\\\\&quot; in API group \\\\\\&quot;\\\\\\&quot; in the namespace \\\\\\&quot;default\\\\\\&quot;\\&quot;,\\&quot;reason\\&quot;:\\&quot;Forbidden\\&quot;,\\&quot;details\\&quot;:&#123;\\&quot;name\\&quot;:\\&quot;emqx-service\\&quot;,\\&quot;kind\\&quot;:\\&quot;endpoints\\&quot;&#125;,\\&quot;code\\&quot;:403&#125;\\n&quot;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Pod  kubernetes apiserver  HTTP 403</p>\n<p> Pod  kubernetes apiserver  kubernetes apiserver  http  ServiceAccountRole  RoleBinding  RBAC </p>\n<ul>\n<li>\n<p>  ServiceAccountRole  RoleBinding</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat rbac.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ServiceAccount</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: Role</span><br><span class=\"line\">apiVersion: rbac.authorization.kubernetes.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">rules:</span><br><span class=\"line\">- apiGroups:</span><br><span class=\"line\">  - &quot;&quot;</span><br><span class=\"line\">  resources:</span><br><span class=\"line\">  - endpoints </span><br><span class=\"line\">  verbs: </span><br><span class=\"line\">  - get</span><br><span class=\"line\">  - watch</span><br><span class=\"line\">  - list</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: RoleBinding</span><br><span class=\"line\">apiVersion: rbac.authorization.kubernetes.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">subjects:</span><br><span class=\"line\">  - kind: ServiceAccount</span><br><span class=\"line\">    name: emqx</span><br><span class=\"line\">    namespace: default</span><br><span class=\"line\">roleRef:</span><br><span class=\"line\">  kind: Role</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">  apiGroup: rbac.authorization.kubernetes.io</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f rbac.yaml</span><br><span class=\"line\">serviceaccount/emqx created</span><br><span class=\"line\">role.rbac.authorization.kubernetes.io/emqx created</span><br><span class=\"line\">rolebinding.rbac.authorization.kubernetes.io/emqx created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment  yaml  <code>spec.template.spec.serviceAccountName</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        env:</span><br><span class=\"line\">        - name: EMQX_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__DISCOVERY</span><br><span class=\"line\">          value: kubernetes</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APP_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__SERVICE_NAME</span><br><span class=\"line\">          value: emqx-service</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APISERVER</span><br><span class=\"line\">          value: &quot;https://kubernetes.default.svc:443&quot;</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__NAMESPACE</span><br><span class=\"line\">          value: default</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl delete deployment emqx-deployment</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-6b854486c-dhd7p   1/1     Running   0          10s</span><br><span class=\"line\">emqx-deployment-6b854486c-psv2r   1/1     Running   0          10s</span><br><span class=\"line\">emqx-deployment-6b854486c-tdzld   1/1     Running   0          10s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.77.92&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.115&#x27;,&#x27;emqx@192.168.77.92&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.157&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete pods emqx-deployment-6b854486c-dhd7p</span><br><span class=\"line\">pod &quot;emqx-deployment-6b854486c-dhd7p&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-6b854486c-846v7   1/1     Running   0          56s</span><br><span class=\"line\">emqx-deployment-6b854486c-psv2r   1/1     Running   0          3m50s</span><br><span class=\"line\">emqx-deployment-6b854486c-tdzld   1/1     Running   0          3m50s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-6b854486c-846v7 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.115&#x27;,&#x27;emqx@192.168.77.84&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.157&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; [&#x27;emqx@192.168.77.92&#x27;]&#125;</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker  Pod Deployment  Pod </p>\n</li>\n</ul>\n<p>EMQX Broker  kubernetes </p>\n<h2 id=\"-EMQX-Broker-\"> EMQX Broker </h2>\n<p> Deployment  Pod Pod  Pod  EMQX Broker  EMQX Broker  Pod EMQX Broker </p>\n<h3 id=\"ConfigMap\">ConfigMap</h3>\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/\">ConfigMap</a>  configMap  API </p>\n<p>ConfigMap  <a href=\"https://kubernetes.io/docs/concepts/overview/#why-containers\"></a> </p>\n<blockquote>\n<p>ConfigMap  <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\">Secret</a>  ConfigMap</p>\n</blockquote>\n<p> ConfigMap  EMQX Broker  Deployment </p>\n<ul>\n<li>\n<p> Configmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat configmap.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-config</span><br><span class=\"line\">data:</span><br><span class=\"line\">  EMQX_CLUSTER__K8S__ADDRESS_TYPE: &quot;hostname&quot;</span><br><span class=\"line\">  EMQX_CLUSTER__K8S__APISERVER: &quot;https://kubernetes.default.svc:443&quot;</span><br><span class=\"line\">  EMQX_CLUSTER__K8S__SUFFIX: &quot;svc.cluster.local&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f configmap.yaml</span><br><span class=\"line\">configmap/emqx-config created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment  Configmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        envFrom:</span><br><span class=\"line\">          - configMapRef:</span><br><span class=\"line\">              name: emqx-config</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete -f deployment.yaml</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-5c7696b5d7-k9lzj   1/1     Running   0          3s</span><br><span class=\"line\">emqx-deployment-5c7696b5d7-mdwkt   1/1     Running   0          3s</span><br><span class=\"line\">emqx-deployment-5c7696b5d7-z57z7   1/1     Running   0          3s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.87.149&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.106&#x27;,&#x27;emqx@192.168.77.107&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.149&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>EMQX Broker  Configmap  Configmap Pod </p>\n<h3 id=\"StatefulSet\">StatefulSet</h3>\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/\">StatefulSet</a>  Deployments  ReplicaSets </p>\n<ul>\n<li> Pod  PVC </li>\n<li> Pod  PodName  HostName  Headless ServiceCluster IPService</li>\n<li> Pod 0N-1Pod Pod  Running  Ready  init containers </li>\n<li>N-10</li>\n</ul>\n<p>StatefulSet</p>\n<ul>\n<li>DNS domain Headless Service</li>\n<li> PersistentVolumes  volumeClaimTemplates</li>\n<li> StatefulSet</li>\n</ul>\n<p>StatefulSet  Pod  DNS  <code>statefulSetName-&#123;0..N-1&#125;.serviceName.namespace.svc.cluster.local</code> </p>\n<ul>\n<li><code>serviceName</code>  Headless Service </li>\n<li><code>0..N-1</code>  Pod  0  N-1</li>\n<li><code>statefulSetName</code> StatefulSet</li>\n<li><code>namespace</code>  namespaceHeadless Servic  StatefulSet  namespace</li>\n<li><code>.cluster.local</code>  Cluster Domain</li>\n</ul>\n<p> StatefulSet  Deployment  Pod</p>\n<ul>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete deployment emqx-deployment</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> StatefulSet</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: StatefulSet</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-statefulset</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  serviceName: emqx-headless</span><br><span class=\"line\">  updateStrategy:</span><br><span class=\"line\">    type: RollingUpdate</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        envFrom:</span><br><span class=\"line\">          - configMapRef:</span><br><span class=\"line\">              name: emqx-config</span><br></pre></td></tr></table></figure>\n<p>StatefulSet  Headless Service  Service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat headless.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Service</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-headless</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  type: ClusterIP</span><br><span class=\"line\">  clusterIP: None</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - name: mqtt</span><br><span class=\"line\">    port: 1883</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 1883</span><br><span class=\"line\">  - name: mqttssl</span><br><span class=\"line\">    port: 8883</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8883</span><br><span class=\"line\">  - name: mgmt</span><br><span class=\"line\">    port: 8081</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8081</span><br><span class=\"line\">  - name: websocket</span><br><span class=\"line\">    port: 8083</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8083</span><br><span class=\"line\">  - name: wss</span><br><span class=\"line\">    port: 8084</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8084</span><br><span class=\"line\">  - name: dashboard</span><br><span class=\"line\">    port: 18083</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 18083</span><br></pre></td></tr></table></figure>\n<p> Headless Service  IP <code>clusterIP: None</code> </p>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f headless-service.yaml</span><br><span class=\"line\">service/emqx-headless created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f statefulset.yaml</span><br><span class=\"line\">statefulset.apps/emqx-deployment created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0                 1/1     Running   0          2m59s</span><br><span class=\"line\">emqx-statefulset-1                 1/1     Running   0          2m57s</span><br><span class=\"line\">emqx-statefulset-2                 1/1     Running   0          2m54s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-statefulset-0 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.105&#x27;,&#x27;emqx@192.168.87.153&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.155&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Configmap<br>\nStatefulSet EMQX Broker  hostname  dns  IP  hostname  <code>emqx.conf</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cluster.kubernetes.address_type = hostname</span><br><span class=\"line\">cluster.kubernetes.suffix = &quot;svc.cluster.local&quot;</span><br></pre></td></tr></table></figure>\n<p>kubernetes  Pod  DNS EMQX Broker   <code>cluster.kubernetes.suffix</code>  DNS  DNS <code>statefulSetName-&#123;0..N-1&#125;.serviceName.namespace.svc.cluster.local</code> DNS  serviceName  StatefulSet  Headless Service <code>cluster.kubernetes.service_name</code>   Headless Service Name<br>\n Configmap </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EMQX_CLUSTER__K8S__ADDRESS_TYPE: &quot;hostname&quot;</span><br><span class=\"line\">EMQX_CLUSTER__K8S__SUFFIX: &quot;svc.cluster.local&quot;</span><br><span class=\"line\">EMQX_CLUSTER__K8S__SERVICE_NAME: emqx-headless</span><br></pre></td></tr></table></figure>\n<p>Configmap  <code>$ kubectl edit configmap emqx-config</code>  Configmap</p>\n</li>\n<li>\n<p> StatefulSet<br>\nConfigmap  Pod  StatefulSet</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete statefulset emqx-statefulset</span><br><span class=\"line\">statefulset.apps &quot;emqx-statefulset&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f statefulset.yaml</span><br><span class=\"line\">statefulset.apps/emqx-statefulset created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          115s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          112s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          110s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker </p>\n</li>\n<li>\n<p> Pod<br>\nStatefulSet  Pod  PodName  HostName </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">kuNAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          6m20s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          6m17s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          6m15s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl delete pod emqx-statefulset-0</span><br><span class=\"line\">pod &quot;emqx-statefulset-0&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          27s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          9m45s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          9m43s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n<p>StatefulSet  PodPod  EMQX Broker </p>\n</li>\n</ul>\n<h2 id=\"StorageClassesPersistentVolume--PersistentVolumeClaim\">StorageClassesPersistentVolume  PersistentVolumeClaim</h2>\n<p>PersistentVolumePVPV  PV  Volume  PV  Pod  API   NFSiSCSI </p>\n<p>PersistentVolumeClaimPVC Pod Pod PVC  PV Pod CPU / </p>\n<p>StorageClass  class   class   Kubernetes  class  </p>\n<p> EMQX Broker  PV  StorageClass PVC  EMQX Broker  <code>/opt/emqx/data/mnesia</code> PodsEMQX  <code>/opt/emqx/data/mnesia</code>  EMQX Broker </p>\n<ul>\n<li>\n<p> StatefulSet</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: StatefulSet</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-statefulset</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  serviceName: emqx-headless</span><br><span class=\"line\">  updateStrategy:</span><br><span class=\"line\">    type: RollingUpdate</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      volumes:</span><br><span class=\"line\">      - name: emqx-data</span><br><span class=\"line\">        persistentVolumeClaim:</span><br><span class=\"line\">          claimName: emqx-pvc</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        envFrom:</span><br><span class=\"line\">          - configMapRef:</span><br><span class=\"line\">              name: emqx-config</span><br><span class=\"line\">        volumeMounts:</span><br><span class=\"line\">        - name: emqx-data</span><br><span class=\"line\">          mountPath: &quot;/opt/emqx/data/mnesia&quot;</span><br><span class=\"line\">  volumeClaimTemplates:</span><br><span class=\"line\">  - metadata:</span><br><span class=\"line\">      name: emqx-pvc</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        volume.alpha.kubernetes.io/storage-class: manual</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      accessModes: [ &quot;ReadWriteOnce&quot; ]</span><br><span class=\"line\">      resources:</span><br><span class=\"line\">        requests:</span><br><span class=\"line\">          storage: 1Gi</span><br></pre></td></tr></table></figure>\n<p> <code>volumeClaimTemplates</code>  StorageClass  name  manual  emqx-pvc  PVC PVC  <code>ReadWriteOnce</code> 1Gi  PVC  name  emqx-data  volumes volumes  Pod  <code>/opt/emqx/data/mnesia</code>  </p>\n</li>\n<li>\n<p><br>\n StatefulSet  kubernetes </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f statefulset.yaml</span><br><span class=\"line\">statefulset.apps/emqx-statefulset created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          27s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          9m45s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          9m43s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pvc</span><br><span class=\"line\">NAME                                 STATUS    VOLUME                                 CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class=\"line\">emqx-data-emqx-statefulset-0   Bound     pvc-8094cd75-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            2m11s</span><br><span class=\"line\">emqx-data-emqx-statefulset-0   Bound     pvc-9325441d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            99s</span><br><span class=\"line\">emqx-data-emqx-statefulset-0   Bound     pvc-ad425e9d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            56s</span><br></pre></td></tr></table></figure>\n<p> PVC  BoundPVC  Pod EMQX Broker  PVC </p>\n</li>\n</ul>\n<p>EMQX Broker  kubernetes  Demo <a href=\"https://kubernetes.io/zh-cn/docs/home/\">kubernetes </a>   EMQX Team  <a href=\"https://github.com/emqx/emqx-rel/tree/master/deploy/charts/emqx\">Helm chart </a>  Github  issuepull requests  start</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">emqx-deployment</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">emqx/emqx:5.7</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">mqtt</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">1883</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">mqttssl</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8883</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">mgmt</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8081</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ws</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8083</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">wss</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8084</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dashboard</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">18083</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h1> EMQX MQTT  K8S </h1>\n<iframe src=\"/widgets/metadata/\" data-src=\"/widgets/metadata/\" data-subtype=\"widget\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"height: 441px;\"></iframe>\n<hr>\n<ul>\n<li> EMQX MQTT  K8S  - <a href=\"http://www.emqx.com\">www.emqx.com</a></li>\n<li><a href=\"https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster\">https://www.emqx.com/zh/blog/emqx-mqtt-broker-k8s-cluster</a></li>\n<li> EMQX MQTT  K8S </li>\n<li>2024-06-28 10:42:05</li>\n</ul>\n<hr>\n<p>EMQX Team  Helm chart  kubernetes  EMQX <a href=\"https://www.emqx.com/zh/products/emqx\">MQTT </a>,  EMQX Team  kubernetes  k3s  EMQX MQTT   yaml  EMQX MQTT  K8S , </p>\n<p> kubernetes  kubernetes </p>\n<h2 id=\"-K8S--EMQX-MQTT\"> K8S  EMQX MQTT</h2>\n<h3 id=\"-Pod--EMQX-Broker\"> Pod  EMQX Broker</h3>\n<p>Kubernetes <a href=\"https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-overview/\">Pod</a>Pod  Kubernetes  Kubernetes Pod  <a href=\"https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-cluster\"></a> </p>\n<p>EMQX Broker  <a href=\"https://hub.docker.com/r/emqx/emqx\">docker hub</a> ,  pod  EMQX Broker <code>kubectl run</code>  EMQX Broker  Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl run emqx --image=emqx/emqx:v4.1-rc.1  --generator=run-pod/v1</span><br><span class=\"line\">pod/emqx created</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods -o wide</span><br><span class=\"line\">NAME   READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx   1/1     Running   0          3m13s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.77.108&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br></pre></td></tr></table></figure>\n<p> Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete pods emqx</span><br><span class=\"line\">pod &quot;emqx&quot; deleted</span><br></pre></td></tr></table></figure>\n<p>Pod  Pod</p>\n<h3 id=\"-Deoloyment--Pod\"> Deoloyment  Pod</h3>\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/\">Deployment</a>  Pod  ReplicaSet declarative<a href=\"https://www.kubernetes.org.cn/replication-controller-kubernetes\">ReplicationController</a> </p>\n<ul>\n<li>DeploymentPodReplicaSet</li>\n<li></li>\n<li></li>\n<li>Deployment</li>\n</ul>\n<p> Deployment  EMQX Broker Pod</p>\n<ul>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 1</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get deployment</span><br><span class=\"line\">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/emqx-deployment   3/3     3            3           74s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/emqx-deployment-7c44dbd68-8j77l   1/1     Running   0          74s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec pod/emqx-deployment-7c44dbd68-8j77l -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx-deployment-7c44dbd68-8j77l@192.168.77.117&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete pods emqx-deployment-7c44dbd68-8j77l</span><br><span class=\"line\">pod &quot;emqx-deployment-7c44dbd68-8j77l&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          59s</span><br></pre></td></tr></table></figure>\n<p> Deployment  EMQX Broker Pod Pod Deployment  Pod</p>\n</li>\n</ul>\n<h3 id=\"-Services--EMQX-Broker-Pod-\"> Services  EMQX Broker Pod </h3>\n<p>Kubernetes <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/\">Pods</a>   <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/\">Deployment</a>  Pod</p>\n<p> Pod  IP  Deployment  Pod  Pod </p>\n<p> EMQX Broker Pod  <strong>MQTT </strong> IP  EMQX Broker </p>\n<p>Service</p>\n<p>Service  <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/\">Pods</a> </p>\n<p> Service  EMQX Broker Pod </p>\n<ul>\n<li>\n<p> Service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat service.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Service</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-service</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - name: mqtt</span><br><span class=\"line\">      port: 1883</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: mqtt</span><br><span class=\"line\">    - name: mqttssl</span><br><span class=\"line\">      port: 8883</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: mqttssl</span><br><span class=\"line\">    - name: mgmt</span><br><span class=\"line\">      port: 8081</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: mgmt</span><br><span class=\"line\">    - name: ws</span><br><span class=\"line\">      port: 8083</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: ws</span><br><span class=\"line\">    - name: wss</span><br><span class=\"line\">      port: 8084</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: wss</span><br><span class=\"line\">    - name: dashboard</span><br><span class=\"line\">      port: 18083</span><br><span class=\"line\">      protocol: TCP</span><br><span class=\"line\">      targetPort: dashboard</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f service.yaml</span><br><span class=\"line\">service/emqx-service created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get svc</span><br><span class=\"line\">NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                                        AGE</span><br><span class=\"line\">emqx-service   ClusterIP   10.96.54.205   &lt;none&gt;        1883/TCP,8883/TCP,8081/TCP,8083/TCP,8084/TCP,18083/TCP   58s</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Service  IP  EMQX Broker  API</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl 10.96.54.205:8081/status</span><br><span class=\"line\">Node emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120 is started</span><br><span class=\"line\">emqx is running</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p> EMQX Broker  kubernetes  Deployment  EMQX Broker Pod Service  EMQX Broker </p>\n<h2 id=\"-kubernetes--EMQX-MQTT-\"> kubernetes  EMQX MQTT </h2>\n<p> Deployment  EMQX Broker Pod Deployment  Pod  <code>kubectl scale deployment $&#123;deployment_name&#125; --replicas $&#123;numer&#125;</code>  Pod  EMQX Broker Pod  3 </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl scale deployment emqx-deployment --replicas 3</span><br><span class=\"line\">deployment.apps/emqx-deployment scaled</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-2nhh6   1/1     Running   0          18m</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-mpvch   1/1     Running   0          6s</span><br><span class=\"line\">emqx-deployment-68fcb4bfd6-mx55q   1/1     Running   0          6s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-68fcb4bfd6-2nhh6 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx-deployment-68fcb4bfd6-2nhh6@192.168.77.120&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker Pod  3  Pod  kubernetes  EMQX Broker Pod</p>\n<h3 id=\"-EMQX-Broker-\"> EMQX Broker </h3>\n<p> EMQX Broker <a href=\"https://docs.emqx.com/zh/emqx/latest/deploy/cluster/introduction.html\"></a> EMQX Broker </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cluster.discovery = kubernetes</span><br><span class=\"line\">cluster.kubernetes.apiserver = http://10.110.111.204:8080</span><br><span class=\"line\">cluster.kubernetes.service_name = ekka</span><br><span class=\"line\">cluster.kubernetes.address_type = ip</span><br><span class=\"line\">cluster.kubernetes.app_name = ekka</span><br></pre></td></tr></table></figure>\n<p> <code>cluster.kubernetes.apiserver</code>  kubernetes apiserver  <code>kubectl cluster-info</code> <code>cluster.kubernetes.service_name</code>  Service  name <code>cluster.kubernetes.app_name</code>  EMQX Broker  <code>node.name</code>  <code>@</code>  EMQX Broker  <code>node.name</code> </p>\n<p>EMQX Broker  docker  <a href=\"https://hub.docker.com/r/emqx/emqx\">docker hub</a>  <a href=\"https://github.com/emqx/emqx-rel/blob/master/deploy/docker/README.md\">Github</a></p>\n<ul>\n<li>\n<p> Deployment  yaml </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        env:</span><br><span class=\"line\">        - name: EMQX_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__DISCOVERY</span><br><span class=\"line\">          value: k8s</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APP_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__SERVICE_NAME</span><br><span class=\"line\">          value: emqx-service</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APISERVER</span><br><span class=\"line\">          value: &quot;https://kubernetes.default.svc:443&quot;</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__NAMESPACE</span><br><span class=\"line\">          value: default</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p> ``kubectl scale deployment ${deployment_name} --replicas ${numer}<code> yaml  yaml </code>spec.replicas: 3` </p>\n<p>Pod  kubernetes  DNS  <code>https://kubernetes.default.svc:443</code>  kubernetes apiserver  </p>\n</blockquote>\n</li>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete deployment emqx-deployment</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"-Pod--kubernetes-apiserver-\"> Pod  kubernetes apiserver </h3>\n<p> Deployment  EMQX Broker  EMQX Broker  EMQX Broker Pod  log</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-5c8cfc4d75-67lmt   1/1     Running   0          5s</span><br><span class=\"line\">emqx-deployment-5c8cfc4d75-r6jgb   1/1     Running   0          5s</span><br><span class=\"line\">emqx-deployment-5c8cfc4d75-wv2hj   1/1     Running   0          5s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.87.150&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c8cfc4d75-67lmt -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt; [&#x27;emqx@192.168.87.150&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl logs emqx-deployment-76f6895c46-4684f</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">(emqx@192.168.87.150)1&gt; 2020-05-20 01:48:39.726 [error] Ekka(AutoCluster): Discovery error: &#123;403,</span><br><span class=\"line\">                                     &quot;&#123;\\&quot;kind\\&quot;:\\&quot;Status\\&quot;,\\&quot;apiVersion\\&quot;:\\&quot;v1\\&quot;,\\&quot;metadata\\&quot;:&#123;&#125;,\\&quot;status\\&quot;:\\&quot;Failure\\&quot;,\\&quot;message\\&quot;:\\&quot;endpoints \\\\\\&quot;emqx-service\\\\\\&quot; is forbidden: User \\\\\\&quot;system:serviceaccount:default:default\\\\\\&quot; cannot get resource \\\\\\&quot;endpoints\\\\\\&quot; in API group \\\\\\&quot;\\\\\\&quot; in the namespace \\\\\\&quot;default\\\\\\&quot;\\&quot;,\\&quot;reason\\&quot;:\\&quot;Forbidden\\&quot;,\\&quot;details\\&quot;:&#123;\\&quot;name\\&quot;:\\&quot;emqx-service\\&quot;,\\&quot;kind\\&quot;:\\&quot;endpoints\\&quot;&#125;,\\&quot;code\\&quot;:403&#125;\\n&quot;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Pod  kubernetes apiserver  HTTP 403</p>\n<p> Pod  kubernetes apiserver  kubernetes apiserver  http  ServiceAccountRole  RoleBinding  RBAC </p>\n<ul>\n<li>\n<p>  ServiceAccountRole  RoleBinding</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat rbac.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ServiceAccount</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: Role</span><br><span class=\"line\">apiVersion: rbac.authorization.kubernetes.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">rules:</span><br><span class=\"line\">- apiGroups:</span><br><span class=\"line\">  - &quot;&quot;</span><br><span class=\"line\">  resources:</span><br><span class=\"line\">  - endpoints </span><br><span class=\"line\">  verbs: </span><br><span class=\"line\">  - get</span><br><span class=\"line\">  - watch</span><br><span class=\"line\">  - list</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: RoleBinding</span><br><span class=\"line\">apiVersion: rbac.authorization.kubernetes.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">subjects:</span><br><span class=\"line\">  - kind: ServiceAccount</span><br><span class=\"line\">    name: emqx</span><br><span class=\"line\">    namespace: default</span><br><span class=\"line\">roleRef:</span><br><span class=\"line\">  kind: Role</span><br><span class=\"line\">  name: emqx</span><br><span class=\"line\">  apiGroup: rbac.authorization.kubernetes.io</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f rbac.yaml</span><br><span class=\"line\">serviceaccount/emqx created</span><br><span class=\"line\">role.rbac.authorization.kubernetes.io/emqx created</span><br><span class=\"line\">rolebinding.rbac.authorization.kubernetes.io/emqx created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment  yaml  <code>spec.template.spec.serviceAccountName</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        env:</span><br><span class=\"line\">        - name: EMQX_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__DISCOVERY</span><br><span class=\"line\">          value: kubernetes</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APP_NAME</span><br><span class=\"line\">          value: emqx</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__SERVICE_NAME</span><br><span class=\"line\">          value: emqx-service</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__APISERVER</span><br><span class=\"line\">          value: &quot;https://kubernetes.default.svc:443&quot;</span><br><span class=\"line\">        - name: EMQX_CLUSTER__K8S__NAMESPACE</span><br><span class=\"line\">          value: default</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl delete deployment emqx-deployment</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-6b854486c-dhd7p   1/1     Running   0          10s</span><br><span class=\"line\">emqx-deployment-6b854486c-psv2r   1/1     Running   0          10s</span><br><span class=\"line\">emqx-deployment-6b854486c-tdzld   1/1     Running   0          10s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.77.92&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-6b854486c-dhd7p  -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.115&#x27;,&#x27;emqx@192.168.77.92&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.157&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete pods emqx-deployment-6b854486c-dhd7p</span><br><span class=\"line\">pod &quot;emqx-deployment-6b854486c-dhd7p&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-6b854486c-846v7   1/1     Running   0          56s</span><br><span class=\"line\">emqx-deployment-6b854486c-psv2r   1/1     Running   0          3m50s</span><br><span class=\"line\">emqx-deployment-6b854486c-tdzld   1/1     Running   0          3m50s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-6b854486c-846v7 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.115&#x27;,&#x27;emqx@192.168.77.84&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.157&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; [&#x27;emqx@192.168.77.92&#x27;]&#125;</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker  Pod Deployment  Pod </p>\n</li>\n</ul>\n<p>EMQX Broker  kubernetes </p>\n<h2 id=\"-EMQX-Broker-\"> EMQX Broker </h2>\n<p> Deployment  Pod Pod  Pod  EMQX Broker  EMQX Broker  Pod EMQX Broker </p>\n<h3 id=\"ConfigMap\">ConfigMap</h3>\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/\">ConfigMap</a>  configMap  API </p>\n<p>ConfigMap  <a href=\"https://kubernetes.io/docs/concepts/overview/#why-containers\"></a> </p>\n<blockquote>\n<p>ConfigMap  <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\">Secret</a>  ConfigMap</p>\n</blockquote>\n<p> ConfigMap  EMQX Broker  Deployment </p>\n<ul>\n<li>\n<p> Configmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat configmap.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-config</span><br><span class=\"line\">data:</span><br><span class=\"line\">  EMQX_CLUSTER__K8S__ADDRESS_TYPE: &quot;hostname&quot;</span><br><span class=\"line\">  EMQX_CLUSTER__K8S__APISERVER: &quot;https://kubernetes.default.svc:443&quot;</span><br><span class=\"line\">  EMQX_CLUSTER__K8S__SUFFIX: &quot;svc.cluster.local&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f configmap.yaml</span><br><span class=\"line\">configmap/emqx-config created</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment  Configmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat deployment.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-deployment</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        envFrom:</span><br><span class=\"line\">          - configMapRef:</span><br><span class=\"line\">              name: emqx-config</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete -f deployment.yaml</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f deployment.yaml</span><br><span class=\"line\">deployment.apps/emqx-deployment created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-deployment-5c7696b5d7-k9lzj   1/1     Running   0          3s</span><br><span class=\"line\">emqx-deployment-5c7696b5d7-mdwkt   1/1     Running   0          3s</span><br><span class=\"line\">emqx-deployment-5c7696b5d7-z57z7   1/1     Running   0          3s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl status</span><br><span class=\"line\">Node &#x27;emqx@192.168.87.149&#x27; is started</span><br><span class=\"line\">emqx 4.1-rc.1 is running</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-deployment-5c7696b5d7-k9lzj -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.106&#x27;,&#x27;emqx@192.168.77.107&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.149&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>EMQX Broker  Configmap  Configmap Pod </p>\n<h3 id=\"StatefulSet\">StatefulSet</h3>\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/\">StatefulSet</a>  Deployments  ReplicaSets </p>\n<ul>\n<li> Pod  PVC </li>\n<li> Pod  PodName  HostName  Headless ServiceCluster IPService</li>\n<li> Pod 0N-1Pod Pod  Running  Ready  init containers </li>\n<li>N-10</li>\n</ul>\n<p>StatefulSet</p>\n<ul>\n<li>DNS domain Headless Service</li>\n<li> PersistentVolumes  volumeClaimTemplates</li>\n<li> StatefulSet</li>\n</ul>\n<p>StatefulSet  Pod  DNS  <code>statefulSetName-&#123;0..N-1&#125;.serviceName.namespace.svc.cluster.local</code> </p>\n<ul>\n<li><code>serviceName</code>  Headless Service </li>\n<li><code>0..N-1</code>  Pod  0  N-1</li>\n<li><code>statefulSetName</code> StatefulSet</li>\n<li><code>namespace</code>  namespaceHeadless Servic  StatefulSet  namespace</li>\n<li><code>.cluster.local</code>  Cluster Domain</li>\n</ul>\n<p> StatefulSet  Deployment  Pod</p>\n<ul>\n<li>\n<p> Deployment</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete deployment emqx-deployment</span><br><span class=\"line\">deployment.apps &quot;emqx-deployment&quot; deleted</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> StatefulSet</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: StatefulSet</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-statefulset</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  serviceName: emqx-headless</span><br><span class=\"line\">  updateStrategy:</span><br><span class=\"line\">    type: RollingUpdate</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        envFrom:</span><br><span class=\"line\">          - configMapRef:</span><br><span class=\"line\">              name: emqx-config</span><br></pre></td></tr></table></figure>\n<p>StatefulSet  Headless Service  Service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat headless.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Service</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-headless</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  type: ClusterIP</span><br><span class=\"line\">  clusterIP: None</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - name: mqtt</span><br><span class=\"line\">    port: 1883</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 1883</span><br><span class=\"line\">  - name: mqttssl</span><br><span class=\"line\">    port: 8883</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8883</span><br><span class=\"line\">  - name: mgmt</span><br><span class=\"line\">    port: 8081</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8081</span><br><span class=\"line\">  - name: websocket</span><br><span class=\"line\">    port: 8083</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8083</span><br><span class=\"line\">  - name: wss</span><br><span class=\"line\">    port: 8084</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 8084</span><br><span class=\"line\">  - name: dashboard</span><br><span class=\"line\">    port: 18083</span><br><span class=\"line\">    protocol: TCP</span><br><span class=\"line\">    targetPort: 18083</span><br></pre></td></tr></table></figure>\n<p> Headless Service  IP <code>clusterIP: None</code> </p>\n</li>\n<li>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f headless-service.yaml</span><br><span class=\"line\">service/emqx-headless created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f statefulset.yaml</span><br><span class=\"line\">statefulset.apps/emqx-deployment created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0                 1/1     Running   0          2m59s</span><br><span class=\"line\">emqx-statefulset-1                 1/1     Running   0          2m57s</span><br><span class=\"line\">emqx-statefulset-2                 1/1     Running   0          2m54s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-statefulset-0 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@192.168.77.105&#x27;,&#x27;emqx@192.168.87.153&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@192.168.87.155&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p> Configmap<br>\nStatefulSet EMQX Broker  hostname  dns  IP  hostname  <code>emqx.conf</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cluster.kubernetes.address_type = hostname</span><br><span class=\"line\">cluster.kubernetes.suffix = &quot;svc.cluster.local&quot;</span><br></pre></td></tr></table></figure>\n<p>kubernetes  Pod  DNS EMQX Broker   <code>cluster.kubernetes.suffix</code>  DNS  DNS <code>statefulSetName-&#123;0..N-1&#125;.serviceName.namespace.svc.cluster.local</code> DNS  serviceName  StatefulSet  Headless Service <code>cluster.kubernetes.service_name</code>   Headless Service Name<br>\n Configmap </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EMQX_CLUSTER__K8S__ADDRESS_TYPE: &quot;hostname&quot;</span><br><span class=\"line\">EMQX_CLUSTER__K8S__SUFFIX: &quot;svc.cluster.local&quot;</span><br><span class=\"line\">EMQX_CLUSTER__K8S__SERVICE_NAME: emqx-headless</span><br></pre></td></tr></table></figure>\n<p>Configmap  <code>$ kubectl edit configmap emqx-config</code>  Configmap</p>\n</li>\n<li>\n<p> StatefulSet<br>\nConfigmap  Pod  StatefulSet</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl delete statefulset emqx-statefulset</span><br><span class=\"line\">statefulset.apps &quot;emqx-statefulset&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f statefulset.yaml</span><br><span class=\"line\">statefulset.apps/emqx-statefulset created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          115s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          112s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          110s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n<p> EMQX Broker </p>\n</li>\n<li>\n<p> Pod<br>\nStatefulSet  Pod  PodName  HostName </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">kuNAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          6m20s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          6m17s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          6m15s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl delete pod emqx-statefulset-0</span><br><span class=\"line\">pod &quot;emqx-statefulset-0&quot; deleted</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          27s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          9m45s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          9m43s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl exec emqx-statefulset-2 -- emqx_ctl cluster status</span><br><span class=\"line\">Cluster status: #&#123;running_nodes =&gt;</span><br><span class=\"line\">                      [&#x27;emqx@emqx-statefulset-0.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-1.emqx-headless.default.svc.cluster.local&#x27;,</span><br><span class=\"line\">                       &#x27;emqx@emqx-statefulset-2.emqx-headless.default.svc.cluster.local&#x27;],</span><br><span class=\"line\">                  stopped_nodes =&gt; []&#125;</span><br></pre></td></tr></table></figure>\n<p>StatefulSet  PodPod  EMQX Broker </p>\n</li>\n</ul>\n<h2 id=\"StorageClassesPersistentVolume--PersistentVolumeClaim\">StorageClassesPersistentVolume  PersistentVolumeClaim</h2>\n<p>PersistentVolumePVPV  PV  Volume  PV  Pod  API   NFSiSCSI </p>\n<p>PersistentVolumeClaimPVC Pod Pod PVC  PV Pod CPU / </p>\n<p>StorageClass  class   class   Kubernetes  class  </p>\n<p> EMQX Broker  PV  StorageClass PVC  EMQX Broker  <code>/opt/emqx/data/mnesia</code> PodsEMQX  <code>/opt/emqx/data/mnesia</code>  EMQX Broker </p>\n<ul>\n<li>\n<p> StatefulSet</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: StatefulSet</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: emqx-statefulset</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: emqx</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 3</span><br><span class=\"line\">  serviceName: emqx-headless</span><br><span class=\"line\">  updateStrategy:</span><br><span class=\"line\">    type: RollingUpdate</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: emqx</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: emqx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      volumes:</span><br><span class=\"line\">      - name: emqx-data</span><br><span class=\"line\">        persistentVolumeClaim:</span><br><span class=\"line\">          claimName: emqx-pvc</span><br><span class=\"line\">      serviceAccountName: emqx</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: emqx</span><br><span class=\"line\">        image: emqx/emqx:v4.1-rc.1</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">        - name: mqtt</span><br><span class=\"line\">          containerPort: 1883</span><br><span class=\"line\">        - name: mqttssl</span><br><span class=\"line\">          containerPort: 8883</span><br><span class=\"line\">        - name: mgmt</span><br><span class=\"line\">          containerPort: 8081</span><br><span class=\"line\">        - name: ws</span><br><span class=\"line\">          containerPort: 8083</span><br><span class=\"line\">        - name: wss</span><br><span class=\"line\">          containerPort: 8084</span><br><span class=\"line\">        - name: dashboard</span><br><span class=\"line\">          containerPort: 18083</span><br><span class=\"line\">        envFrom:</span><br><span class=\"line\">          - configMapRef:</span><br><span class=\"line\">              name: emqx-config</span><br><span class=\"line\">        volumeMounts:</span><br><span class=\"line\">        - name: emqx-data</span><br><span class=\"line\">          mountPath: &quot;/opt/emqx/data/mnesia&quot;</span><br><span class=\"line\">  volumeClaimTemplates:</span><br><span class=\"line\">  - metadata:</span><br><span class=\"line\">      name: emqx-pvc</span><br><span class=\"line\">      annotations:</span><br><span class=\"line\">        volume.alpha.kubernetes.io/storage-class: manual</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      accessModes: [ &quot;ReadWriteOnce&quot; ]</span><br><span class=\"line\">      resources:</span><br><span class=\"line\">        requests:</span><br><span class=\"line\">          storage: 1Gi</span><br></pre></td></tr></table></figure>\n<p> <code>volumeClaimTemplates</code>  StorageClass  name  manual  emqx-pvc  PVC PVC  <code>ReadWriteOnce</code> 1Gi  PVC  name  emqx-data  volumes volumes  Pod  <code>/opt/emqx/data/mnesia</code>  </p>\n</li>\n<li>\n<p><br>\n StatefulSet  kubernetes </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f statefulset.yaml</span><br><span class=\"line\">statefulset.apps/emqx-statefulset created</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods</span><br><span class=\"line\">NAME                 READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">emqx-statefulset-0   1/1     Running   0          27s</span><br><span class=\"line\">emqx-statefulset-1   1/1     Running   0          9m45s</span><br><span class=\"line\">emqx-statefulset-2   1/1     Running   0          9m43s</span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pvc</span><br><span class=\"line\">NAME                                 STATUS    VOLUME                                 CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class=\"line\">emqx-data-emqx-statefulset-0   Bound     pvc-8094cd75-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            2m11s</span><br><span class=\"line\">emqx-data-emqx-statefulset-0   Bound     pvc-9325441d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            99s</span><br><span class=\"line\">emqx-data-emqx-statefulset-0   Bound     pvc-ad425e9d-adb5-11e9-80cc-0697b59e8064   1Gi        RWO            gp2            56s</span><br></pre></td></tr></table></figure>\n<p> PVC  BoundPVC  Pod EMQX Broker  PVC </p>\n</li>\n</ul>\n<p>EMQX Broker  kubernetes  Demo <a href=\"https://kubernetes.io/zh-cn/docs/home/\">kubernetes </a>   EMQX Team  <a href=\"https://github.com/emqx/emqx-rel/tree/master/deploy/charts/emqx\">Helm chart </a>  Github  issuepull requests  start</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">emqx-deployment</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">emqx</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">emqx/emqx:5.7</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">mqtt</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">1883</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">mqttssl</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8883</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">mgmt</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8081</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ws</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8083</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">wss</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">8084</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dashboard</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">18083</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n"},{"title":"Consul ","date":"2025-05-01T08:57:07.000Z","lastmod":"2025-05-01T08:57:07.000Z","_content":"Consul \n\n## \n\n```shell\nconsul agent -server -bootstrap-expect 1 -data-dir /home/ubuntu/consul/data -ui -config-dir /home/ubuntu/consul/consul.d -bind=172.25.74.176 -client=0.0.0.0\n```","source":"_posts/20250501/6.md","raw":"---\ntitle: Consul \ndate: 2025-05-01 16:57:07\nlastmod: 2025-05-01 16:57:07\ntags: [Consul]\ncategory: Consul\n---\nConsul \n\n## \n\n```shell\nconsul agent -server -bootstrap-expect 1 -data-dir /home/ubuntu/consul/data -ui -config-dir /home/ubuntu/consul/consul.d -bind=172.25.74.176 -client=0.0.0.0\n```","slug":"20250501-6","published":1,"updated":"2025-05-01T09:40:45.205Z","comments":1,"layout":"post","photos":[],"_id":"cma56nfvu0009isjjedzadazh","content":"<p>Consul </p>\n<h2 id=\"\"></h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">consul agent -server -bootstrap-expect 1 -data-dir /home/ubuntu/consul/data -ui -config-dir /home/ubuntu/consul/consul.d -bind=172.25.74.176 -client=0.0.0.0</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<p>Consul </p>\n<h2 id=\"\"></h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">consul agent -server -bootstrap-expect 1 -data-dir /home/ubuntu/consul/data -ui -config-dir /home/ubuntu/consul/consul.d -bind=172.25.74.176 -client=0.0.0.0</span><br></pre></td></tr></table></figure>"},{"title":"Netty Recycler","date":"2025-05-01T08:57:07.000Z","lastmod":"2025-05-01T08:57:07.000Z","_content":"\n\n\n# Recycler\n\n---\n>           bin              \n> Netty **4.1.56.Final**\n\n## 1. \n\n\n\n\n\n\n\n\n\n[Netty](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484244%26idx%3D1%26sn%3D831060fc38caa201d69f87305de7f86a%26chksm%3Dce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e%23rd \"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&mid=2247484244&idx=1&sn=831060fc38caa201d69f87305de7f86a&chksm=ce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e#rd\")JVMNetty  Netty  JVM  native memory  DirectByteBuffer  native  `unsafe.allocateMemory`  `malloc` \n\n\n\n*  JVM  DirectByteBuffer  JVM \n*  `malloc`  DirectByteBuffer \n\n Netty  Netty \n\n## 2. \n\n\n\n Netty  Netty  PooledDirectByteBuf  Netty  IO  PooledDirectByteBuf \n\n PooledDirectByteBuf \n\n Netty  Netty  channel \n\nNetty  Channel  ChannelOutboundBuffer  ChannelOutboundBuffer  Channel  flush  ChannelOutboundBuffer  Socket \n\n ChannelOutboundBuffer  Entry  Entry  Entry  ChannelOutboundBuffer \n\n>  ChannelOutboundBuffer  Entry \n\nNetty IO  Entry  IO  JVM  GC  Netty \n\n\n\n\n\n---\n\n\n\n\n\n## 3. JVM\n\n### 3.1 \n\n Java  new JVM new \n\n1.  JVM  new  Java \n2. JVMJVM\n\n> [JVM](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd \"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&mid=2247484304&idx=1&sn=54bf0d07e69c5621c145afaece8f50d6&chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\")\n\n3. JVMJVMJVMJVMCAS  + \n4. JVMJVM-TLABTLABTLABJVM**** `-XX:+UseTLAB`TLAB`-XX:-UseTLAB`TLAB\n\n> TLABNettyRecycler\n\n5. JVM\n6. MarkWord[JVM](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd \"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&mid=2247484304&idx=1&sn=54bf0d07e69c5621c145afaece8f50d6&chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\")\n7. \n\n### 3.2 \n\n* JVMJavaGC ROOTS\n* GC PAUSESTOP THE WORLD\n\n---\n\nIONetty Recycler \n\n Recycler  Recycler \n\n## 4. Recycler\n\nNettyRecycler PooledDirectByteBuf \n\n> PooledDirectByteBuf\n\n![image.png](/assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp)\n\n### 4.1 PooledDirectByteBuf\n\n```java\nfinal class PooledDirectByteBuf extends PooledByteBuf<ByteBuffer> {\n    //\n    private static final ObjectPool<PooledDirectByteBuf> RECYCLER = ObjectPool.newPool(\n            new ObjectCreator<PooledDirectByteBuf>() {\n        @Override\n        public PooledDirectByteBuf newObject(Handle<PooledDirectByteBuf> handle) {\n            return new PooledDirectByteBuf(handle, 0);\n        }\n    });\n\n    //\n    private final Handle<PooledByteBuf<T>> recyclerHandle;\n\n    static PooledDirectByteBuf newInstance(int maxCapacity) {\n        //\n        PooledDirectByteBuf buf = RECYCLER.get();\n        buf.reuse(maxCapacity);\n        return buf;\n    }\n  \n    private void recycle() {\n         //\n        recyclerHandle.recycle(this);\n    }\n\n    ..................................\n}\n```\n\nNettyPooledDirectByteBufPooledDirectByteBuf\n\nNetty`ObjectPool  RECYCLER `\n\nPooledDirectByteBuf`ObjectPool<T>`Netty ObjectPool#newPool  ObjectCreator  ObjectCreatornewObject \n\nrecyclerHandlerecyclerHandlerecyclerHandle\n\nPooledDirectByteBuf`RECYCLER.get()`PooledDirectByteBuf\n\nPooledDirectByteBuf`recyclerHandle.recycle(this) `\n\n### 4.2 Channel\n\nChannelChannelOutboundBufferchannelwrite\n\nChannelChannelOutboundBufferChannelOutboundBufferEntryNettyEntryEntry\n\nPooledDirectByteBufEntry\n\n#### \n\n```java\n   static final class Entry {\n\n        private static final ObjectPool<Entry> RECYCLER = ObjectPool.newPool(new ObjectCreator<Entry>() {\n            @Override\n            public Entry newObject(Handle<Entry> handle) {\n                return new Entry(handle);\n            }\n        });\n\n        //recyclerHandle\n        private  Handle<Entry> handle;\n      \n        private Entry(Handle<Entry> handle) {\n            this.handle = handle;\n        }\n   }\n```\n\n\n\n```java\nstatic final ObjectPool<Entry> RECYCLER \n```\n\n ObjectCreator \n\n```java\n    public interface ObjectCreator<T> {\n        T newObject(Handle<T> handle);\n    }\n```\n\n`ObjectPool#newPool` Entry\n\nHandlerHandlerHandler\n\n#### \n\nEntrypublicEntry\n\n static  newInstance`RECYCLER.get()`\n\n```java\n      static Entry newInstance(Object msg, int size, long total, ChannelPromise promise) {\n            Entry entry = RECYCLER.get();\n          \n            .......................\n\n            return entry;\n        }\n```\n\n#### \n\n recycle \n\n```java\n        void recycle() {\n            next = null;\n            bufs = null;\n            buf = null;\n            msg = null;\n            promise = null;\n            progress = 0;\n            total = 0;\n            pendingSize = 0;\n            count = -1;\n            cancelled = false;\n            handle.recycle(this);\n        }\n```\n\n* \n* Handler\n\n---\n\nNetty\n\n\n\n## 5. Recycler\n\nRecycler -  - \n\n\n\n\n\n\n\nRecycler\n\n![image.png](/assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp)\n\n### 5.1 \n\n\n\n\n\n Stack  WeakOrderQueue\n\nStack \n\n****StackJVMTLAB,TLAB\n\n, StackStack\n\n**NettyTLABStackStack**\n\n> ****Netty\n\n### 5.2 Stack\n\nRecyclerStack\n\n* Stack****\n* WeakOrderQueuehead WeakOrderQueuecursor prev WeakOrderQueueWeakOrderQueueWeakOrderQueue\n\n> WeakOrderQueue\n\n**StackWeakOrderQueue**\n\nRecyclerthread1 thread2 , thread3 , thread4\n\n> StackWeakOrderQueue\n\n![image.png](/assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp)\n\n thread1 thread1thread1thread1stack1`hread1stack1\n\n> Stack\n\nthread1thread2thread3thread2thread3thread1\n\nthread1thread1stack1stack1**NettyStack**\n\nthread1Stack1thread1Stack1\n\n> GCStack\n\n**Netty**\n\nthead2 , thread3 ....WeakOrderQueueWeakOrderQueue\n\n> WeakOrderQueueStack\n\n``thread1``thread2 , thread3 , thead4 .....\n\nthread1stack1**WeakOrderQueue**stack1stack1WeakOrderQueueStackheadprevcursorWeakOrderQueue\n\n> WeakOrderQueue\n\nthread1Stack1Stack\n\nStack cursor StackWeakOrderQueueWeakOrderQueue****WeakOrderQueue\n\n> StackStackWeakOrderQueueWeakOrderQueue\n\n****\n\n****\n\n![image.png](/assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp)\n\n### 5.3 WeakOrderQueue\n\nWeakOrderQueue\n\n> ****\n\n![image.png](/assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp)\n\nWeakOrderQueueWeakOrderQueue\n\n Head Tail Link \n\nLink  elements \n\nLinkreadIndexelementswriteIndexelementselements`16`Link1616LinkLink\n\nWeakoOrderQueueStack****WeakOrderQueueLinkHeadHeadLinkStack**Link**16\n\nLinkStackLinkWeakOrderQueueLinkHeadLink\n\n> head**Link**headTail****\n\n********\n\n**Netty** \n\nWeakOrderQueue****\n\n> ****\n\n Netty Recycler WeakOrderQueue\n\nNetty\n\n## 6. Recycler\n\n4. RecyclerRecycler\n\n* PooledDirectByteBuf\n* ChannelChannelOutboundBuffer\n\n ObjectPool ObjectPool Netty\n\n\n\n### 6.1 ObjectPool\n\n```java\npublic abstract class ObjectPool<T> {\n\n    ObjectPool() { }\n\n    public abstract T get();\n\n    public interface Handle<T> {\n        void recycle(T self);\n    }\n\n    public interface ObjectCreator<T> {\n        T newObject(Handle<T> handle);\n    }\n\n    ..................................\n\n}\n```\n\n ObjecPool \n\n4. Recycler\n\n```java\nstatic final class Entry {\n\n    private static final ObjectPool<Entry> RECYCLER\n\n}\n```\n\n```java\nfinal class PooledDirectByteBuf extends PooledByteBuf<ByteBuffer> {\n\n    private static final ObjectPool<PooledDirectByteBuf> RECYCLER\n\n}\n```\n\nObjecPool \n\n```java\npublic abstract T get();\n```\n\n Handler \n\n```java\n     public interface Handle<T> {\n        void recycle(T self);\n    } \n```\n\nHandlerHandlerDefaultHandle\n\n> StackDefaultHandleWeakOrderQueueLinkelementsDefaultHandle\n\n**recycleHandlerObejctPool**\n\nrecycle\n\n4. RecyclerHandlerHandlerrecyclerecycleHandlerrecycle\n\n```java\nstatic final class Entry {\n\n        void recycle() {\n            next = null;\n            bufs = null;\n            buf = null;\n            msg = null;\n            promise = null;\n            progress = 0;\n            total = 0;\n            pendingSize = 0;\n            count = -1;\n            cancelled = false;\n            handle.recycle(this);\n        }\n\n}\n```\n\nObjectPool \n\n```java\n    public interface ObjectCreator<T> {\n        T newObject(Handle<T> handle);\n    }\n```\n\n`ObjectCreator#newObject`Handler\n\n```java\n  static final class Entry {\n\n      private static final ObjectPool<Entry> RECYCLER = ObjectPool.newPool(new ObjectCreator<Entry>() {\n            @Override\n            public Entry newObject(Handle<Entry> handle) {\n                return new Entry(handle);\n            }\n        });\n\n      //Entry\n      private Entry(Handle<Entry> handle) {\n            this.handle = handle;\n        }\n\n  }\n```\n\n#### 6.1.1 ObjectPool\n\n![image.png](/assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp)\n\n```java\npublic abstract class ObjectPool<T> {\n\n    public static <T> ObjectPool<T> newPool(final ObjectCreator<T> creator) {\n        return new RecyclerObjectPool<T>(ObjectUtil.checkNotNull(creator, \"creator\"));\n    }\n\n    private static final class RecyclerObjectPool<T> extends ObjectPool<T> {\n        //recycler\n        private final Recycler<T> recycler;\n\n        RecyclerObjectPool(final ObjectCreator<T> creator) {\n             recycler = new Recycler<T>() {\n                @Override\n                protected T newObject(Handle<T> handle) {\n                    return creator.newObject(handle);\n                }\n            };\n        }\n\n        @Override\n        public T get() {\n            return recycler.get();\n        }\n    }\n\n}\n```\n\n```java\npublic abstract class Recycler<T> {\n\n    protected abstract T newObject(Handle<T> handle);\n  \n    .....................................\n}\n```\n\n `ObjectPool#newPool`  RecyclerObjectPool ** Recycler**  RecyclerObjectPool \n\nRecyclerObjectCreator \n\n## 7. Recycler\n\nRecycler\n\n![image.png](/assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp)\n\n### 7.1 Id\n\n```java\npublic abstract class Recycler<T> {\n\n    //Id,\n    private static final AtomicInteger ID_GENERATOR = new AtomicInteger(Integer.MIN_VALUE);\n    //Id static final OWN_THREAD_ID\n    //Id\n    //\n    private static final int OWN_THREAD_ID = ID_GENERATOR.getAndIncrement();\n\n}\n```\n\n* `AtomicInteger ID_GENERATOR` : AtomicInteger IdId****\n* `int OWN_THREAD_ID` Recycler ID_GENERATOR  OWN_THREAD_ID  OWN_THREAD_ID IdOWN_THREAD_ID  static final Recycler OWN_THREAD_ID \n\nthread1, thread2, thread3.....Recycler  OWN_THREAD_ID \n\n![image.png](/assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp)\n\n**Id**Netty****Id\n\nId WeakOrderQueue  WeakOrderQueue Id\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n\n    //Id,weakOrderQueuestackweakOrderQueue\n   private final int id = ID_GENERATOR.getAndIncrement();\n}\n```\n\n### 7.2 \n\n![image.png](/assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp)\n\n```java\n    //Stack 4096 \n    private static final int DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD = 4 * 1024; // Use 4k instances as default.\n    // Stack 4096\n    private static final int DEFAULT_MAX_CAPACITY_PER_THREAD;\n    //  min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256) 256\n    private static final int INITIAL_CAPACITY;\n```\n\nRecycler \n\n```java\n    static {\n\n        int maxCapacityPerThread = SystemPropertyUtil.getInt(\"io.netty.recycler.maxCapacityPerThread\",\n                SystemPropertyUtil.getInt(\"io.netty.recycler.maxCapacity\", DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD));\n        if (maxCapacityPerThread < 0) {\n            maxCapacityPerThread = DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD;\n        }\n\n        DEFAULT_MAX_CAPACITY_PER_THREAD = maxCapacityPerThread;\n\n        INITIAL_CAPACITY = min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256);\n    }\n```\n\n* `DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD`Stack4096JVM `-D io.netty.recycler.maxCapacity` \n* `DEFAULT_MAX_CAPACITY_PER_THREAD`StackJVM `-D io.netty.recycler.maxCapacityPerThread`  DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD 4096\n* `INITIAL_CAPACITY `: Stack`min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256)`256256 DEFAULT_MAX_CAPACITY_PER_THREAD\n\n### 7.3 \n\n```java\n   //  2  \n    private static final int MAX_SHARED_CAPACITY_FACTOR;\n    // cpu * 2\n    private static final int MAX_DELAYED_QUEUES_PER_THREAD;\n    //WeakOrderQueueLink 16\n    private static final int LINK_CAPACITY;\n```\n\nRecycler  Stack \n\n```java\n    static {\n\n        MAX_SHARED_CAPACITY_FACTOR = max(2,\n                SystemPropertyUtil.getInt(\"io.netty.recycler.maxSharedCapacityFactor\",\n                        2));\n\n        MAX_DELAYED_QUEUES_PER_THREAD = max(0,\n                SystemPropertyUtil.getInt(\"io.netty.recycler.maxDelayedQueuesPerThread\",\n                        // We use the same value as default EventLoop number\n                        NettyRuntime.availableProcessors() * 2));\n\n        LINK_CAPACITY = safeFindNextPositivePowerOfTwo(\n                max(SystemPropertyUtil.getInt(\"io.netty.recycler.linkCapacity\", 16), 16));\n\n    }\n```\n\n* `MAX_SHARED_CAPACITY_FACTOR` :  Stack2JVM `-D io.netty.recycler.maxSharedCapacityFactor`  `max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)` 2048 LINK_CAPACITY  16\n* `MAX_DELAYED_QUEUES_PER_THREAD` : CPU * 2JVM `-D io.netty.recycler.maxDelayedQueuesPerThread` ****\n* `LINK_CAPACITY `:   Stack  WeakOrderQueue WeakOrderQueueLinkLink16JVM `-D io.netty.recycler.linkCapacity` \n\n\n\n![image.png](/assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp)\n\n### 7.4 \n\n\n\nNetty\n\n```java\n    //81/88\n    private static final int RATIO;\n    //8 1/8\n    private static final int DELAYED_QUEUE_RATIO;\n```\n\n\n\n```java\n    static {\n\n        RATIO = max(0, SystemPropertyUtil.getInt(\"io.netty.recycler.ratio\", 8));\n\n        DELAYED_QUEUE_RATIO = max(0, SystemPropertyUtil.getInt(\"io.netty.recycler.delayedQueue.ratio\", RATIO));\n\n    }\n```\n\n Recycler \n\n*  RATIO 8JVM `-D io.netty.recycler.ratio`  1 / 8  8  1\n* StackStackWeakOrderQueueWeakOrderQueue****Stack DELAYED_QUEUE_RATIO 8JVM `-D io.netty.recycler.delayedQueue.ratio`  8  1 \n\n## 8. Recycler\n\n```java\n    private static final class RecyclerObjectPool<T> extends ObjectPool<T> {\n        //recycler\n        private final Recycler<T> recycler;\n\n        RecyclerObjectPool(final ObjectCreator<T> creator) {\n             recycler = new Recycler<T>() {\n                @Override\n                protected T newObject(Handle<T> handle) {\n                    return creator.newObject(handle);\n                }\n            };\n        }\n    \n        ..............................\n      }\n```\n\nNetty  Recycler Recycler newObject \n\n```java\npublic abstract class Recycler<T> {\n\n   protected abstract T newObject(Handle<T> handle);\n\n   protected Recycler() {\n        this(DEFAULT_MAX_CAPACITY_PER_THREAD);\n    }\n\n    protected Recycler(int maxCapacityPerThread) {\n        this(maxCapacityPerThread, MAX_SHARED_CAPACITY_FACTOR);\n    }\n\n    protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor) {\n        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);\n    }\n\n    protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n                       int ratio, int maxDelayedQueuesPerThread) {\n        this(maxCapacityPerThread, maxSharedCapacityFactor, ratio, maxDelayedQueuesPerThread,\n                DELAYED_QUEUE_RATIO);\n    }\n\n    //\n    private final int maxCapacityPerThread;\n    //()\n    private final int maxSharedCapacityFactor;\n    //\n    private final int interval;\n    //\n    private final int maxDelayedQueuesPerThread;\n    //\n    private final int delayedQueueInterval;\n\n    protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n                       int ratio, int maxDelayedQueuesPerThread, int delayedQueueRatio) {\n        interval = max(0, ratio);\n        delayedQueueInterval = max(0, delayedQueueRatio);\n        if (maxCapacityPerThread <= 0) {\n            this.maxCapacityPerThread = 0;\n            this.maxSharedCapacityFactor = 1;\n            this.maxDelayedQueuesPerThread = 0;\n        } else {\n            this.maxCapacityPerThread = maxCapacityPerThread;\n            this.maxSharedCapacityFactor = max(1, maxSharedCapacityFactor);\n            this.maxDelayedQueuesPerThread = max(0, maxDelayedQueuesPerThread);\n        }\n    }\n\n}\n```\n\nRecyclerRecycler\n\n## 9. \n\n![image.png](/assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp)\n\nNettyNetty TLAB StackStackRecyclerStakc\n\n```java\n    //threadlocal stack\n    private final FastThreadLocal<Stack<T>> threadLocal = new FastThreadLocal<Stack<T>>() {\n        @Override\n        protected Stack<T> initialValue() {\n            return new Stack<T>(Recycler.this, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,\n                    interval, maxDelayedQueuesPerThread, delayedQueueInterval);\n        }\n      \n        ........................\n    };\n```\n\n FastThreadLocal  threadLocal Stack\n\n> FastThreadLocalNettyJDKThreadLocalFastThreadLocalJDKThreadLocal\n\nStack\n\n### 9.1 Stack\n\nStack5.2 StackStackWeakOrderQueueHeadPrevCursor\n\nStackStack\n\n```java\nprivate static final class Stack<T> {\n\n        // stackrecycler\n        final Recycler<T> parent;\n\n        //stack defaultHandler -> stack -> thread\n        // thread\n        final WeakReference<Thread> threadRef;\n\n        //\n        final AtomicInteger availableSharedCapacity;\n\n        //Stack\n        private final int maxDelayedQueues;\n\n        //stack 4096\n        private final int maxCapacity;\n\n        //\n        private final int interval;\n\n        //\n        private final int delayedQueueInterval;\n\n        // Stack 2564096\n        DefaultHandle<?>[] elements;\n\n        // \n        int size;\n\n        //  interval \n        private int handleRecycleCount;\n\n        //\n        //StackWeakOrderQueue\n        private WeakOrderQueue cursor, prev;\n        private volatile WeakOrderQueue head;\n}\n```\n\n![image.png](/assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp)\n\n* `Recycler<T> parent`StackRecyclerStackStackparentRecycler stack1 , stack2 , stack3 , stack4 parentRecycler\n* `WeakReference<Thread> threadRef `Stack` -> DefaultHandler -> stack -> threadRef`StackGC\n* `AtomicInteger availableSharedCapacity`thread2 , thread3 , thread4  thread1 availableSharedCapacity ****1 LINK_CAPACITY(WeakOrderQueueLink)stack `max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)`\n\n> StackWeakOrderQueueavailableSharedCapacity \n\n* `int maxDelayedQueues`  CPU * 2 thread2  thread1  thread3 , thread4 maxDelayedQueues  3 \n* `int maxCapacity`Stack4096\n* `int interval`8\n* `int delayedQueueInterval`8\n* `DefaultHandle<?>[] elements`Stack\n* `int size`\n* `int handleRecycleCount` interval  0  +1 `handleRecycleCount == interval`81 Stack \n* `WeakOrderQueue cursor, prevhead`Stack**** WeakOrderQueue \n\nStackRecyclerStack\n\n```java\n    private final FastThreadLocal<Stack<T>> threadLocal = new FastThreadLocal<Stack<T>>() {\n        @Override\n        protected Stack<T> initialValue() {\n            return new Stack<T>(Recycler.this, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,\n                    interval, maxDelayedQueuesPerThread, delayedQueueInterval);\n        }\n\n      ..........................\n    }\n```\n\n```java\n       Stack(Recycler<T> parent, Thread thread, int maxCapacity, int maxSharedCapacityFactor,\n              int interval, int maxDelayedQueues, int delayedQueueInterval) {\n            this.parent = parent;\n            threadRef = new WeakReference<Thread>(thread);\n            this.maxCapacity = maxCapacity;\n            availableSharedCapacity = new AtomicInteger(max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY));\n            elements = new DefaultHandle[min(INITIAL_CAPACITY, maxCapacity)];\n            this.interval = interval;\n            this.delayedQueueInterval = delayedQueueInterval;\n            handleRecycleCount = interval; \n            this.maxDelayedQueues = maxDelayedQueues;\n        }\n```\n\n### 9.2 \n\n![image.png](/assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp)\n\n```java\npublic abstract class Recycler<T> {\n      //Handler,\n     private static final Handle NOOP_HANDLE = new Handle() {\n        @Override\n        public void recycle(Object object) {\n            // NOOP\n        }\n    };\n\n    public final T get() {\n        //0\n        if (maxCapacityPerThread == 0) {\n            return newObject((Handle<T>) NOOP_HANDLE);\n        }\n        // stack\n        Stack<T> stack = threadLocal.get();\n        //stackpophandler\n        DefaultHandle<T> handle = stack.pop();\n        //stack \n        if (handle == null) {\n            //handlerrecycleIdlastRecyclerId0\n            handle = stack.newHandle();\n            //newObjectrecycler \n            handle.value = newObject(handle);\n        }\n        return (T) handle.value;\n    }\n\n}\n```\n\nRecyclerStack\n\n1. `maxCapacityPerThread == 0`Handler\n2. threadLocalStackStackDefaultHandler\n3. DefaultHandlerStackDefaultHandlerDefaultHandlerDefaultHandlerDefaultHandler\n\n```java\nstatic final class Entry {\n\n     private static final ObjectPool<Entry> RECYCLER = ObjectPool.newPool(new ObjectCreator<Entry>() {\n            @Override\n            public Entry newObject(Handle<Entry> handle) {\n                return new Entry(handle);\n            }\n        });\n\n     private Entry(Handle<Entry> handle) {\n            this.handle = handle;\n     }\n}\n```\n\n### 9.3 DefaultHandler\n\n Handler\n\n```java\npublic abstract class ObjectPool<T> {\n\n    public interface Handle<T> {\n        void recycle(T self);\n    }\n\n}\n```\n\nRecycler DefaultHandler DefaultHandler \n\nStackDefaultHandlerStack\n\n```java\n private static final class Stack<T> {\n\n        DefaultHandle<T> newHandle() {\n            return new DefaultHandle<T>(this);\n        }\n }\n```\n\n DefaultHandler \n\n```java\n   private static final class DefaultHandle<T> implements Handle<T> {\n        //0\n        int lastRecycledId;\n        //0\n        int recycleId;\n\n        //\n        boolean hasBeenRecycled;\n        //handlerstack\n        Stack<?> stack;\n        //\n        Object value;\n\n        DefaultHandle(Stack<?> stack) {\n            this.stack = stack;\n        }\n\n        @Override\n        public void recycle(Object object) {\n\n          ................................\n        }\n    }\n```\n\nDefaultHandler\n\n* `int lastRecycledId`0\n* `int recycleId`0\n* `boolean hasBeenRecycled`Stack\n\n****\n\n\n\n* ``Stack`recycleId = lastRecycledId = OWN_THREAD_ID`\n* ``****StackWeakOrderQueue`recycleId = 0lastRecycledId = IdWeakOrderQueue#id`WeakOrderQueueStack`recycleId = lastRecycledId = IdWeakOrderQueue#id`\n\n lastRecycledId recycleId \n\n Object value  Stack<?> stack HandlerStack\n\nStackStack``` -> DefaultHandler -> Stack -> threadRef`\n\n![image.png](/assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp)\n\n```java\nstatic final class Entry {\n    //EntryDefaultHandler\n    private  Handle<Entry> handle;\n  \n}\n\n\nprivate static final class DefaultHandle<T> implements Handle<T> {\n    // DefaultHandlerStack\n    Stack<?> stack;\n\n}\n\nprivate static final class Stack<T> {\n    // Stack\n    final WeakReference<Thread> threadRef;\n\n}\n```\n\n### 9.4 Stack\n\n![image.png](/assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp)\n\n```java\n        DefaultHandle<T> pop() {\n            //\n            int size = this.size;\n            if (size == 0) {\n                //stackstackweakOrderQueuestack\n                if (!scavenge()) {\n                    return null;\n                }\n                size = this.size;\n                if (size <= 0) {\n                    // WeakOrderQueue\n                    // null \n                    return null;\n                }\n            }\n            size --;\n            DefaultHandle ret = elements[size];\n            elements[size] = null;\n            this.size = size;\n\n            if (ret.lastRecycledId != ret.recycleId) {\n                // \n                throw new IllegalStateException(\"recycled multiple times\");\n            }\n\n            //   recycleId = lastRecycleId = 0\n            ret.recycleId = 0;\n            ret.lastRecycledId = 0;\n            return ret;\n        }\n```\n\nStack\n\n*  size == 0  scavenge StackWeakOrderQueueLinkWeakOrderQueueStack null \n*  DefaultHandler DefaultHandler`recycleId  = lastRecycledId = 0`\n\nrecycleId  lastRecycledId \n\n* `recycleId  = lastRecycledId = 0`\n* `recycleId  = lastRecycledId != 0`Stack\n* `recycleId  != lastRecycledId`WeakOrderQueueStack\n\n### 9.4 Stack\n\n![image.png](/assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp)\n\nStack\n\n* Stack\n* StackWeakOrderQueueWeakOrderQueue\n\nStackWeakOrderQueueWeakOrderQueue****\n\n scavenge \n\n```java\n       private boolean scavenge() {\n            //weakOrderQueue   stack\n            if (scavengeSome()) {\n                return true;\n            }\n\n            // weakOrderQueuestackcursor.prev\n            // weakOrderQueuecursor\n            prev = null;\n            cursor = head;\n            return false;\n        }\n```\n\nscavengeSome() WeakOrderQueue true WeakOrderQueuecursorheadprevnullWeakOrderQueuecursor\n\n### 9.5 \n\nStackWeakOrderQueue\n\nWeakOrderQueueStackWeakOrderQueue\n\n![image.png](/assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp)\n\nStackWeakOrderQueue prev = head = cursor = null \n\nWeakOrderQueue**WeakOrderQueue**\n\n> WeakOrderQueue\n\nheadcursorcursorprevcursorprev\n\nWeakOrderQueue\n\n```java\n        private boolean scavengeSome() {\n            WeakOrderQueue prev;\n            //stack weakOrderQueue\n            WeakOrderQueue cursor = this.cursor;\n            //stackcursorprev,headnullcursor == null stackweakOrderQueue\n            if (cursor == null) {\n                prev = null;\n                cursor = head;\n                if (cursor == null) {\n                    //weakOrderQueue\n                    return false;\n                }\n            } else {\n                //prevcursor\n                prev = this.prev;\n            }\n\n            boolean success = false;\n            //weakOrderQueue \n            do {\n                //weakOrderQueuestacklink\n                if (cursor.transfer(this)) {\n                    success = true;\n                    break;\n                }\n                //cursorweakOrderQueue\n                WeakOrderQueue next = cursor.getNext();\n                //weakOrderQueue\n                if (cursor.get() == null) {\n                    // weakOrderQueue\n                    if (cursor.hasFinalData()) {\n                        //weakOrderQueueweakOrderQueue\n                        for (;;) {\n\n                            if (cursor.transfer(this)) {\n                                success = true;\n                            } else {\n                                break;\n                            }\n                        }\n                    }\n\n                    //weaoOrderQueueunlinkcursor\n                    //netty\n                    // prev == null cursorunlink \n                    if (prev != null) {\n                        //weakOrderQueueGC\n                        cursor.reclaimAllSpaceAndUnlink();\n                        //prevcursor\n                        prev.setNext(next);\n                    }\n                } else {\n                    prev = cursor;\n                }\n                //prev,cursorweakOrderQueue\n                cursor = next;\n\n            } while (cursor != null && !success);\n\n            this.prev = prev;\n            this.cursor = cursor;\n            return success;\n        }\n```\n\n1. WeakOrderQueuecursorStackWeakOrderQueuecursorheadheadWeakOrderQueueheadheadWeakOrderQueue\n2. cursorWeakOrderQueueStackLinkWeakOrderQueueWeakOrderQueue\n\n```java\n        if (cursor.transfer(this)) {\n            success = true;\n            break;\n        }\n\n        WeakOrderQueue next = cursor.getNext();\n```\n\n3. WeakOrderQueueWeakOrderQueue``,GC`cursor.get() == null`WeakOrderQueueStack**Link**WeakOrderQueue\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n\n    ............WeakOrderQueue.........\n\n}\n```\n\n4. WeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC`cursor.reclaimAllSpaceAndUnlink()`availableSharedCapacityWeakOrderQueue\n\n```java\n        if (prev != null) {\n              cursor.reclaimAllSpaceAndUnlink();\n              //prevcursor\n              prev.setNext(next);\n        }\n```\n\n> NettyWeakOrderQueue`prev == null`Netty\n\nWeakOrderQueuecursor\n\n\n\n****\n\n![image.png](/assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp)\n\nWeakOrderQueueStackWeakOrderQueue****\n\n thread4 ****cursorthread3thread3\n\n thread5 thread5WeakOrderQueuecursor`thread4``cursor.get() == null``thread4`\n\n> \n\n**WeakOrderQueue**\n\nWeakOrderQueueWeakOrderQueueStackWeakOrderQueue\n\nStackWeakOrderQueue\n\n****\n\n```java\n        //recycler\n        synchronized void setHead(WeakOrderQueue queue) {\n            //weakOrderQueue\n            queue.setNext(head);\n            head = queue;\n        }\n```\n\nRecycler\n\n> \n\n## 10. WeakOrderQueue\n\n![image.png](/assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp)\n\nWeakOrderQueueQueueLinkHeadLinkLinkheadLinkTail`Link`\n\n### 10.1 Link\n\n```java\n    private static final class WeakOrderQueue extends WeakReference<Thread> {\n\n        // linkAtomicInteger writeindex\n        static final class Link extends AtomicInteger {\n            //16\n            final DefaultHandle<?>[] elements = new DefaultHandle[LINK_CAPACITY];\n\n            int readIndex;\n            //weakOrderQueuelink\n            Link next;\n        }\n}\n```\n\nWeakOrderQueue `WeakReference < Thread >` , ``WeakOrderQueueGC\n\n* `DefaultHandle<?>[] elements `: LinkLINK_CAPACITY 16DefaultHandle\n* `int readIndex`LinkreadIndexreadIndexint\n* `writeIndex`LinkAtomicIntegerLinkwriteIndexLinkwriteIndexLinkwriteIndexwriteIndexAtomicInteger\n* `Link next`Linknext\n\n### 10.2 Head\n\n```java\n        // weakOrderQueuelink\n        private static final class Head {\n            // reserveSpaceForLink\n            //availableSharedCapacity\n            private final AtomicInteger availableSharedCapacity;\n            //link\n            Link link;\n\n            Head(AtomicInteger availableSharedCapacity) {\n                this.availableSharedCapacity = availableSharedCapacity;\n            }\n\n            void reclaimAllSpaceAndUnlink() {\n                    ....headheadhead....\n            }\n\n            private void reclaimSpace(int space) {\n                //availableSharedCapacity\n                availableSharedCapacity.addAndGet(space);\n            }\n\n            //linkheadhead\n            void relink(Link link) {\n                  ...headLink...\n            }\n\n            Link newLink() {\n                  ....Link...\n            }\n\n            //link\n            static boolean reserveSpaceForLink(AtomicInteger availableSharedCapacity) {             \n                  ...Link...\n            }\n        }\n```\n\nHead\n\n* `AtomicInteger availableSharedCapacity`LinkLINK_CAPACITY LinkLINK_CAPACITY \n* `Link link`HeadLink\n\nHead\n\n### 10.3 WeakOrderQueue\n\n```java\n private static final class WeakOrderQueue extends WeakReference<Thread> {\n\n        //linkheadLinK\n        private final Head head;\n        //\n        private Link tail;\n        //stackstackweakOrderQueuestackweakOrderQueue\n        //stackweakOrderQueue\n        private WeakOrderQueue next;\n        //Id,weakOrderQueuestackweakOrderQueue\n        private final int id = ID_GENERATOR.getAndIncrement();\n        // 8\n        private final int interval;\n        // 1/8\n        private int handleRecycleCount;\n\n}\n```\n\n* `Head head`WeakOrderQueueLink\n* `Link tail`Link\n* `WeakOrderQueue next`StackStackWeakOrderQueueWeakOrderQueuenextWeakOrderQueue\n* `int id `IdStackId\n* `int interval` 1 / 8 \n* `int handleRecycleCount`\n\n### 10.4 WeakOrderQueue\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n        //stackGC,stack\n        private WeakOrderQueue(Stack<?> stack, Thread thread) {\n            //weakOrderQueue\n            super(thread);\n            //\n            tail = new Link();\n\n            //   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor\n            head = new Head(stack.availableSharedCapacity);\n            head.link = tail;\n            interval = stack.delayedQueueInterval;\n            handleRecycleCount = interval; \n        }\n}\n```\n\nWeakOrderQueue `WeakReference<Thread>` \n\nLinkheadtail\n\nStackWeakOrderQueue\n\nStackWeakOrderQueue**WeakOrderQueueStack**\n\nWeakOrderQueueWeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC\n\n**StackWeakOrderQueueStackStackGC**\n\nStackWeakOrderQueueWeakOrderQueueStack\n\n> \n\n### 10.5 WeakOrderQueue\n\nWeakOrderQueuetransferWeakOrderQueueStack\n\nWeakOrderQueueLinkStackLINK_CAPACITYStacktransfertrue\n\nheadLinkLink**Link**Linktransferfalse\n\ntransfer\n\n![image.png](/assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp)\n\n#### 10.5.1 \n\n```java\n            //weakOrderQueuelink\n            Link head = this.head.link;\n            //null\n            if (head == null) {\n                return false;\n            }\n\n            //\n            if (head.readIndex == LINK_CAPACITY) {\n                //Link\n                if (head.next == null) {\n                    //link\n                    return false;\n                }\n                head = head.next;\n                //HeadheadheadLinK\n                this.head.relink(head);\n            }\n```\n\nLink`head == null` Linkfalse\n\n`head.readIndex == LINK_CAPACITY` head relink Linkfalse\n\n```java\n private static final class Head {\n\n            //linkheadhead\n            void relink(Link link) {\n                //availableSharedCapacitylinkavailableSharedCapacity\n                reclaimSpace(LINK_CAPACITY);\n                //headlink\n                this.link = link;\n            }\n            private void reclaimSpace(int space) {\n                //availableSharedCapacity\n                availableSharedCapacity.addAndGet(space);\n            }\n}\n```\n\n#### 10.5.2 Stack\n\nHeadStackStackStack\n\n```java\n            final int srcStart = head.readIndex;\n            //writeIndex\n            int srcEnd = head.get();\n            //link\n            final int srcSize = srcEnd - srcStart;\n            if (srcSize == 0) {\n                return false;\n            }\n\n            // stack\n            final int dstSize = dst.size;\n            // weakOrderQueuestackstack = stack + \n            final int expectedCapacity = dstSize + srcSize;\n\n            if (expectedCapacity > dst.elements.length) {\n                //stackstack stack\n                final int actualCapacity = dst.increaseCapacity(expectedCapacity);\n                //Link\n                //actualCapacity - dstSizestack\n                srcEnd = min(srcStart + actualCapacity - dstSize, srcEnd);\n            }\n```\n\nLinkreadIndexwriteIndex  `writeIndex - readIndex` \n\nStack `expectedCapacity = stack + `\n\nStack expectedCapacity StackStack `min(srcStart + actualCapacity - dstSize, srcEnd)` Stack\n\n```java\nprivate static final class Stack<T> {\n\n        int increaseCapacity(int expectedCapacity) {\n            int newCapacity = elements.length;\n            int maxCapacity = this.maxCapacity;\n            do {\n                newCapacity <<= 1;\n            } while (newCapacity < expectedCapacity && newCapacity < maxCapacity);\n            //expectedCapacity2\n            newCapacity = min(newCapacity, maxCapacity);\n            if (newCapacity != elements.length) {\n                elements = Arrays.copyOf(elements, newCapacity);\n            }\n\n            return newCapacity;\n        }\n\n}\n```\n\nStack`actualCapacity - dstSize = 0``false`\n\n```java\nif (srcStart != srcEnd) {\n   ............\n}else {\n    // The destination stack is full already.\n    return false;\n}\n```\n\n**Stack**\n\n#### 10.5.3 \n\n```java\n                // Link\n                final DefaultHandle[] srcElems = head.elements;\n                //stack\n                final DefaultHandle[] dstElems = dst.elements;\n                int newDstSize = dstSize;\n                for (int i = srcStart; i < srcEnd; i++) {\n                    DefaultHandle<?> element = srcElems[i];\n                    //recycleId == 0 stack\n                    if (element.recycleId == 0) {\n                        //recycleId weakOrderQueue\n                        element.recycleId = element.lastRecycledId;\n                    } else if (element.recycleId != element.lastRecycledId) {\n                        //    \n                        throw new IllegalStateException(\"recycled already\");\n                    }\n                    //Link\n                    srcElems[i] = null;\n\n                    //weakOrderQueuestack \n                    if (dst.dropHandle(element)) {\n                        // Drop the object.\n                        continue;\n                    }\n                    //defaultHandlerstack(handlerstack)\n                    //defaultHandlerstacknullstackGC\n                    element.stack = dst;\n                    //handlerstack\n                    dstElems[newDstSize ++] = element;\n                }\n```\n\nLinkelementsStackelements `srcStart  ->  srcEnd `\n\n `element.recycleId == 0` Stack9.3 Stack\n\n* `recycleId = lastRecycledId = 0`\n\nId `element.recycleId = element.lastRecycledId`lastRecycledIdWeakOrderQueueId\n\n`element.recycleId != element.lastRecycledId` \n\nStack\n\n#### 10.5.4 \n\n 1 / 8  8  1 \n\n```java\n        boolean dropHandle(DefaultHandle<?> handle) {\n            if (!handle.hasBeenRecycled) {\n                //handleRecycleCount 8 \n                //interval 8\n                if (handleRecycleCount < interval) {\n                    handleRecycleCount++;\n                    // Drop the object.\n                    return true;\n                }\n                //\n                handleRecycleCount = 0;\n                //defaultHandlertrue\n                handle.hasBeenRecycled = true;\n            }\n            return false;\n        }\n```\n\nDefaultHandlerStackStackWeakOrderQueueDefaultHandlerStacknull\n\n> Stacknull\n\nStack\n\nLinkreadIndexStackLinkHead\n\n```java\n             if (srcEnd == LINK_CAPACITY && head.next != null) {\n                    // Add capacity back as the Link is GCed.\n                    // Linklinkhead\n                    this.head.relink(head.next);\n                }\n\n                //LinkreadIndex\n                head.readIndex = srcEnd;\n                // return false\n                if (dst.size == newDstSize) {\n                    return false;\n                }\n                dst.size = newDstSize;\n                return true;\n```\n\nRecycler\n\n## 11. \n\nDefaultHandlerrecycle\n\n![image.png](/assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp)\n\n```java\nstatic final class Entry {\n\n       private  Handle<Entry> handle;\n\n       void recycle() {\n            next = null;\n            bufs = null;\n            buf = null;\n            msg = null;\n            promise = null;\n            progress = 0;\n            total = 0;\n            pendingSize = 0;\n            count = -1;\n            cancelled = false;\n            handle.recycle(this);\n        }\n\n}\n```\n\n```java\nprivate static final class DefaultHandle<T> implements Handle<T> {\n      \n        ..............................\n\n        //handlerstack\n        Stack<?> stack;\n        //\n        Object value;\n\n        @Override\n        public void recycle(Object object) {\n            if (object != value) {\n                throw new IllegalArgumentException(\"object does not belong to handle\");\n            }\n\n            Stack<?> stack = this.stack;\n            //handler  recycleId = lastRecycledId = 0\n            //recycleId = lastRecycledId = OWN_THREAD_ID\n            //lastRecycledId = Id,stack recycleId = lastRecycledId = Id\n            if (lastRecycledId != recycleId || stack == null) {\n                throw new IllegalStateException(\"recycled already\");\n            }\n\n            stack.push(this);\n        }\n\n}\n```\n\nDefaultHandler recycle  if \n\n* `lastRecycledId != recycleId`  WeakOrderQueue Stack****\n\n> 9.3 Stack recycleId  lastRecycledId \n\n* `stack == null` StackGC\n\n### 11.1 StackBug!\n\n```java\nprivate static final class Stack<T> {\n        //\n        final WeakReference<Thread> threadRef;\n\n        void push(DefaultHandle<?> item) {\n            Thread currentThread = Thread.currentThread();\n            //  weakOrderQueue\n            //stack\n            if (threadRef.get() == currentThread) {\n                //  stack\n                pushNow(item);\n            } else {\n                // stackweakOrderQueuecurrentThread\n                pushLater(item, currentThread);\n            }\n        }\n}\n```\n\nDefaultHandlerStackStack\n\n>  if...else...Bug\n\n`threadRef.get() == currentThread)` pushNow(item) \n\n `threadRef.get() != currentThread)` \n\n1. currentThread `pushLater(item, currentThread)` WeakOrderQueue\n2. Bug `threadRef.get()  == null`  else GC****StackGC**Stack**NettyStackWeakOrderQueueWeakOrderQueue\n\nBug\n\n![image.png](/assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp)\n\n**Netty**\n\n\n\n![image.png](/assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp)\n\nDefaultHandlerDefaultHandlerStack\n\n![image.png](/assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp)\n\nGCStackStackStackGC\n\n## 11.2 PRBug!\n\nBug\n\nNetty Issue11864 \n\n> Issue11864 : [github.com/netty/netty](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fissues%2F11864 \"https://github.com/netty/netty/issues/11864\")\n\n PR11865 Bug\n\n> PR : [github.com/netty/netty](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fpull%2F11865 \"https://github.com/netty/netty/pull/11865\")\n\nPR\n\n1.  `threadRef.get()  == null`  return \n2. Stack `item.stack = null`StackGC\n\nPR `threadRef.get()  == null` \n\n```java\n        void push(DefaultHandle<?> item) {\n            Thread currentThread = Thread.currentThread();\n            if (threadRef.get() == currentThread) {\n                pushNow(item);\n            } else if (threadRef.get() == null) {\n                // when the thread that belonged to the Stack was died or GC'ed\n                // There is no need to add this item to WeakOrderQueue-linked-list which belonged to the Stack any more\n                item.stack = null;\n            } else {\n                pushLater(item, currentThread);\n            }\n        }\n```\n\n## 11.3 PR\n\n PR11865\n\n![image.png](/assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp)\n\nNettyNetty Recycler RecyclerRecycler******GC**Netty\n\ncommit\n\n> commit[github.com/netty/netty](https://github.com/netty/netty/commit/28b9834612638ffec4948c0c650d04f766f20690)\n\nRecycler**4.1.71.Final**Recycler**4.1.71.Final**\n\n**4.1.71.Final** .....  Issue11864 : [github.com/netty/netty](https://github.com/netty/netty/issues/11864) **4.1.71.Final**\n\n chrisvest   PR11996  **4.1.74.Final** Issue11864\n\n> PR11996 [github.com/netty/netty](https://github.com/netty/netty/pull/11996)\n\n>  chrisvest  Neo4j commitorNetty BufferAPI\n\nBug **4.1.74.Final** \n\n1.  chrisvest   threadLocal onRemovalLocalPoolpooledHandles  nullLocalPool\n\n>  LocalPool StackLocalPoolpooledHandlesStack\n\n```java\npublic abstract class Recycler<T> {\n\n    private final FastThreadLocal<LocalPool<T>> threadLocal = new FastThreadLocal<LocalPool<T>>() {\n        @Override\n        protected LocalPool<T> initialValue() {\n            return new LocalPool<T>(maxCapacityPerThread, interval, chunkSize);\n        }\n\n        @Override\n        protected void onRemoval(LocalPool<T> value) throws Exception {\n            //LocalPool\n            super.onRemoval(value);\n            MessagePassingQueue<DefaultHandle<T>> handles = value.pooledHandles;\n            //pooledHandles  null\n            value.pooledHandles = null;\n            //LocalPool\n            handles.clear();\n        }\n    };\n\n}\n```\n\n2. LocalPoolpooledHandles\n\n```java\nprivate static final class LocalPool<T> {\n    //\n    private volatile MessagePassingQueue<DefaultHandle<T>> pooledHandles;\n\n     void release(DefaultHandle<T> handle) {\n            MessagePassingQueue<DefaultHandle<T>> handles = pooledHandles;\n            handle.toAvailable();\n            if (handles != null) {\n                handles.relaxedOffer(handle);\n            }\n        }\n}\n```\n\n  GC LocalPoolStackLocalPool\n\nBug\n\n### 11.4 \n\n```java\n       private void pushNow(DefaultHandle<?> item) {\n            // recycleId = lastRecycleId = 0\n            //0 \n            if ((item.recycleId | item.lastRecycledId) != 0) {\n                throw new IllegalStateException(\"recycled already\");\n            }\n\n            //recycleIdlastRecycleIdId-OWN_THREAD_ID\n            //OWN_THREAD_ID\n            // OWN_THREAD_IDId\n            item.recycleId = item.lastRecycledId = OWN_THREAD_ID;\n\n            int size = this.size;\n            // \n            //1/8\n            if (size >= maxCapacity || dropHandle(item)) {\n                // Hit the maximum capacity or should drop - drop the possibly youngest object.\n                //\n                return;\n            }\n\n            //stackstack\n            if (size == elements.length) {\n                //\n                elements = Arrays.copyOf(elements, min(size << 1, maxCapacity));\n            }\n            //stack\n            elements[size] = item;\n            //stack\n            this.size = size + 1;\n        }\n```\n\n* `item.recycleId | item.lastRecycledId) != 0`Id0\n* Id`item.recycleId = item.lastRecycledId = OWN_THREAD_ID`\n* Stack\n*  1 / 8  dropHandle \n* Stackstack\n* Stack\n\n### 11.5 \n\n![image.png](/assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp)\n\nRecycler\n\n thread2 , thread3 , thread4 ...  Stackthread1\n\n  thread2 , thread3 , thread4 ... thread1thread1thread1StackWeakOrderQueue thread2 , thread3 , thread4 ...  \n\nRecycler maxDelayedQueuesPerThread \n\n```java\npublic abstract class Recycler<T> {\n\n      // cpu * 2\n      private static final int MAX_DELAYED_QUEUES_PER_THREAD;\n\n     //\n      private final int maxDelayedQueuesPerThread;\n\n      private static final class Stack<T> {\n\n            // \n            private final int maxDelayedQueues;\n\n      }\n\n}\n\n```\n\nRecycler maxDelayedQueuesPerThread \n\n****\n\n![image.png](/assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp)\n\n FastThreadLocal  DELAYED_RECYCLED  DELAYED_RECYCLED  WeakHashMap WeakHashMap \n\nWeakHashMap  key  Stack value StackWeakOrderQueue Recycler.png \n\n```java\npublic abstract class Recycler<T> {\n\n    //\n    //key: stack  value:  weakOrderQueue\n    //value stackweakOrderQueue\n    private static final FastThreadLocal<Map<Stack<?>, WeakOrderQueue>> DELAYED_RECYCLED =\n            new FastThreadLocal<Map<Stack<?>, WeakOrderQueue>>() {\n        @Override\n        protected Map<Stack<?>, WeakOrderQueue> initialValue() {\n            return new WeakHashMap<Stack<?>, WeakOrderQueue>();\n        }\n    };\n\n}\n```\n\nWeakHashMap sizesize maxDelayedQueuesPerThread \n\n**WeakHashMap**?\n\nGCStackStackStackGCStackWeakHashMapEntryWeakHashMapStack\n\n\n\n```java\n      private void pushLater(DefaultHandle<?> item, Thread thread) {\n            //maxDelayQueues == 0 \n            if (maxDelayedQueues == 0) {\n                //\n                return;\n            }\n          \n            //\n            Map<Stack<?>, WeakOrderQueue> delayedRecycled = DELAYED_RECYCLED.get();\n            //stack    \n            WeakOrderQueue queue = delayedRecycled.get(this);\n            //queue == null stack\n            if (queue == null) {\n                //maxDelayedQueues\n                //delayedRecycled.size()\n                if (delayedRecycled.size() >= maxDelayedQueues) {\n              \n                    //WeakOrderQueue\n                    //WeakOrderQueue.DUMMY  \n                    delayedRecycled.put(this, WeakOrderQueue.DUMMY);\n                    return;\n                }\n \n                // WeakOrderQueue\n                if ((queue = newWeakOrderQueue(thread)) == null) {\n                    // \n                    return;\n                }\n                //threadLocal stack  weakOrderQueue\n                delayedRecycled.put(this, queue);\n            } else if (queue == WeakOrderQueue.DUMMY) {\n                // drop object\n                // queueWeakOrderQueue.DUMMY  \n                return;\n            }\n\n            //  weakOrderQueue\n            queue.add(item);\n        }\n```\n\n1. Recycler `maxDelayedQueues == 0` \n2. StackWeakOrderQueue**** maxDelayedQueues \n3.  maxDelayedQueues  WeakHashMap  WeakOrderQueue DUMMY WeakOrderQueue  DUMMY \n\n```java\n private static final class WeakOrderQueue extends WeakReference<Thread> {\n        //DUMMY\n        static final WeakOrderQueue DUMMY = new WeakOrderQueue();\n\n}\n```\n\n4.  maxDelayedQueues  `stack#newWeakOrderQueue` StackWeakOrderQueueWeakHashMapStackWeakOrderQueue\n5. StackWeakOrderQueue\n\n### 11.6  WeakOrderQueue\n\nStackWeakOrderQueueWeakOrderQueue\n\n```java\n   private static final class Stack<T> {\n\n         private WeakOrderQueue newWeakOrderQueue(Thread thread) {\n              return WeakOrderQueue.newQueue(this, thread);\n        }\n   }\n```\n\n![image.png](/assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp)\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n\n        static WeakOrderQueue newQueue(Stack<?> stack, Thread thread) {\n  \n            // linkweakOrderQueueLink\n            // stackavailableSharedCapacity  LINK_CAPACITY\n            if (!Head.reserveSpaceForLink(stack.availableSharedCapacity)) {\n                return null;\n            }\n\n            //linkweakOrderQueue\n            final WeakOrderQueue queue = new WeakOrderQueue(stack, thread);\n\n            // stackweakOrderQueueweakOrderQueue \n            // stackweakOrderQueueWeakOrderQueueWeakOrderQueue.this\n            // \n            stack.setHead(queue);\n\n            return queue;\n        }\n\n}\n```\n\nWeakOrderQueueWeakOrderQueueLinkWeakOrderQueueLink\n\nWeakOrderQueueLinkLink\n\navailableSharedCapacity LinkLINK_CAPACITY LinkLINK_CAPACITY  availableSharedCapacity \n\nWeakOrderQueueLink**** availableSharedCapacity LinkWeakOrderQueue\n\navailableSharedCapacityLinkWeakOrderQueue\n\n```java\n            //link\n            static boolean reserveSpaceForLink(AtomicInteger availableSharedCapacity) {\n                for (;;) {\n                    //stackstack\n                    int available = availableSharedCapacity.get();\n                    //availbaleLinkstack\n                    if (available < LINK_CAPACITY) {\n                        return false;\n                    }\n                    //LinkLinkavailableSharedCapacity\n                    if (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) {\n                        return true;\n                    }\n                }\n            }\n```\n\n availableSharedCapacity  LINK_CAPACITY  availableSharedCapacity \n\nWeakOrderQueueLinkWeakOrderQueue\n\n```java\n        //stackGC,stack\n        private WeakOrderQueue(Stack<?> stack, Thread thread) {\n            //weakOrderQueue\n            super(thread);\n            //\n            tail = new Link();\n\n            //   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor\n            // availableSharedCapacitylink\n            head = new Head(stack.availableSharedCapacity);\n            head.link = tail;\n            interval = stack.delayedQueueInterval;\n            handleRecycleCount = interval; \n        }\n```\n\nWeakOrderQueueStackWeakOrderQueueWeakOrderQueueStackWeakOrderQueueRecycler \n\n```java\n       synchronized void setHead(WeakOrderQueue queue) {\n            //weakOrderQueuequeue\n            queue.setNext(head);\n            head = queue;\n        }\n```\n\n![image.png](/assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp)\n\n### 11.7 WeakOrderQueue\n\n\n\nWeakOrderQueueNettyLinkLinkLink\n\n```java\n      void add(DefaultHandle<?> handle) {\n            //handlerlastRecycledIdweakOrderQueueId,stackweakOrderQueue\n            // \n            handle.lastRecycledId = id;\n\n            //  1/8\n            // scavengeSomeweakOrderQueuestackNetty\n            // netty weakOrderQueue\n            if (handleRecycleCount < interval) {\n                handleRecycleCount++;\n                // Drop the item to prevent recycling to aggressive.\n                return;\n            }\n            handleRecycleCount = 0;\n\n            //link\n            Link tail = this.tail;\n            int writeIndex;\n\n            //linklink\n            if ((writeIndex = tail.get()) == LINK_CAPACITY) {\n                //Link\n                Link link = head.newLink();\n                //availableSharedCapacityLink\n                if (link == null) {\n                    // \n                    return;\n                }\n                // We allocate a Link so reserve the space\n                //\n                this.tail = tail = tail.next = link;\n\n                writeIndex = tail.get();\n            }\n\n            //handlerlink\n            tail.elements[writeIndex] = handle;\n            //stacknullstack\n            //StackGChandlestackGC\n            //stack\n            handle.stack = null;\n            //lazySetwriteIndexwriteIndex\n            // Netty\n            //scavengeSomeweakOrderQueueweakOrderQueue\n            //weakOrderQueue\n            tail.lazySet(writeIndex + 1);\n        }\n```\n\n1. DefaultHandlerlastRecycledId IdDefaultHandler `recycleId != lastRecycledId `\n2.  1 / 8 9.5  `stack#scavengeSome` StackWeakOrderQueue 1 / 8 ****nettyweakOrderQueue\n3. WeakOrderQueueLinkLink `writeIndex = tail.get()) == LINK_CAPACITY` LinktailLink availableSharedCapacity Link\n\n```java\n    private static final class Head {\n\n             Link newLink() {\n                  //availableSharedCapacityavailableSharedCapacity\n                  //availableSharedCapacity\n                  return reserveSpaceForLink(availableSharedCapacity) ? new Link() : null;\n             }\n\n            //link\n            static boolean reserveSpaceForLink(AtomicInteger availableSharedCapacity) {\n                for (;;) {\n                    //stackstack\n                    int available = availableSharedCapacity.get();\n                    //availbaleLinkstack\n                    if (available < LINK_CAPACITY) {\n                        return false;\n                    }\n                    //LinkLinkavailableSharedCapacity\n                    if (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) {\n                        return true;\n                    }\n                }\n            }\n    }\n```\n\nRecycler****\n\n\n\n**handle.stacknull**?\n\n `stack#scavengeSome` WeakOrderQueuestackDefaultHandlerstackstack\n\n```java\nboolean transfer(Stack<?> dst) {\n\n      ...............................\n\n      //defaultHandlerstack(handlerstack)\n      //defaultHandlerstacknullstackGC\n      element.stack = dst;\n\n      ...............................\n}\n```\n\nWeakOrderQueue handle.stack null handle.stack \n\nGCstackstackstacknullWeakOrderQueueGCstackGC\n\n> \n\n**lazySetwriteIndex**\n\nLinkwriteIndex\n\n\n\nStackWeakOrderQueueWeakOrderQueu\n\nwriteIndex LOCK **WeakOrderQueue**Netty\n\n---\n\n## \n\nRecycler\n\nRecycler**4.1.71.Final**Recycler\n\n~~\n","source":"_posts/20250501/7.md","raw":"---\ntitle: Netty Recycler\ndate: 2025-05-01 16:57:07\nlastmod: 2025-05-01 16:57:07\ntags: [Recycler,Netty]\ncategory: Netty\n---\n\n\n\n# Recycler\n\n---\n>           bin              \n> Netty **4.1.56.Final**\n\n## 1. \n\n\n\n\n\n\n\n\n\n[Netty](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484244%26idx%3D1%26sn%3D831060fc38caa201d69f87305de7f86a%26chksm%3Dce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e%23rd \"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&mid=2247484244&idx=1&sn=831060fc38caa201d69f87305de7f86a&chksm=ce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e#rd\")JVMNetty  Netty  JVM  native memory  DirectByteBuffer  native  `unsafe.allocateMemory`  `malloc` \n\n\n\n*  JVM  DirectByteBuffer  JVM \n*  `malloc`  DirectByteBuffer \n\n Netty  Netty \n\n## 2. \n\n\n\n Netty  Netty  PooledDirectByteBuf  Netty  IO  PooledDirectByteBuf \n\n PooledDirectByteBuf \n\n Netty  Netty  channel \n\nNetty  Channel  ChannelOutboundBuffer  ChannelOutboundBuffer  Channel  flush  ChannelOutboundBuffer  Socket \n\n ChannelOutboundBuffer  Entry  Entry  Entry  ChannelOutboundBuffer \n\n>  ChannelOutboundBuffer  Entry \n\nNetty IO  Entry  IO  JVM  GC  Netty \n\n\n\n\n\n---\n\n\n\n\n\n## 3. JVM\n\n### 3.1 \n\n Java  new JVM new \n\n1.  JVM  new  Java \n2. JVMJVM\n\n> [JVM](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd \"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&mid=2247484304&idx=1&sn=54bf0d07e69c5621c145afaece8f50d6&chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\")\n\n3. JVMJVMJVMJVMCAS  + \n4. JVMJVM-TLABTLABTLABJVM**** `-XX:+UseTLAB`TLAB`-XX:-UseTLAB`TLAB\n\n> TLABNettyRecycler\n\n5. JVM\n6. MarkWord[JVM](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd \"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&mid=2247484304&idx=1&sn=54bf0d07e69c5621c145afaece8f50d6&chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\")\n7. \n\n### 3.2 \n\n* JVMJavaGC ROOTS\n* GC PAUSESTOP THE WORLD\n\n---\n\nIONetty Recycler \n\n Recycler  Recycler \n\n## 4. Recycler\n\nNettyRecycler PooledDirectByteBuf \n\n> PooledDirectByteBuf\n\n![image.png](/assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp)\n\n### 4.1 PooledDirectByteBuf\n\n```java\nfinal class PooledDirectByteBuf extends PooledByteBuf<ByteBuffer> {\n    //\n    private static final ObjectPool<PooledDirectByteBuf> RECYCLER = ObjectPool.newPool(\n            new ObjectCreator<PooledDirectByteBuf>() {\n        @Override\n        public PooledDirectByteBuf newObject(Handle<PooledDirectByteBuf> handle) {\n            return new PooledDirectByteBuf(handle, 0);\n        }\n    });\n\n    //\n    private final Handle<PooledByteBuf<T>> recyclerHandle;\n\n    static PooledDirectByteBuf newInstance(int maxCapacity) {\n        //\n        PooledDirectByteBuf buf = RECYCLER.get();\n        buf.reuse(maxCapacity);\n        return buf;\n    }\n  \n    private void recycle() {\n         //\n        recyclerHandle.recycle(this);\n    }\n\n    ..................................\n}\n```\n\nNettyPooledDirectByteBufPooledDirectByteBuf\n\nNetty`ObjectPool  RECYCLER `\n\nPooledDirectByteBuf`ObjectPool<T>`Netty ObjectPool#newPool  ObjectCreator  ObjectCreatornewObject \n\nrecyclerHandlerecyclerHandlerecyclerHandle\n\nPooledDirectByteBuf`RECYCLER.get()`PooledDirectByteBuf\n\nPooledDirectByteBuf`recyclerHandle.recycle(this) `\n\n### 4.2 Channel\n\nChannelChannelOutboundBufferchannelwrite\n\nChannelChannelOutboundBufferChannelOutboundBufferEntryNettyEntryEntry\n\nPooledDirectByteBufEntry\n\n#### \n\n```java\n   static final class Entry {\n\n        private static final ObjectPool<Entry> RECYCLER = ObjectPool.newPool(new ObjectCreator<Entry>() {\n            @Override\n            public Entry newObject(Handle<Entry> handle) {\n                return new Entry(handle);\n            }\n        });\n\n        //recyclerHandle\n        private  Handle<Entry> handle;\n      \n        private Entry(Handle<Entry> handle) {\n            this.handle = handle;\n        }\n   }\n```\n\n\n\n```java\nstatic final ObjectPool<Entry> RECYCLER \n```\n\n ObjectCreator \n\n```java\n    public interface ObjectCreator<T> {\n        T newObject(Handle<T> handle);\n    }\n```\n\n`ObjectPool#newPool` Entry\n\nHandlerHandlerHandler\n\n#### \n\nEntrypublicEntry\n\n static  newInstance`RECYCLER.get()`\n\n```java\n      static Entry newInstance(Object msg, int size, long total, ChannelPromise promise) {\n            Entry entry = RECYCLER.get();\n          \n            .......................\n\n            return entry;\n        }\n```\n\n#### \n\n recycle \n\n```java\n        void recycle() {\n            next = null;\n            bufs = null;\n            buf = null;\n            msg = null;\n            promise = null;\n            progress = 0;\n            total = 0;\n            pendingSize = 0;\n            count = -1;\n            cancelled = false;\n            handle.recycle(this);\n        }\n```\n\n* \n* Handler\n\n---\n\nNetty\n\n\n\n## 5. Recycler\n\nRecycler -  - \n\n\n\n\n\n\n\nRecycler\n\n![image.png](/assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp)\n\n### 5.1 \n\n\n\n\n\n Stack  WeakOrderQueue\n\nStack \n\n****StackJVMTLAB,TLAB\n\n, StackStack\n\n**NettyTLABStackStack**\n\n> ****Netty\n\n### 5.2 Stack\n\nRecyclerStack\n\n* Stack****\n* WeakOrderQueuehead WeakOrderQueuecursor prev WeakOrderQueueWeakOrderQueueWeakOrderQueue\n\n> WeakOrderQueue\n\n**StackWeakOrderQueue**\n\nRecyclerthread1 thread2 , thread3 , thread4\n\n> StackWeakOrderQueue\n\n![image.png](/assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp)\n\n thread1 thread1thread1thread1stack1`hread1stack1\n\n> Stack\n\nthread1thread2thread3thread2thread3thread1\n\nthread1thread1stack1stack1**NettyStack**\n\nthread1Stack1thread1Stack1\n\n> GCStack\n\n**Netty**\n\nthead2 , thread3 ....WeakOrderQueueWeakOrderQueue\n\n> WeakOrderQueueStack\n\n``thread1``thread2 , thread3 , thead4 .....\n\nthread1stack1**WeakOrderQueue**stack1stack1WeakOrderQueueStackheadprevcursorWeakOrderQueue\n\n> WeakOrderQueue\n\nthread1Stack1Stack\n\nStack cursor StackWeakOrderQueueWeakOrderQueue****WeakOrderQueue\n\n> StackStackWeakOrderQueueWeakOrderQueue\n\n****\n\n****\n\n![image.png](/assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp)\n\n### 5.3 WeakOrderQueue\n\nWeakOrderQueue\n\n> ****\n\n![image.png](/assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp)\n\nWeakOrderQueueWeakOrderQueue\n\n Head Tail Link \n\nLink  elements \n\nLinkreadIndexelementswriteIndexelementselements`16`Link1616LinkLink\n\nWeakoOrderQueueStack****WeakOrderQueueLinkHeadHeadLinkStack**Link**16\n\nLinkStackLinkWeakOrderQueueLinkHeadLink\n\n> head**Link**headTail****\n\n********\n\n**Netty** \n\nWeakOrderQueue****\n\n> ****\n\n Netty Recycler WeakOrderQueue\n\nNetty\n\n## 6. Recycler\n\n4. RecyclerRecycler\n\n* PooledDirectByteBuf\n* ChannelChannelOutboundBuffer\n\n ObjectPool ObjectPool Netty\n\n\n\n### 6.1 ObjectPool\n\n```java\npublic abstract class ObjectPool<T> {\n\n    ObjectPool() { }\n\n    public abstract T get();\n\n    public interface Handle<T> {\n        void recycle(T self);\n    }\n\n    public interface ObjectCreator<T> {\n        T newObject(Handle<T> handle);\n    }\n\n    ..................................\n\n}\n```\n\n ObjecPool \n\n4. Recycler\n\n```java\nstatic final class Entry {\n\n    private static final ObjectPool<Entry> RECYCLER\n\n}\n```\n\n```java\nfinal class PooledDirectByteBuf extends PooledByteBuf<ByteBuffer> {\n\n    private static final ObjectPool<PooledDirectByteBuf> RECYCLER\n\n}\n```\n\nObjecPool \n\n```java\npublic abstract T get();\n```\n\n Handler \n\n```java\n     public interface Handle<T> {\n        void recycle(T self);\n    } \n```\n\nHandlerHandlerDefaultHandle\n\n> StackDefaultHandleWeakOrderQueueLinkelementsDefaultHandle\n\n**recycleHandlerObejctPool**\n\nrecycle\n\n4. RecyclerHandlerHandlerrecyclerecycleHandlerrecycle\n\n```java\nstatic final class Entry {\n\n        void recycle() {\n            next = null;\n            bufs = null;\n            buf = null;\n            msg = null;\n            promise = null;\n            progress = 0;\n            total = 0;\n            pendingSize = 0;\n            count = -1;\n            cancelled = false;\n            handle.recycle(this);\n        }\n\n}\n```\n\nObjectPool \n\n```java\n    public interface ObjectCreator<T> {\n        T newObject(Handle<T> handle);\n    }\n```\n\n`ObjectCreator#newObject`Handler\n\n```java\n  static final class Entry {\n\n      private static final ObjectPool<Entry> RECYCLER = ObjectPool.newPool(new ObjectCreator<Entry>() {\n            @Override\n            public Entry newObject(Handle<Entry> handle) {\n                return new Entry(handle);\n            }\n        });\n\n      //Entry\n      private Entry(Handle<Entry> handle) {\n            this.handle = handle;\n        }\n\n  }\n```\n\n#### 6.1.1 ObjectPool\n\n![image.png](/assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp)\n\n```java\npublic abstract class ObjectPool<T> {\n\n    public static <T> ObjectPool<T> newPool(final ObjectCreator<T> creator) {\n        return new RecyclerObjectPool<T>(ObjectUtil.checkNotNull(creator, \"creator\"));\n    }\n\n    private static final class RecyclerObjectPool<T> extends ObjectPool<T> {\n        //recycler\n        private final Recycler<T> recycler;\n\n        RecyclerObjectPool(final ObjectCreator<T> creator) {\n             recycler = new Recycler<T>() {\n                @Override\n                protected T newObject(Handle<T> handle) {\n                    return creator.newObject(handle);\n                }\n            };\n        }\n\n        @Override\n        public T get() {\n            return recycler.get();\n        }\n    }\n\n}\n```\n\n```java\npublic abstract class Recycler<T> {\n\n    protected abstract T newObject(Handle<T> handle);\n  \n    .....................................\n}\n```\n\n `ObjectPool#newPool`  RecyclerObjectPool ** Recycler**  RecyclerObjectPool \n\nRecyclerObjectCreator \n\n## 7. Recycler\n\nRecycler\n\n![image.png](/assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp)\n\n### 7.1 Id\n\n```java\npublic abstract class Recycler<T> {\n\n    //Id,\n    private static final AtomicInteger ID_GENERATOR = new AtomicInteger(Integer.MIN_VALUE);\n    //Id static final OWN_THREAD_ID\n    //Id\n    //\n    private static final int OWN_THREAD_ID = ID_GENERATOR.getAndIncrement();\n\n}\n```\n\n* `AtomicInteger ID_GENERATOR` : AtomicInteger IdId****\n* `int OWN_THREAD_ID` Recycler ID_GENERATOR  OWN_THREAD_ID  OWN_THREAD_ID IdOWN_THREAD_ID  static final Recycler OWN_THREAD_ID \n\nthread1, thread2, thread3.....Recycler  OWN_THREAD_ID \n\n![image.png](/assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp)\n\n**Id**Netty****Id\n\nId WeakOrderQueue  WeakOrderQueue Id\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n\n    //Id,weakOrderQueuestackweakOrderQueue\n   private final int id = ID_GENERATOR.getAndIncrement();\n}\n```\n\n### 7.2 \n\n![image.png](/assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp)\n\n```java\n    //Stack 4096 \n    private static final int DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD = 4 * 1024; // Use 4k instances as default.\n    // Stack 4096\n    private static final int DEFAULT_MAX_CAPACITY_PER_THREAD;\n    //  min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256) 256\n    private static final int INITIAL_CAPACITY;\n```\n\nRecycler \n\n```java\n    static {\n\n        int maxCapacityPerThread = SystemPropertyUtil.getInt(\"io.netty.recycler.maxCapacityPerThread\",\n                SystemPropertyUtil.getInt(\"io.netty.recycler.maxCapacity\", DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD));\n        if (maxCapacityPerThread < 0) {\n            maxCapacityPerThread = DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD;\n        }\n\n        DEFAULT_MAX_CAPACITY_PER_THREAD = maxCapacityPerThread;\n\n        INITIAL_CAPACITY = min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256);\n    }\n```\n\n* `DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD`Stack4096JVM `-D io.netty.recycler.maxCapacity` \n* `DEFAULT_MAX_CAPACITY_PER_THREAD`StackJVM `-D io.netty.recycler.maxCapacityPerThread`  DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD 4096\n* `INITIAL_CAPACITY `: Stack`min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256)`256256 DEFAULT_MAX_CAPACITY_PER_THREAD\n\n### 7.3 \n\n```java\n   //  2  \n    private static final int MAX_SHARED_CAPACITY_FACTOR;\n    // cpu * 2\n    private static final int MAX_DELAYED_QUEUES_PER_THREAD;\n    //WeakOrderQueueLink 16\n    private static final int LINK_CAPACITY;\n```\n\nRecycler  Stack \n\n```java\n    static {\n\n        MAX_SHARED_CAPACITY_FACTOR = max(2,\n                SystemPropertyUtil.getInt(\"io.netty.recycler.maxSharedCapacityFactor\",\n                        2));\n\n        MAX_DELAYED_QUEUES_PER_THREAD = max(0,\n                SystemPropertyUtil.getInt(\"io.netty.recycler.maxDelayedQueuesPerThread\",\n                        // We use the same value as default EventLoop number\n                        NettyRuntime.availableProcessors() * 2));\n\n        LINK_CAPACITY = safeFindNextPositivePowerOfTwo(\n                max(SystemPropertyUtil.getInt(\"io.netty.recycler.linkCapacity\", 16), 16));\n\n    }\n```\n\n* `MAX_SHARED_CAPACITY_FACTOR` :  Stack2JVM `-D io.netty.recycler.maxSharedCapacityFactor`  `max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)` 2048 LINK_CAPACITY  16\n* `MAX_DELAYED_QUEUES_PER_THREAD` : CPU * 2JVM `-D io.netty.recycler.maxDelayedQueuesPerThread` ****\n* `LINK_CAPACITY `:   Stack  WeakOrderQueue WeakOrderQueueLinkLink16JVM `-D io.netty.recycler.linkCapacity` \n\n\n\n![image.png](/assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp)\n\n### 7.4 \n\n\n\nNetty\n\n```java\n    //81/88\n    private static final int RATIO;\n    //8 1/8\n    private static final int DELAYED_QUEUE_RATIO;\n```\n\n\n\n```java\n    static {\n\n        RATIO = max(0, SystemPropertyUtil.getInt(\"io.netty.recycler.ratio\", 8));\n\n        DELAYED_QUEUE_RATIO = max(0, SystemPropertyUtil.getInt(\"io.netty.recycler.delayedQueue.ratio\", RATIO));\n\n    }\n```\n\n Recycler \n\n*  RATIO 8JVM `-D io.netty.recycler.ratio`  1 / 8  8  1\n* StackStackWeakOrderQueueWeakOrderQueue****Stack DELAYED_QUEUE_RATIO 8JVM `-D io.netty.recycler.delayedQueue.ratio`  8  1 \n\n## 8. Recycler\n\n```java\n    private static final class RecyclerObjectPool<T> extends ObjectPool<T> {\n        //recycler\n        private final Recycler<T> recycler;\n\n        RecyclerObjectPool(final ObjectCreator<T> creator) {\n             recycler = new Recycler<T>() {\n                @Override\n                protected T newObject(Handle<T> handle) {\n                    return creator.newObject(handle);\n                }\n            };\n        }\n    \n        ..............................\n      }\n```\n\nNetty  Recycler Recycler newObject \n\n```java\npublic abstract class Recycler<T> {\n\n   protected abstract T newObject(Handle<T> handle);\n\n   protected Recycler() {\n        this(DEFAULT_MAX_CAPACITY_PER_THREAD);\n    }\n\n    protected Recycler(int maxCapacityPerThread) {\n        this(maxCapacityPerThread, MAX_SHARED_CAPACITY_FACTOR);\n    }\n\n    protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor) {\n        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);\n    }\n\n    protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n                       int ratio, int maxDelayedQueuesPerThread) {\n        this(maxCapacityPerThread, maxSharedCapacityFactor, ratio, maxDelayedQueuesPerThread,\n                DELAYED_QUEUE_RATIO);\n    }\n\n    //\n    private final int maxCapacityPerThread;\n    //()\n    private final int maxSharedCapacityFactor;\n    //\n    private final int interval;\n    //\n    private final int maxDelayedQueuesPerThread;\n    //\n    private final int delayedQueueInterval;\n\n    protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n                       int ratio, int maxDelayedQueuesPerThread, int delayedQueueRatio) {\n        interval = max(0, ratio);\n        delayedQueueInterval = max(0, delayedQueueRatio);\n        if (maxCapacityPerThread <= 0) {\n            this.maxCapacityPerThread = 0;\n            this.maxSharedCapacityFactor = 1;\n            this.maxDelayedQueuesPerThread = 0;\n        } else {\n            this.maxCapacityPerThread = maxCapacityPerThread;\n            this.maxSharedCapacityFactor = max(1, maxSharedCapacityFactor);\n            this.maxDelayedQueuesPerThread = max(0, maxDelayedQueuesPerThread);\n        }\n    }\n\n}\n```\n\nRecyclerRecycler\n\n## 9. \n\n![image.png](/assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp)\n\nNettyNetty TLAB StackStackRecyclerStakc\n\n```java\n    //threadlocal stack\n    private final FastThreadLocal<Stack<T>> threadLocal = new FastThreadLocal<Stack<T>>() {\n        @Override\n        protected Stack<T> initialValue() {\n            return new Stack<T>(Recycler.this, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,\n                    interval, maxDelayedQueuesPerThread, delayedQueueInterval);\n        }\n      \n        ........................\n    };\n```\n\n FastThreadLocal  threadLocal Stack\n\n> FastThreadLocalNettyJDKThreadLocalFastThreadLocalJDKThreadLocal\n\nStack\n\n### 9.1 Stack\n\nStack5.2 StackStackWeakOrderQueueHeadPrevCursor\n\nStackStack\n\n```java\nprivate static final class Stack<T> {\n\n        // stackrecycler\n        final Recycler<T> parent;\n\n        //stack defaultHandler -> stack -> thread\n        // thread\n        final WeakReference<Thread> threadRef;\n\n        //\n        final AtomicInteger availableSharedCapacity;\n\n        //Stack\n        private final int maxDelayedQueues;\n\n        //stack 4096\n        private final int maxCapacity;\n\n        //\n        private final int interval;\n\n        //\n        private final int delayedQueueInterval;\n\n        // Stack 2564096\n        DefaultHandle<?>[] elements;\n\n        // \n        int size;\n\n        //  interval \n        private int handleRecycleCount;\n\n        //\n        //StackWeakOrderQueue\n        private WeakOrderQueue cursor, prev;\n        private volatile WeakOrderQueue head;\n}\n```\n\n![image.png](/assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp)\n\n* `Recycler<T> parent`StackRecyclerStackStackparentRecycler stack1 , stack2 , stack3 , stack4 parentRecycler\n* `WeakReference<Thread> threadRef `Stack` -> DefaultHandler -> stack -> threadRef`StackGC\n* `AtomicInteger availableSharedCapacity`thread2 , thread3 , thread4  thread1 availableSharedCapacity ****1 LINK_CAPACITY(WeakOrderQueueLink)stack `max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)`\n\n> StackWeakOrderQueueavailableSharedCapacity \n\n* `int maxDelayedQueues`  CPU * 2 thread2  thread1  thread3 , thread4 maxDelayedQueues  3 \n* `int maxCapacity`Stack4096\n* `int interval`8\n* `int delayedQueueInterval`8\n* `DefaultHandle<?>[] elements`Stack\n* `int size`\n* `int handleRecycleCount` interval  0  +1 `handleRecycleCount == interval`81 Stack \n* `WeakOrderQueue cursor, prevhead`Stack**** WeakOrderQueue \n\nStackRecyclerStack\n\n```java\n    private final FastThreadLocal<Stack<T>> threadLocal = new FastThreadLocal<Stack<T>>() {\n        @Override\n        protected Stack<T> initialValue() {\n            return new Stack<T>(Recycler.this, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,\n                    interval, maxDelayedQueuesPerThread, delayedQueueInterval);\n        }\n\n      ..........................\n    }\n```\n\n```java\n       Stack(Recycler<T> parent, Thread thread, int maxCapacity, int maxSharedCapacityFactor,\n              int interval, int maxDelayedQueues, int delayedQueueInterval) {\n            this.parent = parent;\n            threadRef = new WeakReference<Thread>(thread);\n            this.maxCapacity = maxCapacity;\n            availableSharedCapacity = new AtomicInteger(max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY));\n            elements = new DefaultHandle[min(INITIAL_CAPACITY, maxCapacity)];\n            this.interval = interval;\n            this.delayedQueueInterval = delayedQueueInterval;\n            handleRecycleCount = interval; \n            this.maxDelayedQueues = maxDelayedQueues;\n        }\n```\n\n### 9.2 \n\n![image.png](/assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp)\n\n```java\npublic abstract class Recycler<T> {\n      //Handler,\n     private static final Handle NOOP_HANDLE = new Handle() {\n        @Override\n        public void recycle(Object object) {\n            // NOOP\n        }\n    };\n\n    public final T get() {\n        //0\n        if (maxCapacityPerThread == 0) {\n            return newObject((Handle<T>) NOOP_HANDLE);\n        }\n        // stack\n        Stack<T> stack = threadLocal.get();\n        //stackpophandler\n        DefaultHandle<T> handle = stack.pop();\n        //stack \n        if (handle == null) {\n            //handlerrecycleIdlastRecyclerId0\n            handle = stack.newHandle();\n            //newObjectrecycler \n            handle.value = newObject(handle);\n        }\n        return (T) handle.value;\n    }\n\n}\n```\n\nRecyclerStack\n\n1. `maxCapacityPerThread == 0`Handler\n2. threadLocalStackStackDefaultHandler\n3. DefaultHandlerStackDefaultHandlerDefaultHandlerDefaultHandlerDefaultHandler\n\n```java\nstatic final class Entry {\n\n     private static final ObjectPool<Entry> RECYCLER = ObjectPool.newPool(new ObjectCreator<Entry>() {\n            @Override\n            public Entry newObject(Handle<Entry> handle) {\n                return new Entry(handle);\n            }\n        });\n\n     private Entry(Handle<Entry> handle) {\n            this.handle = handle;\n     }\n}\n```\n\n### 9.3 DefaultHandler\n\n Handler\n\n```java\npublic abstract class ObjectPool<T> {\n\n    public interface Handle<T> {\n        void recycle(T self);\n    }\n\n}\n```\n\nRecycler DefaultHandler DefaultHandler \n\nStackDefaultHandlerStack\n\n```java\n private static final class Stack<T> {\n\n        DefaultHandle<T> newHandle() {\n            return new DefaultHandle<T>(this);\n        }\n }\n```\n\n DefaultHandler \n\n```java\n   private static final class DefaultHandle<T> implements Handle<T> {\n        //0\n        int lastRecycledId;\n        //0\n        int recycleId;\n\n        //\n        boolean hasBeenRecycled;\n        //handlerstack\n        Stack<?> stack;\n        //\n        Object value;\n\n        DefaultHandle(Stack<?> stack) {\n            this.stack = stack;\n        }\n\n        @Override\n        public void recycle(Object object) {\n\n          ................................\n        }\n    }\n```\n\nDefaultHandler\n\n* `int lastRecycledId`0\n* `int recycleId`0\n* `boolean hasBeenRecycled`Stack\n\n****\n\n\n\n* ``Stack`recycleId = lastRecycledId = OWN_THREAD_ID`\n* ``****StackWeakOrderQueue`recycleId = 0lastRecycledId = IdWeakOrderQueue#id`WeakOrderQueueStack`recycleId = lastRecycledId = IdWeakOrderQueue#id`\n\n lastRecycledId recycleId \n\n Object value  Stack<?> stack HandlerStack\n\nStackStack``` -> DefaultHandler -> Stack -> threadRef`\n\n![image.png](/assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp)\n\n```java\nstatic final class Entry {\n    //EntryDefaultHandler\n    private  Handle<Entry> handle;\n  \n}\n\n\nprivate static final class DefaultHandle<T> implements Handle<T> {\n    // DefaultHandlerStack\n    Stack<?> stack;\n\n}\n\nprivate static final class Stack<T> {\n    // Stack\n    final WeakReference<Thread> threadRef;\n\n}\n```\n\n### 9.4 Stack\n\n![image.png](/assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp)\n\n```java\n        DefaultHandle<T> pop() {\n            //\n            int size = this.size;\n            if (size == 0) {\n                //stackstackweakOrderQueuestack\n                if (!scavenge()) {\n                    return null;\n                }\n                size = this.size;\n                if (size <= 0) {\n                    // WeakOrderQueue\n                    // null \n                    return null;\n                }\n            }\n            size --;\n            DefaultHandle ret = elements[size];\n            elements[size] = null;\n            this.size = size;\n\n            if (ret.lastRecycledId != ret.recycleId) {\n                // \n                throw new IllegalStateException(\"recycled multiple times\");\n            }\n\n            //   recycleId = lastRecycleId = 0\n            ret.recycleId = 0;\n            ret.lastRecycledId = 0;\n            return ret;\n        }\n```\n\nStack\n\n*  size == 0  scavenge StackWeakOrderQueueLinkWeakOrderQueueStack null \n*  DefaultHandler DefaultHandler`recycleId  = lastRecycledId = 0`\n\nrecycleId  lastRecycledId \n\n* `recycleId  = lastRecycledId = 0`\n* `recycleId  = lastRecycledId != 0`Stack\n* `recycleId  != lastRecycledId`WeakOrderQueueStack\n\n### 9.4 Stack\n\n![image.png](/assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp)\n\nStack\n\n* Stack\n* StackWeakOrderQueueWeakOrderQueue\n\nStackWeakOrderQueueWeakOrderQueue****\n\n scavenge \n\n```java\n       private boolean scavenge() {\n            //weakOrderQueue   stack\n            if (scavengeSome()) {\n                return true;\n            }\n\n            // weakOrderQueuestackcursor.prev\n            // weakOrderQueuecursor\n            prev = null;\n            cursor = head;\n            return false;\n        }\n```\n\nscavengeSome() WeakOrderQueue true WeakOrderQueuecursorheadprevnullWeakOrderQueuecursor\n\n### 9.5 \n\nStackWeakOrderQueue\n\nWeakOrderQueueStackWeakOrderQueue\n\n![image.png](/assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp)\n\nStackWeakOrderQueue prev = head = cursor = null \n\nWeakOrderQueue**WeakOrderQueue**\n\n> WeakOrderQueue\n\nheadcursorcursorprevcursorprev\n\nWeakOrderQueue\n\n```java\n        private boolean scavengeSome() {\n            WeakOrderQueue prev;\n            //stack weakOrderQueue\n            WeakOrderQueue cursor = this.cursor;\n            //stackcursorprev,headnullcursor == null stackweakOrderQueue\n            if (cursor == null) {\n                prev = null;\n                cursor = head;\n                if (cursor == null) {\n                    //weakOrderQueue\n                    return false;\n                }\n            } else {\n                //prevcursor\n                prev = this.prev;\n            }\n\n            boolean success = false;\n            //weakOrderQueue \n            do {\n                //weakOrderQueuestacklink\n                if (cursor.transfer(this)) {\n                    success = true;\n                    break;\n                }\n                //cursorweakOrderQueue\n                WeakOrderQueue next = cursor.getNext();\n                //weakOrderQueue\n                if (cursor.get() == null) {\n                    // weakOrderQueue\n                    if (cursor.hasFinalData()) {\n                        //weakOrderQueueweakOrderQueue\n                        for (;;) {\n\n                            if (cursor.transfer(this)) {\n                                success = true;\n                            } else {\n                                break;\n                            }\n                        }\n                    }\n\n                    //weaoOrderQueueunlinkcursor\n                    //netty\n                    // prev == null cursorunlink \n                    if (prev != null) {\n                        //weakOrderQueueGC\n                        cursor.reclaimAllSpaceAndUnlink();\n                        //prevcursor\n                        prev.setNext(next);\n                    }\n                } else {\n                    prev = cursor;\n                }\n                //prev,cursorweakOrderQueue\n                cursor = next;\n\n            } while (cursor != null && !success);\n\n            this.prev = prev;\n            this.cursor = cursor;\n            return success;\n        }\n```\n\n1. WeakOrderQueuecursorStackWeakOrderQueuecursorheadheadWeakOrderQueueheadheadWeakOrderQueue\n2. cursorWeakOrderQueueStackLinkWeakOrderQueueWeakOrderQueue\n\n```java\n        if (cursor.transfer(this)) {\n            success = true;\n            break;\n        }\n\n        WeakOrderQueue next = cursor.getNext();\n```\n\n3. WeakOrderQueueWeakOrderQueue``,GC`cursor.get() == null`WeakOrderQueueStack**Link**WeakOrderQueue\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n\n    ............WeakOrderQueue.........\n\n}\n```\n\n4. WeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC`cursor.reclaimAllSpaceAndUnlink()`availableSharedCapacityWeakOrderQueue\n\n```java\n        if (prev != null) {\n              cursor.reclaimAllSpaceAndUnlink();\n              //prevcursor\n              prev.setNext(next);\n        }\n```\n\n> NettyWeakOrderQueue`prev == null`Netty\n\nWeakOrderQueuecursor\n\n\n\n****\n\n![image.png](/assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp)\n\nWeakOrderQueueStackWeakOrderQueue****\n\n thread4 ****cursorthread3thread3\n\n thread5 thread5WeakOrderQueuecursor`thread4``cursor.get() == null``thread4`\n\n> \n\n**WeakOrderQueue**\n\nWeakOrderQueueWeakOrderQueueStackWeakOrderQueue\n\nStackWeakOrderQueue\n\n****\n\n```java\n        //recycler\n        synchronized void setHead(WeakOrderQueue queue) {\n            //weakOrderQueue\n            queue.setNext(head);\n            head = queue;\n        }\n```\n\nRecycler\n\n> \n\n## 10. WeakOrderQueue\n\n![image.png](/assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp)\n\nWeakOrderQueueQueueLinkHeadLinkLinkheadLinkTail`Link`\n\n### 10.1 Link\n\n```java\n    private static final class WeakOrderQueue extends WeakReference<Thread> {\n\n        // linkAtomicInteger writeindex\n        static final class Link extends AtomicInteger {\n            //16\n            final DefaultHandle<?>[] elements = new DefaultHandle[LINK_CAPACITY];\n\n            int readIndex;\n            //weakOrderQueuelink\n            Link next;\n        }\n}\n```\n\nWeakOrderQueue `WeakReference < Thread >` , ``WeakOrderQueueGC\n\n* `DefaultHandle<?>[] elements `: LinkLINK_CAPACITY 16DefaultHandle\n* `int readIndex`LinkreadIndexreadIndexint\n* `writeIndex`LinkAtomicIntegerLinkwriteIndexLinkwriteIndexLinkwriteIndexwriteIndexAtomicInteger\n* `Link next`Linknext\n\n### 10.2 Head\n\n```java\n        // weakOrderQueuelink\n        private static final class Head {\n            // reserveSpaceForLink\n            //availableSharedCapacity\n            private final AtomicInteger availableSharedCapacity;\n            //link\n            Link link;\n\n            Head(AtomicInteger availableSharedCapacity) {\n                this.availableSharedCapacity = availableSharedCapacity;\n            }\n\n            void reclaimAllSpaceAndUnlink() {\n                    ....headheadhead....\n            }\n\n            private void reclaimSpace(int space) {\n                //availableSharedCapacity\n                availableSharedCapacity.addAndGet(space);\n            }\n\n            //linkheadhead\n            void relink(Link link) {\n                  ...headLink...\n            }\n\n            Link newLink() {\n                  ....Link...\n            }\n\n            //link\n            static boolean reserveSpaceForLink(AtomicInteger availableSharedCapacity) {             \n                  ...Link...\n            }\n        }\n```\n\nHead\n\n* `AtomicInteger availableSharedCapacity`LinkLINK_CAPACITY LinkLINK_CAPACITY \n* `Link link`HeadLink\n\nHead\n\n### 10.3 WeakOrderQueue\n\n```java\n private static final class WeakOrderQueue extends WeakReference<Thread> {\n\n        //linkheadLinK\n        private final Head head;\n        //\n        private Link tail;\n        //stackstackweakOrderQueuestackweakOrderQueue\n        //stackweakOrderQueue\n        private WeakOrderQueue next;\n        //Id,weakOrderQueuestackweakOrderQueue\n        private final int id = ID_GENERATOR.getAndIncrement();\n        // 8\n        private final int interval;\n        // 1/8\n        private int handleRecycleCount;\n\n}\n```\n\n* `Head head`WeakOrderQueueLink\n* `Link tail`Link\n* `WeakOrderQueue next`StackStackWeakOrderQueueWeakOrderQueuenextWeakOrderQueue\n* `int id `IdStackId\n* `int interval` 1 / 8 \n* `int handleRecycleCount`\n\n### 10.4 WeakOrderQueue\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n        //stackGC,stack\n        private WeakOrderQueue(Stack<?> stack, Thread thread) {\n            //weakOrderQueue\n            super(thread);\n            //\n            tail = new Link();\n\n            //   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor\n            head = new Head(stack.availableSharedCapacity);\n            head.link = tail;\n            interval = stack.delayedQueueInterval;\n            handleRecycleCount = interval; \n        }\n}\n```\n\nWeakOrderQueue `WeakReference<Thread>` \n\nLinkheadtail\n\nStackWeakOrderQueue\n\nStackWeakOrderQueue**WeakOrderQueueStack**\n\nWeakOrderQueueWeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC\n\n**StackWeakOrderQueueStackStackGC**\n\nStackWeakOrderQueueWeakOrderQueueStack\n\n> \n\n### 10.5 WeakOrderQueue\n\nWeakOrderQueuetransferWeakOrderQueueStack\n\nWeakOrderQueueLinkStackLINK_CAPACITYStacktransfertrue\n\nheadLinkLink**Link**Linktransferfalse\n\ntransfer\n\n![image.png](/assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp)\n\n#### 10.5.1 \n\n```java\n            //weakOrderQueuelink\n            Link head = this.head.link;\n            //null\n            if (head == null) {\n                return false;\n            }\n\n            //\n            if (head.readIndex == LINK_CAPACITY) {\n                //Link\n                if (head.next == null) {\n                    //link\n                    return false;\n                }\n                head = head.next;\n                //HeadheadheadLinK\n                this.head.relink(head);\n            }\n```\n\nLink`head == null` Linkfalse\n\n`head.readIndex == LINK_CAPACITY` head relink Linkfalse\n\n```java\n private static final class Head {\n\n            //linkheadhead\n            void relink(Link link) {\n                //availableSharedCapacitylinkavailableSharedCapacity\n                reclaimSpace(LINK_CAPACITY);\n                //headlink\n                this.link = link;\n            }\n            private void reclaimSpace(int space) {\n                //availableSharedCapacity\n                availableSharedCapacity.addAndGet(space);\n            }\n}\n```\n\n#### 10.5.2 Stack\n\nHeadStackStackStack\n\n```java\n            final int srcStart = head.readIndex;\n            //writeIndex\n            int srcEnd = head.get();\n            //link\n            final int srcSize = srcEnd - srcStart;\n            if (srcSize == 0) {\n                return false;\n            }\n\n            // stack\n            final int dstSize = dst.size;\n            // weakOrderQueuestackstack = stack + \n            final int expectedCapacity = dstSize + srcSize;\n\n            if (expectedCapacity > dst.elements.length) {\n                //stackstack stack\n                final int actualCapacity = dst.increaseCapacity(expectedCapacity);\n                //Link\n                //actualCapacity - dstSizestack\n                srcEnd = min(srcStart + actualCapacity - dstSize, srcEnd);\n            }\n```\n\nLinkreadIndexwriteIndex  `writeIndex - readIndex` \n\nStack `expectedCapacity = stack + `\n\nStack expectedCapacity StackStack `min(srcStart + actualCapacity - dstSize, srcEnd)` Stack\n\n```java\nprivate static final class Stack<T> {\n\n        int increaseCapacity(int expectedCapacity) {\n            int newCapacity = elements.length;\n            int maxCapacity = this.maxCapacity;\n            do {\n                newCapacity <<= 1;\n            } while (newCapacity < expectedCapacity && newCapacity < maxCapacity);\n            //expectedCapacity2\n            newCapacity = min(newCapacity, maxCapacity);\n            if (newCapacity != elements.length) {\n                elements = Arrays.copyOf(elements, newCapacity);\n            }\n\n            return newCapacity;\n        }\n\n}\n```\n\nStack`actualCapacity - dstSize = 0``false`\n\n```java\nif (srcStart != srcEnd) {\n   ............\n}else {\n    // The destination stack is full already.\n    return false;\n}\n```\n\n**Stack**\n\n#### 10.5.3 \n\n```java\n                // Link\n                final DefaultHandle[] srcElems = head.elements;\n                //stack\n                final DefaultHandle[] dstElems = dst.elements;\n                int newDstSize = dstSize;\n                for (int i = srcStart; i < srcEnd; i++) {\n                    DefaultHandle<?> element = srcElems[i];\n                    //recycleId == 0 stack\n                    if (element.recycleId == 0) {\n                        //recycleId weakOrderQueue\n                        element.recycleId = element.lastRecycledId;\n                    } else if (element.recycleId != element.lastRecycledId) {\n                        //    \n                        throw new IllegalStateException(\"recycled already\");\n                    }\n                    //Link\n                    srcElems[i] = null;\n\n                    //weakOrderQueuestack \n                    if (dst.dropHandle(element)) {\n                        // Drop the object.\n                        continue;\n                    }\n                    //defaultHandlerstack(handlerstack)\n                    //defaultHandlerstacknullstackGC\n                    element.stack = dst;\n                    //handlerstack\n                    dstElems[newDstSize ++] = element;\n                }\n```\n\nLinkelementsStackelements `srcStart  ->  srcEnd `\n\n `element.recycleId == 0` Stack9.3 Stack\n\n* `recycleId = lastRecycledId = 0`\n\nId `element.recycleId = element.lastRecycledId`lastRecycledIdWeakOrderQueueId\n\n`element.recycleId != element.lastRecycledId` \n\nStack\n\n#### 10.5.4 \n\n 1 / 8  8  1 \n\n```java\n        boolean dropHandle(DefaultHandle<?> handle) {\n            if (!handle.hasBeenRecycled) {\n                //handleRecycleCount 8 \n                //interval 8\n                if (handleRecycleCount < interval) {\n                    handleRecycleCount++;\n                    // Drop the object.\n                    return true;\n                }\n                //\n                handleRecycleCount = 0;\n                //defaultHandlertrue\n                handle.hasBeenRecycled = true;\n            }\n            return false;\n        }\n```\n\nDefaultHandlerStackStackWeakOrderQueueDefaultHandlerStacknull\n\n> Stacknull\n\nStack\n\nLinkreadIndexStackLinkHead\n\n```java\n             if (srcEnd == LINK_CAPACITY && head.next != null) {\n                    // Add capacity back as the Link is GCed.\n                    // Linklinkhead\n                    this.head.relink(head.next);\n                }\n\n                //LinkreadIndex\n                head.readIndex = srcEnd;\n                // return false\n                if (dst.size == newDstSize) {\n                    return false;\n                }\n                dst.size = newDstSize;\n                return true;\n```\n\nRecycler\n\n## 11. \n\nDefaultHandlerrecycle\n\n![image.png](/assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp)\n\n```java\nstatic final class Entry {\n\n       private  Handle<Entry> handle;\n\n       void recycle() {\n            next = null;\n            bufs = null;\n            buf = null;\n            msg = null;\n            promise = null;\n            progress = 0;\n            total = 0;\n            pendingSize = 0;\n            count = -1;\n            cancelled = false;\n            handle.recycle(this);\n        }\n\n}\n```\n\n```java\nprivate static final class DefaultHandle<T> implements Handle<T> {\n      \n        ..............................\n\n        //handlerstack\n        Stack<?> stack;\n        //\n        Object value;\n\n        @Override\n        public void recycle(Object object) {\n            if (object != value) {\n                throw new IllegalArgumentException(\"object does not belong to handle\");\n            }\n\n            Stack<?> stack = this.stack;\n            //handler  recycleId = lastRecycledId = 0\n            //recycleId = lastRecycledId = OWN_THREAD_ID\n            //lastRecycledId = Id,stack recycleId = lastRecycledId = Id\n            if (lastRecycledId != recycleId || stack == null) {\n                throw new IllegalStateException(\"recycled already\");\n            }\n\n            stack.push(this);\n        }\n\n}\n```\n\nDefaultHandler recycle  if \n\n* `lastRecycledId != recycleId`  WeakOrderQueue Stack****\n\n> 9.3 Stack recycleId  lastRecycledId \n\n* `stack == null` StackGC\n\n### 11.1 StackBug!\n\n```java\nprivate static final class Stack<T> {\n        //\n        final WeakReference<Thread> threadRef;\n\n        void push(DefaultHandle<?> item) {\n            Thread currentThread = Thread.currentThread();\n            //  weakOrderQueue\n            //stack\n            if (threadRef.get() == currentThread) {\n                //  stack\n                pushNow(item);\n            } else {\n                // stackweakOrderQueuecurrentThread\n                pushLater(item, currentThread);\n            }\n        }\n}\n```\n\nDefaultHandlerStackStack\n\n>  if...else...Bug\n\n`threadRef.get() == currentThread)` pushNow(item) \n\n `threadRef.get() != currentThread)` \n\n1. currentThread `pushLater(item, currentThread)` WeakOrderQueue\n2. Bug `threadRef.get()  == null`  else GC****StackGC**Stack**NettyStackWeakOrderQueueWeakOrderQueue\n\nBug\n\n![image.png](/assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp)\n\n**Netty**\n\n\n\n![image.png](/assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp)\n\nDefaultHandlerDefaultHandlerStack\n\n![image.png](/assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp)\n\nGCStackStackStackGC\n\n## 11.2 PRBug!\n\nBug\n\nNetty Issue11864 \n\n> Issue11864 : [github.com/netty/netty](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fissues%2F11864 \"https://github.com/netty/netty/issues/11864\")\n\n PR11865 Bug\n\n> PR : [github.com/netty/netty](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fpull%2F11865 \"https://github.com/netty/netty/pull/11865\")\n\nPR\n\n1.  `threadRef.get()  == null`  return \n2. Stack `item.stack = null`StackGC\n\nPR `threadRef.get()  == null` \n\n```java\n        void push(DefaultHandle<?> item) {\n            Thread currentThread = Thread.currentThread();\n            if (threadRef.get() == currentThread) {\n                pushNow(item);\n            } else if (threadRef.get() == null) {\n                // when the thread that belonged to the Stack was died or GC'ed\n                // There is no need to add this item to WeakOrderQueue-linked-list which belonged to the Stack any more\n                item.stack = null;\n            } else {\n                pushLater(item, currentThread);\n            }\n        }\n```\n\n## 11.3 PR\n\n PR11865\n\n![image.png](/assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp)\n\nNettyNetty Recycler RecyclerRecycler******GC**Netty\n\ncommit\n\n> commit[github.com/netty/netty](https://github.com/netty/netty/commit/28b9834612638ffec4948c0c650d04f766f20690)\n\nRecycler**4.1.71.Final**Recycler**4.1.71.Final**\n\n**4.1.71.Final** .....  Issue11864 : [github.com/netty/netty](https://github.com/netty/netty/issues/11864) **4.1.71.Final**\n\n chrisvest   PR11996  **4.1.74.Final** Issue11864\n\n> PR11996 [github.com/netty/netty](https://github.com/netty/netty/pull/11996)\n\n>  chrisvest  Neo4j commitorNetty BufferAPI\n\nBug **4.1.74.Final** \n\n1.  chrisvest   threadLocal onRemovalLocalPoolpooledHandles  nullLocalPool\n\n>  LocalPool StackLocalPoolpooledHandlesStack\n\n```java\npublic abstract class Recycler<T> {\n\n    private final FastThreadLocal<LocalPool<T>> threadLocal = new FastThreadLocal<LocalPool<T>>() {\n        @Override\n        protected LocalPool<T> initialValue() {\n            return new LocalPool<T>(maxCapacityPerThread, interval, chunkSize);\n        }\n\n        @Override\n        protected void onRemoval(LocalPool<T> value) throws Exception {\n            //LocalPool\n            super.onRemoval(value);\n            MessagePassingQueue<DefaultHandle<T>> handles = value.pooledHandles;\n            //pooledHandles  null\n            value.pooledHandles = null;\n            //LocalPool\n            handles.clear();\n        }\n    };\n\n}\n```\n\n2. LocalPoolpooledHandles\n\n```java\nprivate static final class LocalPool<T> {\n    //\n    private volatile MessagePassingQueue<DefaultHandle<T>> pooledHandles;\n\n     void release(DefaultHandle<T> handle) {\n            MessagePassingQueue<DefaultHandle<T>> handles = pooledHandles;\n            handle.toAvailable();\n            if (handles != null) {\n                handles.relaxedOffer(handle);\n            }\n        }\n}\n```\n\n  GC LocalPoolStackLocalPool\n\nBug\n\n### 11.4 \n\n```java\n       private void pushNow(DefaultHandle<?> item) {\n            // recycleId = lastRecycleId = 0\n            //0 \n            if ((item.recycleId | item.lastRecycledId) != 0) {\n                throw new IllegalStateException(\"recycled already\");\n            }\n\n            //recycleIdlastRecycleIdId-OWN_THREAD_ID\n            //OWN_THREAD_ID\n            // OWN_THREAD_IDId\n            item.recycleId = item.lastRecycledId = OWN_THREAD_ID;\n\n            int size = this.size;\n            // \n            //1/8\n            if (size >= maxCapacity || dropHandle(item)) {\n                // Hit the maximum capacity or should drop - drop the possibly youngest object.\n                //\n                return;\n            }\n\n            //stackstack\n            if (size == elements.length) {\n                //\n                elements = Arrays.copyOf(elements, min(size << 1, maxCapacity));\n            }\n            //stack\n            elements[size] = item;\n            //stack\n            this.size = size + 1;\n        }\n```\n\n* `item.recycleId | item.lastRecycledId) != 0`Id0\n* Id`item.recycleId = item.lastRecycledId = OWN_THREAD_ID`\n* Stack\n*  1 / 8  dropHandle \n* Stackstack\n* Stack\n\n### 11.5 \n\n![image.png](/assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp)\n\nRecycler\n\n thread2 , thread3 , thread4 ...  Stackthread1\n\n  thread2 , thread3 , thread4 ... thread1thread1thread1StackWeakOrderQueue thread2 , thread3 , thread4 ...  \n\nRecycler maxDelayedQueuesPerThread \n\n```java\npublic abstract class Recycler<T> {\n\n      // cpu * 2\n      private static final int MAX_DELAYED_QUEUES_PER_THREAD;\n\n     //\n      private final int maxDelayedQueuesPerThread;\n\n      private static final class Stack<T> {\n\n            // \n            private final int maxDelayedQueues;\n\n      }\n\n}\n\n```\n\nRecycler maxDelayedQueuesPerThread \n\n****\n\n![image.png](/assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp)\n\n FastThreadLocal  DELAYED_RECYCLED  DELAYED_RECYCLED  WeakHashMap WeakHashMap \n\nWeakHashMap  key  Stack value StackWeakOrderQueue Recycler.png \n\n```java\npublic abstract class Recycler<T> {\n\n    //\n    //key: stack  value:  weakOrderQueue\n    //value stackweakOrderQueue\n    private static final FastThreadLocal<Map<Stack<?>, WeakOrderQueue>> DELAYED_RECYCLED =\n            new FastThreadLocal<Map<Stack<?>, WeakOrderQueue>>() {\n        @Override\n        protected Map<Stack<?>, WeakOrderQueue> initialValue() {\n            return new WeakHashMap<Stack<?>, WeakOrderQueue>();\n        }\n    };\n\n}\n```\n\nWeakHashMap sizesize maxDelayedQueuesPerThread \n\n**WeakHashMap**?\n\nGCStackStackStackGCStackWeakHashMapEntryWeakHashMapStack\n\n\n\n```java\n      private void pushLater(DefaultHandle<?> item, Thread thread) {\n            //maxDelayQueues == 0 \n            if (maxDelayedQueues == 0) {\n                //\n                return;\n            }\n          \n            //\n            Map<Stack<?>, WeakOrderQueue> delayedRecycled = DELAYED_RECYCLED.get();\n            //stack    \n            WeakOrderQueue queue = delayedRecycled.get(this);\n            //queue == null stack\n            if (queue == null) {\n                //maxDelayedQueues\n                //delayedRecycled.size()\n                if (delayedRecycled.size() >= maxDelayedQueues) {\n              \n                    //WeakOrderQueue\n                    //WeakOrderQueue.DUMMY  \n                    delayedRecycled.put(this, WeakOrderQueue.DUMMY);\n                    return;\n                }\n \n                // WeakOrderQueue\n                if ((queue = newWeakOrderQueue(thread)) == null) {\n                    // \n                    return;\n                }\n                //threadLocal stack  weakOrderQueue\n                delayedRecycled.put(this, queue);\n            } else if (queue == WeakOrderQueue.DUMMY) {\n                // drop object\n                // queueWeakOrderQueue.DUMMY  \n                return;\n            }\n\n            //  weakOrderQueue\n            queue.add(item);\n        }\n```\n\n1. Recycler `maxDelayedQueues == 0` \n2. StackWeakOrderQueue**** maxDelayedQueues \n3.  maxDelayedQueues  WeakHashMap  WeakOrderQueue DUMMY WeakOrderQueue  DUMMY \n\n```java\n private static final class WeakOrderQueue extends WeakReference<Thread> {\n        //DUMMY\n        static final WeakOrderQueue DUMMY = new WeakOrderQueue();\n\n}\n```\n\n4.  maxDelayedQueues  `stack#newWeakOrderQueue` StackWeakOrderQueueWeakHashMapStackWeakOrderQueue\n5. StackWeakOrderQueue\n\n### 11.6  WeakOrderQueue\n\nStackWeakOrderQueueWeakOrderQueue\n\n```java\n   private static final class Stack<T> {\n\n         private WeakOrderQueue newWeakOrderQueue(Thread thread) {\n              return WeakOrderQueue.newQueue(this, thread);\n        }\n   }\n```\n\n![image.png](/assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp)\n\n```java\nprivate static final class WeakOrderQueue extends WeakReference<Thread> {\n\n        static WeakOrderQueue newQueue(Stack<?> stack, Thread thread) {\n  \n            // linkweakOrderQueueLink\n            // stackavailableSharedCapacity  LINK_CAPACITY\n            if (!Head.reserveSpaceForLink(stack.availableSharedCapacity)) {\n                return null;\n            }\n\n            //linkweakOrderQueue\n            final WeakOrderQueue queue = new WeakOrderQueue(stack, thread);\n\n            // stackweakOrderQueueweakOrderQueue \n            // stackweakOrderQueueWeakOrderQueueWeakOrderQueue.this\n            // \n            stack.setHead(queue);\n\n            return queue;\n        }\n\n}\n```\n\nWeakOrderQueueWeakOrderQueueLinkWeakOrderQueueLink\n\nWeakOrderQueueLinkLink\n\navailableSharedCapacity LinkLINK_CAPACITY LinkLINK_CAPACITY  availableSharedCapacity \n\nWeakOrderQueueLink**** availableSharedCapacity LinkWeakOrderQueue\n\navailableSharedCapacityLinkWeakOrderQueue\n\n```java\n            //link\n            static boolean reserveSpaceForLink(AtomicInteger availableSharedCapacity) {\n                for (;;) {\n                    //stackstack\n                    int available = availableSharedCapacity.get();\n                    //availbaleLinkstack\n                    if (available < LINK_CAPACITY) {\n                        return false;\n                    }\n                    //LinkLinkavailableSharedCapacity\n                    if (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) {\n                        return true;\n                    }\n                }\n            }\n```\n\n availableSharedCapacity  LINK_CAPACITY  availableSharedCapacity \n\nWeakOrderQueueLinkWeakOrderQueue\n\n```java\n        //stackGC,stack\n        private WeakOrderQueue(Stack<?> stack, Thread thread) {\n            //weakOrderQueue\n            super(thread);\n            //\n            tail = new Link();\n\n            //   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor\n            // availableSharedCapacitylink\n            head = new Head(stack.availableSharedCapacity);\n            head.link = tail;\n            interval = stack.delayedQueueInterval;\n            handleRecycleCount = interval; \n        }\n```\n\nWeakOrderQueueStackWeakOrderQueueWeakOrderQueueStackWeakOrderQueueRecycler \n\n```java\n       synchronized void setHead(WeakOrderQueue queue) {\n            //weakOrderQueuequeue\n            queue.setNext(head);\n            head = queue;\n        }\n```\n\n![image.png](/assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp)\n\n### 11.7 WeakOrderQueue\n\n\n\nWeakOrderQueueNettyLinkLinkLink\n\n```java\n      void add(DefaultHandle<?> handle) {\n            //handlerlastRecycledIdweakOrderQueueId,stackweakOrderQueue\n            // \n            handle.lastRecycledId = id;\n\n            //  1/8\n            // scavengeSomeweakOrderQueuestackNetty\n            // netty weakOrderQueue\n            if (handleRecycleCount < interval) {\n                handleRecycleCount++;\n                // Drop the item to prevent recycling to aggressive.\n                return;\n            }\n            handleRecycleCount = 0;\n\n            //link\n            Link tail = this.tail;\n            int writeIndex;\n\n            //linklink\n            if ((writeIndex = tail.get()) == LINK_CAPACITY) {\n                //Link\n                Link link = head.newLink();\n                //availableSharedCapacityLink\n                if (link == null) {\n                    // \n                    return;\n                }\n                // We allocate a Link so reserve the space\n                //\n                this.tail = tail = tail.next = link;\n\n                writeIndex = tail.get();\n            }\n\n            //handlerlink\n            tail.elements[writeIndex] = handle;\n            //stacknullstack\n            //StackGChandlestackGC\n            //stack\n            handle.stack = null;\n            //lazySetwriteIndexwriteIndex\n            // Netty\n            //scavengeSomeweakOrderQueueweakOrderQueue\n            //weakOrderQueue\n            tail.lazySet(writeIndex + 1);\n        }\n```\n\n1. DefaultHandlerlastRecycledId IdDefaultHandler `recycleId != lastRecycledId `\n2.  1 / 8 9.5  `stack#scavengeSome` StackWeakOrderQueue 1 / 8 ****nettyweakOrderQueue\n3. WeakOrderQueueLinkLink `writeIndex = tail.get()) == LINK_CAPACITY` LinktailLink availableSharedCapacity Link\n\n```java\n    private static final class Head {\n\n             Link newLink() {\n                  //availableSharedCapacityavailableSharedCapacity\n                  //availableSharedCapacity\n                  return reserveSpaceForLink(availableSharedCapacity) ? new Link() : null;\n             }\n\n            //link\n            static boolean reserveSpaceForLink(AtomicInteger availableSharedCapacity) {\n                for (;;) {\n                    //stackstack\n                    int available = availableSharedCapacity.get();\n                    //availbaleLinkstack\n                    if (available < LINK_CAPACITY) {\n                        return false;\n                    }\n                    //LinkLinkavailableSharedCapacity\n                    if (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) {\n                        return true;\n                    }\n                }\n            }\n    }\n```\n\nRecycler****\n\n\n\n**handle.stacknull**?\n\n `stack#scavengeSome` WeakOrderQueuestackDefaultHandlerstackstack\n\n```java\nboolean transfer(Stack<?> dst) {\n\n      ...............................\n\n      //defaultHandlerstack(handlerstack)\n      //defaultHandlerstacknullstackGC\n      element.stack = dst;\n\n      ...............................\n}\n```\n\nWeakOrderQueue handle.stack null handle.stack \n\nGCstackstackstacknullWeakOrderQueueGCstackGC\n\n> \n\n**lazySetwriteIndex**\n\nLinkwriteIndex\n\n\n\nStackWeakOrderQueueWeakOrderQueu\n\nwriteIndex LOCK **WeakOrderQueue**Netty\n\n---\n\n## \n\nRecycler\n\nRecycler**4.1.71.Final**Recycler\n\n~~\n","slug":"20250501-7","published":1,"updated":"2025-05-01T09:57:30.606Z","_id":"cma56nfvx000iisjja19xesyn","comments":1,"layout":"post","photos":[],"content":"<h1>Recycler</h1>\n<hr>\n<blockquote>\n<p>          bin<br>\nNetty <strong>4.1.56.Final</strong></p>\n</blockquote>\n<h2 id=\"1-\">1. </h2>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p><a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484244%26idx%3D1%26sn%3D831060fc38caa201d69f87305de7f86a%26chksm%3Dce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e%23rd\" title=\"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&amp;mid=2247484244&amp;idx=1&amp;sn=831060fc38caa201d69f87305de7f86a&amp;chksm=ce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e#rd\">Netty</a>JVMNetty  Netty  JVM  native memory  DirectByteBuffer  native  <code>unsafe.allocateMemory</code>  <code>malloc</code> </p>\n<p></p>\n<ul>\n<li> JVM  DirectByteBuffer  JVM </li>\n<li> <code>malloc</code>  DirectByteBuffer </li>\n</ul>\n<p> Netty  Netty </p>\n<h2 id=\"2-\">2. </h2>\n<p></p>\n<p> Netty  Netty  PooledDirectByteBuf  Netty  IO  PooledDirectByteBuf </p>\n<p> PooledDirectByteBuf </p>\n<p> Netty  Netty  channel </p>\n<p>Netty  Channel  ChannelOutboundBuffer  ChannelOutboundBuffer  Channel  flush  ChannelOutboundBuffer  Socket </p>\n<p> ChannelOutboundBuffer  Entry  Entry  Entry  ChannelOutboundBuffer </p>\n<blockquote>\n<p> ChannelOutboundBuffer  Entry </p>\n</blockquote>\n<p>Netty IO  Entry  IO  JVM  GC  Netty </p>\n<p></p>\n<p></p>\n<hr>\n<p></p>\n<p></p>\n<h2 id=\"3-JVM\">3. JVM</h2>\n<h3 id=\"3-1-\">3.1 </h3>\n<p> Java  new JVM new </p>\n<ol>\n<li> JVM  new  Java </li>\n<li>JVMJVM</li>\n</ol>\n<blockquote>\n<p><a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd\" title=\"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&amp;mid=2247484304&amp;idx=1&amp;sn=54bf0d07e69c5621c145afaece8f50d6&amp;chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\">JVM</a></p>\n</blockquote>\n<ol start=\"3\">\n<li>JVMJVMJVMJVMCAS  + </li>\n<li>JVMJVM-TLABTLABTLABJVM<strong></strong> <code>-XX:+UseTLAB</code>TLAB<code>-XX:-UseTLAB</code>TLAB</li>\n</ol>\n<blockquote>\n<p>TLABNettyRecycler</p>\n</blockquote>\n<ol start=\"5\">\n<li>JVM</li>\n<li>MarkWord<a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd\" title=\"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&amp;mid=2247484304&amp;idx=1&amp;sn=54bf0d07e69c5621c145afaece8f50d6&amp;chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\">JVM</a></li>\n<li></li>\n</ol>\n<h3 id=\"3-2-\">3.2 </h3>\n<ul>\n<li>JVMJavaGC ROOTS</li>\n<li>GC PAUSESTOP THE WORLD</li>\n</ul>\n<hr>\n<p>IONetty Recycler </p>\n<p> Recycler  Recycler </p>\n<h2 id=\"4-Recycler\">4. Recycler</h2>\n<p>NettyRecycler PooledDirectByteBuf </p>\n<blockquote>\n<p>PooledDirectByteBuf</p>\n</blockquote>\n<p><img src=\"/assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp\" alt=\"image.png\"></p>\n<h3 id=\"4-1-PooledDirectByteBuf\">4.1 PooledDirectByteBuf</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PooledDirectByteBuf</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">PooledByteBuf</span>&lt;ByteBuffer&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;PooledDirectByteBuf&gt; RECYCLER = ObjectPool.newPool(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;PooledDirectByteBuf&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> PooledDirectByteBuf <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;PooledDirectByteBuf&gt; handle)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PooledDirectByteBuf</span>(handle, <span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Handle&lt;PooledByteBuf&lt;T&gt;&gt; recyclerHandle;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> PooledDirectByteBuf <span class=\"title function_\">newInstance</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacity)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">PooledDirectByteBuf</span> <span class=\"variable\">buf</span> <span class=\"operator\">=</span> RECYCLER.get();</span><br><span class=\"line\">        buf.reuse(maxCapacity);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buf;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">         <span class=\"comment\">//</span></span><br><span class=\"line\">        recyclerHandle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ..................................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>NettyPooledDirectByteBufPooledDirectByteBuf</p>\n<p>Netty<code>ObjectPool  RECYCLER </code></p>\n<p>PooledDirectByteBuf<code>ObjectPool&lt;T&gt;</code>Netty ObjectPool#newPool  ObjectCreator  ObjectCreatornewObject </p>\n<p>recyclerHandlerecyclerHandlerecyclerHandle</p>\n<p>PooledDirectByteBuf<code>RECYCLER.get()</code>PooledDirectByteBuf</p>\n<p>PooledDirectByteBuf<code>recyclerHandle.recycle(this) </code></p>\n<h3 id=\"4-2-Channel\">4.2 Channel</h3>\n<p>ChannelChannelOutboundBufferchannelwrite</p>\n<p>ChannelChannelOutboundBufferChannelOutboundBufferEntryNettyEntryEntry</p>\n<p>PooledDirectByteBufEntry</p>\n<h4 id=\"\"></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER = ObjectPool.newPool(<span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;Entry&gt;() &#123;</span><br><span class=\"line\">         <span class=\"meta\">@Override</span></span><br><span class=\"line\">         <span class=\"keyword\">public</span> Entry <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">             <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Entry</span>(handle);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//recyclerHandle</span></span><br><span class=\"line\">     <span class=\"keyword\">private</span>  Handle&lt;Entry&gt; handle;</span><br><span class=\"line\">   </span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"title function_\">Entry</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">         <span class=\"built_in\">this</span>.handle = handle;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER </span><br></pre></td></tr></table></figure>\n<p> ObjectCreator </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ObjectCreator</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>ObjectPool#newPool</code> Entry</p>\n<p>HandlerHandlerHandler</p>\n<h4 id=\"\"></h4>\n<p>EntrypublicEntry</p>\n<p> static  newInstance<code>RECYCLER.get()</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> Entry <span class=\"title function_\">newInstance</span><span class=\"params\">(Object msg, <span class=\"type\">int</span> size, <span class=\"type\">long</span> total, ChannelPromise promise)</span> &#123;</span><br><span class=\"line\">      <span class=\"type\">Entry</span> <span class=\"variable\">entry</span> <span class=\"operator\">=</span> RECYCLER.get();</span><br><span class=\"line\">    </span><br><span class=\"line\">      .......................</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> entry;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<p> recycle </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    bufs = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    buf = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    msg = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    promise = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    progress = <span class=\"number\">0</span>;</span><br><span class=\"line\">    total = <span class=\"number\">0</span>;</span><br><span class=\"line\">    pendingSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">    count = -<span class=\"number\">1</span>;</span><br><span class=\"line\">    cancelled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    handle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li></li>\n<li>Handler</li>\n</ul>\n<hr>\n<p>Netty</p>\n<p></p>\n<h2 id=\"5-Recycler\">5. Recycler</h2>\n<p>Recycler -  - </p>\n<p></p>\n<p></p>\n<p></p>\n<p>Recycler</p>\n<p><img src=\"/assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp\" alt=\"image.png\"></p>\n<h3 id=\"5-1-\">5.1 </h3>\n<p></p>\n<p></p>\n<p> Stack  WeakOrderQueue</p>\n<p>Stack </p>\n<p><strong></strong>StackJVMTLAB,TLAB</p>\n<p>, StackStack</p>\n<p><strong>NettyTLABStackStack</strong></p>\n<blockquote>\n<p><strong></strong>Netty</p>\n</blockquote>\n<h3 id=\"5-2-Stack\">5.2 Stack</h3>\n<p>RecyclerStack</p>\n<ul>\n<li>Stack<strong></strong></li>\n<li>WeakOrderQueuehead WeakOrderQueuecursor prev WeakOrderQueueWeakOrderQueueWeakOrderQueue</li>\n</ul>\n<blockquote>\n<p>WeakOrderQueue</p>\n</blockquote>\n<p><strong>StackWeakOrderQueue</strong></p>\n<p>Recyclerthread1 thread2 , thread3 , thread4</p>\n<blockquote>\n<p>StackWeakOrderQueue</p>\n</blockquote>\n<p><img src=\"/assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp\" alt=\"image.png\"></p>\n<p> thread1 thread1thread1thread1stack1`hread1stack1</p>\n<blockquote>\n<p>Stack</p>\n</blockquote>\n<p>thread1thread2thread3thread2thread3thread1</p>\n<p>thread1thread1stack1stack1<strong>NettyStack</strong></p>\n<p>thread1Stack1thread1Stack1</p>\n<blockquote>\n<p>GCStack</p>\n</blockquote>\n<p><strong>Netty</strong></p>\n<p>thead2 , thread3 WeakOrderQueueWeakOrderQueue</p>\n<blockquote>\n<p>WeakOrderQueueStack</p>\n</blockquote>\n<p><code></code>thread1<code></code>thread2 , thread3 , thead4 </p>\n<p>thread1stack1<strong>WeakOrderQueue</strong>stack1stack1WeakOrderQueueStackheadprevcursorWeakOrderQueue</p>\n<blockquote>\n<p>WeakOrderQueue</p>\n</blockquote>\n<p>thread1Stack1Stack</p>\n<p>Stack cursor StackWeakOrderQueueWeakOrderQueue<strong></strong>WeakOrderQueue</p>\n<blockquote>\n<p>StackStackWeakOrderQueueWeakOrderQueue</p>\n</blockquote>\n<p><strong></strong></p>\n<p><strong></strong></p>\n<p><img src=\"/assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp\" alt=\"image.png\"></p>\n<h3 id=\"5-3-WeakOrderQueue\">5.3 WeakOrderQueue</h3>\n<p>WeakOrderQueue</p>\n<blockquote>\n<p><strong></strong></p>\n</blockquote>\n<p><img src=\"/assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp\" alt=\"image.png\"></p>\n<p>WeakOrderQueueWeakOrderQueue</p>\n<p> Head Tail Link </p>\n<p>Link  elements </p>\n<p>LinkreadIndexelementswriteIndexelementselements<code>16</code>Link1616LinkLink</p>\n<p>WeakoOrderQueueStack<strong></strong>WeakOrderQueueLinkHeadHeadLinkStack<strong>Link</strong>16</p>\n<p>LinkStackLinkWeakOrderQueueLinkHeadLink</p>\n<blockquote>\n<p>head<strong>Link</strong>headTail<strong></strong></p>\n</blockquote>\n<p><strong></strong><strong></strong></p>\n<p><strong>Netty</strong> </p>\n<p>WeakOrderQueue<strong></strong></p>\n<blockquote>\n<p><strong></strong></p>\n</blockquote>\n<p> Netty Recycler WeakOrderQueue</p>\n<p>Netty</p>\n<h2 id=\"6-Recycler\">6. Recycler</h2>\n<p>4. RecyclerRecycler</p>\n<ul>\n<li>PooledDirectByteBuf</li>\n<li>ChannelChannelOutboundBuffer</li>\n</ul>\n<p> ObjectPool ObjectPool Netty</p>\n<p></p>\n<h3 id=\"6-1-ObjectPool\">6.1 ObjectPool</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    ObjectPool() &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(T self)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ObjectCreator</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ..................................</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> ObjecPool </p>\n<p>4. Recycler</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PooledDirectByteBuf</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">PooledByteBuf</span>&lt;ByteBuffer&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;PooledDirectByteBuf&gt; RECYCLER</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ObjecPool </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span>;</span><br></pre></td></tr></table></figure>\n<p> Handler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(T self)</span>;</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<p>HandlerHandlerDefaultHandle</p>\n<blockquote>\n<p>StackDefaultHandleWeakOrderQueueLinkelementsDefaultHandle</p>\n</blockquote>\n<p><strong>recycleHandlerObejctPool</strong></p>\n<p>recycle</p>\n<p>4. RecyclerHandlerHandlerrecyclerecycleHandlerrecycle</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            bufs = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            buf = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            msg = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            promise = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            progress = <span class=\"number\">0</span>;</span><br><span class=\"line\">            total = <span class=\"number\">0</span>;</span><br><span class=\"line\">            pendingSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">            count = -<span class=\"number\">1</span>;</span><br><span class=\"line\">            cancelled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            handle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ObjectPool </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ObjectCreator</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>ObjectCreator#newObject</code>Handler</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER = ObjectPool.newPool(<span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;Entry&gt;() &#123;</span><br><span class=\"line\">          <span class=\"meta\">@Override</span></span><br><span class=\"line\">          <span class=\"keyword\">public</span> Entry <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Entry</span>(handle);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Entry</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">Entry</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">          <span class=\"built_in\">this</span>.handle = handle;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"6-1-1-ObjectPool\">6.1.1 ObjectPool</h4>\n<p><img src=\"/assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; ObjectPool&lt;T&gt; <span class=\"title function_\">newPool</span><span class=\"params\">(<span class=\"keyword\">final</span> ObjectCreator&lt;T&gt; creator)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RecyclerObjectPool</span>&lt;T&gt;(ObjectUtil.checkNotNull(creator, <span class=\"string\">&quot;creator&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RecyclerObjectPool</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//recycler</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Recycler&lt;T&gt; recycler;</span><br><span class=\"line\"></span><br><span class=\"line\">        RecyclerObjectPool(<span class=\"keyword\">final</span> ObjectCreator&lt;T&gt; creator) &#123;</span><br><span class=\"line\">             recycler = <span class=\"keyword\">new</span> <span class=\"title class_\">Recycler</span>&lt;T&gt;() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">protected</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> creator.newObject(handle);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> recycler.get();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">    .....................................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>ObjectPool#newPool</code>  RecyclerObjectPool <strong> Recycler</strong>  RecyclerObjectPool </p>\n<p>RecyclerObjectCreator </p>\n<h2 id=\"7-Recycler\">7. Recycler</h2>\n<p>Recycler</p>\n<p><img src=\"/assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp\" alt=\"image.png\"></p>\n<h3 id=\"7-1-Id\">7.1 Id</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Id,</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">AtomicInteger</span> <span class=\"variable\">ID_GENERATOR</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(Integer.MIN_VALUE);</span><br><span class=\"line\">    <span class=\"comment\">//Id static final OWN_THREAD_ID</span></span><br><span class=\"line\">    <span class=\"comment\">//Id</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">OWN_THREAD_ID</span> <span class=\"operator\">=</span> ID_GENERATOR.getAndIncrement();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>AtomicInteger ID_GENERATOR</code> : AtomicInteger IdId<strong></strong></li>\n<li><code>int OWN_THREAD_ID</code> Recycler ID_GENERATOR  OWN_THREAD_ID  OWN_THREAD_ID IdOWN_THREAD_ID  static final Recycler OWN_THREAD_ID </li>\n</ul>\n<p>thread1, thread2, thread3Recycler  OWN_THREAD_ID </p>\n<p><img src=\"/assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp\" alt=\"image.png\"></p>\n<p><strong>Id</strong>Netty<strong></strong>Id</p>\n<p>Id WeakOrderQueue  WeakOrderQueue Id</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Id,weakOrderQueuestackweakOrderQueue</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">id</span> <span class=\"operator\">=</span> ID_GENERATOR.getAndIncrement();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"7-2-\">7.2 </h3>\n<p><img src=\"/assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Stack 4096 </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD</span> <span class=\"operator\">=</span> <span class=\"number\">4</span> * <span class=\"number\">1024</span>; <span class=\"comment\">// Use 4k instances as default.</span></span><br><span class=\"line\"><span class=\"comment\">// Stack 4096</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> DEFAULT_MAX_CAPACITY_PER_THREAD;</span><br><span class=\"line\"><span class=\"comment\">//  min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256) 256</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> INITIAL_CAPACITY;</span><br></pre></td></tr></table></figure>\n<p>Recycler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">maxCapacityPerThread</span> <span class=\"operator\">=</span> SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxCapacityPerThread&quot;</span>,</span><br><span class=\"line\">            SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxCapacity&quot;</span>, DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD));</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxCapacityPerThread &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        maxCapacityPerThread = DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    DEFAULT_MAX_CAPACITY_PER_THREAD = maxCapacityPerThread;</span><br><span class=\"line\"></span><br><span class=\"line\">    INITIAL_CAPACITY = min(DEFAULT_MAX_CAPACITY_PER_THREAD, <span class=\"number\">256</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD</code>Stack4096JVM <code>-D io.netty.recycler.maxCapacity</code> </li>\n<li><code>DEFAULT_MAX_CAPACITY_PER_THREAD</code>StackJVM <code>-D io.netty.recycler.maxCapacityPerThread</code>  DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD 4096</li>\n<li><code>INITIAL_CAPACITY </code>: Stack<code>min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256)</code>256256 DEFAULT_MAX_CAPACITY_PER_THREAD</li>\n</ul>\n<h3 id=\"7-3-\">7.3 </h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  2  </span></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> MAX_SHARED_CAPACITY_FACTOR;</span><br><span class=\"line\"> <span class=\"comment\">// cpu * 2</span></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> MAX_DELAYED_QUEUES_PER_THREAD;</span><br><span class=\"line\"> <span class=\"comment\">//WeakOrderQueueLink 16</span></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> LINK_CAPACITY;</span><br></pre></td></tr></table></figure>\n<p>Recycler  Stack </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    MAX_SHARED_CAPACITY_FACTOR = max(<span class=\"number\">2</span>,</span><br><span class=\"line\">            SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxSharedCapacityFactor&quot;</span>,</span><br><span class=\"line\">                    <span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    MAX_DELAYED_QUEUES_PER_THREAD = max(<span class=\"number\">0</span>,</span><br><span class=\"line\">            SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxDelayedQueuesPerThread&quot;</span>,</span><br><span class=\"line\">                    <span class=\"comment\">// We use the same value as default EventLoop number</span></span><br><span class=\"line\">                    NettyRuntime.availableProcessors() * <span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    LINK_CAPACITY = safeFindNextPositivePowerOfTwo(</span><br><span class=\"line\">            max(SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.linkCapacity&quot;</span>, <span class=\"number\">16</span>), <span class=\"number\">16</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>MAX_SHARED_CAPACITY_FACTOR</code> :  Stack2JVM <code>-D io.netty.recycler.maxSharedCapacityFactor</code>  <code>max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)</code> 2048 LINK_CAPACITY  16</li>\n<li><code>MAX_DELAYED_QUEUES_PER_THREAD</code> : CPU * 2JVM <code>-D io.netty.recycler.maxDelayedQueuesPerThread</code> <strong></strong></li>\n<li><code>LINK_CAPACITY </code>:   Stack  WeakOrderQueue WeakOrderQueueLinkLink16JVM <code>-D io.netty.recycler.linkCapacity</code> </li>\n</ul>\n<p></p>\n<p><img src=\"/assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp\" alt=\"image.png\"></p>\n<h3 id=\"7-4-\">7.4 </h3>\n<p></p>\n<p>Netty</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//81/88</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> RATIO;</span><br><span class=\"line\"><span class=\"comment\">//8 1/8</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> DELAYED_QUEUE_RATIO;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    RATIO = max(<span class=\"number\">0</span>, SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.ratio&quot;</span>, <span class=\"number\">8</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    DELAYED_QUEUE_RATIO = max(<span class=\"number\">0</span>, SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.delayedQueue.ratio&quot;</span>, RATIO));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Recycler </p>\n<ul>\n<li> RATIO 8JVM <code>-D io.netty.recycler.ratio</code>  1 / 8  8  1</li>\n<li>StackStackWeakOrderQueueWeakOrderQueue<strong></strong>Stack DELAYED_QUEUE_RATIO 8JVM <code>-D io.netty.recycler.delayedQueue.ratio</code>  8  1 </li>\n</ul>\n<h2 id=\"8-Recycler\">8. Recycler</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RecyclerObjectPool</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//recycler</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Recycler&lt;T&gt; recycler;</span><br><span class=\"line\"></span><br><span class=\"line\">    RecyclerObjectPool(<span class=\"keyword\">final</span> ObjectCreator&lt;T&gt; creator) &#123;</span><br><span class=\"line\">         recycler = <span class=\"keyword\">new</span> <span class=\"title class_\">Recycler</span>&lt;T&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">protected</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> creator.newObject(handle);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ..............................</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>Netty  Recycler Recycler newObject </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(DEFAULT_MAX_CAPACITY_PER_THREAD);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(maxCapacityPerThread, MAX_SHARED_CAPACITY_FACTOR);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread, <span class=\"type\">int</span> maxSharedCapacityFactor)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread, <span class=\"type\">int</span> maxSharedCapacityFactor,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"type\">int</span> ratio, <span class=\"type\">int</span> maxDelayedQueuesPerThread)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(maxCapacityPerThread, maxSharedCapacityFactor, ratio, maxDelayedQueuesPerThread,</span><br><span class=\"line\">                DELAYED_QUEUE_RATIO);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxCapacityPerThread;</span><br><span class=\"line\">    <span class=\"comment\">//()</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxSharedCapacityFactor;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> interval;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueuesPerThread;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> delayedQueueInterval;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread, <span class=\"type\">int</span> maxSharedCapacityFactor,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"type\">int</span> ratio, <span class=\"type\">int</span> maxDelayedQueuesPerThread, <span class=\"type\">int</span> delayedQueueRatio)</span> &#123;</span><br><span class=\"line\">        interval = max(<span class=\"number\">0</span>, ratio);</span><br><span class=\"line\">        delayedQueueInterval = max(<span class=\"number\">0</span>, delayedQueueRatio);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxCapacityPerThread &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxCapacityPerThread = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxSharedCapacityFactor = <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxDelayedQueuesPerThread = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxCapacityPerThread = maxCapacityPerThread;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxSharedCapacityFactor = max(<span class=\"number\">1</span>, maxSharedCapacityFactor);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxDelayedQueuesPerThread = max(<span class=\"number\">0</span>, maxDelayedQueuesPerThread);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RecyclerRecycler</p>\n<h2 id=\"9-\">9. </h2>\n<p><img src=\"/assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp\" alt=\"image.png\"></p>\n<p>NettyNetty TLAB StackStackRecyclerStakc</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//threadlocal stack</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;Stack&lt;T&gt;&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;Stack&lt;T&gt;&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Stack&lt;T&gt; <span class=\"title function_\">initialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;T&gt;(Recycler.<span class=\"built_in\">this</span>, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,</span><br><span class=\"line\">                interval, maxDelayedQueuesPerThread, delayedQueueInterval);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    ........................</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> FastThreadLocal  threadLocal Stack</p>\n<blockquote>\n<p>FastThreadLocalNettyJDKThreadLocalFastThreadLocalJDKThreadLocal</p>\n</blockquote>\n<p>Stack</p>\n<h3 id=\"9-1-Stack\">9.1 Stack</h3>\n<p>Stack5.2 StackStackWeakOrderQueueHeadPrevCursor</p>\n<p>StackStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// stackrecycler</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> Recycler&lt;T&gt; parent;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//stack defaultHandler -&gt; stack -&gt; thread</span></span><br><span class=\"line\">        <span class=\"comment\">// thread</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> WeakReference&lt;Thread&gt; threadRef;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> AtomicInteger availableSharedCapacity;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//Stack</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueues;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//stack 4096</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxCapacity;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> interval;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> delayedQueueInterval;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Stack 2564096</span></span><br><span class=\"line\">        DefaultHandle&lt;?&gt;[] elements;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  interval </span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> handleRecycleCount;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"comment\">//StackWeakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> WeakOrderQueue cursor, prev;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> WeakOrderQueue head;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp\" alt=\"image.png\"></p>\n<ul>\n<li><code>Recycler&lt;T&gt; parent</code>StackRecyclerStackStackparentRecycler stack1 , stack2 , stack3 , stack4 parentRecycler</li>\n<li><code>WeakReference&lt;Thread&gt; threadRef </code>Stack<code> -&gt; DefaultHandler -&gt; stack -&gt; threadRef</code>StackGC</li>\n<li><code>AtomicInteger availableSharedCapacity</code>thread2 , thread3 , thread4  thread1 availableSharedCapacity <strong></strong>1 LINK_CAPACITY(WeakOrderQueueLink)stack <code>max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)</code></li>\n</ul>\n<blockquote>\n<p>StackWeakOrderQueueavailableSharedCapacity </p>\n</blockquote>\n<ul>\n<li><code>int maxDelayedQueues</code>  CPU * 2 thread2  thread1  thread3 , thread4 maxDelayedQueues  3 </li>\n<li><code>int maxCapacity</code>Stack4096</li>\n<li><code>int interval</code>8</li>\n<li><code>int delayedQueueInterval</code>8</li>\n<li><code>DefaultHandle&lt;?&gt;[] elements</code>Stack</li>\n<li><code>int size</code></li>\n<li><code>int handleRecycleCount</code> interval  0  +1 <code>handleRecycleCount == interval</code>81 Stack </li>\n<li><code>WeakOrderQueue cursor, prevhead</code>Stack<strong></strong> WeakOrderQueue </li>\n</ul>\n<p>StackRecyclerStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;Stack&lt;T&gt;&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;Stack&lt;T&gt;&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Stack&lt;T&gt; <span class=\"title function_\">initialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;T&gt;(Recycler.<span class=\"built_in\">this</span>, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,</span><br><span class=\"line\">                interval, maxDelayedQueuesPerThread, delayedQueueInterval);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ..........................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stack(Recycler&lt;T&gt; parent, Thread thread, <span class=\"type\">int</span> maxCapacity, <span class=\"type\">int</span> maxSharedCapacityFactor,</span><br><span class=\"line\">       <span class=\"type\">int</span> interval, <span class=\"type\">int</span> maxDelayedQueues, <span class=\"type\">int</span> delayedQueueInterval) &#123;</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.parent = parent;</span><br><span class=\"line\">     threadRef = <span class=\"keyword\">new</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt;(thread);</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.maxCapacity = maxCapacity;</span><br><span class=\"line\">     availableSharedCapacity = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY));</span><br><span class=\"line\">     elements = <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultHandle</span>[min(INITIAL_CAPACITY, maxCapacity)];</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.interval = interval;</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.delayedQueueInterval = delayedQueueInterval;</span><br><span class=\"line\">     handleRecycleCount = interval; </span><br><span class=\"line\">     <span class=\"built_in\">this</span>.maxDelayedQueues = maxDelayedQueues;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-2-\">9.2 </h3>\n<p><img src=\"/assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\">      <span class=\"comment\">//Handler,</span></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Handle</span> <span class=\"variable\">NOOP_HANDLE</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Handle</span>() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(Object object)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// NOOP</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxCapacityPerThread == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> newObject((Handle&lt;T&gt;) NOOP_HANDLE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// stack</span></span><br><span class=\"line\">        Stack&lt;T&gt; stack = threadLocal.get();</span><br><span class=\"line\">        <span class=\"comment\">//stackpophandler</span></span><br><span class=\"line\">        DefaultHandle&lt;T&gt; handle = stack.pop();</span><br><span class=\"line\">        <span class=\"comment\">//stack </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (handle == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//handlerrecycleIdlastRecyclerId0</span></span><br><span class=\"line\">            handle = stack.newHandle();</span><br><span class=\"line\">            <span class=\"comment\">//newObjectrecycler </span></span><br><span class=\"line\">            handle.value = newObject(handle);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (T) handle.value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RecyclerStack</p>\n<ol>\n<li><code>maxCapacityPerThread == 0</code>Handler</li>\n<li>threadLocalStackStackDefaultHandler</li>\n<li>DefaultHandlerStackDefaultHandlerDefaultHandlerDefaultHandlerDefaultHandler</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER = ObjectPool.newPool(<span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;Entry&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> Entry <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Entry</span>(handle);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"title function_\">Entry</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.handle = handle;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-3-DefaultHandler\">9.3 DefaultHandler</h3>\n<p> Handler</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(T self)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Recycler DefaultHandler DefaultHandler </p>\n<p>StackDefaultHandlerStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       DefaultHandle&lt;T&gt; <span class=\"title function_\">newHandle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt;(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> DefaultHandler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">     <span class=\"comment\">//0</span></span><br><span class=\"line\">     <span class=\"type\">int</span> lastRecycledId;</span><br><span class=\"line\">     <span class=\"comment\">//0</span></span><br><span class=\"line\">     <span class=\"type\">int</span> recycleId;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//</span></span><br><span class=\"line\">     <span class=\"type\">boolean</span> hasBeenRecycled;</span><br><span class=\"line\">     <span class=\"comment\">//handlerstack</span></span><br><span class=\"line\">     Stack&lt;?&gt; stack;</span><br><span class=\"line\">     <span class=\"comment\">//</span></span><br><span class=\"line\">     Object value;</span><br><span class=\"line\"></span><br><span class=\"line\">     DefaultHandle(Stack&lt;?&gt; stack) &#123;</span><br><span class=\"line\">         <span class=\"built_in\">this</span>.stack = stack;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"meta\">@Override</span></span><br><span class=\"line\">     <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(Object object)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       ................................</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandler</p>\n<ul>\n<li><code>int lastRecycledId</code>0</li>\n<li><code>int recycleId</code>0</li>\n<li><code>boolean hasBeenRecycled</code>Stack</li>\n</ul>\n<p><strong></strong></p>\n<p></p>\n<ul>\n<li><code></code>Stack<code>recycleId = lastRecycledId = OWN_THREAD_ID</code></li>\n<li><code></code><strong></strong>StackWeakOrderQueue<code>recycleId = 0lastRecycledId = IdWeakOrderQueue#id</code>WeakOrderQueueStack<code>recycleId = lastRecycledId = IdWeakOrderQueue#id</code></li>\n</ul>\n<p> lastRecycledId recycleId </p>\n<p> Object value  Stack&lt;?&gt; stack HandlerStack</p>\n<p>StackStack<code></code><code> -&gt; DefaultHandler -&gt; Stack -&gt; threadRef</code></p>\n<p><img src=\"/assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//EntryDefaultHandler</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span>  Handle&lt;Entry&gt; handle;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// DefaultHandlerStack</span></span><br><span class=\"line\">    Stack&lt;?&gt; stack;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Stack</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> WeakReference&lt;Thread&gt; threadRef;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-4-Stack\">9.4 Stack</h3>\n<p><img src=\"/assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DefaultHandle&lt;T&gt; <span class=\"title function_\">pop</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.size;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//stackstackweakOrderQueuestack</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!scavenge()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        size = <span class=\"built_in\">this</span>.size;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// WeakOrderQueue</span></span><br><span class=\"line\">            <span class=\"comment\">// null </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    size --;</span><br><span class=\"line\">    <span class=\"type\">DefaultHandle</span> <span class=\"variable\">ret</span> <span class=\"operator\">=</span> elements[size];</span><br><span class=\"line\">    elements[size] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.size = size;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ret.lastRecycledId != ret.recycleId) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled multiple times&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//   recycleId = lastRecycleId = 0</span></span><br><span class=\"line\">    ret.recycleId = <span class=\"number\">0</span>;</span><br><span class=\"line\">    ret.lastRecycledId = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Stack</p>\n<ul>\n<li> size == 0  scavenge StackWeakOrderQueueLinkWeakOrderQueueStack null </li>\n<li> DefaultHandler DefaultHandler<code>recycleId  = lastRecycledId = 0</code></li>\n</ul>\n<p>recycleId  lastRecycledId </p>\n<ul>\n<li><code>recycleId  = lastRecycledId = 0</code></li>\n<li><code>recycleId  = lastRecycledId != 0</code>Stack</li>\n<li><code>recycleId  != lastRecycledId</code>WeakOrderQueueStack</li>\n</ul>\n<h3 id=\"9-4-Stack\">9.4 Stack</h3>\n<p><img src=\"/assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp\" alt=\"image.png\"></p>\n<p>Stack</p>\n<ul>\n<li>Stack</li>\n<li>StackWeakOrderQueueWeakOrderQueue</li>\n</ul>\n<p>StackWeakOrderQueueWeakOrderQueue<strong></strong></p>\n<p> scavenge </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">scavenge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">//weakOrderQueue   stack</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (scavengeSome()) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">// weakOrderQueuestackcursor.prev</span></span><br><span class=\"line\">     <span class=\"comment\">// weakOrderQueuecursor</span></span><br><span class=\"line\">     prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">     cursor = head;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>scavengeSome() WeakOrderQueue true WeakOrderQueuecursorheadprevnullWeakOrderQueuecursor</p>\n<h3 id=\"9-5-\">9.5 </h3>\n<p>StackWeakOrderQueue</p>\n<p>WeakOrderQueueStackWeakOrderQueue</p>\n<p><img src=\"/assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp\" alt=\"image.png\"></p>\n<p>StackWeakOrderQueue prev = head = cursor = null </p>\n<p>WeakOrderQueue<strong>WeakOrderQueue</strong></p>\n<blockquote>\n<p>WeakOrderQueue</p>\n</blockquote>\n<p>headcursorcursorprevcursorprev</p>\n<p>WeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">scavengeSome</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    WeakOrderQueue prev;</span><br><span class=\"line\">    <span class=\"comment\">//stack weakOrderQueue</span></span><br><span class=\"line\">    <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">cursor</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.cursor;</span><br><span class=\"line\">    <span class=\"comment\">//stackcursorprev,headnullcursor == null stackweakOrderQueue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cursor == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        cursor = head;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cursor == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//prevcursor</span></span><br><span class=\"line\">        prev = <span class=\"built_in\">this</span>.prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueue </span></span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//weakOrderQueuestacklink</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cursor.transfer(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">            success = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//cursorweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">next</span> <span class=\"operator\">=</span> cursor.getNext();</span><br><span class=\"line\">        <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cursor.get() == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cursor.hasFinalData()) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//weakOrderQueueweakOrderQueue</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (cursor.transfer(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">                        success = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//weaoOrderQueueunlinkcursor</span></span><br><span class=\"line\">            <span class=\"comment\">//netty</span></span><br><span class=\"line\">            <span class=\"comment\">// prev == null cursorunlink </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (prev != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//weakOrderQueueGC</span></span><br><span class=\"line\">                cursor.reclaimAllSpaceAndUnlink();</span><br><span class=\"line\">                <span class=\"comment\">//prevcursor</span></span><br><span class=\"line\">                prev.setNext(next);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            prev = cursor;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//prev,cursorweakOrderQueue</span></span><br><span class=\"line\">        cursor = next;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (cursor != <span class=\"literal\">null</span> &amp;&amp; !success);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.prev = prev;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.cursor = cursor;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> success;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>WeakOrderQueuecursorStackWeakOrderQueuecursorheadheadWeakOrderQueueheadheadWeakOrderQueue</li>\n<li>cursorWeakOrderQueueStackLinkWeakOrderQueueWeakOrderQueue</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (cursor.transfer(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">    success = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">next</span> <span class=\"operator\">=</span> cursor.getNext();</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>WeakOrderQueueWeakOrderQueue<code></code>,GC<code>cursor.get() == null</code>WeakOrderQueueStack<strong>Link</strong>WeakOrderQueue</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    ............WeakOrderQueue.........</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>WeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC<code>cursor.reclaimAllSpaceAndUnlink()</code>availableSharedCapacityWeakOrderQueue</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (prev != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      cursor.reclaimAllSpaceAndUnlink();</span><br><span class=\"line\">      <span class=\"comment\">//prevcursor</span></span><br><span class=\"line\">      prev.setNext(next);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>NettyWeakOrderQueue<code>prev == null</code>Netty</p>\n</blockquote>\n<p>WeakOrderQueuecursor</p>\n<p></p>\n<p><strong></strong></p>\n<p><img src=\"/assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp\" alt=\"image.png\"></p>\n<p>WeakOrderQueueStackWeakOrderQueue<strong></strong></p>\n<p> thread4 <strong></strong>cursorthread3thread3</p>\n<p> thread5 thread5WeakOrderQueuecursor<code>thread4</code><code>cursor.get() == null</code><code>thread4</code></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p><strong>WeakOrderQueue</strong></p>\n<p>WeakOrderQueueWeakOrderQueueStackWeakOrderQueue</p>\n<p>StackWeakOrderQueue</p>\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//recycler</span></span><br><span class=\"line\"><span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setHead</span><span class=\"params\">(WeakOrderQueue queue)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">    queue.setNext(head);</span><br><span class=\"line\">    head = queue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Recycler</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"10-WeakOrderQueue\">10. WeakOrderQueue</h2>\n<p><img src=\"/assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp\" alt=\"image.png\"></p>\n<p>WeakOrderQueueQueueLinkHeadLinkLinkheadLinkTail<code>Link</code></p>\n<h3 id=\"10-1-Link\">10.1 Link</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// linkAtomicInteger writeindex</span></span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Link</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AtomicInteger</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//16</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> DefaultHandle&lt;?&gt;[] elements = <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultHandle</span>[LINK_CAPACITY];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">int</span> readIndex;</span><br><span class=\"line\">            <span class=\"comment\">//weakOrderQueuelink</span></span><br><span class=\"line\">            Link next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueue <code>WeakReference &lt; Thread &gt;</code> , <code></code>WeakOrderQueueGC</p>\n<ul>\n<li><code>DefaultHandle&lt;?&gt;[] elements </code>: LinkLINK_CAPACITY 16DefaultHandle</li>\n<li><code>int readIndex</code>LinkreadIndexreadIndexint</li>\n<li><code>writeIndex</code>LinkAtomicIntegerLinkwriteIndexLinkwriteIndexLinkwriteIndexwriteIndexAtomicInteger</li>\n<li><code>Link next</code>Linknext</li>\n</ul>\n<h3 id=\"10-2-Head\">10.2 Head</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// weakOrderQueuelink</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Head</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// reserveSpaceForLink</span></span><br><span class=\"line\">    <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicInteger availableSharedCapacity;</span><br><span class=\"line\">    <span class=\"comment\">//link</span></span><br><span class=\"line\">    Link link;</span><br><span class=\"line\"></span><br><span class=\"line\">    Head(AtomicInteger availableSharedCapacity) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.availableSharedCapacity = availableSharedCapacity;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">reclaimAllSpaceAndUnlink</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            ....headheadhead....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reclaimSpace</span><span class=\"params\">(<span class=\"type\">int</span> space)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">        availableSharedCapacity.addAndGet(space);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//linkheadhead</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">relink</span><span class=\"params\">(Link link)</span> &#123;</span><br><span class=\"line\">          ...headLink...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    Link <span class=\"title function_\">newLink</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">          ....Link...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//link</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserveSpaceForLink</span><span class=\"params\">(AtomicInteger availableSharedCapacity)</span> &#123;             </span><br><span class=\"line\">          ...Link...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Head</p>\n<ul>\n<li><code>AtomicInteger availableSharedCapacity</code>LinkLINK_CAPACITY LinkLINK_CAPACITY </li>\n<li><code>Link link</code>HeadLink</li>\n</ul>\n<p>Head</p>\n<h3 id=\"10-3-WeakOrderQueue\">10.3 WeakOrderQueue</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//linkheadLinK</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Head head;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> Link tail;</span><br><span class=\"line\">        <span class=\"comment\">//stackstackweakOrderQueuestackweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"comment\">//stackweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> WeakOrderQueue next;</span><br><span class=\"line\">        <span class=\"comment\">//Id,weakOrderQueuestackweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">id</span> <span class=\"operator\">=</span> ID_GENERATOR.getAndIncrement();</span><br><span class=\"line\">        <span class=\"comment\">// 8</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> interval;</span><br><span class=\"line\">        <span class=\"comment\">// 1/8</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> handleRecycleCount;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>Head head</code>WeakOrderQueueLink</li>\n<li><code>Link tail</code>Link</li>\n<li><code>WeakOrderQueue next</code>StackStackWeakOrderQueueWeakOrderQueuenextWeakOrderQueue</li>\n<li><code>int id </code>IdStackId</li>\n<li><code>int interval</code> 1 / 8 </li>\n<li><code>int handleRecycleCount</code></li>\n</ul>\n<h3 id=\"10-4-WeakOrderQueue\">10.4 WeakOrderQueue</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//stackGC,stack</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"title function_\">WeakOrderQueue</span><span class=\"params\">(Stack&lt;?&gt; stack, Thread thread)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>(thread);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            tail = <span class=\"keyword\">new</span> <span class=\"title class_\">Link</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor</span></span><br><span class=\"line\">            head = <span class=\"keyword\">new</span> <span class=\"title class_\">Head</span>(stack.availableSharedCapacity);</span><br><span class=\"line\">            head.link = tail;</span><br><span class=\"line\">            interval = stack.delayedQueueInterval;</span><br><span class=\"line\">            handleRecycleCount = interval; </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueue <code>WeakReference&lt;Thread&gt;</code> </p>\n<p>Linkheadtail</p>\n<p>StackWeakOrderQueue</p>\n<p>StackWeakOrderQueue<strong>WeakOrderQueueStack</strong></p>\n<p>WeakOrderQueueWeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC</p>\n<p><strong>StackWeakOrderQueueStackStackGC</strong></p>\n<p>StackWeakOrderQueueWeakOrderQueueStack</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"10-5-WeakOrderQueue\">10.5 WeakOrderQueue</h3>\n<p>WeakOrderQueuetransferWeakOrderQueueStack</p>\n<p>WeakOrderQueueLinkStackLINK_CAPACITYStacktransfertrue</p>\n<p>headLinkLink<strong>Link</strong>Linktransferfalse</p>\n<p>transfer</p>\n<p><img src=\"/assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp\" alt=\"image.png\"></p>\n<h4 id=\"10-5-1-\">10.5.1 </h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//weakOrderQueuelink</span></span><br><span class=\"line\"><span class=\"type\">Link</span> <span class=\"variable\">head</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.head.link;</span><br><span class=\"line\"><span class=\"comment\">//null</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (head == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (head.readIndex == LINK_CAPACITY) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//Link</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (head.next == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//link</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    head = head.next;</span><br><span class=\"line\">    <span class=\"comment\">//HeadheadheadLinK</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.head.relink(head);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Link<code>head == null</code> Linkfalse</p>\n<p><code>head.readIndex == LINK_CAPACITY</code> head relink Linkfalse</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Head</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//linkheadhead</span></span><br><span class=\"line\">            <span class=\"keyword\">void</span> <span class=\"title function_\">relink</span><span class=\"params\">(Link link)</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//availableSharedCapacitylinkavailableSharedCapacity</span></span><br><span class=\"line\">                reclaimSpace(LINK_CAPACITY);</span><br><span class=\"line\">                <span class=\"comment\">//headlink</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.link = link;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reclaimSpace</span><span class=\"params\">(<span class=\"type\">int</span> space)</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">                availableSharedCapacity.addAndGet(space);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"10-5-2-Stack\">10.5.2 Stack</h4>\n<p>HeadStackStackStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">srcStart</span> <span class=\"operator\">=</span> head.readIndex;</span><br><span class=\"line\"><span class=\"comment\">//writeIndex</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">srcEnd</span> <span class=\"operator\">=</span> head.get();</span><br><span class=\"line\"><span class=\"comment\">//link</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">srcSize</span> <span class=\"operator\">=</span> srcEnd - srcStart;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (srcSize == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// stack</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">dstSize</span> <span class=\"operator\">=</span> dst.size;</span><br><span class=\"line\"><span class=\"comment\">// weakOrderQueuestackstack = stack + </span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">expectedCapacity</span> <span class=\"operator\">=</span> dstSize + srcSize;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (expectedCapacity &gt; dst.elements.length) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//stackstack stack</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">actualCapacity</span> <span class=\"operator\">=</span> dst.increaseCapacity(expectedCapacity);</span><br><span class=\"line\">    <span class=\"comment\">//Link</span></span><br><span class=\"line\">    <span class=\"comment\">//actualCapacity - dstSizestack</span></span><br><span class=\"line\">    srcEnd = min(srcStart + actualCapacity - dstSize, srcEnd);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>LinkreadIndexwriteIndex  <code>writeIndex - readIndex</code> </p>\n<p>Stack <code>expectedCapacity = stack + </code></p>\n<p>Stack expectedCapacity StackStack <code>min(srcStart + actualCapacity - dstSize, srcEnd)</code> Stack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"title function_\">increaseCapacity</span><span class=\"params\">(<span class=\"type\">int</span> expectedCapacity)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">newCapacity</span> <span class=\"operator\">=</span> elements.length;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">maxCapacity</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.maxCapacity;</span><br><span class=\"line\">            <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                newCapacity &lt;&lt;= <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">while</span> (newCapacity &lt; expectedCapacity &amp;&amp; newCapacity &lt; maxCapacity);</span><br><span class=\"line\">            <span class=\"comment\">//expectedCapacity2</span></span><br><span class=\"line\">            newCapacity = min(newCapacity, maxCapacity);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newCapacity != elements.length) &#123;</span><br><span class=\"line\">                elements = Arrays.copyOf(elements, newCapacity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> newCapacity;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Stack<code>actualCapacity - dstSize = 0</code><code>false</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (srcStart != srcEnd) &#123;</span><br><span class=\"line\">   ............</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// The destination stack is full already.</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>Stack</strong></p>\n<h4 id=\"10-5-3-\">10.5.3 </h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Link</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> DefaultHandle[] srcElems = head.elements;</span><br><span class=\"line\"><span class=\"comment\">//stack</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> DefaultHandle[] dstElems = dst.elements;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">newDstSize</span> <span class=\"operator\">=</span> dstSize;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> srcStart; i &lt; srcEnd; i++) &#123;</span><br><span class=\"line\">    DefaultHandle&lt;?&gt; element = srcElems[i];</span><br><span class=\"line\">    <span class=\"comment\">//recycleId == 0 stack</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (element.recycleId == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//recycleId weakOrderQueue</span></span><br><span class=\"line\">        element.recycleId = element.lastRecycledId;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element.recycleId != element.lastRecycledId) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//    </span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled already&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//Link</span></span><br><span class=\"line\">    srcElems[i] = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueuestack </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dst.dropHandle(element)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Drop the object.</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//defaultHandlerstack(handlerstack)</span></span><br><span class=\"line\">    <span class=\"comment\">//defaultHandlerstacknullstackGC</span></span><br><span class=\"line\">    element.stack = dst;</span><br><span class=\"line\">    <span class=\"comment\">//handlerstack</span></span><br><span class=\"line\">    dstElems[newDstSize ++] = element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>LinkelementsStackelements <code>srcStart  -&gt;  srcEnd </code></p>\n<p> <code>element.recycleId == 0</code> Stack9.3 Stack</p>\n<ul>\n<li><code>recycleId = lastRecycledId = 0</code></li>\n</ul>\n<p>Id <code>element.recycleId = element.lastRecycledId</code>lastRecycledIdWeakOrderQueueId</p>\n<p><code>element.recycleId != element.lastRecycledId</code> </p>\n<p>Stack</p>\n<h4 id=\"10-5-4-\">10.5.4 </h4>\n<p> 1 / 8  8  1 </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">dropHandle</span><span class=\"params\">(DefaultHandle&lt;?&gt; handle)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!handle.hasBeenRecycled) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//handleRecycleCount 8 </span></span><br><span class=\"line\">        <span class=\"comment\">//interval 8</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (handleRecycleCount &lt; interval) &#123;</span><br><span class=\"line\">            handleRecycleCount++;</span><br><span class=\"line\">            <span class=\"comment\">// Drop the object.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        handleRecycleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">//defaultHandlertrue</span></span><br><span class=\"line\">        handle.hasBeenRecycled = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandlerStackStackWeakOrderQueueDefaultHandlerStacknull</p>\n<blockquote>\n<p>Stacknull</p>\n</blockquote>\n<p>Stack</p>\n<p>LinkreadIndexStackLinkHead</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (srcEnd == LINK_CAPACITY &amp;&amp; head.next != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">       <span class=\"comment\">// Add capacity back as the Link is GCed.</span></span><br><span class=\"line\">       <span class=\"comment\">// Linklinkhead</span></span><br><span class=\"line\">       <span class=\"built_in\">this</span>.head.relink(head.next);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//LinkreadIndex</span></span><br><span class=\"line\">   head.readIndex = srcEnd;</span><br><span class=\"line\">   <span class=\"comment\">// return false</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (dst.size == newDstSize) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   dst.size = newDstSize;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n<p>Recycler</p>\n<h2 id=\"11-\">11. </h2>\n<p>DefaultHandlerrecycle</p>\n<p><img src=\"/assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">private</span>  Handle&lt;Entry&gt; handle;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            bufs = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            buf = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            msg = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            promise = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            progress = <span class=\"number\">0</span>;</span><br><span class=\"line\">            total = <span class=\"number\">0</span>;</span><br><span class=\"line\">            pendingSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">            count = -<span class=\"number\">1</span>;</span><br><span class=\"line\">            cancelled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            handle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">        ..............................</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//handlerstack</span></span><br><span class=\"line\">        Stack&lt;?&gt; stack;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Object value;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(Object object)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (object != value) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;object does not belong to handle&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            Stack&lt;?&gt; stack = <span class=\"built_in\">this</span>.stack;</span><br><span class=\"line\">            <span class=\"comment\">//handler  recycleId = lastRecycledId = 0</span></span><br><span class=\"line\">            <span class=\"comment\">//recycleId = lastRecycledId = OWN_THREAD_ID</span></span><br><span class=\"line\">            <span class=\"comment\">//lastRecycledId = Id,stack recycleId = lastRecycledId = Id</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (lastRecycledId != recycleId || stack == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled already&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            stack.push(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandler recycle  if </p>\n<ul>\n<li><code>lastRecycledId != recycleId</code>  WeakOrderQueue Stack<strong></strong></li>\n</ul>\n<blockquote>\n<p>9.3 Stack recycleId  lastRecycledId </p>\n</blockquote>\n<ul>\n<li><code>stack == null</code> StackGC</li>\n</ul>\n<h3 id=\"11-1-StackBug\">11.1 StackBug!</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> WeakReference&lt;Thread&gt; threadRef;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">push</span><span class=\"params\">(DefaultHandle&lt;?&gt; item)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">currentThread</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">            <span class=\"comment\">//  weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"comment\">//stack</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (threadRef.get() == currentThread) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//  stack</span></span><br><span class=\"line\">                pushNow(item);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// stackweakOrderQueuecurrentThread</span></span><br><span class=\"line\">                pushLater(item, currentThread);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandlerStackStack</p>\n<blockquote>\n<p> ifelseBug</p>\n</blockquote>\n<p><code>threadRef.get() == currentThread)</code> pushNow(item) </p>\n<p> <code>threadRef.get() != currentThread)</code> </p>\n<ol>\n<li>currentThread <code>pushLater(item, currentThread)</code> WeakOrderQueue</li>\n<li>Bug <code>threadRef.get()  == null</code>  else GC<strong></strong>StackGC<strong>Stack</strong>NettyStackWeakOrderQueueWeakOrderQueue</li>\n</ol>\n<p>Bug</p>\n<p><img src=\"/assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp\" alt=\"image.png\"></p>\n<p><strong>Netty</strong></p>\n<p></p>\n<p><img src=\"/assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp\" alt=\"image.png\"></p>\n<p>DefaultHandlerDefaultHandlerStack</p>\n<p><img src=\"/assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp\" alt=\"image.png\"></p>\n<p>GCStackStackStackGC</p>\n<h2 id=\"11-2-PRBug\">11.2 PRBug!</h2>\n<p>Bug</p>\n<p>Netty Issue11864 </p>\n<blockquote>\n<p>Issue11864 : <a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fissues%2F11864\" title=\"https://github.com/netty/netty/issues/11864\">github.com/netty/netty</a></p>\n</blockquote>\n<p> PR11865 Bug</p>\n<blockquote>\n<p>PR : <a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fpull%2F11865\" title=\"https://github.com/netty/netty/pull/11865\">github.com/netty/netty</a></p>\n</blockquote>\n<p>PR</p>\n<ol>\n<li> <code>threadRef.get()  == null</code>  return </li>\n<li>Stack <code>item.stack = null</code>StackGC</li>\n</ol>\n<p>PR <code>threadRef.get()  == null</code> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">push</span><span class=\"params\">(DefaultHandle&lt;?&gt; item)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Thread</span> <span class=\"variable\">currentThread</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (threadRef.get() == currentThread) &#123;</span><br><span class=\"line\">        pushNow(item);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (threadRef.get() == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// when the thread that belonged to the Stack was died or GC&#x27;ed</span></span><br><span class=\"line\">        <span class=\"comment\">// There is no need to add this item to WeakOrderQueue-linked-list which belonged to the Stack any more</span></span><br><span class=\"line\">        item.stack = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        pushLater(item, currentThread);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"11-3-PR\">11.3 PR</h2>\n<p> PR11865</p>\n<p><img src=\"/assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp\" alt=\"image.png\"></p>\n<p>NettyNetty Recycler RecyclerRecycler<strong></strong><strong>GC</strong>Netty</p>\n<p>commit</p>\n<blockquote>\n<p>commit<a href=\"https://github.com/netty/netty/commit/28b9834612638ffec4948c0c650d04f766f20690\">github.com/netty/netty</a></p>\n</blockquote>\n<p>Recycler<strong>4.1.71.Final</strong>Recycler<strong>4.1.71.Final</strong></p>\n<p><strong>4.1.71.Final</strong>   Issue11864 : <a href=\"https://github.com/netty/netty/issues/11864\">github.com/netty/netty</a> <strong>4.1.71.Final</strong></p>\n<p> chrisvest   PR11996  <strong>4.1.74.Final</strong> Issue11864</p>\n<blockquote>\n<p>PR11996 <a href=\"https://github.com/netty/netty/pull/11996\">github.com/netty/netty</a></p>\n</blockquote>\n<blockquote>\n<p> chrisvest  Neo4j commitorNetty BufferAPI</p>\n</blockquote>\n<p>Bug <strong>4.1.74.Final</strong> </p>\n<ol>\n<li> chrisvest   threadLocal onRemovalLocalPoolpooledHandles  nullLocalPool</li>\n</ol>\n<blockquote>\n<p> LocalPool StackLocalPoolpooledHandlesStack</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;LocalPool&lt;T&gt;&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;LocalPool&lt;T&gt;&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> LocalPool&lt;T&gt; <span class=\"title function_\">initialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LocalPool</span>&lt;T&gt;(maxCapacityPerThread, interval, chunkSize);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onRemoval</span><span class=\"params\">(LocalPool&lt;T&gt; value)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"comment\">//LocalPool</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>.onRemoval(value);</span><br><span class=\"line\">            MessagePassingQueue&lt;DefaultHandle&lt;T&gt;&gt; handles = value.pooledHandles;</span><br><span class=\"line\">            <span class=\"comment\">//pooledHandles  null</span></span><br><span class=\"line\">            value.pooledHandles = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"comment\">//LocalPool</span></span><br><span class=\"line\">            handles.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>LocalPoolpooledHandles</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LocalPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> MessagePassingQueue&lt;DefaultHandle&lt;T&gt;&gt; pooledHandles;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">void</span> <span class=\"title function_\">release</span><span class=\"params\">(DefaultHandle&lt;T&gt; handle)</span> &#123;</span><br><span class=\"line\">            MessagePassingQueue&lt;DefaultHandle&lt;T&gt;&gt; handles = pooledHandles;</span><br><span class=\"line\">            handle.toAvailable();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (handles != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                handles.relaxedOffer(handle);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  GC LocalPoolStackLocalPool</p>\n<p>Bug</p>\n<h3 id=\"11-4-\">11.4 </h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">pushNow</span><span class=\"params\">(DefaultHandle&lt;?&gt; item)</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">// recycleId = lastRecycleId = 0</span></span><br><span class=\"line\">     <span class=\"comment\">//0 </span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> ((item.recycleId | item.lastRecycledId) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled already&quot;</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//recycleIdlastRecycleIdId-OWN_THREAD_ID</span></span><br><span class=\"line\">     <span class=\"comment\">//OWN_THREAD_ID</span></span><br><span class=\"line\">     <span class=\"comment\">// OWN_THREAD_IDId</span></span><br><span class=\"line\">     item.recycleId = item.lastRecycledId = OWN_THREAD_ID;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.size;</span><br><span class=\"line\">     <span class=\"comment\">// </span></span><br><span class=\"line\">     <span class=\"comment\">//1/8</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (size &gt;= maxCapacity || dropHandle(item)) &#123;</span><br><span class=\"line\">         <span class=\"comment\">// Hit the maximum capacity or should drop - drop the possibly youngest object.</span></span><br><span class=\"line\">         <span class=\"comment\">//</span></span><br><span class=\"line\">         <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//stackstack</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (size == elements.length) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//</span></span><br><span class=\"line\">         elements = Arrays.copyOf(elements, min(size &lt;&lt; <span class=\"number\">1</span>, maxCapacity));</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"comment\">//stack</span></span><br><span class=\"line\">     elements[size] = item;</span><br><span class=\"line\">     <span class=\"comment\">//stack</span></span><br><span class=\"line\">     <span class=\"built_in\">this</span>.size = size + <span class=\"number\">1</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>item.recycleId | item.lastRecycledId) != 0</code>Id0</li>\n<li>Id<code>item.recycleId = item.lastRecycledId = OWN_THREAD_ID</code></li>\n<li>Stack</li>\n<li> 1 / 8  dropHandle </li>\n<li>Stackstack</li>\n<li>Stack</li>\n</ul>\n<h3 id=\"11-5-\">11.5 </h3>\n<p><img src=\"/assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp\" alt=\"image.png\"></p>\n<p>Recycler</p>\n<p> thread2 , thread3 , thread4   Stackthread1</p>\n<p>  thread2 , thread3 , thread4  thread1thread1thread1StackWeakOrderQueue thread2 , thread3 , thread4   </p>\n<p>Recycler maxDelayedQueuesPerThread </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// cpu * 2</span></span><br><span class=\"line\">      <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> MAX_DELAYED_QUEUES_PER_THREAD;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//</span></span><br><span class=\"line\">      <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueuesPerThread;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueues;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Recycler maxDelayedQueuesPerThread </p>\n<p><strong></strong></p>\n<p><img src=\"/assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp\" alt=\"image.png\"></p>\n<p> FastThreadLocal  DELAYED_RECYCLED  DELAYED_RECYCLED  WeakHashMap WeakHashMap </p>\n<p>WeakHashMap  key  Stack value StackWeakOrderQueue Recycler.png </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">//key: stack  value:  weakOrderQueue</span></span><br><span class=\"line\">    <span class=\"comment\">//value stackweakOrderQueue</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt;&gt; DELAYED_RECYCLED =</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt;&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt; initialValue() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeakHashMap</span>&lt;Stack&lt;?&gt;, WeakOrderQueue&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakHashMap sizesize maxDelayedQueuesPerThread </p>\n<p><strong>WeakHashMap</strong>?</p>\n<p>GCStackStackStackGCStackWeakHashMapEntryWeakHashMapStack</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">pushLater</span><span class=\"params\">(DefaultHandle&lt;?&gt; item, Thread thread)</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">//maxDelayQueues == 0 </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (maxDelayedQueues == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">      <span class=\"comment\">//</span></span><br><span class=\"line\">      Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt; delayedRecycled = DELAYED_RECYCLED.get();</span><br><span class=\"line\">      <span class=\"comment\">//stack    </span></span><br><span class=\"line\">      <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">queue</span> <span class=\"operator\">=</span> delayedRecycled.get(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">      <span class=\"comment\">//queue == null stack</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (queue == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//maxDelayedQueues</span></span><br><span class=\"line\">          <span class=\"comment\">//delayedRecycled.size()</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (delayedRecycled.size() &gt;= maxDelayedQueues) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">              <span class=\"comment\">//WeakOrderQueue</span></span><br><span class=\"line\">              <span class=\"comment\">//WeakOrderQueue.DUMMY  </span></span><br><span class=\"line\">              delayedRecycled.put(<span class=\"built_in\">this</span>, WeakOrderQueue.DUMMY);</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">          <span class=\"comment\">// WeakOrderQueue</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ((queue = newWeakOrderQueue(thread)) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// </span></span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">//threadLocal stack  weakOrderQueue</span></span><br><span class=\"line\">          delayedRecycled.put(<span class=\"built_in\">this</span>, queue);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (queue == WeakOrderQueue.DUMMY) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// drop object</span></span><br><span class=\"line\">          <span class=\"comment\">// queueWeakOrderQueue.DUMMY  </span></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  weakOrderQueue</span></span><br><span class=\"line\">      queue.add(item);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>Recycler <code>maxDelayedQueues == 0</code> </li>\n<li>StackWeakOrderQueue<strong></strong> maxDelayedQueues </li>\n<li> maxDelayedQueues  WeakHashMap  WeakOrderQueue DUMMY WeakOrderQueue  DUMMY </li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//DUMMY</span></span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">DUMMY</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeakOrderQueue</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li> maxDelayedQueues  <code>stack#newWeakOrderQueue</code> StackWeakOrderQueueWeakHashMapStackWeakOrderQueue</li>\n<li>StackWeakOrderQueue</li>\n</ol>\n<h3 id=\"11-6-WeakOrderQueue\">11.6  WeakOrderQueue</h3>\n<p>StackWeakOrderQueueWeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">private</span> WeakOrderQueue <span class=\"title function_\">newWeakOrderQueue</span><span class=\"params\">(Thread thread)</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> WeakOrderQueue.newQueue(<span class=\"built_in\">this</span>, thread);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">static</span> WeakOrderQueue <span class=\"title function_\">newQueue</span><span class=\"params\">(Stack&lt;?&gt; stack, Thread thread)</span> &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">            <span class=\"comment\">// linkweakOrderQueueLink</span></span><br><span class=\"line\">            <span class=\"comment\">// stackavailableSharedCapacity  LINK_CAPACITY</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!Head.reserveSpaceForLink(stack.availableSharedCapacity)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//linkweakOrderQueue</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">queue</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeakOrderQueue</span>(stack, thread);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// stackweakOrderQueueweakOrderQueue </span></span><br><span class=\"line\">            <span class=\"comment\">// stackweakOrderQueueWeakOrderQueueWeakOrderQueue.this</span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            stack.setHead(queue);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> queue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueueWeakOrderQueueLinkWeakOrderQueueLink</p>\n<p>WeakOrderQueueLinkLink</p>\n<p>availableSharedCapacity LinkLINK_CAPACITY LinkLINK_CAPACITY  availableSharedCapacity </p>\n<p>WeakOrderQueueLink<strong></strong> availableSharedCapacity LinkWeakOrderQueue</p>\n<p>availableSharedCapacityLinkWeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//link</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserveSpaceForLink</span><span class=\"params\">(AtomicInteger availableSharedCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//stackstack</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">available</span> <span class=\"operator\">=</span> availableSharedCapacity.get();</span><br><span class=\"line\">        <span class=\"comment\">//availbaleLinkstack</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (available &lt; LINK_CAPACITY) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//LinkLinkavailableSharedCapacity</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> availableSharedCapacity  LINK_CAPACITY  availableSharedCapacity </p>\n<p>WeakOrderQueueLinkWeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//stackGC,stack</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"title function_\">WeakOrderQueue</span><span class=\"params\">(Stack&lt;?&gt; stack, Thread thread)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">    <span class=\"built_in\">super</span>(thread);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    tail = <span class=\"keyword\">new</span> <span class=\"title class_\">Link</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor</span></span><br><span class=\"line\">    <span class=\"comment\">// availableSharedCapacitylink</span></span><br><span class=\"line\">    head = <span class=\"keyword\">new</span> <span class=\"title class_\">Head</span>(stack.availableSharedCapacity);</span><br><span class=\"line\">    head.link = tail;</span><br><span class=\"line\">    interval = stack.delayedQueueInterval;</span><br><span class=\"line\">    handleRecycleCount = interval; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueueStackWeakOrderQueueWeakOrderQueueStackWeakOrderQueueRecycler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setHead</span><span class=\"params\">(WeakOrderQueue queue)</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">//weakOrderQueuequeue</span></span><br><span class=\"line\">     queue.setNext(head);</span><br><span class=\"line\">     head = queue;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp\" alt=\"image.png\"></p>\n<h3 id=\"11-7-WeakOrderQueue\">11.7 WeakOrderQueue</h3>\n<p></p>\n<p>WeakOrderQueueNettyLinkLinkLink</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(DefaultHandle&lt;?&gt; handle)</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">//handlerlastRecycledIdweakOrderQueueId,stackweakOrderQueue</span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      handle.lastRecycledId = id;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  1/8</span></span><br><span class=\"line\">      <span class=\"comment\">// scavengeSomeweakOrderQueuestackNetty</span></span><br><span class=\"line\">      <span class=\"comment\">// netty weakOrderQueue</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (handleRecycleCount &lt; interval) &#123;</span><br><span class=\"line\">          handleRecycleCount++;</span><br><span class=\"line\">          <span class=\"comment\">// Drop the item to prevent recycling to aggressive.</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      handleRecycleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//link</span></span><br><span class=\"line\">      <span class=\"type\">Link</span> <span class=\"variable\">tail</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.tail;</span><br><span class=\"line\">      <span class=\"type\">int</span> writeIndex;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//linklink</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ((writeIndex = tail.get()) == LINK_CAPACITY) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//Link</span></span><br><span class=\"line\">          <span class=\"type\">Link</span> <span class=\"variable\">link</span> <span class=\"operator\">=</span> head.newLink();</span><br><span class=\"line\">          <span class=\"comment\">//availableSharedCapacityLink</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (link == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// </span></span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">// We allocate a Link so reserve the space</span></span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">          <span class=\"built_in\">this</span>.tail = tail = tail.next = link;</span><br><span class=\"line\"></span><br><span class=\"line\">          writeIndex = tail.get();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//handlerlink</span></span><br><span class=\"line\">      tail.elements[writeIndex] = handle;</span><br><span class=\"line\">      <span class=\"comment\">//stacknullstack</span></span><br><span class=\"line\">      <span class=\"comment\">//StackGChandlestackGC</span></span><br><span class=\"line\">      <span class=\"comment\">//stack</span></span><br><span class=\"line\">      handle.stack = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"comment\">//lazySetwriteIndexwriteIndex</span></span><br><span class=\"line\">      <span class=\"comment\">// Netty</span></span><br><span class=\"line\">      <span class=\"comment\">//scavengeSomeweakOrderQueueweakOrderQueue</span></span><br><span class=\"line\">      <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">      tail.lazySet(writeIndex + <span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>DefaultHandlerlastRecycledId IdDefaultHandler <code>recycleId != lastRecycledId </code></li>\n<li> 1 / 8 9.5  <code>stack#scavengeSome</code> StackWeakOrderQueue 1 / 8 <strong></strong>nettyweakOrderQueue</li>\n<li>WeakOrderQueueLinkLink <code>writeIndex = tail.get()) == LINK_CAPACITY</code> LinktailLink availableSharedCapacity Link</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Head</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">         Link <span class=\"title function_\">newLink</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">              <span class=\"comment\">//availableSharedCapacityavailableSharedCapacity</span></span><br><span class=\"line\">              <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">              <span class=\"keyword\">return</span> reserveSpaceForLink(availableSharedCapacity) ? <span class=\"keyword\">new</span> <span class=\"title class_\">Link</span>() : <span class=\"literal\">null</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//link</span></span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserveSpaceForLink</span><span class=\"params\">(AtomicInteger availableSharedCapacity)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//stackstack</span></span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">available</span> <span class=\"operator\">=</span> availableSharedCapacity.get();</span><br><span class=\"line\">                <span class=\"comment\">//availbaleLinkstack</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (available &lt; LINK_CAPACITY) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//LinkLinkavailableSharedCapacity</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Recycler<strong></strong></p>\n<p></p>\n<p><strong>handle.stacknull</strong>?</p>\n<p> <code>stack#scavengeSome</code> WeakOrderQueuestackDefaultHandlerstackstack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">transfer</span><span class=\"params\">(Stack&lt;?&gt; dst)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      ...............................</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//defaultHandlerstack(handlerstack)</span></span><br><span class=\"line\">      <span class=\"comment\">//defaultHandlerstacknullstackGC</span></span><br><span class=\"line\">      element.stack = dst;</span><br><span class=\"line\"></span><br><span class=\"line\">      ...............................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueue handle.stack null handle.stack </p>\n<p>GCstackstackstacknullWeakOrderQueueGCstackGC</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p><strong>lazySetwriteIndex</strong></p>\n<p>LinkwriteIndex</p>\n<p></p>\n<p>StackWeakOrderQueueWeakOrderQueu</p>\n<p>writeIndex LOCK <strong>WeakOrderQueue</strong>Netty</p>\n<hr>\n<h2 id=\"\"></h2>\n<p>Recycler</p>\n<p>Recycler<strong>4.1.71.Final</strong>Recycler</p>\n<p>~~</p>\n","excerpt":"","more":"<h1>Recycler</h1>\n<hr>\n<blockquote>\n<p>          bin<br>\nNetty <strong>4.1.56.Final</strong></p>\n</blockquote>\n<h2 id=\"1-\">1. </h2>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p><a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484244%26idx%3D1%26sn%3D831060fc38caa201d69f87305de7f86a%26chksm%3Dce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e%23rd\" title=\"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&amp;mid=2247484244&amp;idx=1&amp;sn=831060fc38caa201d69f87305de7f86a&amp;chksm=ce77c513f9004c05b48f849ff99997d6d7252453135ae856a029137b88aa70b8e046013d596e#rd\">Netty</a>JVMNetty  Netty  JVM  native memory  DirectByteBuffer  native  <code>unsafe.allocateMemory</code>  <code>malloc</code> </p>\n<p></p>\n<ul>\n<li> JVM  DirectByteBuffer  JVM </li>\n<li> <code>malloc</code>  DirectByteBuffer </li>\n</ul>\n<p> Netty  Netty </p>\n<h2 id=\"2-\">2. </h2>\n<p></p>\n<p> Netty  Netty  PooledDirectByteBuf  Netty  IO  PooledDirectByteBuf </p>\n<p> PooledDirectByteBuf </p>\n<p> Netty  Netty  channel </p>\n<p>Netty  Channel  ChannelOutboundBuffer  ChannelOutboundBuffer  Channel  flush  ChannelOutboundBuffer  Socket </p>\n<p> ChannelOutboundBuffer  Entry  Entry  Entry  ChannelOutboundBuffer </p>\n<blockquote>\n<p> ChannelOutboundBuffer  Entry </p>\n</blockquote>\n<p>Netty IO  Entry  IO  JVM  GC  Netty </p>\n<p></p>\n<p></p>\n<hr>\n<p></p>\n<p></p>\n<h2 id=\"3-JVM\">3. JVM</h2>\n<h3 id=\"3-1-\">3.1 </h3>\n<p> Java  new JVM new </p>\n<ol>\n<li> JVM  new  Java </li>\n<li>JVMJVM</li>\n</ol>\n<blockquote>\n<p><a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd\" title=\"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&amp;mid=2247484304&amp;idx=1&amp;sn=54bf0d07e69c5621c145afaece8f50d6&amp;chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\">JVM</a></p>\n</blockquote>\n<ol start=\"3\">\n<li>JVMJVMJVMJVMCAS  + </li>\n<li>JVMJVM-TLABTLABTLABJVM<strong></strong> <code>-XX:+UseTLAB</code>TLAB<code>-XX:-UseTLAB</code>TLAB</li>\n</ol>\n<blockquote>\n<p>TLABNettyRecycler</p>\n</blockquote>\n<ol start=\"5\">\n<li>JVM</li>\n<li>MarkWord<a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247484304%26idx%3D1%26sn%3D54bf0d07e69c5621c145afaece8f50d6%26chksm%3Dce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d%23rd\" title=\"https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&amp;mid=2247484304&amp;idx=1&amp;sn=54bf0d07e69c5621c145afaece8f50d6&amp;chksm=ce77c5d7f9004cc1249a03dfd0fb12b7d75171f1b87acea1fa44bbb11ca374b6f42a66fa274d#rd\">JVM</a></li>\n<li></li>\n</ol>\n<h3 id=\"3-2-\">3.2 </h3>\n<ul>\n<li>JVMJavaGC ROOTS</li>\n<li>GC PAUSESTOP THE WORLD</li>\n</ul>\n<hr>\n<p>IONetty Recycler </p>\n<p> Recycler  Recycler </p>\n<h2 id=\"4-Recycler\">4. Recycler</h2>\n<p>NettyRecycler PooledDirectByteBuf </p>\n<blockquote>\n<p>PooledDirectByteBuf</p>\n</blockquote>\n<p><img src=\"/assets/ec623644e43b4c56bf1110c9cfc74bc8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-1zakfmq.awebp\" alt=\"image.png\"></p>\n<h3 id=\"4-1-PooledDirectByteBuf\">4.1 PooledDirectByteBuf</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PooledDirectByteBuf</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">PooledByteBuf</span>&lt;ByteBuffer&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;PooledDirectByteBuf&gt; RECYCLER = ObjectPool.newPool(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;PooledDirectByteBuf&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> PooledDirectByteBuf <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;PooledDirectByteBuf&gt; handle)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PooledDirectByteBuf</span>(handle, <span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Handle&lt;PooledByteBuf&lt;T&gt;&gt; recyclerHandle;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> PooledDirectByteBuf <span class=\"title function_\">newInstance</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacity)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">PooledDirectByteBuf</span> <span class=\"variable\">buf</span> <span class=\"operator\">=</span> RECYCLER.get();</span><br><span class=\"line\">        buf.reuse(maxCapacity);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buf;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">         <span class=\"comment\">//</span></span><br><span class=\"line\">        recyclerHandle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ..................................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>NettyPooledDirectByteBufPooledDirectByteBuf</p>\n<p>Netty<code>ObjectPool  RECYCLER </code></p>\n<p>PooledDirectByteBuf<code>ObjectPool&lt;T&gt;</code>Netty ObjectPool#newPool  ObjectCreator  ObjectCreatornewObject </p>\n<p>recyclerHandlerecyclerHandlerecyclerHandle</p>\n<p>PooledDirectByteBuf<code>RECYCLER.get()</code>PooledDirectByteBuf</p>\n<p>PooledDirectByteBuf<code>recyclerHandle.recycle(this) </code></p>\n<h3 id=\"4-2-Channel\">4.2 Channel</h3>\n<p>ChannelChannelOutboundBufferchannelwrite</p>\n<p>ChannelChannelOutboundBufferChannelOutboundBufferEntryNettyEntryEntry</p>\n<p>PooledDirectByteBufEntry</p>\n<h4 id=\"\"></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER = ObjectPool.newPool(<span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;Entry&gt;() &#123;</span><br><span class=\"line\">         <span class=\"meta\">@Override</span></span><br><span class=\"line\">         <span class=\"keyword\">public</span> Entry <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">             <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Entry</span>(handle);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//recyclerHandle</span></span><br><span class=\"line\">     <span class=\"keyword\">private</span>  Handle&lt;Entry&gt; handle;</span><br><span class=\"line\">   </span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"title function_\">Entry</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">         <span class=\"built_in\">this</span>.handle = handle;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER </span><br></pre></td></tr></table></figure>\n<p> ObjectCreator </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ObjectCreator</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>ObjectPool#newPool</code> Entry</p>\n<p>HandlerHandlerHandler</p>\n<h4 id=\"\"></h4>\n<p>EntrypublicEntry</p>\n<p> static  newInstance<code>RECYCLER.get()</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> Entry <span class=\"title function_\">newInstance</span><span class=\"params\">(Object msg, <span class=\"type\">int</span> size, <span class=\"type\">long</span> total, ChannelPromise promise)</span> &#123;</span><br><span class=\"line\">      <span class=\"type\">Entry</span> <span class=\"variable\">entry</span> <span class=\"operator\">=</span> RECYCLER.get();</span><br><span class=\"line\">    </span><br><span class=\"line\">      .......................</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> entry;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"></h4>\n<p> recycle </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    bufs = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    buf = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    msg = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    promise = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    progress = <span class=\"number\">0</span>;</span><br><span class=\"line\">    total = <span class=\"number\">0</span>;</span><br><span class=\"line\">    pendingSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">    count = -<span class=\"number\">1</span>;</span><br><span class=\"line\">    cancelled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    handle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li></li>\n<li>Handler</li>\n</ul>\n<hr>\n<p>Netty</p>\n<p></p>\n<h2 id=\"5-Recycler\">5. Recycler</h2>\n<p>Recycler -  - </p>\n<p></p>\n<p></p>\n<p></p>\n<p>Recycler</p>\n<p><img src=\"/assets/d8bdbd9d79814646999637ffc46281cbtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-5lz8huo.awebp\" alt=\"image.png\"></p>\n<h3 id=\"5-1-\">5.1 </h3>\n<p></p>\n<p></p>\n<p> Stack  WeakOrderQueue</p>\n<p>Stack </p>\n<p><strong></strong>StackJVMTLAB,TLAB</p>\n<p>, StackStack</p>\n<p><strong>NettyTLABStackStack</strong></p>\n<blockquote>\n<p><strong></strong>Netty</p>\n</blockquote>\n<h3 id=\"5-2-Stack\">5.2 Stack</h3>\n<p>RecyclerStack</p>\n<ul>\n<li>Stack<strong></strong></li>\n<li>WeakOrderQueuehead WeakOrderQueuecursor prev WeakOrderQueueWeakOrderQueueWeakOrderQueue</li>\n</ul>\n<blockquote>\n<p>WeakOrderQueue</p>\n</blockquote>\n<p><strong>StackWeakOrderQueue</strong></p>\n<p>Recyclerthread1 thread2 , thread3 , thread4</p>\n<blockquote>\n<p>StackWeakOrderQueue</p>\n</blockquote>\n<p><img src=\"/assets/d4522ab88aca42a4b9c2d633301fcac5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-idyvok3.awebp\" alt=\"image.png\"></p>\n<p> thread1 thread1thread1thread1stack1`hread1stack1</p>\n<blockquote>\n<p>Stack</p>\n</blockquote>\n<p>thread1thread2thread3thread2thread3thread1</p>\n<p>thread1thread1stack1stack1<strong>NettyStack</strong></p>\n<p>thread1Stack1thread1Stack1</p>\n<blockquote>\n<p>GCStack</p>\n</blockquote>\n<p><strong>Netty</strong></p>\n<p>thead2 , thread3 WeakOrderQueueWeakOrderQueue</p>\n<blockquote>\n<p>WeakOrderQueueStack</p>\n</blockquote>\n<p><code></code>thread1<code></code>thread2 , thread3 , thead4 </p>\n<p>thread1stack1<strong>WeakOrderQueue</strong>stack1stack1WeakOrderQueueStackheadprevcursorWeakOrderQueue</p>\n<blockquote>\n<p>WeakOrderQueue</p>\n</blockquote>\n<p>thread1Stack1Stack</p>\n<p>Stack cursor StackWeakOrderQueueWeakOrderQueue<strong></strong>WeakOrderQueue</p>\n<blockquote>\n<p>StackStackWeakOrderQueueWeakOrderQueue</p>\n</blockquote>\n<p><strong></strong></p>\n<p><strong></strong></p>\n<p><img src=\"/assets/0566fc7826064b12bb88082b39c10bd2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hkx67f6.awebp\" alt=\"image.png\"></p>\n<h3 id=\"5-3-WeakOrderQueue\">5.3 WeakOrderQueue</h3>\n<p>WeakOrderQueue</p>\n<blockquote>\n<p><strong></strong></p>\n</blockquote>\n<p><img src=\"/assets/63f3b4b63fd14b7a84c33c0840bc41e2tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-7eix1tf.awebp\" alt=\"image.png\"></p>\n<p>WeakOrderQueueWeakOrderQueue</p>\n<p> Head Tail Link </p>\n<p>Link  elements </p>\n<p>LinkreadIndexelementswriteIndexelementselements<code>16</code>Link1616LinkLink</p>\n<p>WeakoOrderQueueStack<strong></strong>WeakOrderQueueLinkHeadHeadLinkStack<strong>Link</strong>16</p>\n<p>LinkStackLinkWeakOrderQueueLinkHeadLink</p>\n<blockquote>\n<p>head<strong>Link</strong>headTail<strong></strong></p>\n</blockquote>\n<p><strong></strong><strong></strong></p>\n<p><strong>Netty</strong> </p>\n<p>WeakOrderQueue<strong></strong></p>\n<blockquote>\n<p><strong></strong></p>\n</blockquote>\n<p> Netty Recycler WeakOrderQueue</p>\n<p>Netty</p>\n<h2 id=\"6-Recycler\">6. Recycler</h2>\n<p>4. RecyclerRecycler</p>\n<ul>\n<li>PooledDirectByteBuf</li>\n<li>ChannelChannelOutboundBuffer</li>\n</ul>\n<p> ObjectPool ObjectPool Netty</p>\n<p></p>\n<h3 id=\"6-1-ObjectPool\">6.1 ObjectPool</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    ObjectPool() &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(T self)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ObjectCreator</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ..................................</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> ObjecPool </p>\n<p>4. Recycler</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PooledDirectByteBuf</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">PooledByteBuf</span>&lt;ByteBuffer&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;PooledDirectByteBuf&gt; RECYCLER</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ObjecPool </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span>;</span><br></pre></td></tr></table></figure>\n<p> Handler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(T self)</span>;</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<p>HandlerHandlerDefaultHandle</p>\n<blockquote>\n<p>StackDefaultHandleWeakOrderQueueLinkelementsDefaultHandle</p>\n</blockquote>\n<p><strong>recycleHandlerObejctPool</strong></p>\n<p>recycle</p>\n<p>4. RecyclerHandlerHandlerrecyclerecycleHandlerrecycle</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            bufs = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            buf = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            msg = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            promise = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            progress = <span class=\"number\">0</span>;</span><br><span class=\"line\">            total = <span class=\"number\">0</span>;</span><br><span class=\"line\">            pendingSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">            count = -<span class=\"number\">1</span>;</span><br><span class=\"line\">            cancelled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            handle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ObjectPool </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ObjectCreator</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>ObjectCreator#newObject</code>Handler</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER = ObjectPool.newPool(<span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;Entry&gt;() &#123;</span><br><span class=\"line\">          <span class=\"meta\">@Override</span></span><br><span class=\"line\">          <span class=\"keyword\">public</span> Entry <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Entry</span>(handle);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Entry</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">Entry</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">          <span class=\"built_in\">this</span>.handle = handle;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"6-1-1-ObjectPool\">6.1.1 ObjectPool</h4>\n<p><img src=\"/assets/948ff8d7b81449269cbedf8928f28e59tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2e3ivzs.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; ObjectPool&lt;T&gt; <span class=\"title function_\">newPool</span><span class=\"params\">(<span class=\"keyword\">final</span> ObjectCreator&lt;T&gt; creator)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RecyclerObjectPool</span>&lt;T&gt;(ObjectUtil.checkNotNull(creator, <span class=\"string\">&quot;creator&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RecyclerObjectPool</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//recycler</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Recycler&lt;T&gt; recycler;</span><br><span class=\"line\"></span><br><span class=\"line\">        RecyclerObjectPool(<span class=\"keyword\">final</span> ObjectCreator&lt;T&gt; creator) &#123;</span><br><span class=\"line\">             recycler = <span class=\"keyword\">new</span> <span class=\"title class_\">Recycler</span>&lt;T&gt;() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">protected</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> creator.newObject(handle);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> recycler.get();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">    .....................................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>ObjectPool#newPool</code>  RecyclerObjectPool <strong> Recycler</strong>  RecyclerObjectPool </p>\n<p>RecyclerObjectCreator </p>\n<h2 id=\"7-Recycler\">7. Recycler</h2>\n<p>Recycler</p>\n<p><img src=\"/assets/f469c168d72b40c6b23accd8ab652a22tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-t5puo5k.awebp\" alt=\"image.png\"></p>\n<h3 id=\"7-1-Id\">7.1 Id</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Id,</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">AtomicInteger</span> <span class=\"variable\">ID_GENERATOR</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(Integer.MIN_VALUE);</span><br><span class=\"line\">    <span class=\"comment\">//Id static final OWN_THREAD_ID</span></span><br><span class=\"line\">    <span class=\"comment\">//Id</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">OWN_THREAD_ID</span> <span class=\"operator\">=</span> ID_GENERATOR.getAndIncrement();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>AtomicInteger ID_GENERATOR</code> : AtomicInteger IdId<strong></strong></li>\n<li><code>int OWN_THREAD_ID</code> Recycler ID_GENERATOR  OWN_THREAD_ID  OWN_THREAD_ID IdOWN_THREAD_ID  static final Recycler OWN_THREAD_ID </li>\n</ul>\n<p>thread1, thread2, thread3Recycler  OWN_THREAD_ID </p>\n<p><img src=\"/assets/34f2d54bc3724e51b0c8ad2695f7de95tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-2cym377.awebp\" alt=\"image.png\"></p>\n<p><strong>Id</strong>Netty<strong></strong>Id</p>\n<p>Id WeakOrderQueue  WeakOrderQueue Id</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Id,weakOrderQueuestackweakOrderQueue</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">id</span> <span class=\"operator\">=</span> ID_GENERATOR.getAndIncrement();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"7-2-\">7.2 </h3>\n<p><img src=\"/assets/233f28fc503e4dcc9c1e1317a89b71d9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-vqp6dd1.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Stack 4096 </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD</span> <span class=\"operator\">=</span> <span class=\"number\">4</span> * <span class=\"number\">1024</span>; <span class=\"comment\">// Use 4k instances as default.</span></span><br><span class=\"line\"><span class=\"comment\">// Stack 4096</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> DEFAULT_MAX_CAPACITY_PER_THREAD;</span><br><span class=\"line\"><span class=\"comment\">//  min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256) 256</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> INITIAL_CAPACITY;</span><br></pre></td></tr></table></figure>\n<p>Recycler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">maxCapacityPerThread</span> <span class=\"operator\">=</span> SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxCapacityPerThread&quot;</span>,</span><br><span class=\"line\">            SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxCapacity&quot;</span>, DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD));</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (maxCapacityPerThread &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        maxCapacityPerThread = DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    DEFAULT_MAX_CAPACITY_PER_THREAD = maxCapacityPerThread;</span><br><span class=\"line\"></span><br><span class=\"line\">    INITIAL_CAPACITY = min(DEFAULT_MAX_CAPACITY_PER_THREAD, <span class=\"number\">256</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD</code>Stack4096JVM <code>-D io.netty.recycler.maxCapacity</code> </li>\n<li><code>DEFAULT_MAX_CAPACITY_PER_THREAD</code>StackJVM <code>-D io.netty.recycler.maxCapacityPerThread</code>  DEFAULT_INITIAL_MAX_CAPACITY_PER_THREAD 4096</li>\n<li><code>INITIAL_CAPACITY </code>: Stack<code>min(DEFAULT_MAX_CAPACITY_PER_THREAD, 256)</code>256256 DEFAULT_MAX_CAPACITY_PER_THREAD</li>\n</ul>\n<h3 id=\"7-3-\">7.3 </h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  2  </span></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> MAX_SHARED_CAPACITY_FACTOR;</span><br><span class=\"line\"> <span class=\"comment\">// cpu * 2</span></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> MAX_DELAYED_QUEUES_PER_THREAD;</span><br><span class=\"line\"> <span class=\"comment\">//WeakOrderQueueLink 16</span></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> LINK_CAPACITY;</span><br></pre></td></tr></table></figure>\n<p>Recycler  Stack </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    MAX_SHARED_CAPACITY_FACTOR = max(<span class=\"number\">2</span>,</span><br><span class=\"line\">            SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxSharedCapacityFactor&quot;</span>,</span><br><span class=\"line\">                    <span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    MAX_DELAYED_QUEUES_PER_THREAD = max(<span class=\"number\">0</span>,</span><br><span class=\"line\">            SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.maxDelayedQueuesPerThread&quot;</span>,</span><br><span class=\"line\">                    <span class=\"comment\">// We use the same value as default EventLoop number</span></span><br><span class=\"line\">                    NettyRuntime.availableProcessors() * <span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    LINK_CAPACITY = safeFindNextPositivePowerOfTwo(</span><br><span class=\"line\">            max(SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.linkCapacity&quot;</span>, <span class=\"number\">16</span>), <span class=\"number\">16</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>MAX_SHARED_CAPACITY_FACTOR</code> :  Stack2JVM <code>-D io.netty.recycler.maxSharedCapacityFactor</code>  <code>max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)</code> 2048 LINK_CAPACITY  16</li>\n<li><code>MAX_DELAYED_QUEUES_PER_THREAD</code> : CPU * 2JVM <code>-D io.netty.recycler.maxDelayedQueuesPerThread</code> <strong></strong></li>\n<li><code>LINK_CAPACITY </code>:   Stack  WeakOrderQueue WeakOrderQueueLinkLink16JVM <code>-D io.netty.recycler.linkCapacity</code> </li>\n</ul>\n<p></p>\n<p><img src=\"/assets/d76e41420e1d44eb82e4b74dc7d4309btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-e21hjq1.awebp\" alt=\"image.png\"></p>\n<h3 id=\"7-4-\">7.4 </h3>\n<p></p>\n<p>Netty</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//81/88</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> RATIO;</span><br><span class=\"line\"><span class=\"comment\">//8 1/8</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> DELAYED_QUEUE_RATIO;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    RATIO = max(<span class=\"number\">0</span>, SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.ratio&quot;</span>, <span class=\"number\">8</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    DELAYED_QUEUE_RATIO = max(<span class=\"number\">0</span>, SystemPropertyUtil.getInt(<span class=\"string\">&quot;io.netty.recycler.delayedQueue.ratio&quot;</span>, RATIO));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Recycler </p>\n<ul>\n<li> RATIO 8JVM <code>-D io.netty.recycler.ratio</code>  1 / 8  8  1</li>\n<li>StackStackWeakOrderQueueWeakOrderQueue<strong></strong>Stack DELAYED_QUEUE_RATIO 8JVM <code>-D io.netty.recycler.delayedQueue.ratio</code>  8  1 </li>\n</ul>\n<h2 id=\"8-Recycler\">8. Recycler</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RecyclerObjectPool</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//recycler</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Recycler&lt;T&gt; recycler;</span><br><span class=\"line\"></span><br><span class=\"line\">    RecyclerObjectPool(<span class=\"keyword\">final</span> ObjectCreator&lt;T&gt; creator) &#123;</span><br><span class=\"line\">         recycler = <span class=\"keyword\">new</span> <span class=\"title class_\">Recycler</span>&lt;T&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">protected</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> creator.newObject(handle);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ..............................</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>Netty  Recycler Recycler newObject </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> T <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;T&gt; handle)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(DEFAULT_MAX_CAPACITY_PER_THREAD);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(maxCapacityPerThread, MAX_SHARED_CAPACITY_FACTOR);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread, <span class=\"type\">int</span> maxSharedCapacityFactor)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread, <span class=\"type\">int</span> maxSharedCapacityFactor,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"type\">int</span> ratio, <span class=\"type\">int</span> maxDelayedQueuesPerThread)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>(maxCapacityPerThread, maxSharedCapacityFactor, ratio, maxDelayedQueuesPerThread,</span><br><span class=\"line\">                DELAYED_QUEUE_RATIO);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxCapacityPerThread;</span><br><span class=\"line\">    <span class=\"comment\">//()</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxSharedCapacityFactor;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> interval;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueuesPerThread;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> delayedQueueInterval;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"title function_\">Recycler</span><span class=\"params\">(<span class=\"type\">int</span> maxCapacityPerThread, <span class=\"type\">int</span> maxSharedCapacityFactor,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"type\">int</span> ratio, <span class=\"type\">int</span> maxDelayedQueuesPerThread, <span class=\"type\">int</span> delayedQueueRatio)</span> &#123;</span><br><span class=\"line\">        interval = max(<span class=\"number\">0</span>, ratio);</span><br><span class=\"line\">        delayedQueueInterval = max(<span class=\"number\">0</span>, delayedQueueRatio);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxCapacityPerThread &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxCapacityPerThread = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxSharedCapacityFactor = <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxDelayedQueuesPerThread = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxCapacityPerThread = maxCapacityPerThread;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxSharedCapacityFactor = max(<span class=\"number\">1</span>, maxSharedCapacityFactor);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxDelayedQueuesPerThread = max(<span class=\"number\">0</span>, maxDelayedQueuesPerThread);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RecyclerRecycler</p>\n<h2 id=\"9-\">9. </h2>\n<p><img src=\"/assets/908c9b12522247dfbd32bada7308cb27tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-r7sakmv.awebp\" alt=\"image.png\"></p>\n<p>NettyNetty TLAB StackStackRecyclerStakc</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//threadlocal stack</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;Stack&lt;T&gt;&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;Stack&lt;T&gt;&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Stack&lt;T&gt; <span class=\"title function_\">initialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;T&gt;(Recycler.<span class=\"built_in\">this</span>, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,</span><br><span class=\"line\">                interval, maxDelayedQueuesPerThread, delayedQueueInterval);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    ........................</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> FastThreadLocal  threadLocal Stack</p>\n<blockquote>\n<p>FastThreadLocalNettyJDKThreadLocalFastThreadLocalJDKThreadLocal</p>\n</blockquote>\n<p>Stack</p>\n<h3 id=\"9-1-Stack\">9.1 Stack</h3>\n<p>Stack5.2 StackStackWeakOrderQueueHeadPrevCursor</p>\n<p>StackStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// stackrecycler</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> Recycler&lt;T&gt; parent;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//stack defaultHandler -&gt; stack -&gt; thread</span></span><br><span class=\"line\">        <span class=\"comment\">// thread</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> WeakReference&lt;Thread&gt; threadRef;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> AtomicInteger availableSharedCapacity;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//Stack</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueues;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//stack 4096</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxCapacity;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> interval;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> delayedQueueInterval;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Stack 2564096</span></span><br><span class=\"line\">        DefaultHandle&lt;?&gt;[] elements;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  interval </span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> handleRecycleCount;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"comment\">//StackWeakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> WeakOrderQueue cursor, prev;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> WeakOrderQueue head;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/ad0a175194af489d9c71f096ac430a03tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-4g64cdf.awebp\" alt=\"image.png\"></p>\n<ul>\n<li><code>Recycler&lt;T&gt; parent</code>StackRecyclerStackStackparentRecycler stack1 , stack2 , stack3 , stack4 parentRecycler</li>\n<li><code>WeakReference&lt;Thread&gt; threadRef </code>Stack<code> -&gt; DefaultHandler -&gt; stack -&gt; threadRef</code>StackGC</li>\n<li><code>AtomicInteger availableSharedCapacity</code>thread2 , thread3 , thread4  thread1 availableSharedCapacity <strong></strong>1 LINK_CAPACITY(WeakOrderQueueLink)stack <code>max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY)</code></li>\n</ul>\n<blockquote>\n<p>StackWeakOrderQueueavailableSharedCapacity </p>\n</blockquote>\n<ul>\n<li><code>int maxDelayedQueues</code>  CPU * 2 thread2  thread1  thread3 , thread4 maxDelayedQueues  3 </li>\n<li><code>int maxCapacity</code>Stack4096</li>\n<li><code>int interval</code>8</li>\n<li><code>int delayedQueueInterval</code>8</li>\n<li><code>DefaultHandle&lt;?&gt;[] elements</code>Stack</li>\n<li><code>int size</code></li>\n<li><code>int handleRecycleCount</code> interval  0  +1 <code>handleRecycleCount == interval</code>81 Stack </li>\n<li><code>WeakOrderQueue cursor, prevhead</code>Stack<strong></strong> WeakOrderQueue </li>\n</ul>\n<p>StackRecyclerStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;Stack&lt;T&gt;&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;Stack&lt;T&gt;&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Stack&lt;T&gt; <span class=\"title function_\">initialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;T&gt;(Recycler.<span class=\"built_in\">this</span>, Thread.currentThread(), maxCapacityPerThread, maxSharedCapacityFactor,</span><br><span class=\"line\">                interval, maxDelayedQueuesPerThread, delayedQueueInterval);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ..........................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stack(Recycler&lt;T&gt; parent, Thread thread, <span class=\"type\">int</span> maxCapacity, <span class=\"type\">int</span> maxSharedCapacityFactor,</span><br><span class=\"line\">       <span class=\"type\">int</span> interval, <span class=\"type\">int</span> maxDelayedQueues, <span class=\"type\">int</span> delayedQueueInterval) &#123;</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.parent = parent;</span><br><span class=\"line\">     threadRef = <span class=\"keyword\">new</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt;(thread);</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.maxCapacity = maxCapacity;</span><br><span class=\"line\">     availableSharedCapacity = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(max(maxCapacity / maxSharedCapacityFactor, LINK_CAPACITY));</span><br><span class=\"line\">     elements = <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultHandle</span>[min(INITIAL_CAPACITY, maxCapacity)];</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.interval = interval;</span><br><span class=\"line\">     <span class=\"built_in\">this</span>.delayedQueueInterval = delayedQueueInterval;</span><br><span class=\"line\">     handleRecycleCount = interval; </span><br><span class=\"line\">     <span class=\"built_in\">this</span>.maxDelayedQueues = maxDelayedQueues;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-2-\">9.2 </h3>\n<p><img src=\"/assets/002bdbd0d71140c3834d44b93555237ftplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ryqzvpj.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\">      <span class=\"comment\">//Handler,</span></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Handle</span> <span class=\"variable\">NOOP_HANDLE</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Handle</span>() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(Object object)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// NOOP</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxCapacityPerThread == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> newObject((Handle&lt;T&gt;) NOOP_HANDLE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// stack</span></span><br><span class=\"line\">        Stack&lt;T&gt; stack = threadLocal.get();</span><br><span class=\"line\">        <span class=\"comment\">//stackpophandler</span></span><br><span class=\"line\">        DefaultHandle&lt;T&gt; handle = stack.pop();</span><br><span class=\"line\">        <span class=\"comment\">//stack </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (handle == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//handlerrecycleIdlastRecyclerId0</span></span><br><span class=\"line\">            handle = stack.newHandle();</span><br><span class=\"line\">            <span class=\"comment\">//newObjectrecycler </span></span><br><span class=\"line\">            handle.value = newObject(handle);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (T) handle.value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>RecyclerStack</p>\n<ol>\n<li><code>maxCapacityPerThread == 0</code>Handler</li>\n<li>threadLocalStackStackDefaultHandler</li>\n<li>DefaultHandlerStackDefaultHandlerDefaultHandlerDefaultHandlerDefaultHandler</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectPool&lt;Entry&gt; RECYCLER = ObjectPool.newPool(<span class=\"keyword\">new</span> <span class=\"title class_\">ObjectCreator</span>&lt;Entry&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> Entry <span class=\"title function_\">newObject</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Entry</span>(handle);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"title function_\">Entry</span><span class=\"params\">(Handle&lt;Entry&gt; handle)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.handle = handle;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-3-DefaultHandler\">9.3 DefaultHandler</h3>\n<p> Handler</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ObjectPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(T self)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Recycler DefaultHandler DefaultHandler </p>\n<p>StackDefaultHandlerStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       DefaultHandle&lt;T&gt; <span class=\"title function_\">newHandle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt;(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> DefaultHandler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">     <span class=\"comment\">//0</span></span><br><span class=\"line\">     <span class=\"type\">int</span> lastRecycledId;</span><br><span class=\"line\">     <span class=\"comment\">//0</span></span><br><span class=\"line\">     <span class=\"type\">int</span> recycleId;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//</span></span><br><span class=\"line\">     <span class=\"type\">boolean</span> hasBeenRecycled;</span><br><span class=\"line\">     <span class=\"comment\">//handlerstack</span></span><br><span class=\"line\">     Stack&lt;?&gt; stack;</span><br><span class=\"line\">     <span class=\"comment\">//</span></span><br><span class=\"line\">     Object value;</span><br><span class=\"line\"></span><br><span class=\"line\">     DefaultHandle(Stack&lt;?&gt; stack) &#123;</span><br><span class=\"line\">         <span class=\"built_in\">this</span>.stack = stack;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"meta\">@Override</span></span><br><span class=\"line\">     <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(Object object)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       ................................</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandler</p>\n<ul>\n<li><code>int lastRecycledId</code>0</li>\n<li><code>int recycleId</code>0</li>\n<li><code>boolean hasBeenRecycled</code>Stack</li>\n</ul>\n<p><strong></strong></p>\n<p></p>\n<ul>\n<li><code></code>Stack<code>recycleId = lastRecycledId = OWN_THREAD_ID</code></li>\n<li><code></code><strong></strong>StackWeakOrderQueue<code>recycleId = 0lastRecycledId = IdWeakOrderQueue#id</code>WeakOrderQueueStack<code>recycleId = lastRecycledId = IdWeakOrderQueue#id</code></li>\n</ul>\n<p> lastRecycledId recycleId </p>\n<p> Object value  Stack&lt;?&gt; stack HandlerStack</p>\n<p>StackStack<code></code><code> -&gt; DefaultHandler -&gt; Stack -&gt; threadRef</code></p>\n<p><img src=\"/assets/d9a984a0659546258734112ce5c687f7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-qzq41qp.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//EntryDefaultHandler</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span>  Handle&lt;Entry&gt; handle;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// DefaultHandlerStack</span></span><br><span class=\"line\">    Stack&lt;?&gt; stack;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Stack</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> WeakReference&lt;Thread&gt; threadRef;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-4-Stack\">9.4 Stack</h3>\n<p><img src=\"/assets/6d2a0769269e405dac3519f9e45d14d7tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-hfn0g3i.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DefaultHandle&lt;T&gt; <span class=\"title function_\">pop</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.size;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//stackstackweakOrderQueuestack</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!scavenge()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        size = <span class=\"built_in\">this</span>.size;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// WeakOrderQueue</span></span><br><span class=\"line\">            <span class=\"comment\">// null </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    size --;</span><br><span class=\"line\">    <span class=\"type\">DefaultHandle</span> <span class=\"variable\">ret</span> <span class=\"operator\">=</span> elements[size];</span><br><span class=\"line\">    elements[size] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.size = size;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ret.lastRecycledId != ret.recycleId) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled multiple times&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//   recycleId = lastRecycleId = 0</span></span><br><span class=\"line\">    ret.recycleId = <span class=\"number\">0</span>;</span><br><span class=\"line\">    ret.lastRecycledId = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Stack</p>\n<ul>\n<li> size == 0  scavenge StackWeakOrderQueueLinkWeakOrderQueueStack null </li>\n<li> DefaultHandler DefaultHandler<code>recycleId  = lastRecycledId = 0</code></li>\n</ul>\n<p>recycleId  lastRecycledId </p>\n<ul>\n<li><code>recycleId  = lastRecycledId = 0</code></li>\n<li><code>recycleId  = lastRecycledId != 0</code>Stack</li>\n<li><code>recycleId  != lastRecycledId</code>WeakOrderQueueStack</li>\n</ul>\n<h3 id=\"9-4-Stack\">9.4 Stack</h3>\n<p><img src=\"/assets/29c7d6a21d76455d9bc5443394172a2btplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-jhifgqp.awebp\" alt=\"image.png\"></p>\n<p>Stack</p>\n<ul>\n<li>Stack</li>\n<li>StackWeakOrderQueueWeakOrderQueue</li>\n</ul>\n<p>StackWeakOrderQueueWeakOrderQueue<strong></strong></p>\n<p> scavenge </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">scavenge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">//weakOrderQueue   stack</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (scavengeSome()) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">// weakOrderQueuestackcursor.prev</span></span><br><span class=\"line\">     <span class=\"comment\">// weakOrderQueuecursor</span></span><br><span class=\"line\">     prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">     cursor = head;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>scavengeSome() WeakOrderQueue true WeakOrderQueuecursorheadprevnullWeakOrderQueuecursor</p>\n<h3 id=\"9-5-\">9.5 </h3>\n<p>StackWeakOrderQueue</p>\n<p>WeakOrderQueueStackWeakOrderQueue</p>\n<p><img src=\"/assets/c7d327afbf054012bd98bb554bfd19a3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-kxpsqug.awebp\" alt=\"image.png\"></p>\n<p>StackWeakOrderQueue prev = head = cursor = null </p>\n<p>WeakOrderQueue<strong>WeakOrderQueue</strong></p>\n<blockquote>\n<p>WeakOrderQueue</p>\n</blockquote>\n<p>headcursorcursorprevcursorprev</p>\n<p>WeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">scavengeSome</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    WeakOrderQueue prev;</span><br><span class=\"line\">    <span class=\"comment\">//stack weakOrderQueue</span></span><br><span class=\"line\">    <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">cursor</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.cursor;</span><br><span class=\"line\">    <span class=\"comment\">//stackcursorprev,headnullcursor == null stackweakOrderQueue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cursor == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        cursor = head;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cursor == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//prevcursor</span></span><br><span class=\"line\">        prev = <span class=\"built_in\">this</span>.prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">success</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueue </span></span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//weakOrderQueuestacklink</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cursor.transfer(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">            success = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//cursorweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">next</span> <span class=\"operator\">=</span> cursor.getNext();</span><br><span class=\"line\">        <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cursor.get() == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cursor.hasFinalData()) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//weakOrderQueueweakOrderQueue</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (cursor.transfer(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">                        success = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//weaoOrderQueueunlinkcursor</span></span><br><span class=\"line\">            <span class=\"comment\">//netty</span></span><br><span class=\"line\">            <span class=\"comment\">// prev == null cursorunlink </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (prev != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//weakOrderQueueGC</span></span><br><span class=\"line\">                cursor.reclaimAllSpaceAndUnlink();</span><br><span class=\"line\">                <span class=\"comment\">//prevcursor</span></span><br><span class=\"line\">                prev.setNext(next);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            prev = cursor;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//prev,cursorweakOrderQueue</span></span><br><span class=\"line\">        cursor = next;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (cursor != <span class=\"literal\">null</span> &amp;&amp; !success);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.prev = prev;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.cursor = cursor;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> success;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>WeakOrderQueuecursorStackWeakOrderQueuecursorheadheadWeakOrderQueueheadheadWeakOrderQueue</li>\n<li>cursorWeakOrderQueueStackLinkWeakOrderQueueWeakOrderQueue</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (cursor.transfer(<span class=\"built_in\">this</span>)) &#123;</span><br><span class=\"line\">    success = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">next</span> <span class=\"operator\">=</span> cursor.getNext();</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>WeakOrderQueueWeakOrderQueue<code></code>,GC<code>cursor.get() == null</code>WeakOrderQueueStack<strong>Link</strong>WeakOrderQueue</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    ............WeakOrderQueue.........</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>WeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC<code>cursor.reclaimAllSpaceAndUnlink()</code>availableSharedCapacityWeakOrderQueue</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (prev != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      cursor.reclaimAllSpaceAndUnlink();</span><br><span class=\"line\">      <span class=\"comment\">//prevcursor</span></span><br><span class=\"line\">      prev.setNext(next);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>NettyWeakOrderQueue<code>prev == null</code>Netty</p>\n</blockquote>\n<p>WeakOrderQueuecursor</p>\n<p></p>\n<p><strong></strong></p>\n<p><img src=\"/assets/359cbfb6d68e450b8f611a9975099c6etplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ol5zynd.awebp\" alt=\"image.png\"></p>\n<p>WeakOrderQueueStackWeakOrderQueue<strong></strong></p>\n<p> thread4 <strong></strong>cursorthread3thread3</p>\n<p> thread5 thread5WeakOrderQueuecursor<code>thread4</code><code>cursor.get() == null</code><code>thread4</code></p>\n<blockquote>\n<p></p>\n</blockquote>\n<p><strong>WeakOrderQueue</strong></p>\n<p>WeakOrderQueueWeakOrderQueueStackWeakOrderQueue</p>\n<p>StackWeakOrderQueue</p>\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//recycler</span></span><br><span class=\"line\"><span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setHead</span><span class=\"params\">(WeakOrderQueue queue)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">    queue.setNext(head);</span><br><span class=\"line\">    head = queue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Recycler</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"10-WeakOrderQueue\">10. WeakOrderQueue</h2>\n<p><img src=\"/assets/53b93ae1d4dc4adeaa4d6104cc9aa7b6tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-onec9un.awebp\" alt=\"image.png\"></p>\n<p>WeakOrderQueueQueueLinkHeadLinkLinkheadLinkTail<code>Link</code></p>\n<h3 id=\"10-1-Link\">10.1 Link</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// linkAtomicInteger writeindex</span></span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Link</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AtomicInteger</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//16</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> DefaultHandle&lt;?&gt;[] elements = <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultHandle</span>[LINK_CAPACITY];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">int</span> readIndex;</span><br><span class=\"line\">            <span class=\"comment\">//weakOrderQueuelink</span></span><br><span class=\"line\">            Link next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueue <code>WeakReference &lt; Thread &gt;</code> , <code></code>WeakOrderQueueGC</p>\n<ul>\n<li><code>DefaultHandle&lt;?&gt;[] elements </code>: LinkLINK_CAPACITY 16DefaultHandle</li>\n<li><code>int readIndex</code>LinkreadIndexreadIndexint</li>\n<li><code>writeIndex</code>LinkAtomicIntegerLinkwriteIndexLinkwriteIndexLinkwriteIndexwriteIndexAtomicInteger</li>\n<li><code>Link next</code>Linknext</li>\n</ul>\n<h3 id=\"10-2-Head\">10.2 Head</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// weakOrderQueuelink</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Head</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// reserveSpaceForLink</span></span><br><span class=\"line\">    <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicInteger availableSharedCapacity;</span><br><span class=\"line\">    <span class=\"comment\">//link</span></span><br><span class=\"line\">    Link link;</span><br><span class=\"line\"></span><br><span class=\"line\">    Head(AtomicInteger availableSharedCapacity) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.availableSharedCapacity = availableSharedCapacity;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">reclaimAllSpaceAndUnlink</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            ....headheadhead....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reclaimSpace</span><span class=\"params\">(<span class=\"type\">int</span> space)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">        availableSharedCapacity.addAndGet(space);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//linkheadhead</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">relink</span><span class=\"params\">(Link link)</span> &#123;</span><br><span class=\"line\">          ...headLink...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    Link <span class=\"title function_\">newLink</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">          ....Link...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//link</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserveSpaceForLink</span><span class=\"params\">(AtomicInteger availableSharedCapacity)</span> &#123;             </span><br><span class=\"line\">          ...Link...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Head</p>\n<ul>\n<li><code>AtomicInteger availableSharedCapacity</code>LinkLINK_CAPACITY LinkLINK_CAPACITY </li>\n<li><code>Link link</code>HeadLink</li>\n</ul>\n<p>Head</p>\n<h3 id=\"10-3-WeakOrderQueue\">10.3 WeakOrderQueue</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//linkheadLinK</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Head head;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> Link tail;</span><br><span class=\"line\">        <span class=\"comment\">//stackstackweakOrderQueuestackweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"comment\">//stackweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> WeakOrderQueue next;</span><br><span class=\"line\">        <span class=\"comment\">//Id,weakOrderQueuestackweakOrderQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">id</span> <span class=\"operator\">=</span> ID_GENERATOR.getAndIncrement();</span><br><span class=\"line\">        <span class=\"comment\">// 8</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> interval;</span><br><span class=\"line\">        <span class=\"comment\">// 1/8</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> handleRecycleCount;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>Head head</code>WeakOrderQueueLink</li>\n<li><code>Link tail</code>Link</li>\n<li><code>WeakOrderQueue next</code>StackStackWeakOrderQueueWeakOrderQueuenextWeakOrderQueue</li>\n<li><code>int id </code>IdStackId</li>\n<li><code>int interval</code> 1 / 8 </li>\n<li><code>int handleRecycleCount</code></li>\n</ul>\n<h3 id=\"10-4-WeakOrderQueue\">10.4 WeakOrderQueue</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//stackGC,stack</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"title function_\">WeakOrderQueue</span><span class=\"params\">(Stack&lt;?&gt; stack, Thread thread)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>(thread);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            tail = <span class=\"keyword\">new</span> <span class=\"title class_\">Link</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor</span></span><br><span class=\"line\">            head = <span class=\"keyword\">new</span> <span class=\"title class_\">Head</span>(stack.availableSharedCapacity);</span><br><span class=\"line\">            head.link = tail;</span><br><span class=\"line\">            interval = stack.delayedQueueInterval;</span><br><span class=\"line\">            handleRecycleCount = interval; </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueue <code>WeakReference&lt;Thread&gt;</code> </p>\n<p>Linkheadtail</p>\n<p>StackWeakOrderQueue</p>\n<p>StackWeakOrderQueue<strong>WeakOrderQueueStack</strong></p>\n<p>WeakOrderQueueWeakOrderQueueStackWeakOrderQueueWeakOrderQueueGC</p>\n<p><strong>StackWeakOrderQueueStackStackGC</strong></p>\n<p>StackWeakOrderQueueWeakOrderQueueStack</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h3 id=\"10-5-WeakOrderQueue\">10.5 WeakOrderQueue</h3>\n<p>WeakOrderQueuetransferWeakOrderQueueStack</p>\n<p>WeakOrderQueueLinkStackLINK_CAPACITYStacktransfertrue</p>\n<p>headLinkLink<strong>Link</strong>Linktransferfalse</p>\n<p>transfer</p>\n<p><img src=\"/assets/25a723e07ab64f0fa5fcdc4eeddf1e0dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-afj8oqs.awebp\" alt=\"image.png\"></p>\n<h4 id=\"10-5-1-\">10.5.1 </h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//weakOrderQueuelink</span></span><br><span class=\"line\"><span class=\"type\">Link</span> <span class=\"variable\">head</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.head.link;</span><br><span class=\"line\"><span class=\"comment\">//null</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (head == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (head.readIndex == LINK_CAPACITY) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//Link</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (head.next == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//link</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    head = head.next;</span><br><span class=\"line\">    <span class=\"comment\">//HeadheadheadLinK</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.head.relink(head);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Link<code>head == null</code> Linkfalse</p>\n<p><code>head.readIndex == LINK_CAPACITY</code> head relink Linkfalse</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Head</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//linkheadhead</span></span><br><span class=\"line\">            <span class=\"keyword\">void</span> <span class=\"title function_\">relink</span><span class=\"params\">(Link link)</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//availableSharedCapacitylinkavailableSharedCapacity</span></span><br><span class=\"line\">                reclaimSpace(LINK_CAPACITY);</span><br><span class=\"line\">                <span class=\"comment\">//headlink</span></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.link = link;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reclaimSpace</span><span class=\"params\">(<span class=\"type\">int</span> space)</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">                availableSharedCapacity.addAndGet(space);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"10-5-2-Stack\">10.5.2 Stack</h4>\n<p>HeadStackStackStack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">srcStart</span> <span class=\"operator\">=</span> head.readIndex;</span><br><span class=\"line\"><span class=\"comment\">//writeIndex</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">srcEnd</span> <span class=\"operator\">=</span> head.get();</span><br><span class=\"line\"><span class=\"comment\">//link</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">srcSize</span> <span class=\"operator\">=</span> srcEnd - srcStart;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (srcSize == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// stack</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">dstSize</span> <span class=\"operator\">=</span> dst.size;</span><br><span class=\"line\"><span class=\"comment\">// weakOrderQueuestackstack = stack + </span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">expectedCapacity</span> <span class=\"operator\">=</span> dstSize + srcSize;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (expectedCapacity &gt; dst.elements.length) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//stackstack stack</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">actualCapacity</span> <span class=\"operator\">=</span> dst.increaseCapacity(expectedCapacity);</span><br><span class=\"line\">    <span class=\"comment\">//Link</span></span><br><span class=\"line\">    <span class=\"comment\">//actualCapacity - dstSizestack</span></span><br><span class=\"line\">    srcEnd = min(srcStart + actualCapacity - dstSize, srcEnd);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>LinkreadIndexwriteIndex  <code>writeIndex - readIndex</code> </p>\n<p>Stack <code>expectedCapacity = stack + </code></p>\n<p>Stack expectedCapacity StackStack <code>min(srcStart + actualCapacity - dstSize, srcEnd)</code> Stack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"title function_\">increaseCapacity</span><span class=\"params\">(<span class=\"type\">int</span> expectedCapacity)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">newCapacity</span> <span class=\"operator\">=</span> elements.length;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">maxCapacity</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.maxCapacity;</span><br><span class=\"line\">            <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                newCapacity &lt;&lt;= <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">while</span> (newCapacity &lt; expectedCapacity &amp;&amp; newCapacity &lt; maxCapacity);</span><br><span class=\"line\">            <span class=\"comment\">//expectedCapacity2</span></span><br><span class=\"line\">            newCapacity = min(newCapacity, maxCapacity);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newCapacity != elements.length) &#123;</span><br><span class=\"line\">                elements = Arrays.copyOf(elements, newCapacity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> newCapacity;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Stack<code>actualCapacity - dstSize = 0</code><code>false</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (srcStart != srcEnd) &#123;</span><br><span class=\"line\">   ............</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// The destination stack is full already.</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>Stack</strong></p>\n<h4 id=\"10-5-3-\">10.5.3 </h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Link</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> DefaultHandle[] srcElems = head.elements;</span><br><span class=\"line\"><span class=\"comment\">//stack</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> DefaultHandle[] dstElems = dst.elements;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">newDstSize</span> <span class=\"operator\">=</span> dstSize;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> srcStart; i &lt; srcEnd; i++) &#123;</span><br><span class=\"line\">    DefaultHandle&lt;?&gt; element = srcElems[i];</span><br><span class=\"line\">    <span class=\"comment\">//recycleId == 0 stack</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (element.recycleId == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//recycleId weakOrderQueue</span></span><br><span class=\"line\">        element.recycleId = element.lastRecycledId;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element.recycleId != element.lastRecycledId) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//    </span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled already&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//Link</span></span><br><span class=\"line\">    srcElems[i] = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueuestack </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dst.dropHandle(element)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Drop the object.</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//defaultHandlerstack(handlerstack)</span></span><br><span class=\"line\">    <span class=\"comment\">//defaultHandlerstacknullstackGC</span></span><br><span class=\"line\">    element.stack = dst;</span><br><span class=\"line\">    <span class=\"comment\">//handlerstack</span></span><br><span class=\"line\">    dstElems[newDstSize ++] = element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>LinkelementsStackelements <code>srcStart  -&gt;  srcEnd </code></p>\n<p> <code>element.recycleId == 0</code> Stack9.3 Stack</p>\n<ul>\n<li><code>recycleId = lastRecycledId = 0</code></li>\n</ul>\n<p>Id <code>element.recycleId = element.lastRecycledId</code>lastRecycledIdWeakOrderQueueId</p>\n<p><code>element.recycleId != element.lastRecycledId</code> </p>\n<p>Stack</p>\n<h4 id=\"10-5-4-\">10.5.4 </h4>\n<p> 1 / 8  8  1 </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">dropHandle</span><span class=\"params\">(DefaultHandle&lt;?&gt; handle)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!handle.hasBeenRecycled) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//handleRecycleCount 8 </span></span><br><span class=\"line\">        <span class=\"comment\">//interval 8</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (handleRecycleCount &lt; interval) &#123;</span><br><span class=\"line\">            handleRecycleCount++;</span><br><span class=\"line\">            <span class=\"comment\">// Drop the object.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        handleRecycleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">//defaultHandlertrue</span></span><br><span class=\"line\">        handle.hasBeenRecycled = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandlerStackStackWeakOrderQueueDefaultHandlerStacknull</p>\n<blockquote>\n<p>Stacknull</p>\n</blockquote>\n<p>Stack</p>\n<p>LinkreadIndexStackLinkHead</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (srcEnd == LINK_CAPACITY &amp;&amp; head.next != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">       <span class=\"comment\">// Add capacity back as the Link is GCed.</span></span><br><span class=\"line\">       <span class=\"comment\">// Linklinkhead</span></span><br><span class=\"line\">       <span class=\"built_in\">this</span>.head.relink(head.next);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//LinkreadIndex</span></span><br><span class=\"line\">   head.readIndex = srcEnd;</span><br><span class=\"line\">   <span class=\"comment\">// return false</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (dst.size == newDstSize) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   dst.size = newDstSize;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n<p>Recycler</p>\n<h2 id=\"11-\">11. </h2>\n<p>DefaultHandlerrecycle</p>\n<p><img src=\"/assets/58038d8ee0344260875993d8636331d5tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lhvub6f.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">private</span>  Handle&lt;Entry&gt; handle;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            bufs = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            buf = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            msg = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            promise = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            progress = <span class=\"number\">0</span>;</span><br><span class=\"line\">            total = <span class=\"number\">0</span>;</span><br><span class=\"line\">            pendingSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">            count = -<span class=\"number\">1</span>;</span><br><span class=\"line\">            cancelled = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            handle.recycle(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DefaultHandle</span>&lt;T&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Handle</span>&lt;T&gt; &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">        ..............................</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//handlerstack</span></span><br><span class=\"line\">        Stack&lt;?&gt; stack;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Object value;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">recycle</span><span class=\"params\">(Object object)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (object != value) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;object does not belong to handle&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            Stack&lt;?&gt; stack = <span class=\"built_in\">this</span>.stack;</span><br><span class=\"line\">            <span class=\"comment\">//handler  recycleId = lastRecycledId = 0</span></span><br><span class=\"line\">            <span class=\"comment\">//recycleId = lastRecycledId = OWN_THREAD_ID</span></span><br><span class=\"line\">            <span class=\"comment\">//lastRecycledId = Id,stack recycleId = lastRecycledId = Id</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (lastRecycledId != recycleId || stack == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled already&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            stack.push(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandler recycle  if </p>\n<ul>\n<li><code>lastRecycledId != recycleId</code>  WeakOrderQueue Stack<strong></strong></li>\n</ul>\n<blockquote>\n<p>9.3 Stack recycleId  lastRecycledId </p>\n</blockquote>\n<ul>\n<li><code>stack == null</code> StackGC</li>\n</ul>\n<h3 id=\"11-1-StackBug\">11.1 StackBug!</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> WeakReference&lt;Thread&gt; threadRef;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">void</span> <span class=\"title function_\">push</span><span class=\"params\">(DefaultHandle&lt;?&gt; item)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Thread</span> <span class=\"variable\">currentThread</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">            <span class=\"comment\">//  weakOrderQueue</span></span><br><span class=\"line\">            <span class=\"comment\">//stack</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (threadRef.get() == currentThread) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//  stack</span></span><br><span class=\"line\">                pushNow(item);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// stackweakOrderQueuecurrentThread</span></span><br><span class=\"line\">                pushLater(item, currentThread);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DefaultHandlerStackStack</p>\n<blockquote>\n<p> ifelseBug</p>\n</blockquote>\n<p><code>threadRef.get() == currentThread)</code> pushNow(item) </p>\n<p> <code>threadRef.get() != currentThread)</code> </p>\n<ol>\n<li>currentThread <code>pushLater(item, currentThread)</code> WeakOrderQueue</li>\n<li>Bug <code>threadRef.get()  == null</code>  else GC<strong></strong>StackGC<strong>Stack</strong>NettyStackWeakOrderQueueWeakOrderQueue</li>\n</ol>\n<p>Bug</p>\n<p><img src=\"/assets/53c6380455754787a12800dbf1e48a06tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-0takv3w.awebp\" alt=\"image.png\"></p>\n<p><strong>Netty</strong></p>\n<p></p>\n<p><img src=\"/assets/f43dc00e2347458c876f15dae66f23d4tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-lapokvs.awebp\" alt=\"image.png\"></p>\n<p>DefaultHandlerDefaultHandlerStack</p>\n<p><img src=\"/assets/c2b0e2f9f93449e7b86ef71e2bac35e9tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8xtfk94.awebp\" alt=\"image.png\"></p>\n<p>GCStackStackStackGC</p>\n<h2 id=\"11-2-PRBug\">11.2 PRBug!</h2>\n<p>Bug</p>\n<p>Netty Issue11864 </p>\n<blockquote>\n<p>Issue11864 : <a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fissues%2F11864\" title=\"https://github.com/netty/netty/issues/11864\">github.com/netty/netty</a></p>\n</blockquote>\n<p> PR11865 Bug</p>\n<blockquote>\n<p>PR : <a href=\"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fpull%2F11865\" title=\"https://github.com/netty/netty/pull/11865\">github.com/netty/netty</a></p>\n</blockquote>\n<p>PR</p>\n<ol>\n<li> <code>threadRef.get()  == null</code>  return </li>\n<li>Stack <code>item.stack = null</code>StackGC</li>\n</ol>\n<p>PR <code>threadRef.get()  == null</code> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">push</span><span class=\"params\">(DefaultHandle&lt;?&gt; item)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Thread</span> <span class=\"variable\">currentThread</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (threadRef.get() == currentThread) &#123;</span><br><span class=\"line\">        pushNow(item);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (threadRef.get() == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// when the thread that belonged to the Stack was died or GC&#x27;ed</span></span><br><span class=\"line\">        <span class=\"comment\">// There is no need to add this item to WeakOrderQueue-linked-list which belonged to the Stack any more</span></span><br><span class=\"line\">        item.stack = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        pushLater(item, currentThread);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"11-3-PR\">11.3 PR</h2>\n<p> PR11865</p>\n<p><img src=\"/assets/84c1132caafa47e1a56f670b0ac349aetplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-czmjytj.awebp\" alt=\"image.png\"></p>\n<p>NettyNetty Recycler RecyclerRecycler<strong></strong><strong>GC</strong>Netty</p>\n<p>commit</p>\n<blockquote>\n<p>commit<a href=\"https://github.com/netty/netty/commit/28b9834612638ffec4948c0c650d04f766f20690\">github.com/netty/netty</a></p>\n</blockquote>\n<p>Recycler<strong>4.1.71.Final</strong>Recycler<strong>4.1.71.Final</strong></p>\n<p><strong>4.1.71.Final</strong>   Issue11864 : <a href=\"https://github.com/netty/netty/issues/11864\">github.com/netty/netty</a> <strong>4.1.71.Final</strong></p>\n<p> chrisvest   PR11996  <strong>4.1.74.Final</strong> Issue11864</p>\n<blockquote>\n<p>PR11996 <a href=\"https://github.com/netty/netty/pull/11996\">github.com/netty/netty</a></p>\n</blockquote>\n<blockquote>\n<p> chrisvest  Neo4j commitorNetty BufferAPI</p>\n</blockquote>\n<p>Bug <strong>4.1.74.Final</strong> </p>\n<ol>\n<li> chrisvest   threadLocal onRemovalLocalPoolpooledHandles  nullLocalPool</li>\n</ol>\n<blockquote>\n<p> LocalPool StackLocalPoolpooledHandlesStack</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;LocalPool&lt;T&gt;&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;LocalPool&lt;T&gt;&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> LocalPool&lt;T&gt; <span class=\"title function_\">initialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LocalPool</span>&lt;T&gt;(maxCapacityPerThread, interval, chunkSize);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onRemoval</span><span class=\"params\">(LocalPool&lt;T&gt; value)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"comment\">//LocalPool</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>.onRemoval(value);</span><br><span class=\"line\">            MessagePassingQueue&lt;DefaultHandle&lt;T&gt;&gt; handles = value.pooledHandles;</span><br><span class=\"line\">            <span class=\"comment\">//pooledHandles  null</span></span><br><span class=\"line\">            value.pooledHandles = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"comment\">//LocalPool</span></span><br><span class=\"line\">            handles.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>LocalPoolpooledHandles</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LocalPool</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> MessagePassingQueue&lt;DefaultHandle&lt;T&gt;&gt; pooledHandles;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">void</span> <span class=\"title function_\">release</span><span class=\"params\">(DefaultHandle&lt;T&gt; handle)</span> &#123;</span><br><span class=\"line\">            MessagePassingQueue&lt;DefaultHandle&lt;T&gt;&gt; handles = pooledHandles;</span><br><span class=\"line\">            handle.toAvailable();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (handles != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                handles.relaxedOffer(handle);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  GC LocalPoolStackLocalPool</p>\n<p>Bug</p>\n<h3 id=\"11-4-\">11.4 </h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">pushNow</span><span class=\"params\">(DefaultHandle&lt;?&gt; item)</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">// recycleId = lastRecycleId = 0</span></span><br><span class=\"line\">     <span class=\"comment\">//0 </span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> ((item.recycleId | item.lastRecycledId) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;recycled already&quot;</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//recycleIdlastRecycleIdId-OWN_THREAD_ID</span></span><br><span class=\"line\">     <span class=\"comment\">//OWN_THREAD_ID</span></span><br><span class=\"line\">     <span class=\"comment\">// OWN_THREAD_IDId</span></span><br><span class=\"line\">     item.recycleId = item.lastRecycledId = OWN_THREAD_ID;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.size;</span><br><span class=\"line\">     <span class=\"comment\">// </span></span><br><span class=\"line\">     <span class=\"comment\">//1/8</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (size &gt;= maxCapacity || dropHandle(item)) &#123;</span><br><span class=\"line\">         <span class=\"comment\">// Hit the maximum capacity or should drop - drop the possibly youngest object.</span></span><br><span class=\"line\">         <span class=\"comment\">//</span></span><br><span class=\"line\">         <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//stackstack</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (size == elements.length) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//</span></span><br><span class=\"line\">         elements = Arrays.copyOf(elements, min(size &lt;&lt; <span class=\"number\">1</span>, maxCapacity));</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"comment\">//stack</span></span><br><span class=\"line\">     elements[size] = item;</span><br><span class=\"line\">     <span class=\"comment\">//stack</span></span><br><span class=\"line\">     <span class=\"built_in\">this</span>.size = size + <span class=\"number\">1</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>item.recycleId | item.lastRecycledId) != 0</code>Id0</li>\n<li>Id<code>item.recycleId = item.lastRecycledId = OWN_THREAD_ID</code></li>\n<li>Stack</li>\n<li> 1 / 8  dropHandle </li>\n<li>Stackstack</li>\n<li>Stack</li>\n</ul>\n<h3 id=\"11-5-\">11.5 </h3>\n<p><img src=\"/assets/e87ee465af764c47866e1f69a22d065atplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-ms062uc.awebp\" alt=\"image.png\"></p>\n<p>Recycler</p>\n<p> thread2 , thread3 , thread4   Stackthread1</p>\n<p>  thread2 , thread3 , thread4  thread1thread1thread1StackWeakOrderQueue thread2 , thread3 , thread4   </p>\n<p>Recycler maxDelayedQueuesPerThread </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// cpu * 2</span></span><br><span class=\"line\">      <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> MAX_DELAYED_QUEUES_PER_THREAD;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//</span></span><br><span class=\"line\">      <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueuesPerThread;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> maxDelayedQueues;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Recycler maxDelayedQueuesPerThread </p>\n<p><strong></strong></p>\n<p><img src=\"/assets/ec983e41a4b54a31a1f7f7c9ec511974tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-8ibqfew.awebp\" alt=\"image.png\"></p>\n<p> FastThreadLocal  DELAYED_RECYCLED  DELAYED_RECYCLED  WeakHashMap WeakHashMap </p>\n<p>WeakHashMap  key  Stack value StackWeakOrderQueue Recycler.png </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recycler</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">//key: stack  value:  weakOrderQueue</span></span><br><span class=\"line\">    <span class=\"comment\">//value stackweakOrderQueue</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> FastThreadLocal&lt;Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt;&gt; DELAYED_RECYCLED =</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">FastThreadLocal</span>&lt;Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt;&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt; initialValue() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeakHashMap</span>&lt;Stack&lt;?&gt;, WeakOrderQueue&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakHashMap sizesize maxDelayedQueuesPerThread </p>\n<p><strong>WeakHashMap</strong>?</p>\n<p>GCStackStackStackGCStackWeakHashMapEntryWeakHashMapStack</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">pushLater</span><span class=\"params\">(DefaultHandle&lt;?&gt; item, Thread thread)</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">//maxDelayQueues == 0 </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (maxDelayedQueues == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">      <span class=\"comment\">//</span></span><br><span class=\"line\">      Map&lt;Stack&lt;?&gt;, WeakOrderQueue&gt; delayedRecycled = DELAYED_RECYCLED.get();</span><br><span class=\"line\">      <span class=\"comment\">//stack    </span></span><br><span class=\"line\">      <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">queue</span> <span class=\"operator\">=</span> delayedRecycled.get(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">      <span class=\"comment\">//queue == null stack</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (queue == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//maxDelayedQueues</span></span><br><span class=\"line\">          <span class=\"comment\">//delayedRecycled.size()</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (delayedRecycled.size() &gt;= maxDelayedQueues) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">              <span class=\"comment\">//WeakOrderQueue</span></span><br><span class=\"line\">              <span class=\"comment\">//WeakOrderQueue.DUMMY  </span></span><br><span class=\"line\">              delayedRecycled.put(<span class=\"built_in\">this</span>, WeakOrderQueue.DUMMY);</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">          <span class=\"comment\">// WeakOrderQueue</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ((queue = newWeakOrderQueue(thread)) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// </span></span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">//threadLocal stack  weakOrderQueue</span></span><br><span class=\"line\">          delayedRecycled.put(<span class=\"built_in\">this</span>, queue);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (queue == WeakOrderQueue.DUMMY) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// drop object</span></span><br><span class=\"line\">          <span class=\"comment\">// queueWeakOrderQueue.DUMMY  </span></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  weakOrderQueue</span></span><br><span class=\"line\">      queue.add(item);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>Recycler <code>maxDelayedQueues == 0</code> </li>\n<li>StackWeakOrderQueue<strong></strong> maxDelayedQueues </li>\n<li> maxDelayedQueues  WeakHashMap  WeakOrderQueue DUMMY WeakOrderQueue  DUMMY </li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">//DUMMY</span></span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">DUMMY</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeakOrderQueue</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li> maxDelayedQueues  <code>stack#newWeakOrderQueue</code> StackWeakOrderQueueWeakHashMapStackWeakOrderQueue</li>\n<li>StackWeakOrderQueue</li>\n</ol>\n<h3 id=\"11-6-WeakOrderQueue\">11.6  WeakOrderQueue</h3>\n<p>StackWeakOrderQueueWeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">private</span> WeakOrderQueue <span class=\"title function_\">newWeakOrderQueue</span><span class=\"params\">(Thread thread)</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> WeakOrderQueue.newQueue(<span class=\"built_in\">this</span>, thread);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/13ba4ffef43045ba8ed42101aefd3d72tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-i9veirg.awebp\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeakOrderQueue</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;Thread&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">static</span> WeakOrderQueue <span class=\"title function_\">newQueue</span><span class=\"params\">(Stack&lt;?&gt; stack, Thread thread)</span> &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">            <span class=\"comment\">// linkweakOrderQueueLink</span></span><br><span class=\"line\">            <span class=\"comment\">// stackavailableSharedCapacity  LINK_CAPACITY</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!Head.reserveSpaceForLink(stack.availableSharedCapacity)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//linkweakOrderQueue</span></span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"type\">WeakOrderQueue</span> <span class=\"variable\">queue</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeakOrderQueue</span>(stack, thread);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// stackweakOrderQueueweakOrderQueue </span></span><br><span class=\"line\">            <span class=\"comment\">// stackweakOrderQueueWeakOrderQueueWeakOrderQueue.this</span></span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            stack.setHead(queue);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> queue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueueWeakOrderQueueLinkWeakOrderQueueLink</p>\n<p>WeakOrderQueueLinkLink</p>\n<p>availableSharedCapacity LinkLINK_CAPACITY LinkLINK_CAPACITY  availableSharedCapacity </p>\n<p>WeakOrderQueueLink<strong></strong> availableSharedCapacity LinkWeakOrderQueue</p>\n<p>availableSharedCapacityLinkWeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//link</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserveSpaceForLink</span><span class=\"params\">(AtomicInteger availableSharedCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//stackstack</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">available</span> <span class=\"operator\">=</span> availableSharedCapacity.get();</span><br><span class=\"line\">        <span class=\"comment\">//availbaleLinkstack</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (available &lt; LINK_CAPACITY) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//LinkLinkavailableSharedCapacity</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> availableSharedCapacity  LINK_CAPACITY  availableSharedCapacity </p>\n<p>WeakOrderQueueLinkWeakOrderQueue</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//stackGC,stack</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"title function_\">WeakOrderQueue</span><span class=\"params\">(Stack&lt;?&gt; stack, Thread thread)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">    <span class=\"built_in\">super</span>(thread);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    tail = <span class=\"keyword\">new</span> <span class=\"title class_\">Link</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//   availableSharedCapacity = maxCapacity / maxSharedCapacityFactor</span></span><br><span class=\"line\">    <span class=\"comment\">// availableSharedCapacitylink</span></span><br><span class=\"line\">    head = <span class=\"keyword\">new</span> <span class=\"title class_\">Head</span>(stack.availableSharedCapacity);</span><br><span class=\"line\">    head.link = tail;</span><br><span class=\"line\">    interval = stack.delayedQueueInterval;</span><br><span class=\"line\">    handleRecycleCount = interval; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueueStackWeakOrderQueueWeakOrderQueueStackWeakOrderQueueRecycler </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setHead</span><span class=\"params\">(WeakOrderQueue queue)</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">//weakOrderQueuequeue</span></span><br><span class=\"line\">     queue.setNext(head);</span><br><span class=\"line\">     head = queue;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/assets/523b778404c140a29621295d079be9f8tplv-k3u1fbpfcp-zoom-in-crop-mark1512000-20231005102344-nuriy5k.awebp\" alt=\"image.png\"></p>\n<h3 id=\"11-7-WeakOrderQueue\">11.7 WeakOrderQueue</h3>\n<p></p>\n<p>WeakOrderQueueNettyLinkLinkLink</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(DefaultHandle&lt;?&gt; handle)</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">//handlerlastRecycledIdweakOrderQueueId,stackweakOrderQueue</span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      handle.lastRecycledId = id;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  1/8</span></span><br><span class=\"line\">      <span class=\"comment\">// scavengeSomeweakOrderQueuestackNetty</span></span><br><span class=\"line\">      <span class=\"comment\">// netty weakOrderQueue</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (handleRecycleCount &lt; interval) &#123;</span><br><span class=\"line\">          handleRecycleCount++;</span><br><span class=\"line\">          <span class=\"comment\">// Drop the item to prevent recycling to aggressive.</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      handleRecycleCount = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//link</span></span><br><span class=\"line\">      <span class=\"type\">Link</span> <span class=\"variable\">tail</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.tail;</span><br><span class=\"line\">      <span class=\"type\">int</span> writeIndex;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//linklink</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ((writeIndex = tail.get()) == LINK_CAPACITY) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//Link</span></span><br><span class=\"line\">          <span class=\"type\">Link</span> <span class=\"variable\">link</span> <span class=\"operator\">=</span> head.newLink();</span><br><span class=\"line\">          <span class=\"comment\">//availableSharedCapacityLink</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (link == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// </span></span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">// We allocate a Link so reserve the space</span></span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">          <span class=\"built_in\">this</span>.tail = tail = tail.next = link;</span><br><span class=\"line\"></span><br><span class=\"line\">          writeIndex = tail.get();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//handlerlink</span></span><br><span class=\"line\">      tail.elements[writeIndex] = handle;</span><br><span class=\"line\">      <span class=\"comment\">//stacknullstack</span></span><br><span class=\"line\">      <span class=\"comment\">//StackGChandlestackGC</span></span><br><span class=\"line\">      <span class=\"comment\">//stack</span></span><br><span class=\"line\">      handle.stack = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"comment\">//lazySetwriteIndexwriteIndex</span></span><br><span class=\"line\">      <span class=\"comment\">// Netty</span></span><br><span class=\"line\">      <span class=\"comment\">//scavengeSomeweakOrderQueueweakOrderQueue</span></span><br><span class=\"line\">      <span class=\"comment\">//weakOrderQueue</span></span><br><span class=\"line\">      tail.lazySet(writeIndex + <span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>DefaultHandlerlastRecycledId IdDefaultHandler <code>recycleId != lastRecycledId </code></li>\n<li> 1 / 8 9.5  <code>stack#scavengeSome</code> StackWeakOrderQueue 1 / 8 <strong></strong>nettyweakOrderQueue</li>\n<li>WeakOrderQueueLinkLink <code>writeIndex = tail.get()) == LINK_CAPACITY</code> LinktailLink availableSharedCapacity Link</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Head</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">         Link <span class=\"title function_\">newLink</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">              <span class=\"comment\">//availableSharedCapacityavailableSharedCapacity</span></span><br><span class=\"line\">              <span class=\"comment\">//availableSharedCapacity</span></span><br><span class=\"line\">              <span class=\"keyword\">return</span> reserveSpaceForLink(availableSharedCapacity) ? <span class=\"keyword\">new</span> <span class=\"title class_\">Link</span>() : <span class=\"literal\">null</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//link</span></span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserveSpaceForLink</span><span class=\"params\">(AtomicInteger availableSharedCapacity)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//stackstack</span></span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">available</span> <span class=\"operator\">=</span> availableSharedCapacity.get();</span><br><span class=\"line\">                <span class=\"comment\">//availbaleLinkstack</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (available &lt; LINK_CAPACITY) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//LinkLinkavailableSharedCapacity</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (availableSharedCapacity.compareAndSet(available, available - LINK_CAPACITY)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Recycler<strong></strong></p>\n<p></p>\n<p><strong>handle.stacknull</strong>?</p>\n<p> <code>stack#scavengeSome</code> WeakOrderQueuestackDefaultHandlerstackstack</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"title function_\">transfer</span><span class=\"params\">(Stack&lt;?&gt; dst)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      ...............................</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//defaultHandlerstack(handlerstack)</span></span><br><span class=\"line\">      <span class=\"comment\">//defaultHandlerstacknullstackGC</span></span><br><span class=\"line\">      element.stack = dst;</span><br><span class=\"line\"></span><br><span class=\"line\">      ...............................</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>WeakOrderQueue handle.stack null handle.stack </p>\n<p>GCstackstackstacknullWeakOrderQueueGCstackGC</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p><strong>lazySetwriteIndex</strong></p>\n<p>LinkwriteIndex</p>\n<p></p>\n<p>StackWeakOrderQueueWeakOrderQueu</p>\n<p>writeIndex LOCK <strong>WeakOrderQueue</strong>Netty</p>\n<hr>\n<h2 id=\"\"></h2>\n<p>Recycler</p>\n<p>Recycler<strong>4.1.71.Final</strong>Recycler</p>\n<p>~~</p>\n"}],"PostAsset":[{"_id":"source/_posts/java/Base/JavaStream.md","post":"cm9s3f3yo0001bfg4gji44ji6","slug":"JavaStream.md","modified":1,"renderable":1},{"_id":"source/_posts/java/Base/ThreadLocal.md","post":"cm9s3f3yo0001bfg4gji44ji6","slug":"ThreadLocal.md","modified":1,"renderable":1},{"_id":"source/_posts/java/Base/Volatile.md","post":"cm9s3f3yo0001bfg4gji44ji6","slug":"Volatile.md","modified":1,"renderable":1},{"_id":"source/_posts/java/Collection/List.md","post":"cm9s3f3yv0005bfg49hwx0b2y","slug":"List.md","modified":1,"renderable":1},{"_id":"source/_posts/java/Collection/Map.md","post":"cm9s3f3yv0005bfg49hwx0b2y","slug":"Map.md","modified":1,"renderable":1},{"_id":"source/_posts/java/Collection/Queue.md","post":"cm9s3f3yv0005bfg49hwx0b2y","slug":"Queue.md","modified":1,"renderable":1},{"_id":"source/_posts/java/Collection/Set.md","post":"cm9s3f3yv0005bfg49hwx0b2y","slug":"Set.md","modified":1,"renderable":1},{"_id":"source/_posts/java/JVM/Java.md","post":"cm9s3f3yv0006bfg45rn42dzz","slug":"Java.md","modified":1,"renderable":1},{"_id":"source/_posts/java/JVM/.md","post":"cm9s3f3yv0006bfg45rn42dzz","slug":".md","modified":1,"renderable":1},{"_id":"source/_posts/java/JVM/.md","post":"cm9s3f3yv0006bfg45rn42dzz","slug":".md","modified":1,"renderable":1},{"_id":"source/_posts/java/JVM/.md","post":"cm9s3f3yv0006bfg45rn42dzz","slug":".md","modified":1,"renderable":1},{"_id":"source/_posts/java/JavaWeb/Filter.md","post":"cm9s3f3yx0007bfg47uroaeyi","slug":"Filter.md","modified":1,"renderable":1},{"_id":"source/_posts/java/thread/.md","post":"cm9s3f3yx0008bfg4d2n5e8hf","slug":".md","modified":1,"renderable":1},{"_id":"source/_posts/java/thread/.md","post":"cm9s3f3yx0008bfg4d2n5e8hf","slug":".md","modified":1,"renderable":1},{"_id":"source/_posts/java/thread/.md","post":"cm9s3f3yx0008bfg4d2n5e8hf","slug":".md","modified":1,"renderable":1},{"_id":"source/_posts/java/thread/.md","post":"cm9s3f3yx0008bfg4d2n5e8hf","slug":".md","modified":1,"renderable":1}],"PostCategory":[{"post_id":"cma56nfvk0000isjj1wo3gapa","category_id":"cma56nfvo0002isjj047r393u","_id":"cma56nfvv000aisjja2jb480r"},{"post_id":"cma56nfvn0001isjj99f3c6ak","category_id":"cma56nfvu0007isjjehho4osz","_id":"cma56nfvx000fisjj67wlclyy"},{"post_id":"cma56nfvs0004isjj2ege7b7j","category_id":"cma56nfvv000bisjj7bkx50ac","_id":"cma56nfvy000jisjj8ovu6gub"},{"post_id":"cma56nfvs0005isjj2cea5i9y","category_id":"cma56nfvx000gisjj2yvi3urh","_id":"cma56nfvz000oisjjhpmk52xo"},{"post_id":"cma56nfvt0006isjjfwyu6rwf","category_id":"cma56nfvy000kisjj25czg1g4","_id":"cma56nfw0000risjjfp3s5v53"},{"post_id":"cma56nfvu0009isjjedzadazh","category_id":"cma56nfvz000pisjj1sdd2g4z","_id":"cma56nfw0000wisjjdawu039e"},{"post_id":"cma56nfvx000iisjja19xesyn","category_id":"cma56nfw0000sisjj95c85bq1","_id":"cma56nfw1000zisjjbyx4a5hu"}],"PostTag":[{"post_id":"cma56nfvk0000isjj1wo3gapa","tag_id":"cma56nfvr0003isjj5rd06rxm","_id":"cma56nfvw000disjj7qsy2gry"},{"post_id":"cma56nfvk0000isjj1wo3gapa","tag_id":"cma56nfvu0008isjje443g871","_id":"cma56nfvx000eisjj8rjtbtkx"},{"post_id":"cma56nfvn0001isjj99f3c6ak","tag_id":"cma56nfvv000cisjjgehcdcfz","_id":"cma56nfvz000misjj8mng6e54"},{"post_id":"cma56nfvn0001isjj99f3c6ak","tag_id":"cma56nfvx000hisjj9olk93bm","_id":"cma56nfvz000nisjjcdgoaw6e"},{"post_id":"cma56nfvs0004isjj2ege7b7j","tag_id":"cma56nfvy000lisjj5a7e9qy4","_id":"cma56nfw0000uisjjbg1j4dr1"},{"post_id":"cma56nfvs0004isjj2ege7b7j","tag_id":"cma56nfvz000qisjj0awnesx3","_id":"cma56nfw0000visjj123jg1sk"},{"post_id":"cma56nfvs0005isjj2cea5i9y","tag_id":"cma56nfw0000tisjj178sduy9","_id":"cma56nfw1000yisjj5w0kh9fn"},{"post_id":"cma56nfvt0006isjjfwyu6rwf","tag_id":"cma56nfw0000xisjjflesd0lq","_id":"cma56nfw10012isjjfmc5f3ax"},{"post_id":"cma56nfvt0006isjjfwyu6rwf","tag_id":"cma56nfw10010isjj0pbcbclr","_id":"cma56nfw10013isjje8an94gu"},{"post_id":"cma56nfvu0009isjjedzadazh","tag_id":"cma56nfw10011isjjgm0tdnuf","_id":"cma56nfw10015isjjdmno9np4"},{"post_id":"cma56nfvx000iisjja19xesyn","tag_id":"cma56nfw10014isjjgiceaoet","_id":"cma56nfw20017isjjat8rhad4"},{"post_id":"cma56nfvx000iisjja19xesyn","tag_id":"cma56nfw10016isjj6p3u1muh","_id":"cma56nfw20018isjjg9gy51sc"}],"Tag":[{"name":"WSL","_id":"cma56nfvr0003isjj5rd06rxm"},{"name":"Kali","_id":"cma56nfvu0008isjje443g871"},{"name":"logback","_id":"cma56nfvv000cisjjgehcdcfz"},{"name":"log","_id":"cma56nfvx000hisjj9olk93bm"},{"name":"Redis","_id":"cma56nfvy000lisjj5a7e9qy4"},{"name":"Linux","_id":"cma56nfvz000qisjj0awnesx3"},{"name":"Javascript","_id":"cma56nfw0000tisjj178sduy9"},{"name":"K3S","_id":"cma56nfw0000xisjjflesd0lq"},{"name":"EMQX","_id":"cma56nfw10010isjj0pbcbclr"},{"name":"Consul","_id":"cma56nfw10011isjjgm0tdnuf"},{"name":"Recycler","_id":"cma56nfw10014isjjgiceaoet"},{"name":"Netty","_id":"cma56nfw10016isjj6p3u1muh"}]}}